column dt new_value vdt
column db new_value vdb
select to_char(sysdate,'yyyymmdd_hh24miss') dt, sys_context('userenv','db_name') db from dual;
set serveroutput on size unlimited
execute dbms_application_info.set_action('APLICANDO DATAFIX');
select to_char(sysdate,'yyyy-mm-dd hh:mi:ss p.m.') fecha_inicio from dual;

DECLARE
  CURSOR cuDatos IS
    SELECT a.package_id,
           a.product_id,
           a.subscription_id,
           o.order_id,
           o.created_date,
           o.order_status_id,
           o.operating_unit_id
      FROM open.or_order_activity a, open.or_order o
     WHERE a.order_id IN (300427182, 302272588, 303686906, 298973018, 300425786, 302269560, 298973017, 298973020, 307300513, 300425785,
                          300425832, 308596872, 308597033, 310406997, 310406996, 310406992, 310408594, 310408596, 310408599, 310408600, 310408601, 310408603,
                          310408604, 305416811, 308596871, 289745737, 289745740, 303685864, 303685870, 303685868, 303685863, 303685865, 303685871, 303685885,
                          307298396, 307298394, 307298401, 307298391, 307298392, 308596876, 308597032, 308597134, 298973019, 302269566, 302269565, 298973012, 
                          298973016, 302269557, 302269605, 302269654, 302269558, 305414746, 305414757, 305414750, 305414753, 305414754, 305414773, 305414748,
                          305414747, 305414749, 305414745, 308598539, 308598544, 307300511, 307300512, 309163295, 309163302, 305416802, 305416803, 305416804,
                          305416806, 305416807, 305416808, 305416809, 305416810, 300427189, 300427191, 300427192, 300427195, 300427197, 300427199, 300427200,
                          279079865, 279923430, 302272591, 302272593, 298978672, 303942394, 305416805, 305416819, 302272638, 303686982, 303942421, 298975302,
                          298977247, 298976761, 298979511, 298975324, 298978577, 308611945, 308614758, 308614732, 308611406, 308598701, 308598871, 308604124,
                          308606278, 308609940, 308616810, 308619961, 308610830, 308613452, 308624281, 308633079, 308633669, 308633780, 308840831, 308847647, 
                          308846309, 308607666, 308608987, 308610164, 308608097, 308607359, 308598786, 308599201, 308603412, 308604649, 308608407, 308610497,
                          308598406, 308598657, 308598779, 308598875, 308602232, 308604893, 308598477, 308598721, 308598792, 308607586, 308604671, 308606835,
                          308616582, 308621862, 308632991, 308633104, 308633981, 308842539, 308617929, 308620544, 308620717, 308618607, 308620667, 308598664,
                          308598791, 308601033, 308603550, 308621264, 308610466, 308613158, 308615266, 308627102, 308632775, 308632876, 308632909, 308625169,
                          308626890, 308630246, 308631348, 308632506, 308632821, 308632332, 308632667, 308625596, 308631619, 308632528, 308625209, 308626823,
                          308632960, 308633419, 308631284, 308632478, 308629249, 308630345, 308631260, 308631298, 308632808, 308633051, 308633759, 308633837,
                          308633218, 308633858, 308632989, 308634091, 308634512, 308633876, 308633622, 308633701, 308634088, 308598601, 308598697, 308598795, 
                          308605187, 308606198, 308841124, 308840751, 308841355, 309163477, 309163479, 309163486, 309163488, 309163490, 309163500, 309163505,
                          309163512, 309163514, 309163532, 309163540, 309163543, 309163544, 309163547, 308598844, 308598846, 308598879, 308629007, 308846841,
                          308847140, 308847847, 309163320, 309163368, 309163392, 309163401, 309163408, 308598661, 308599866, 308634163, 308634503, 308634520,
                          308625764, 308632188, 308632770, 308634427, 308634556, 308634673, 308843289, 312262779, 312262783, 312263230)
       and a.order_id = o.order_id
	   and order_status_id = 8
     order by package_id;

  sbOrderCommen varchar2(4000) := 'Se cambia estado a anulado por caso SOSF-2184';
  nuCommentType number := 1277;
  nuErrorCode   number;
  sbErrorMesse  varchar2(4000);
BEGIN

	dbms_output.put_line('Inicia OSF-2202');

	FOR reg IN cudatos LOOP
		BEGIN
			dbms_output.put_line('Orden: ' || reg.order_id);
		  
			api_anullorder(reg.order_id,
						   nuCommentType,
						   sbOrderCommen,
						   nuErrorCode,
						   sbErrorMesse
						  );
		  
			IF (nuErrorCode = 0) THEN
				COMMIT;
				dbms_output.put_line('Se anulo OK orden: ' || reg.order_id);
			ELSE
				ROLLBACK;
				dbms_output.put_line('Error anulando orden: ' || reg.order_id || ' : ' || sbErrorMesse);
			END IF;
		
		EXCEPTION
			WHEN OTHERS THEN
			dbms_output.put_line('Error OTHERS anulando orden: ' || reg.order_id || ' : ' || sqlerrm);
			ROLLBACK;
		END;
	  END LOOP;
  
	dbms_output.put_line('Inicia OSF-2202');
  
END;
/

select to_char(sysdate,'yyyy-mm-dd hh:mi:ss p.m.') fecha_fin from dual;
set serveroutput off
quit
/