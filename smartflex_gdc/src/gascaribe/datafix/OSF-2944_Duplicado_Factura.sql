column dt new_value vdt
column db new_value vdb
select to_char(sysdate,'yyyymmdd_hh24miss') dt, sys_context('userenv','db_name') db from dual;
set serveroutput on size unlimited
execute dbms_application_info.set_action('APLICANDO DATAFIX');
select to_char(sysdate,'yyyy-mm-dd hh:mi:ss p.m.') fecha_inicio from dual;

DECLARE
    sbFactura CLOB;
BEGIN
    dbms_output.put_line('Inicia OSF-2944');

      sbFactura := '<LDC_FACTURA>
<LDC_DATOS_CLIENTE><FACTURA>2050501528</FACTURA><FECH_FACT>21/MAR/2019</FECH_FACT><MES_FACT>MAR-2019</MES_FACT><PERIODO_FACT>MARZO      2019</PERIODO_FACT><PAGO_HASTA>INMEDIATO</PAGO_HASTA><DIAS_CONSUMO>30</DIAS_CONSUMO><CONTRATO>2163147</CONTRATO><CUPON>157459076</CUPON><NOMBRE>SERRADEL DOLORES AGUILAR DE</NOMBRE><DIRECCION_COBRO>CL 20 KR 3 - 85 PH _</DIRECCION_COBRO><LOCALIDAD>SANTA MARTA (MAG) - MAG</LOCALIDAD><CATEGORIA>RESIDENCIAL</CATEGORIA><ESTRATO>ESTRATO 4</ESTRATO><CICLO>4502</CICLO><RUTA>45027601100148800</RUTA><MESES_DEUDA>2</MESES_DEUDA><NUM_CONTROL>2956468528</NUM_CONTROL><PERIODO_CONSUMO>14/FEB - 15/MAR</PERIODO_CONSUMO><SALDO_FAVOR>0</SALDO_FAVOR><FECHA_SUSPENSION>06/04/2019</FECHA_SUSPENSION><VALOR_RECL>735844</VALOR_RECL><TOTAL_FACTURA>46,287</TOTAL_FACTURA><PAGO_SIN_RECARGO>05/04/2019</PAGO_SIN_RECARGO><CUPO_BRILLA>0</CUPO_BRILLA>
</LDC_DATOS_CLIENTE>
<LDC_CONSUMOS_HIST>
<CONSUMO_MES>6</CONSUMO_MES>
<FECHA_CONS_MES>SEP-18</FECHA_CONS_MES>
</LDC_CONSUMOS_HIST>
<LDC_CONSUMOS_HIST>
<CONSUMO_MES>13</CONSUMO_MES>
<FECHA_CONS_MES>OCT-18</FECHA_CONS_MES>
</LDC_CONSUMOS_HIST>
<LDC_CONSUMOS_HIST>
<CONSUMO_MES>18</CONSUMO_MES>
<FECHA_CONS_MES>NOV-18</FECHA_CONS_MES>
</LDC_CONSUMOS_HIST>
<LDC_CONSUMOS_HIST>
<CONSUMO_MES>10</CONSUMO_MES>
<FECHA_CONS_MES>DIC-18</FECHA_CONS_MES>
</LDC_CONSUMOS_HIST>
<LDC_CONSUMOS_HIST>
<CONSUMO_MES>0</CONSUMO_MES>
<FECHA_CONS_MES>ENE-19</FECHA_CONS_MES>
</LDC_CONSUMOS_HIST>
<LDC_CONSUMOS_HIST>
<CONSUMO_MES>2</CONSUMO_MES>
<FECHA_CONS_MES>FEB-19</FECHA_CONS_MES>
</LDC_CONSUMOS_HIST>
<LDC_DATOS_LECTURA>
<NUM_MEDIDOR>SH-21051370-18</NUM_MEDIDOR><LECTURA_ANTERIOR>0</LECTURA_ANTERIOR><LECTURA_ACTUAL>4.76</LECTURA_ACTUAL><OBS_LECTURA></OBS_LECTURA>
</LDC_DATOS_LECTURA>
<LDC_DATOS_CONSUMO>
<CONS_CORREG>2</CONS_CORREG><FACTOR_CORRECCION> 0.9970</FACTOR_CORRECCION><CONSUMO_MES_1>2</CONSUMO_MES_1><FECHA_CONS_MES_1>FEB-19</FECHA_CONS_MES_1><CONSUMO_MES_2>0</CONSUMO_MES_2><FECHA_CONS_MES_2>ENE-19</FECHA_CONS_MES_2><CONSUMO_MES_3>10</CONSUMO_MES_3><FECHA_CONS_MES_3>DIC-18</FECHA_CONS_MES_3><CONSUMO_MES_4>18</CONSUMO_MES_4><FECHA_CONS_MES_4>NOV-18</FECHA_CONS_MES_4><CONSUMO_MES_5>13</CONSUMO_MES_5><FECHA_CONS_MES_5>OCT-18</FECHA_CONS_MES_5><CONSUMO_MES_6>6</CONSUMO_MES_6><FECHA_CONS_MES_6>SEP-18</FECHA_CONS_MES_6><CONSUMO_PROMEDIO>8</CONSUMO_PROMEDIO><TEMPERATURA>75.0971</TEMPERATURA><PRESION>.33</PRESION><EQUIVAL_KWH>2 M3 Equivalen a 20.74kwh</EQUIVAL_KWH><CALCCONS>LEC.MEDIDOR</CALCCONS>
</LDC_DATOS_CONSUMO>
<LDC_DATOS_REVISION>
<TIPO_NOTI>0</TIPO_NOTI><MENS_NOTI>La Revision Periodica debe Realizarse con Organismos de Inspeccion Acreditados.</MENS_NOTI><FECH_MAXIMA></FECH_MAXIMA><FECH_SUSP></FECH_SUSP>
</LDC_DATOS_REVISION>
<LDC_TOTALES>
<TOTAL_1></TOTAL_1>
</LDC_TOTALES>
<LDC_CARGOS>
<ETIQUETA>1</ETIQUETA><DESC_CONCEP>SERV.GAS (Serv.Susc.2063147)</DESC_CONCEP><SALDO_ANT></SALDO_ANT><CAPITAL></CAPITAL><INTERES></INTERES><TOTAL></TOTAL><SALDO_DIF></SALDO_DIF><CUOTAS></CUOTAS>
</LDC_CARGOS>
<LDC_CARGOS>
<ETIQUETA>2</ETIQUETA><DESC_CONCEP>Saldo Anterior</DESC_CONCEP><SALDO_ANT>34,640</SALDO_ANT><CAPITAL></CAPITAL><INTERES></INTERES><TOTAL></TOTAL><SALDO_DIF></SALDO_DIF><CUOTAS></CUOTAS>
</LDC_CARGOS>
<LDC_CARGOS>
<ETIQUETA>3</ETIQUETA><DESC_CONCEP>CARGO FIJO MENSUAL</DESC_CONCEP><SALDO_ANT></SALDO_ANT><CAPITAL>3,732</CAPITAL><INTERES></INTERES><TOTAL></TOTAL><SALDO_DIF></SALDO_DIF><CUOTAS></CUOTAS>
</LDC_CARGOS>
<LDC_CARGOS>
<ETIQUETA>4</ETIQUETA><DESC_CONCEP>CONSUMO DE GAS NATURALCO-7AJ-201902</DESC_CONCEP><SALDO_ANT></SALDO_ANT><CAPITAL>-11,578</CAPITAL><INTERES></INTERES><TOTAL></TOTAL><SALDO_DIF></SALDO_DIF><CUOTAS></CUOTAS>
</LDC_CARGOS>
<LDC_CARGOS>
<ETIQUETA>5</ETIQUETA><DESC_CONCEP>CONSUMO DE GAS NATURAL</DESC_CONCEP><SALDO_ANT></SALDO_ANT><CAPITAL>3,266</CAPITAL><INTERES></INTERES><TOTAL></TOTAL><SALDO_DIF></SALDO_DIF><CUOTAS></CUOTAS>
</LDC_CARGOS>
<LDC_CARGOS>
<ETIQUETA>6</ETIQUETA><DESC_CONCEP>REVISION PERIODICA RES 059</DESC_CONCEP><SALDO_ANT></SALDO_ANT><CAPITAL>1,015</CAPITAL><INTERES>1,582</INTERES><TOTAL></TOTAL><SALDO_DIF>75,139</SALDO_DIF><CUOTAS>43</CUOTAS>
</LDC_CARGOS>
<LDC_CARGOS>
<ETIQUETA>7</ETIQUETA><DESC_CONCEP>MODIFICACION RED INTERNA</DESC_CONCEP><SALDO_ANT></SALDO_ANT><CAPITAL>1,227</CAPITAL><INTERES>1,803</INTERES><TOTAL></TOTAL><SALDO_DIF>85,603</SALDO_DIF><CUOTAS>44</CUOTAS>
</LDC_CARGOS>
<LDC_CARGOS>
<ETIQUETA>8</ETIQUETA><DESC_CONCEP>MODIFICACION CENTRO DE MEDICIO</DESC_CONCEP><SALDO_ANT></SALDO_ANT><CAPITAL>636</CAPITAL><INTERES>934</INTERES><TOTAL></TOTAL><SALDO_DIF>44,355</SALDO_DIF><CUOTAS>44</CUOTAS>
</LDC_CARGOS>
<LDC_CARGOS>
<ETIQUETA>9</ETIQUETA><DESC_CONCEP>MODIFICACION CENTRO DE MEDICIO</DESC_CONCEP><SALDO_ANT></SALDO_ANT><CAPITAL>1,584</CAPITAL><INTERES>2,331</INTERES><TOTAL></TOTAL><SALDO_DIF>110,620</SALDO_DIF><CUOTAS>44</CUOTAS>
</LDC_CARGOS>
<LDC_CARGOS>
<ETIQUETA>10</ETIQUETA><DESC_CONCEP>MODIFICACION RED INTERNA</DESC_CONCEP><SALDO_ANT></SALDO_ANT><CAPITAL>969</CAPITAL><INTERES>1,479</INTERES><TOTAL></TOTAL><SALDO_DIF>70,965</SALDO_DIF><CUOTAS>46</CUOTAS>
</LDC_CARGOS>
<LDC_CARGOS>
<ETIQUETA>11</ETIQUETA><DESC_CONCEP>MODIFICACION CENTRO DE MEDICIO</DESC_CONCEP><SALDO_ANT></SALDO_ANT><CAPITAL>609</CAPITAL><INTERES>928</INTERES><TOTAL></TOTAL><SALDO_DIF>44,537</SALDO_DIF><CUOTAS>46</CUOTAS>
</LDC_CARGOS>
<LDC_CARGOS>
<ETIQUETA>12</ETIQUETA><DESC_CONCEP>INT FINANC EXC OTROS SERV</DESC_CONCEP><SALDO_ANT></SALDO_ANT><CAPITAL>0</CAPITAL><INTERES>301</INTERES><TOTAL></TOTAL><SALDO_DIF>14,279</SALDO_DIF><CUOTAS>43</CUOTAS>
</LDC_CARGOS>
<LDC_CARGOS>
<ETIQUETA>13</ETIQUETA><DESC_CONCEP>IVA</DESC_CONCEP><SALDO_ANT></SALDO_ANT><CAPITAL>558</CAPITAL><INTERES></INTERES><TOTAL></TOTAL><SALDO_DIF></SALDO_DIF><CUOTAS></CUOTAS>
</LDC_CARGOS>
<LDC_CARGOS>
<ETIQUETA>14</ETIQUETA><DESC_CONCEP>INTERES DE MORA(Tasa 2.127%)</DESC_CONCEP><SALDO_ANT></SALDO_ANT><CAPITAL></CAPITAL><INTERES>271</INTERES><TOTAL></TOTAL><SALDO_DIF></SALDO_DIF><CUOTAS></CUOTAS>
</LDC_CARGOS>
<LDC_CARGOS>
<ETIQUETA>15</ETIQUETA><DESC_CONCEP>Total Servicio:</DESC_CONCEP><SALDO_ANT></SALDO_ANT><CAPITAL>2,018</CAPITAL><INTERES>9,629</INTERES><TOTAL>11,647</TOTAL><SALDO_DIF>445,498</SALDO_DIF><CUOTAS></CUOTAS>
</LDC_CARGOS>
<LDC_RANGOS>
<LIM_INFERIOR>0</LIM_INFERIOR><LIM_SUPERIOR>MAS</LIM_SUPERIOR><VALOR_UNIDAD>1633</VALOR_UNIDAD><CONSUMO>2</CONSUMO><VAL_CONSUMO>3,266.00</VAL_CONSUMO>
</LDC_RANGOS>
<LDC_RANGOS>
<LIM_INFERIOR></LIM_INFERIOR><LIM_SUPERIOR></LIM_SUPERIOR><VALOR_UNIDAD></VALOR_UNIDAD><CONSUMO></CONSUMO><VAL_CONSUMO></VAL_CONSUMO>
</LDC_RANGOS>
<LDC_RANGOS>
<LIM_INFERIOR></LIM_INFERIOR><LIM_SUPERIOR></LIM_SUPERIOR><VALOR_UNIDAD></VALOR_UNIDAD><CONSUMO></CONSUMO><VAL_CONSUMO></VAL_CONSUMO>
</LDC_RANGOS>
<LDC_RANGOS>
<LIM_INFERIOR></LIM_INFERIOR><LIM_SUPERIOR></LIM_SUPERIOR><VALOR_UNIDAD></VALOR_UNIDAD><CONSUMO></CONSUMO><VAL_CONSUMO></VAL_CONSUMO>
</LDC_RANGOS>
<LDC_RANGOS>
<LIM_INFERIOR></LIM_INFERIOR><LIM_SUPERIOR></LIM_SUPERIOR><VALOR_UNIDAD></VALOR_UNIDAD><CONSUMO></CONSUMO><VAL_CONSUMO></VAL_CONSUMO>
</LDC_RANGOS>
<LDC_RANGOS>
<LIM_INFERIOR></LIM_INFERIOR><LIM_SUPERIOR></LIM_SUPERIOR><VALOR_UNIDAD></VALOR_UNIDAD><CONSUMO></CONSUMO><VAL_CONSUMO></VAL_CONSUMO>
</LDC_RANGOS>
<LDC_RANGOS>
<LIM_INFERIOR></LIM_INFERIOR><LIM_SUPERIOR></LIM_SUPERIOR><VALOR_UNIDAD></VALOR_UNIDAD><CONSUMO></CONSUMO><VAL_CONSUMO></VAL_CONSUMO>
</LDC_RANGOS>
<LDC_RANGOS_2>
<LIM_INFERIOR1> </LIM_INFERIOR1>
<LIM_SUPERIOR1> </LIM_SUPERIOR1>
<VALOR_UNIDAD1> </VALOR_UNIDAD1>
 
<VAL_CONSUMO1> </VAL_CONSUMO1>
<LIM_INFERIOR2> </LIM_INFERIOR2>
<LIM_SUPERIOR2> </LIM_SUPERIOR2>
<VALOR_UNIDAD2> </VALOR_UNIDAD2>
 
<VAL_CONSUMO2> </VAL_CONSUMO2>
<LIM_INFERIOR3> </LIM_INFERIOR3>
<LIM_SUPERIOR3> </LIM_SUPERIOR3>
<VALOR_UNIDAD3> </VALOR_UNIDAD3>
 
<VAL_CONSUMO3> </VAL_CONSUMO3>
<LIM_INFERIOR4> </LIM_INFERIOR4>
<LIM_SUPERIOR4> </LIM_SUPERIOR4>
<VALOR_UNIDAD4> </VALOR_UNIDAD4>
 
<VAL_CONSUMO4> </VAL_CONSUMO4>
<LIM_INFERIOR5> </LIM_INFERIOR5>
<LIM_SUPERIOR5> </LIM_SUPERIOR5>
<VALOR_UNIDAD5> </VALOR_UNIDAD5>
 
<VAL_CONSUMO5> </VAL_CONSUMO5>
<LIM_INFERIOR6> </LIM_INFERIOR6>
<LIM_SUPERIOR6> </LIM_SUPERIOR6>
<VALOR_UNIDAD6> </VALOR_UNIDAD6>
 
<VAL_CONSUMO6> </VAL_CONSUMO6>
<LIM_INFERIOR7> </LIM_INFERIOR7>
<LIM_SUPERIOR7> </LIM_SUPERIOR7>
<VALOR_UNIDAD7> </VALOR_UNIDAD7>
<CONSUMO> </CONSUMO>
<VAL_CONSUMO7> </VAL_CONSUMO7>
</LDC_RANGOS_2>
<LDC_COMPCOST>
<COMPCOST>Gm = $977 Tm = $212 Dm = $434 Cv = $0 Cc = $0 Cm = $3732</COMPCOST><VALORESREF>DES(h)=0 IPLI=100% IO=100% IRST=NO APLICA</VALORESREF><VALCALC>DES(h)=0 COMPENSACION($)=0</VALCALC>
</LDC_COMPCOST>
<LDC_CUPON>
<COD_BAR>(415)7707232377896(8020)0157459076(3900)0000046287(96)20290405</COD_BAR>
</LDC_CUPON>
<EXTRA_BARCODE_>
<CODE>41577072323778968200157459076È39000000046287È9620290405</CODE>
<IMAGE></IMAGE>
</EXTRA_BARCODE_>
</LDC_FACTURA>';

    MERGE INTO OPEN.ED_DOCUMENT A USING
    (SELECT
      2050501528 as DOCUCODI,
      66 as DOCUTIDO,
      83650 as DOCUPEFA,
      TO_DATE('21/03/2019 10:00:09 pm', 'DD/MM/YYYY HH:MI:SS AM') as DOCUFERE, 
      sbFactura DOCUDOCU
      FROM DUAL) B
    ON (A.DOCUCODI = B.DOCUCODI and A.DOCUTIDO = B.DOCUTIDO)
    WHEN NOT MATCHED THEN 
    INSERT (
      DOCUCODI, DOCUTIDO, DOCUPEFA, DOCUFERE, DOCUDOCU)
    VALUES (
      B.DOCUCODI, B.DOCUTIDO, B.DOCUPEFA, B.DOCUFERE, B.DOCUDOCU)
    WHEN MATCHED THEN
    UPDATE SET 
      A.DOCUPEFA = B.DOCUPEFA,
      A.DOCUFERE = B.DOCUFERE,
      A.DOCUDOCU = B.DOCUDOCU;

    COMMIT;
    dbms_output.put_line('Fin OSF-2944');
END;
/

select to_char(sysdate,'yyyy-mm-dd hh:mi:ss p.m.') fecha_fin from dual;
set serveroutput off
quit
/