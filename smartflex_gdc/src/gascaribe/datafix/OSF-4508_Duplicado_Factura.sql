column dt new_value vdt
column db new_value vdb
select to_char(sysdate,'yyyymmdd_hh24miss') dt, sys_context('userenv','db_name') db from dual;
set serveroutput on size unlimited
execute dbms_application_info.set_action('APLICANDO DATAFIX');
select to_char(sysdate,'yyyy-mm-dd hh:mi:ss p.m.') fecha_inicio from dual;

DECLARE
sbFactura1 CLOB;

BEGIN
    dbms_output.put_line('Inicia OSF-4508');
sbFactura1 := '<LDC_FACTURA>
<LDC_DATOS_CLIENTE><FACTURA>2054896910</FACTURA><FECH_FACT>10/JUL/2019</FECH_FACT><MES_FACT>JUL-2019</MES_FACT><PERIODO_FACT>JULIO      2019</PERIODO_FACT><PAGO_HASTA>22/07/2019</PAGO_HASTA><DIAS_CONSUMO>30</DIAS_CONSUMO><CONTRATO>66830968</CONTRATO><CUPON>161500731</CUPON><NOMBRE>LUIS DANIEL  PEREZ GUZMAN </NOMBRE><DIRECCION_COBRO>KR 66 CL 46 - 203</DIRECCION_COBRO><LOCALIDAD>SANTA MARTA (MAG) - MAG</LOCALIDAD><CATEGORIA>RESIDENCIAL</CATEGORIA><ESTRATO>2</ESTRATO><CICLO>3602</CICLO><RUTA>36027651050157500</RUTA><MESES_DEUDA>1</MESES_DEUDA><NUM_CONTROL>2962143529</NUM_CONTROL><PERIODO_CONSUMO>05/JUN - 04/JUL</PERIODO_CONSUMO><SALDO_FAVOR>0</SALDO_FAVOR><FECHA_SUSPENSION></FECHA_SUSPENSION><VALOR_RECL>0</VALOR_RECL><TOTAL_FACTURA>341,203</TOTAL_FACTURA><PAGO_SIN_RECARGO>22/07/2019</PAGO_SIN_RECARGO><CUPO_BRILLA>0</CUPO_BRILLA>
</LDC_DATOS_CLIENTE>
<LDC_CONSUMOS_HIST>
<CONSUMO_MES>0</CONSUMO_MES>
<FECHA_CONS_MES>ENE-19</FECHA_CONS_MES>
</LDC_CONSUMOS_HIST>
<LDC_CONSUMOS_HIST>
<CONSUMO_MES>0</CONSUMO_MES>
<FECHA_CONS_MES>FEB-19</FECHA_CONS_MES>
</LDC_CONSUMOS_HIST>
<LDC_CONSUMOS_HIST>
<CONSUMO_MES>0</CONSUMO_MES>
<FECHA_CONS_MES>MAR-19</FECHA_CONS_MES>
</LDC_CONSUMOS_HIST>
<LDC_CONSUMOS_HIST>
<CONSUMO_MES>0</CONSUMO_MES>
<FECHA_CONS_MES>ABR-19</FECHA_CONS_MES>
</LDC_CONSUMOS_HIST>
<LDC_CONSUMOS_HIST>
<CONSUMO_MES>0</CONSUMO_MES>
<FECHA_CONS_MES>MAY-19</FECHA_CONS_MES>
</LDC_CONSUMOS_HIST>
<LDC_CONSUMOS_HIST>
<CONSUMO_MES>99</CONSUMO_MES>
<FECHA_CONS_MES>JUN-19</FECHA_CONS_MES>
</LDC_CONSUMOS_HIST>
<LDC_DATOS_LECTURA>
<NUM_MEDIDOR>SH-21025527-19</NUM_MEDIDOR><LECTURA_ANTERIOR>112.73</LECTURA_ANTERIOR><LECTURA_ACTUAL>197.52</LECTURA_ACTUAL><OBS_LECTURA></OBS_LECTURA>
</LDC_DATOS_LECTURA>
<LDC_DATOS_CONSUMO>
<CONS_CORREG>96</CONS_CORREG><FACTOR_CORRECCION> 0.9885</FACTOR_CORRECCION><CONSUMO_MES_1>99</CONSUMO_MES_1><FECHA_CONS_MES_1>JUN-19</FECHA_CONS_MES_1><CONSUMO_MES_2>0</CONSUMO_MES_2><FECHA_CONS_MES_2>MAY-19</FECHA_CONS_MES_2><CONSUMO_MES_3>0</CONSUMO_MES_3><FECHA_CONS_MES_3>ABR-19</FECHA_CONS_MES_3><CONSUMO_MES_4>0</CONSUMO_MES_4><FECHA_CONS_MES_4>MAR-19</FECHA_CONS_MES_4><CONSUMO_MES_5>0</CONSUMO_MES_5><FECHA_CONS_MES_5>FEB-19</FECHA_CONS_MES_5><CONSUMO_MES_6>0</CONSUMO_MES_6><FECHA_CONS_MES_6>ENE-19</FECHA_CONS_MES_6><CONSUMO_PROMEDIO>17.0000</CONSUMO_PROMEDIO><TEMPERATURA>79.706</TEMPERATURA><PRESION>0.33</PRESION><EQUIVAL_KWH>96 M3 Equivalen a 995.52kwh</EQUIVAL_KWH><CALCCONS>LEC.MEDIDOR</CALCCONS>
</LDC_DATOS_CONSUMO>
<LDC_DATOS_REVISION>
<TIPO_NOTI>0</TIPO_NOTI><MENS_NOTI>La Revision Periodica debe Realizarse con Organismos de Inspeccion Acreditados.</MENS_NOTI><FECH_MAXIMA></FECH_MAXIMA><FECH_SUSP></FECH_SUSP>
</LDC_DATOS_REVISION>
<LDC_TOTALES>
<TOTAL_1></TOTAL_1>
</LDC_TOTALES>
<LDC_CARGOS>
<ETIQUETA>1</ETIQUETA><DESC_CONCEP>SERV.GAS (Serv.Susc.51758531)</DESC_CONCEP><SALDO_ANT></SALDO_ANT><CAPITAL></CAPITAL><INTERES></INTERES><TOTAL></TOTAL><SALDO_DIF></SALDO_DIF><CUOTAS></CUOTAS>
</LDC_CARGOS>
<LDC_CARGOS>
<ETIQUETA>2</ETIQUETA><DESC_CONCEP>CONSUMO DE GAS NATURALCO-83AJ-201906</DESC_CONCEP><SALDO_ANT></SALDO_ANT><CAPITAL>140,054</CAPITAL><INTERES></INTERES><TOTAL></TOTAL><SALDO_DIF></SALDO_DIF><CUOTAS></CUOTAS>
</LDC_CARGOS>
<LDC_CARGOS>
<ETIQUETA>3</ETIQUETA><DESC_CONCEP>CONSUMO DE GAS NATURAL</DESC_CONCEP><SALDO_ANT></SALDO_ANT><CAPITAL>178,343</CAPITAL><INTERES></INTERES><TOTAL></TOTAL><SALDO_DIF></SALDO_DIF><CUOTAS></CUOTAS>
</LDC_CARGOS>
<LDC_CARGOS>
<ETIQUETA>4</ETIQUETA><DESC_CONCEP>CARGO POR CONEXI¿N</DESC_CONCEP><SALDO_ANT></SALDO_ANT><CAPITAL>2,589</CAPITAL><INTERES>11,396</INTERES><TOTAL></TOTAL><SALDO_DIF>530,061</SALDO_DIF><CUOTAS>69</CUOTAS>
</LDC_CARGOS>
<LDC_CARGOS>
<ETIQUETA>5</ETIQUETA><DESC_CONCEP>CONSTRUCCION DE INSTALACION INTERNA</DESC_CONCEP><SALDO_ANT></SALDO_ANT><CAPITAL>5,511</CAPITAL><INTERES>24,252</INTERES><TOTAL></TOTAL><SALDO_DIF>1,128,048</SALDO_DIF><CUOTAS>69</CUOTAS>
</LDC_CARGOS>
<LDC_CARGOS>
<ETIQUETA>6</ETIQUETA><DESC_CONCEP>CERTIFICACI¿N DE INSTALACI¿N PREVIA</DESC_CONCEP><SALDO_ANT></SALDO_ANT><CAPITAL>386</CAPITAL><INTERES>1,699</INTERES><TOTAL></TOTAL><SALDO_DIF>79,024</SALDO_DIF><CUOTAS>69</CUOTAS>
</LDC_CARGOS>
<LDC_CARGOS>
<ETIQUETA>7</ETIQUETA><DESC_CONCEP>INTERES FINANC RED INTERNA EXC</DESC_CONCEP><SALDO_ANT></SALDO_ANT><CAPITAL>0</CAPITAL><INTERES>461</INTERES><TOTAL></TOTAL><SALDO_DIF>21,433</SALDO_DIF><CUOTAS>69</CUOTAS>
</LDC_CARGOS>
<LDC_CARGOS>
<ETIQUETA>8</ETIQUETA><DESC_CONCEP>INT FINANC EXC OTROS SERV</DESC_CONCEP><SALDO_ANT></SALDO_ANT><CAPITAL>0</CAPITAL><INTERES>323</INTERES><TOTAL></TOTAL><SALDO_DIF>15,014</SALDO_DIF><CUOTAS>69</CUOTAS>
</LDC_CARGOS>
<LDC_CARGOS>
<ETIQUETA>9</ETIQUETA><DESC_CONCEP>SUBSIDIO LEY 142/94(Hasta 20M3 47.84% Cons.) SU-4AJ-201906</DESC_CONCEP><SALDO_ANT></SALDO_ANT><CAPITAL>-3,773</CAPITAL><INTERES></INTERES><TOTAL></TOTAL><SALDO_DIF></SALDO_DIF><CUOTAS></CUOTAS>
</LDC_CARGOS>
<LDC_CARGOS>
<ETIQUETA>10</ETIQUETA><DESC_CONCEP>SUBSIDIO LEY 142/94(Hasta 20M3 50% Cons.)</DESC_CONCEP><SALDO_ANT></SALDO_ANT><CAPITAL>-21,000</CAPITAL><INTERES></INTERES><TOTAL></TOTAL><SALDO_DIF></SALDO_DIF><CUOTAS></CUOTAS>
</LDC_CARGOS>
<LDC_CARGOS>
<ETIQUETA>11</ETIQUETA><DESC_CONCEP>IVA</DESC_CONCEP><SALDO_ANT></SALDO_ANT><CAPITAL>962</CAPITAL><INTERES></INTERES><TOTAL></TOTAL><SALDO_DIF></SALDO_DIF><CUOTAS></CUOTAS>
</LDC_CARGOS>
<LDC_CARGOS>
<ETIQUETA>12</ETIQUETA><DESC_CONCEP>Total Servicio:</DESC_CONCEP><SALDO_ANT></SALDO_ANT><CAPITAL>303,072</CAPITAL><INTERES>38,131</INTERES><TOTAL>341,203</TOTAL><SALDO_DIF>1,773,580</SALDO_DIF><CUOTAS></CUOTAS>
</LDC_CARGOS>
<LDC_RANGOS>
<LIM_INFERIOR>0</LIM_INFERIOR><LIM_SUPERIOR>20</LIM_SUPERIOR><VALOR_UNIDAD>2099.96</VALOR_UNIDAD><CONSUMO>20</CONSUMO><VAL_CONSUMO>41,999.20</VAL_CONSUMO>
</LDC_RANGOS>
<LDC_RANGOS>
<LIM_INFERIOR>21</LIM_INFERIOR><LIM_SUPERIOR>MAS</LIM_SUPERIOR><VALOR_UNIDAD>1794</VALOR_UNIDAD><CONSUMO>76</CONSUMO><VAL_CONSUMO>136,344.00</VAL_CONSUMO>
</LDC_RANGOS>
<LDC_RANGOS>
<LIM_INFERIOR></LIM_INFERIOR><LIM_SUPERIOR></LIM_SUPERIOR><VALOR_UNIDAD></VALOR_UNIDAD><CONSUMO></CONSUMO><VAL_CONSUMO></VAL_CONSUMO>
</LDC_RANGOS>
<LDC_RANGOS>
<LIM_INFERIOR></LIM_INFERIOR><LIM_SUPERIOR></LIM_SUPERIOR><VALOR_UNIDAD></VALOR_UNIDAD><CONSUMO></CONSUMO><VAL_CONSUMO></VAL_CONSUMO>
</LDC_RANGOS>
<LDC_RANGOS>
<LIM_INFERIOR></LIM_INFERIOR><LIM_SUPERIOR></LIM_SUPERIOR><VALOR_UNIDAD></VALOR_UNIDAD><CONSUMO></CONSUMO><VAL_CONSUMO></VAL_CONSUMO>
</LDC_RANGOS>
<LDC_RANGOS>
<LIM_INFERIOR></LIM_INFERIOR><LIM_SUPERIOR></LIM_SUPERIOR><VALOR_UNIDAD></VALOR_UNIDAD><CONSUMO></CONSUMO><VAL_CONSUMO></VAL_CONSUMO>
</LDC_RANGOS>
<LDC_RANGOS>
<LIM_INFERIOR></LIM_INFERIOR><LIM_SUPERIOR></LIM_SUPERIOR><VALOR_UNIDAD></VALOR_UNIDAD><CONSUMO></CONSUMO><VAL_CONSUMO></VAL_CONSUMO>
</LDC_RANGOS>
<LDC_RANGOS_2>
<LIM_INFERIOR1> </LIM_INFERIOR1>
<LIM_SUPERIOR1> </LIM_SUPERIOR1>
<VALOR_UNIDAD1> </VALOR_UNIDAD1>
 
<VAL_CONSUMO1> </VAL_CONSUMO1>
<LIM_INFERIOR2> </LIM_INFERIOR2>
<LIM_SUPERIOR2> </LIM_SUPERIOR2>
<VALOR_UNIDAD2> </VALOR_UNIDAD2>
 
<VAL_CONSUMO2> </VAL_CONSUMO2>
<LIM_INFERIOR3> </LIM_INFERIOR3>
<LIM_SUPERIOR3> </LIM_SUPERIOR3>
<VALOR_UNIDAD3> </VALOR_UNIDAD3>
 
<VAL_CONSUMO3> </VAL_CONSUMO3>
<LIM_INFERIOR4> </LIM_INFERIOR4>
<LIM_SUPERIOR4> </LIM_SUPERIOR4>
<VALOR_UNIDAD4> </VALOR_UNIDAD4>
 
<VAL_CONSUMO4> </VAL_CONSUMO4>
<LIM_INFERIOR5> </LIM_INFERIOR5>
<LIM_SUPERIOR5> </LIM_SUPERIOR5>
<VALOR_UNIDAD5> </VALOR_UNIDAD5>
 
<VAL_CONSUMO5> </VAL_CONSUMO5>
<LIM_INFERIOR6> </LIM_INFERIOR6>
<LIM_SUPERIOR6> </LIM_SUPERIOR6>
<VALOR_UNIDAD6> </VALOR_UNIDAD6>
 
<VAL_CONSUMO6> </VAL_CONSUMO6>
<LIM_INFERIOR7> </LIM_INFERIOR7>
<LIM_SUPERIOR7> </LIM_SUPERIOR7>
<VALOR_UNIDAD7> </VALOR_UNIDAD7>
<CONSUMO> </CONSUMO>
<VAL_CONSUMO7> </VAL_CONSUMO7>
</LDC_RANGOS_2>
<LDC_COMPCOST>
<COMPCOST>Gm = $1081 Tm = $235 Dm = $468 Cv = $0 Cc = $0 Cm = $3826</COMPCOST><VALORESREF>DES(h)=0 IPLI=100% IO=100% IRST=NO APLICA</VALORESREF><VALCALC>DES(h)=0 COMPENSACION($)=0</VALCALC>
</LDC_COMPCOST>
<LDC_CUPON>
<COD_BAR>(415)7707232377896(8020)0161500731(3900)0000341203(96)20290722</COD_BAR>
</LDC_CUPON>
<EXTRA_BARCODE_>
<CODE>41577072323778968200161500731È39000000341203È9620290722</CODE>
<IMAGE></IMAGE>
</EXTRA_BARCODE_>
</LDC_FACTURA>';	

MERGE INTO OPEN.ED_DOCUMENT A USING
    (SELECT 2054896910 as DOCUCODI, 66 as DOCUTIDO, 85044 as DOCUPEFA, TO_DATE('10/07/2019 08:38:27 p.m.','DD/MM/YYYY HH:MI:SS A.M.') as DOCUFERE, sbFactura1 DOCUDOCU
      FROM DUAL) B
    ON (A.DOCUCODI = B.DOCUCODI and A.DOCUTIDO = B.DOCUTIDO)
    WHEN NOT MATCHED THEN  INSERT (
      DOCUCODI, DOCUTIDO, DOCUPEFA, DOCUFERE, DOCUDOCU)
     VALUES (
      B.DOCUCODI, B.DOCUTIDO, B.DOCUPEFA, B.DOCUFERE, B.DOCUDOCU)
    WHEN MATCHED THEN
     UPDATE SET 
      A.DOCUPEFA = B.DOCUPEFA,
      A.DOCUFERE = B.DOCUFERE,
      A.DOCUDOCU = B.DOCUDOCU;


    COMMIT;
    dbms_output.put_line('Fin OSF-4508');
END;
/

select to_char(sysdate,'yyyy-mm-dd hh:mi:ss p.m.') fecha_fin from dual;
set serveroutput off
quit
/