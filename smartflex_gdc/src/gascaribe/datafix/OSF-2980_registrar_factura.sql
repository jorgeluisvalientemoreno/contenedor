column dt new_value vdt
column db new_value vdb
select to_char(sysdate,'yyyymmdd_hh24miss') dt, sys_context('userenv','db_name') db from dual;
set serveroutput on size unlimited
execute dbms_application_info.set_action('APLICANDO DATAFIX');
select to_char(sysdate,'yyyy-mm-dd hh:mi:ss p.m.') fecha_inicio from dual;

DECLARE
    sbFactura CLOB;
    sbFactura2 CLOB;
BEGIN
    dbms_output.put_line('Inicia OSF-2980');

      sbFactura := '<LDC_FACTURA>
<LDC_DATOS_CLIENTE><FACTURA>2067890707</FACTURA><FECH_FACT>05/JUN/2020</FECH_FACT><MES_FACT>MAY-2020</MES_FACT><PERIODO_FACT>MAYO       2020</PERIODO_FACT><PAGO_HASTA>INMEDIATO</PAGO_HASTA><DIAS_CONSUMO>30</DIAS_CONSUMO><CONTRATO>48104209</CONTRATO><CUPON>173909900</CUPON><NOMBRE>OROZCO OROZCO RUSBEL</NOMBRE><DIRECCION_COBRO>CL 34 KR 38 - 67 APTO 9</DIRECCION_COBRO><LOCALIDAD>BARRANQUILLA - ATL</LOCALIDAD><CATEGORIA>NO RESIDENCIAL</CATEGORIA><ESTRATO>UNICO</ESTRATO><CICLO>1201</CICLO><RUTA>12014131300152400</RUTA><MESES_DEUDA>5</MESES_DEUDA><NUM_CONTROL>2978969184</NUM_CONTROL><PERIODO_CONSUMO>28/ABR - 27/MAY</PERIODO_CONSUMO><SALDO_FAVOR>0</SALDO_FAVOR><FECHA_SUSPENSION>INMEDIATO</FECHA_SUSPENSION><VALOR_RECL>2326568</VALOR_RECL><TOTAL_FACTURA>760,178</TOTAL_FACTURA><PAGO_SIN_RECARGO>INMEDIATO</PAGO_SIN_RECARGO><CUPO_BRILLA>0</CUPO_BRILLA>
</LDC_DATOS_CLIENTE>
<LDC_CONSUMOS_HIST>
<CONSUMO_MES>86</CONSUMO_MES>
<FECHA_CONS_MES>NOV-19</FECHA_CONS_MES>
</LDC_CONSUMOS_HIST>
<LDC_CONSUMOS_HIST>
<CONSUMO_MES>82</CONSUMO_MES>
<FECHA_CONS_MES>DIC-19</FECHA_CONS_MES>
</LDC_CONSUMOS_HIST>
<LDC_CONSUMOS_HIST>
<CONSUMO_MES>61</CONSUMO_MES>
<FECHA_CONS_MES>ENE-20</FECHA_CONS_MES>
</LDC_CONSUMOS_HIST>
<LDC_CONSUMOS_HIST>
<CONSUMO_MES>120</CONSUMO_MES>
<FECHA_CONS_MES>FEB-20</FECHA_CONS_MES>
</LDC_CONSUMOS_HIST>
<LDC_CONSUMOS_HIST>
<CONSUMO_MES>104</CONSUMO_MES>
<FECHA_CONS_MES>MAR-20</FECHA_CONS_MES>
</LDC_CONSUMOS_HIST>
<LDC_CONSUMOS_HIST>
<CONSUMO_MES>8</CONSUMO_MES>
<FECHA_CONS_MES>ABR-20</FECHA_CONS_MES>
</LDC_CONSUMOS_HIST>
<LDC_DATOS_LECTURA>
<NUM_MEDIDOR>U-1977149-12</NUM_MEDIDOR><LECTURA_ANTERIOR>3369.49</LECTURA_ANTERIOR><LECTURA_ACTUAL>3369.95</LECTURA_ACTUAL><OBS_LECTURA></OBS_LECTURA>
</LDC_DATOS_LECTURA>
<LDC_DATOS_CONSUMO>
<CONS_CORREG>0</CONS_CORREG><FACTOR_CORRECCION> 0.9941</FACTOR_CORRECCION>8ABR-20104MAR-20120FEB-2061ENE-2082DIC-1986NOV-1977.0000<TEMPERATURA>76.63</TEMPERATURA><PRESION>0.33</PRESION><EQUIVAL_KWH>0 M3 Equivalen a 0kwh</EQUIVAL_KWH><CALCCONS>LEC.MEDIDOR</CALCCONS>
</LDC_DATOS_CONSUMO>
<LDC_DATOS_REVISION>
<TIPO_NOTI>4</TIPO_NOTI><MENS_NOTI>Solicite la Revision Periodica con un Organismo de Inspeccion Acreditado y/o distribuidor y siga disfrutando del servicio de Gas.</MENS_NOTI><FECH_MAXIMA>30 Noviembre  2018</FECH_MAXIMA><FECH_SUSP>INMEDIATO</FECH_SUSP>
</LDC_DATOS_REVISION>
<LDC_TOTALES>
<TOTAL_1></TOTAL_1>
</LDC_TOTALES>
<LDC_CARGOS>
<ETIQUETA>31</ETIQUETA><DESC_CONCEP>SERV.GAS (Serv.Susc.50148958)</DESC_CONCEP><SALDO_ANT></SALDO_ANT><CAPITAL></CAPITAL><INTERES></INTERES><TOTAL></TOTAL><SALDO_DIF></SALDO_DIF><CUOTAS></CUOTAS>
</LDC_CARGOS>
<LDC_CARGOS>
<ETIQUETA>32</ETIQUETA><DESC_CONCEP>Saldo Anterior</DESC_CONCEP><SALDO_ANT>721,737</SALDO_ANT><CAPITAL></CAPITAL><INTERES></INTERES><TOTAL></TOTAL><SALDO_DIF></SALDO_DIF><CUOTAS></CUOTAS>
</LDC_CARGOS>
<LDC_CARGOS>
<ETIQUETA>32</ETIQUETA><DESC_CONCEP>CARGO FIJO MENSUAL</DESC_CONCEP><SALDO_ANT></SALDO_ANT><CAPITAL>3,894</CAPITAL><INTERES></INTERES><TOTAL></TOTAL><SALDO_DIF></SALDO_DIF><CUOTAS></CUOTAS>
</LDC_CARGOS>
<LDC_CARGOS>
<ETIQUETA>32</ETIQUETA><DESC_CONCEP>CONTRIBUCION(8.9% Cons. + 8.9% C. Fijo</DESC_CONCEP><SALDO_ANT></SALDO_ANT><CAPITAL>347</CAPITAL><INTERES></INTERES><TOTAL></TOTAL><SALDO_DIF></SALDO_DIF><CUOTAS></CUOTAS>
</LDC_CARGOS>
<LDC_CARGOS>
<ETIQUETA>32</ETIQUETA><DESC_CONCEP>CONSUMO DE GAS NATURAL</DESC_CONCEP><SALDO_ANT></SALDO_ANT><CAPITAL>251</CAPITAL><INTERES>604</INTERES><TOTAL></TOTAL><SALDO_DIF>28,650</SALDO_DIF><CUOTAS>52</CUOTAS>
</LDC_CARGOS>
<LDC_CARGOS>
<ETIQUETA>32</ETIQUETA><DESC_CONCEP>RECONEXION DESDE ACOMETIDA</DESC_CONCEP><SALDO_ANT></SALDO_ANT><CAPITAL>1,002</CAPITAL><INTERES>2,404</INTERES><TOTAL></TOTAL><SALDO_DIF>113,944</SALDO_DIF><CUOTAS>52</CUOTAS>
</LDC_CARGOS>
<LDC_CARGOS>
<ETIQUETA>32</ETIQUETA><DESC_CONCEP>SERVICIOS VARIOS EN CENTRO DE MEDICION</DESC_CONCEP><SALDO_ANT></SALDO_ANT><CAPITAL>813</CAPITAL><INTERES>1,952</INTERES><TOTAL></TOTAL><SALDO_DIF>92,513</SALDO_DIF><CUOTAS>52</CUOTAS>
</LDC_CARGOS>
<LDC_CARGOS>
<ETIQUETA>32</ETIQUETA><DESC_CONCEP>MODIFICACION CENTRO DE MEDICIO</DESC_CONCEP><SALDO_ANT></SALDO_ANT><CAPITAL>426</CAPITAL><INTERES>1,024</INTERES><TOTAL></TOTAL><SALDO_DIF>48,529</SALDO_DIF><CUOTAS>52</CUOTAS>
</LDC_CARGOS>
<LDC_CARGOS>
<ETIQUETA>32</ETIQUETA><DESC_CONCEP>REFI INT FIN EXCL S.PU DIS-COM</DESC_CONCEP><SALDO_ANT></SALDO_ANT><CAPITAL>269</CAPITAL><INTERES>0</INTERES><TOTAL></TOTAL><SALDO_DIF>14,722</SALDO_DIF><CUOTAS>52</CUOTAS>
</LDC_CARGOS>
<LDC_CARGOS>
<ETIQUETA>32</ETIQUETA><DESC_CONCEP>REFI INT FIN EXC S PUB CAR CON</DESC_CONCEP><SALDO_ANT></SALDO_ANT><CAPITAL>179</CAPITAL><INTERES>0</INTERES><TOTAL></TOTAL><SALDO_DIF>9,824</SALDO_DIF><CUOTAS>52</CUOTAS>
</LDC_CARGOS>
<LDC_CARGOS>
<ETIQUETA>32</ETIQUETA><DESC_CONCEP>REFI INT FINANC RED INTERNA</DESC_CONCEP><SALDO_ANT></SALDO_ANT><CAPITAL>114</CAPITAL><INTERES>0</INTERES><TOTAL></TOTAL><SALDO_DIF>6,266</SALDO_DIF><CUOTAS>52</CUOTAS>
</LDC_CARGOS>
<LDC_CARGOS>
<ETIQUETA>32</ETIQUETA><DESC_CONCEP>RECONEXION REVISION PERIODICA</DESC_CONCEP><SALDO_ANT></SALDO_ANT><CAPITAL>171</CAPITAL><INTERES>409</INTERES><TOTAL></TOTAL><SALDO_DIF>19,387</SALDO_DIF><CUOTAS>52</CUOTAS>
</LDC_CARGOS>
<LDC_CARGOS>
<ETIQUETA>32</ETIQUETA><DESC_CONCEP>EXCL-REVISION PERIODICA RES 05</DESC_CONCEP><SALDO_ANT></SALDO_ANT><CAPITAL>436</CAPITAL><INTERES>1,047</INTERES><TOTAL></TOTAL><SALDO_DIF>49,637</SALDO_DIF><CUOTAS>52</CUOTAS>
</LDC_CARGOS>
<LDC_CARGOS>
<ETIQUETA>32</ETIQUETA><DESC_CONCEP>EXCL-MODIFICACION RED INTERNA</DESC_CONCEP><SALDO_ANT></SALDO_ANT><CAPITAL>791</CAPITAL><INTERES>1,899</INTERES><TOTAL></TOTAL><SALDO_DIF>90,012</SALDO_DIF><CUOTAS>52</CUOTAS>
</LDC_CARGOS>
<LDC_CARGOS>
<ETIQUETA>32</ETIQUETA><DESC_CONCEP>RECONEXION DESDE ACOMETIDA</DESC_CONCEP><SALDO_ANT></SALDO_ANT><CAPITAL>3,891</CAPITAL><INTERES>3,245</INTERES><TOTAL></TOTAL><SALDO_DIF>151,283</SALDO_DIF><CUOTAS>27</CUOTAS>
</LDC_CARGOS>
<LDC_CARGOS>
<ETIQUETA>32</ETIQUETA><DESC_CONCEP>INTERES FINANC RED INTERNA EXC</DESC_CONCEP><SALDO_ANT></SALDO_ANT><CAPITAL>0</CAPITAL><INTERES>3</INTERES><TOTAL></TOTAL><SALDO_DIF>158</SALDO_DIF><CUOTAS>62</CUOTAS>
</LDC_CARGOS>
<LDC_CARGOS>
<ETIQUETA>32</ETIQUETA><DESC_CONCEP>INT FINANC EXC OTROS SERV</DESC_CONCEP><SALDO_ANT></SALDO_ANT><CAPITAL>0</CAPITAL><INTERES>1</INTERES><TOTAL></TOTAL><SALDO_DIF>36</SALDO_DIF><CUOTAS>71</CUOTAS>
</LDC_CARGOS>
<LDC_CARGOS>
<ETIQUETA>32</ETIQUETA><DESC_CONCEP>IVA</DESC_CONCEP><SALDO_ANT></SALDO_ANT><CAPITAL>44</CAPITAL><INTERES></INTERES><TOTAL></TOTAL><SALDO_DIF></SALDO_DIF><CUOTAS></CUOTAS>
</LDC_CARGOS>
<LDC_CARGOS>
<ETIQUETA>32</ETIQUETA><DESC_CONCEP>INTERES DE MORA(Tasa 2.004%)</DESC_CONCEP><SALDO_ANT></SALDO_ANT><CAPITAL></CAPITAL><INTERES>13,225</INTERES><TOTAL></TOTAL><SALDO_DIF></SALDO_DIF><CUOTAS></CUOTAS>
</LDC_CARGOS>
<LDC_CARGOS>
<ETIQUETA>33</ETIQUETA><DESC_CONCEP>Total Servicio:</DESC_CONCEP><SALDO_ANT></SALDO_ANT><CAPITAL>12,628</CAPITAL><INTERES>25,813</INTERES><TOTAL>38,441</TOTAL><SALDO_DIF>624,925</SALDO_DIF><CUOTAS></CUOTAS>
</LDC_CARGOS>
<LDC_CARGOS>
<ETIQUETA></ETIQUETA><DESC_CONCEP></DESC_CONCEP><SALDO_ANT></SALDO_ANT><CAPITAL></CAPITAL><INTERES></INTERES><TOTAL></TOTAL><SALDO_DIF></SALDO_DIF><CUOTAS></CUOTAS>
</LDC_CARGOS>
<LDC_CARGOS>
<ETIQUETA>34</ETIQUETA><DESC_CONCEP></DESC_CONCEP><SALDO_ANT></SALDO_ANT><CAPITAL></CAPITAL><INTERES></INTERES><TOTAL></TOTAL><SALDO_DIF></SALDO_DIF><CUOTAS></CUOTAS>
</LDC_CARGOS>
<LDC_CARGOS>
<ETIQUETA>34</ETIQUETA><DESC_CONCEP></DESC_CONCEP><SALDO_ANT></SALDO_ANT><CAPITAL></CAPITAL><INTERES></INTERES><TOTAL></TOTAL><SALDO_DIF></SALDO_DIF><CUOTAS></CUOTAS>
</LDC_CARGOS>
<LDC_CARGOS>
<ETIQUETA>34</ETIQUETA><DESC_CONCEP></DESC_CONCEP><SALDO_ANT></SALDO_ANT><CAPITAL></CAPITAL><INTERES></INTERES><TOTAL></TOTAL><SALDO_DIF></SALDO_DIF><CUOTAS></CUOTAS>
</LDC_CARGOS>
<LDC_CARGOS>
<ETIQUETA>34</ETIQUETA><DESC_CONCEP></DESC_CONCEP><SALDO_ANT></SALDO_ANT><CAPITAL></CAPITAL><INTERES></INTERES><TOTAL></TOTAL><SALDO_DIF></SALDO_DIF><CUOTAS></CUOTAS>
</LDC_CARGOS>
<LDC_CARGOS>
<ETIQUETA>34</ETIQUETA><DESC_CONCEP></DESC_CONCEP><SALDO_ANT></SALDO_ANT><CAPITAL></CAPITAL><INTERES></INTERES><TOTAL></TOTAL><SALDO_DIF></SALDO_DIF><CUOTAS></CUOTAS>
</LDC_CARGOS>
<LDC_CARGOS>
<ETIQUETA>34</ETIQUETA><DESC_CONCEP></DESC_CONCEP><SALDO_ANT></SALDO_ANT><CAPITAL></CAPITAL><INTERES></INTERES><TOTAL></TOTAL><SALDO_DIF></SALDO_DIF><CUOTAS></CUOTAS>
</LDC_CARGOS>
<LDC_CARGOS>
<ETIQUETA>34</ETIQUETA><DESC_CONCEP></DESC_CONCEP><SALDO_ANT></SALDO_ANT><CAPITAL></CAPITAL><INTERES></INTERES><TOTAL></TOTAL><SALDO_DIF></SALDO_DIF><CUOTAS></CUOTAS>
</LDC_CARGOS>
<LDC_CARGOS>
<ETIQUETA>34</ETIQUETA><DESC_CONCEP></DESC_CONCEP><SALDO_ANT></SALDO_ANT><CAPITAL></CAPITAL><INTERES></INTERES><TOTAL></TOTAL><SALDO_DIF></SALDO_DIF><CUOTAS></CUOTAS>
</LDC_CARGOS>
<LDC_CARGOS>
<ETIQUETA>34</ETIQUETA><DESC_CONCEP></DESC_CONCEP><SALDO_ANT></SALDO_ANT><CAPITAL></CAPITAL><INTERES></INTERES><TOTAL></TOTAL><SALDO_DIF></SALDO_DIF><CUOTAS></CUOTAS>
</LDC_CARGOS>
<LDC_RANGOS>
<LIM_INFERIOR></LIM_INFERIOR><LIM_SUPERIOR></LIM_SUPERIOR><VALOR_UNIDAD></VALOR_UNIDAD><CONSUMO></CONSUMO><VAL_CONSUMO></VAL_CONSUMO>
</LDC_RANGOS>
<LDC_RANGOS>
<LIM_INFERIOR></LIM_INFERIOR><LIM_SUPERIOR></LIM_SUPERIOR><VALOR_UNIDAD></VALOR_UNIDAD><CONSUMO></CONSUMO><VAL_CONSUMO></VAL_CONSUMO>
</LDC_RANGOS>
<LDC_RANGOS>
<LIM_INFERIOR></LIM_INFERIOR><LIM_SUPERIOR></LIM_SUPERIOR><VALOR_UNIDAD></VALOR_UNIDAD><CONSUMO></CONSUMO><VAL_CONSUMO></VAL_CONSUMO>
</LDC_RANGOS>
<LDC_RANGOS>
<LIM_INFERIOR></LIM_INFERIOR><LIM_SUPERIOR></LIM_SUPERIOR><VALOR_UNIDAD></VALOR_UNIDAD><CONSUMO></CONSUMO><VAL_CONSUMO></VAL_CONSUMO>
</LDC_RANGOS>
<LDC_RANGOS>
<LIM_INFERIOR></LIM_INFERIOR><LIM_SUPERIOR></LIM_SUPERIOR><VALOR_UNIDAD></VALOR_UNIDAD><CONSUMO></CONSUMO><VAL_CONSUMO></VAL_CONSUMO>
</LDC_RANGOS>
<LDC_RANGOS>
<LIM_INFERIOR></LIM_INFERIOR><LIM_SUPERIOR></LIM_SUPERIOR><VALOR_UNIDAD></VALOR_UNIDAD><CONSUMO></CONSUMO><VAL_CONSUMO></VAL_CONSUMO>
</LDC_RANGOS>
<LDC_RANGOS>
<LIM_INFERIOR></LIM_INFERIOR><LIM_SUPERIOR></LIM_SUPERIOR><VALOR_UNIDAD></VALOR_UNIDAD><CONSUMO></CONSUMO><VAL_CONSUMO></VAL_CONSUMO>
</LDC_RANGOS>
<LDC_RANGOS_2>
<LIM_INFERIOR1> </LIM_INFERIOR1>
<LIM_SUPERIOR1> </LIM_SUPERIOR1>
<VALOR_UNIDAD1> </VALOR_UNIDAD1>
<CONSUMO1> </CONSUMO1>
<VAL_CONSUMO1> </VAL_CONSUMO1>
<LIM_INFERIOR2> </LIM_INFERIOR2>
<LIM_SUPERIOR2> </LIM_SUPERIOR2>
<VALOR_UNIDAD2> </VALOR_UNIDAD2>
<CONSUMO2> </CONSUMO2>
<VAL_CONSUMO2> </VAL_CONSUMO2>
<LIM_INFERIOR3> </LIM_INFERIOR3>
<LIM_SUPERIOR3> </LIM_SUPERIOR3>
<VALOR_UNIDAD3> </VALOR_UNIDAD3>
<CONSUMO3> </CONSUMO3>
<VAL_CONSUMO3> </VAL_CONSUMO3>
<LIM_INFERIOR4> </LIM_INFERIOR4>
<LIM_SUPERIOR4> </LIM_SUPERIOR4>
<VALOR_UNIDAD4> </VALOR_UNIDAD4>
<CONSUMO4> </CONSUMO4>
<VAL_CONSUMO4> </VAL_CONSUMO4>
<LIM_INFERIOR5> </LIM_INFERIOR5>
<LIM_SUPERIOR5> </LIM_SUPERIOR5>
<VALOR_UNIDAD5> </VALOR_UNIDAD5>
<CONSUMO5> </CONSUMO5>
<VAL_CONSUMO5> </VAL_CONSUMO5>
<LIM_INFERIOR6> </LIM_INFERIOR6>
<LIM_SUPERIOR6> </LIM_SUPERIOR6>
<VALOR_UNIDAD6> </VALOR_UNIDAD6>
<CONSUMO6> </CONSUMO6>
<VAL_CONSUMO6> </VAL_CONSUMO6>
<LIM_INFERIOR7> </LIM_INFERIOR7>
<LIM_SUPERIOR7> </LIM_SUPERIOR7>
<VALOR_UNIDAD7> </VALOR_UNIDAD7>
<CONSUMO> </CONSUMO>
<VAL_CONSUMO7> </VAL_CONSUMO7>
</LDC_RANGOS_2>
<LDC_COMPCOST>
<COMPCOST>Gm = $1239 Tm = $293 Dm = $498 Cv = $0 Cc = $0 Cm = $3894</COMPCOST><VALORESREF>DES(h)=0 IPLI=100% IO=100% IRST=NO APLICA</VALORESREF><VALCALC>DES(h)=0 COMPENSACION($)=0</VALCALC>
</LDC_COMPCOST>
<LDC_CUPON>
<COD_BAR>(415)7707232377896(8020)0173909900(3900)0000760178(96)20300617</COD_BAR>
</LDC_CUPON>
<EXTRA_BARCODE_>
<CODE>415770723237789680200173909900È39000000760178È9620200617</CODE>
<IMAGE></IMAGE>
</EXTRA_BARCODE_>
<LDC_DATOS_MARCA>
<VISIBLE>1</VISIBLE>
<IMPRESO>JILLY MORENO MOYA</IMPRESO>
</LDC_DATOS_MARCA>
<DATOS_ADICIONALES>
<DIRECCION_PRODUCTO></DIRECCION_PRODUCTO>
<CAUSA_DESVIACION></CAUSA_DESVIACION>
<PAGARE_UNICO> </PAGARE_UNICO>
</DATOS_ADICIONALES>
</LDC_FACTURA>';

    MERGE INTO OPEN.ED_DOCUMENT A USING
    (SELECT
      2067890707 as DOCUCODI,
      66 as DOCUTIDO,
      89615 as DOCUPEFA,
      TO_DATE('06/06/2020 6:41:01 pm', 'DD/MM/YYYY HH:MI:SS AM') as DOCUFERE,
      sbFactura DOCUDOCU
      FROM DUAL) B
    ON (A.DOCUCODI = B.DOCUCODI and A.DOCUTIDO = B.DOCUTIDO)
    WHEN NOT MATCHED THEN 
    INSERT (
      DOCUCODI, DOCUTIDO, DOCUPEFA, DOCUFERE, DOCUDOCU)
    VALUES (
      B.DOCUCODI, B.DOCUTIDO, B.DOCUPEFA, B.DOCUFERE, B.DOCUDOCU)
    WHEN MATCHED THEN
    UPDATE SET 
      A.DOCUPEFA = B.DOCUPEFA,
      A.DOCUFERE = B.DOCUFERE,
      A.DOCUDOCU = B.DOCUDOCU;
      
    
    COMMIT;
    dbms_output.put_line('Fin OSF-2980');

exception
  when others then
    dbms_output.put_line('Error: ' || sqlerrm);

END;
/

select to_char(sysdate,'yyyy-mm-dd hh:mi:ss p.m.') fecha_fin from dual;
set serveroutput off
quit
/