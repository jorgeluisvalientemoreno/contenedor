column dt new_value vdt
column db new_value vdb
select to_char(sysdate,'yyyymmdd_hh24miss') dt, sys_context('userenv','db_name') db from dual;
set serveroutput on size unlimited
execute dbms_application_info.set_action('APLICANDO DATAFIX');
select to_char(sysdate,'yyyy-mm-dd hh:mi:ss p.m.') fecha_inicio from dual;

declare

	cursor cuOrdenActuCausal is
       SELECT od.order_id, od.causal_id, rownum nurownum
	   FROM or_order od
	   WHERE od.order_id in
	   (
            272636601,
            273727950,
            274682893,
            274830699,
            275582891,
            275585941,
            275585965,
            274683199,
            273177956,
            273179659,
            274758584,
            274927714,
            274928329,
            275175294,
            275585945,
            273286449,
            273318630,
            273946758,
            274687430,
            274680213,
            275095983,
            275096908,
            275543900,
            275543925,
            275543586,
            275543596,
            275543960,
            275543964,
            275543724,
            275543745,
            275543986,
            275543906,
            275543921,
            275543961,
            273090726,
            273091794,
            273322588,
            273294520,
            273286241,
            273286246,
            273286260,
            273286263,
            273286530,
            273286545,
            273286551,
            273286590,
            273286893,
            273287029,
            273946775,
            274685655,
            274687925,
            274685754,
            274680233,
            275096178,
            275096346,
            275176081,
            275453969,
            275521254,
            274902760,
            273743839,
            273743837,
            273728304,
            273728014,
            274466721,
            274466681,
            274466082,
            275093140,
            275096532,
            275096708,
            275097752,
            275179504,
            274679949,
            273944652,
            275453694,
            275453966,
            275453971,
            275454022,
            273743842,
            273743829,
            274683054,
            274907083,
            274927486,
            275092976,
            275093169,
            275319508,
            275448500,
            275450514,
            275450524,
            275445806,
            275450536,
            275448584,
            275448564,
            275450595,
            275448691,
            275471628,
            275471763,
            275543329,
            275543478,
            275569217,
            275543415,
            275543489,
            275543661,
            275543312,
            275562364,
            275543630,
            275559794,
            275543457,
            275543736,
            273286857,
            273293364,
            273293365,
            273298738,
            273743828,
            274687781,
            274830951,
            274924979,
            274924709,
            275093159,
            275095973,
            275450519,
            275448596,
            275448616,
            275448641,
            275450585,
            275448449,
            275448568,
            275505966,
            275471854,
            273183368,
            273286522,
            273286544,
            273286565,
            273416805,
            273571116,
            273571187,
            273572084,
            273570976,
            273573632,
            273727590,
            273728025,
            274201511,
            274402864,
            274683156,
            274680450,
            274713671,
            275097370,
            275183634,
            275183746,
            275471037,
            275471039,
            275471101,
            275450278,
            275450319,
            275450377,
            275448440,
            275450401,
            275450260,
            275450376,
            275450598,
            275471520,
            275471045,
            275471228,
            275471470,
            275471020,
            275471033,
            275471073,
            275471150,
            275448598,
            275448474,
            275471484,
            275507597,
            275543691,
            273183175,
            273286543,
            273570782,
            275001336,
            275471494,
            274686345,
            274902416,
            275450383,
            275450176,
            275448347,
            275450179,
            275450494,
            275450522,
            275450523,
            275471066,
            273091750,
            273091017,
            273089991,
            273286286,
            273945553,
            273946392,
            274649501,
            274780612,
            274927362,
            275179583,
            275179586,
            275179608,
            275179715,
            275471051,
            275471090,
            275471102,
            275471145,
            275471392,
            275584050,
            275579433,
            273286482,
            273286612,
            273286627,
            273286638,
            273286639,
            273292110,
            273295221,
            273292854,
            273416794,
            273619545,
            274686902,
            275450370,
            273286323,
            273286407,
            273286446,
            273286471,
            273290800,
            273569680,
            275096985,
            275583824,
            273083665,
            275179633,
            274466926,
            274252583,
            271764969,
            273090341,
            273290951,
            273286437,
            273286465,
            273291171,
            273316852,
            273316912,
            274736052,
            274252588,
            275757597,
            274185117,
            275757546,
            275757547,
            275757600,
            275757601,
            274184888,
            274185746,
            275471861,
            275757514,
            275757520,
            275757543,
            275757544,
            275757578,
            275757575,
            275757592,
            275757586,
            272309028,
            273955767,
            273954871,
            273954867,
            273955040,
            273955849,
            274186082,
            274186111,
            274927803,
            275428345,
            275757537,
            273955566,
            273954786,
            274185942,
            274185571,
            275757527,
            274185120,
            274466056,
            274466106,
            275445812,
            275517822,
            275471818,
            275471826,
            273628038,
            273627935,
            274830455,
            274586613,
            274652890,
            275450520,
            275517764,
            275517828,
            275471815,
            275469564,
            275766362,
            275517814,
            273572228,
            273572232,
            273570126,
            273570293,
            273570488,
            273570619,
            273570649,
            273570665,
            273570671,
            273570695,
            273570717,
            273570631,
            273570634,
            273570640,
            273570639,
            273570656,
            273571248,
            273955044,
            273954857,
            273955887,
            274185476,
            274185484,
            274252646,
            274252582,
            274467268,
            274466502,
            274466050,
            275319857,
            275519232,
            275519589,
            275450510,
            275517794,
            275514744,
            275517856,
            275519125,
            275518241,
            275471831,
            274252623,
            273571621,
            273571679,
            273572285,
            273570107,
            273570451,
            273570623,
            273570629,
            273570657,
            273570679,
            273570670,
            273570675,
            273570287,
            273570555,
            273570998,
            273571273,
            273571350,
            273571608,
            273954939,
            273996490,
            274186141,
            274185889,
            274185365,
            274252563,
            274252642,
            275445859,
            275452405,
            273570315,
            273572375,
            273955461,
            273624215,
            273572220,
            273570053,
            273570268,
            273571208,
            273573959,
            273955792,
            274185877,
            274184875,
            274186152,
            274252600,
            274252585,
            275336347,
            275447367,
            275471829,
            273561290,
            273561140,
            273956239,
            273955290,
            273955202,
            273955528,
            273955655,
            273954986,
            273954920,
            273954825,
            275335429,
            275445857,
            275757614,
            275757615,
            275757621,
            275445847,
            275471812,
            275471817,
            273954953,
            273955862,
            273954944,
            275361453,
            275757616,
            275757618,
            275757619,
            273955035,
            275757622,
            273614279,
            273627721,
            273628222,
            273954830,
            273954974,
            273955005,
            273955698,
            274185438,
            274185379,
            274185816,
            274186566,
            274186576,
            274185220,
            274186148,
            274184884,
            274184257,
            274185445,
            274184344,
            274186023,
            274186106,
            274272288,
            275175414,
            275511413,
            273561064,
            273561146,
            273561168,
            273561191,
            273561353,
            273561356,
            273561368,
            273561399,
            273561055,
            273561109,
            273561547,
            273561553,
            273561574,
            273955010,
            273954846,
            273561304,
            273075652,
            273613059,
            273613288,
            273627100,
            273736652,
            273948549,
            273954799,
            274185374,
            274186385,
            274185204,
            273561411,
            274186574,
            274185661,
            274185433,
            274185336,
            274184436,
            273561124,
            273561272,
            273561380,
            273561567,
            273561590,
            273629812,
            273179390,
            273561475,
            273561531,
            273561556,
            273561115,
            273561158,
            273561178,
            273561182,
            273561212,
            273561307,
            273561431,
            273561437,
            273561489,
            273561496,
            273561501,
            273561558,
            273561565,
            273561106,
            273561129,
            273561197,
            273561295,
            273561306,
            273561323,
            273561336,
            273561352,
            273561361,
            273561426,
            273561102,
            273561114,
            273561618,
            273561406,
            273561412,
            273561487,
            273561492,
            273561498,
            273628224,
            274444861,
            274444876,
            274466361,
            275097667,
            273570518,
            273571518,
            273955094,
            273736513,
            273954862,
            273954826,
            273613896,
            273614126,
            273614371,
            273615645,
            273614544,
            273627884,
            273629566,
            273626317,
            273626396,
            273743070,
            273955403,
            274185385,
            274184275,
            274184969,
            274185326,
            274185487,
            274185381,
            274185462,
            274186093,
            274184901,
            274185894,
            274185919,
            273561395,
            273628911,
            273629037,
            274204529,
            274577488,
            274577490,
            273561536,
            273561576,
            273561284,
            273561420,
            273561423,
            273561529,
            273561532,
            273561572,
            273561591,
            273561607,
            273561157,
            273561213,
            273561270,
            273561400,
            273561097,
            273561461,
            273626307,
            273942617,
            273942619,
            274204527,
            274204528,
            274577491,
            274204520,
            274204524,
            274577497,
            274444801,
            274447076,
            274577485,
            274577462,
            274577457,
            274577460,
            274578030,
            274577493,
            274577509,
            274577520,
            275097330,
            273572062,
            273570284,
            273569937,
            273570527,
            273570797,
            273570893,
            273570958,
            273571155,
            273948387,
            273948389,
            273948371,
            274577466,
            274577468,
            274577469,
            274577473,
            274577496,
            274577508,
            273955883,
            274577439,
            273561564,
            273626779,
            273626897,
            273628325,
            273948592,
            274444891,
            274577512,
            274578216,
            273948402,
            273948391,
            273954882,
            274577516,
            274577522,
            274578173,
            273954812,
            274577443,
            274577445,
            274577456	   
	   );

	PROCEDURE pActuCausalOrden( inuOrden or_order.order_id%TYPE, inuCausal or_order.causal_id%TYPE, inuRownum NUMBER )
	IS
        rcOrderComment  daor_order_comment.styor_order_comment;
        
        sbComment       or_order_comment.order_comment%TYPE := 'Se actualiza la causal 3443 por OSF-919';
        nuCommTypeId    or_order_comment.comment_type_id%TYPE := 83;
        
	BEGIN

        IF ( inuCausal IN ( 3396 ,3397 ) )
        THEN 
    
            UPDATE or_order
            SET causal_id = 3443  -- REVOCACION DE ORDEN (USO EXCLUSIVO CARTERA)
            WHERE order_id = inuOrden;
            
            rcOrderComment.order_comment_id := or_bosequences.fnuNextOr_Order_Comment;
            rcOrderComment.order_comment    := sbComment;
            rcOrderComment.order_id         := inuOrden;
            rcOrderComment.comment_type_id  := nuCommTypeId;
            rcOrderComment.register_date    := ut_date.fdtSysdate;
            rcOrderComment.legalize_comment := GE_BOConstants.csbNO;
            rcOrderComment.person_id        := ge_boPersonal.fnuGetPersonId;

            daor_order_comment.insRecord(rcOrderComment);

            dbms_output.put_line( 'Ok update causal orden |'|| inuOrden );
            
            IF MOD( inuRownum, 50 )= 0 THEN 
                commit;
            END IF;
            
        ELSE

            dbms_output.put_line( 'No se actualiza Orden |'|| inuOrden || '|causal actual|' || inuCausal );        
            
        END IF;
			  
	exception
		when others then
			dbms_output.put_line( 'ERROR:  orden|' || inuOrden || '|' || SQLERRM );
			rollback;	

	END pActuCausalOrden;

BEGIN

	FOR reg IN cuOrdenActuCausal LOOP
		pActuCausalOrden( reg.order_id , reg.causal_id, reg.nurownum);
	END LOOP;
	
	commit;
	
END;
/

select to_char(sysdate,'yyyy-mm-dd hh:mi:ss p.m.') fecha_fin from dual;
set serveroutput off
quit
/