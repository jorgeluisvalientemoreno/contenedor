column dt new_value vdt
column db new_value vdb
select to_char(sysdate,'yyyymmdd_hh24miss') dt, sys_context('userenv','db_name') db from dual;
set serveroutput on size unlimited
execute dbms_application_info.set_action('APLICANDO DATAFIX');
select to_char(sysdate,'yyyy-mm-dd hh:mi:ss p.m.') fecha_inicio from dual;

declare

	nuQuotaBlockId		ld_quota_block.Quota_Block_Id%TYPE;
	nuCausalId			ld_quota_block.Causal_Id%TYPE		:= 130; 
	sbCaso				VARCHAR2(30) 						:= 'OSF-4760';
	sbObservation		ld_quota_block.Observation%TYPE		:= 'Se bloquea cupo por solicitud del Ã¡rea de cartera FNB, usuarios con cambios de condiciones.';
	sbUserName			ld_quota_block.Username%TYPE		:= PKG_SESSION.GETUSER;
	sbTerminal			ld_quota_block.Terminal%TYPE		:= PKG_SESSION.FSBGETTERMINAL;
	sbencabezadoLog 	VARCHAR2(1000) 						:= 'QUOTA_BLOCK_ID|BLOCK|SUBSCRIPTION_ID|CAUSAL_ID|REGISTER_DATE|OBSERVATION|USERNAME|TERMINAL|RESULTADO';
	sblog				VARCHAR2(5100);
	dtRegisterDate		DATE								:= LDC_BOCONSGENERALES.FDTGETSYSDATE;
	rcContratosBloqueo	DALD_quota_block.styLD_quota_block;
	
	CURSOR cuContratos
	IS
		SELECT susccodi
		FROM suscripc  
		WHERE susccodi IN (1000868,
1007177,
1026938,
1028443,
1045243,
1052304,
1052600,
1053611,
1062099,
1066012,
1068731,
1082591,
1083417,
1088586,
1099007,
1102245,
1104488,
1107584,
1107845,
1110922,
1113290,
1113484,
1114262,
1116662,
1119342,
1119391,
1119552,
1121660,
1124709,
1131007,
1135867,
1137941,
1138804,
1139399,
1140117,
1141815,
1143250,
1145547,
1147154,
1149414,
1150363,
1153933,
1157783,
1157926,
1165674,
1166148,
1167045,
1168418,
1171169,
1171332,
1176043,
1176408,
1177433,
1177765,
1177799,
1180785,
1181251,
1181568,
1182229,
1188681,
1189937,
1190042,
1190418,
1191525,
1705086,
1705199,
2112200,
2125123,
2150649,
2156543,
2158583,
2159595,
2163973,
2164107,
2164695,
2166604,
2166628,
2169352,
2169855,
2170200,
2170302,
2171915,
2172437,
2173626,
2173752,
2176028,
2176917,
2177140,
2177365,
2177708,
2179207,
2179871,
2180276,
2181269,
2182482,
2182976,
2182979,
2183344,
2185458,
2185644,
2185889,
2186416,
2187435,
2188224,
2189544,
2189826,
2191031,
2192075,
2192297,
2192500,
3057574,
4100052,
4166412,
4167153,
4169143,
4170433,
5156952,
5157626,
5157723,
5160616,
5160997,
5163228,
5163359,
6076160,
6076549,
6079940,
6087792,
6088293,
6094767,
6096364,
6096441,
6097926,
6099027,
6099809,
6101395,
6101437,
6101876,
6104541,
6107522,
6112062,
6112356,
6120954,
6123331,
6126445,
6129505,
6135429,
6136034,
6139244,
6209053,
6209399,
6209528,
6210353,
6217662,
6218029,
6222303,
6224428,
6227050,
6228968,
6230553,
6232776,
6232904,
6234726,
6240861,
8085628,
8091293,
8092226,
8092542,
8093747,
8095385,
8095520,
9055681,
9056492,
10000886,
10004027,
10004123,
10004171,
10004681,
11000459,
13000804,
13001259,
14212767,
14216221,
14217695,
14225362,
14228833,
15000655,
16101442,
16101474,
16102049,
16103501,
16104287,
16104861,
16105000,
16105092,
17101093,
17101329,
17101682,
17101940,
17101967,
17102147,
17102472,
17102618,
17102649,
17103317,
17103986,
17104494,
17104988,
17105216,
17105528,
17105645,
17105884,
17106458,
17106572,
17106620,
17107822,
17107954,
17108309,
17108883,
17109544,
17109557,
17109575,
17109762,
17110228,
17110752,
17111453,
17112107,
17112433,
17113512,
17114273,
17115847,
17116316,
17118185,
17119461,
17119989,
17120263,
17120992,
17121374,
17121805,
17121911,
17122294,
17122379,
17122843,
17123212,
17123240,
17124270,
17124653,
17125608,
17125904,
17126357,
17126418,
17127621,
17128875,
17129282,
17129436,
17130720,
17130894,
17131329,
17131379,
17132518,
17132582,
17132595,
17134259,
17134381,
17134771,
17134821,
17135043,
17135046,
17135442,
17136171,
17136858,
17137110,
17138097,
17140171,
17141012,
17141048,
17142055,
17144238,
17144251,
17144809,
17144829,
17145233,
17146277,
17146453,
17147732,
17148074,
17148446,
17149338,
17149720,
17150071,
17150373,
17150709,
17150718,
17150833,
17150852,
17151089,
17151859,
17154643,
17154732,
17155060,
17155295,
17155738,
17155991,
17156570,
17156600,
17156854,
17156898,
17162328,
17164361,
17165169,
17165325,
17166236,
17167439,
17169443,
17169920,
17170632,
17170986,
17171582,
17172153,
17172293,
17172445,
17172808,
17173177,
17173284,
17174502,
17174634,
17174645,
17175151,
17175239,
17175245,
17175382,
17175507,
17175558,
17175676,
17175896,
17176056,
17176099,
17176184,
17176189,
17176192,
17176269,
17176724,
17176914,
17178982,
17179690,
17180650,
17180668,
17181415,
17181424,
17181659,
17181825,
17182294,
17182534,
17183174,
17183340,
17183624,
17183999,
17184017,
17184070,
17184079,
17184100,
17185025,
17185676,
17185974,
17186524,
17186525,
17186543,
17186742,
17187736,
17188341,
17188537,
17188596,
17189231,
17190184,
17190363,
17190645,
17190919,
17191084,
17191146,
17191557,
17192405,
17192747,
17194147,
17196905,
17198770,
17198890,
17199378,
17200244,
17200759,
17201963,
17202899,
17204539,
17204736,
17207491,
17208385,
17208412,
17208458,
17209679,
17209949,
17209952,
17210319,
17210862,
17210897,
17211311,
17211385,
17212275,
17212429,
17213123,
17213184,
17214115,
17214392,
17217689,
17218572,
17219519,
17220802,
17221534,
17221875,
17221982,
17222252,
17222771,
19000860,
19000949,
20201417,
22000232,
24001115,
26000601,
48002001,
48002659,
48004141,
48005255,
48005429,
48005585,
48006946,
48008741,
48009435,
48010014,
48010063,
48011318,
48013582,
48013867,
48014140,
48015602,
48016416,
48018353,
48019517,
48020033,
48020764,
48026476,
48026612,
48028102,
48030130,
48030690,
48030857,
48033797,
48037137,
48038208,
48041777,
48044528,
48046328,
48053339,
48060052,
48064388,
48068028,
48072048,
48073925,
48074630,
48075618,
48075853,
48078064,
48079455,
48081833,
48085382,
48089449,
48089759,
48090053,
48091180,
48091816,
48097616,
48101023,
48101903,
48102817,
48108189,
48109399,
48109795,
48110137,
48112452,
48113430,
48114517,
48115292,
48115664,
48121951,
48123202,
48123616,
48124213,
48126310,
48126627,
48129932,
48130045,
48135149,
48138027,
48140546,
48141363,
48143342,
48143572,
48145879,
48148158,
48148774,
48151507,
48152367,
48153817,
48153845,
48154264,
48154794,
48154900,
48158742,
48159903,
48160344,
48162920,
48163216,
48164620,
48166249,
48166669,
48166735,
48166745,
48167374,
48168052,
48169620,
48170833,
48171619,
48171822,
48173621,
48177987,
48179397,
48184059,
48184495,
48185649,
48186850,
48187379,
48188781,
48188805,
48188891,
48189329,
48189765,
48192406,
48193625,
48193785,
48195954,
48196200,
48197967,
48199414,
48200264,
48203569,
48203615,
48205819,
48206551,
48209920,
48209975,
48210152,
48211788,
48211968,
48212490,
48214418,
48218551,
48219005,
48219073,
48224823,
48225877,
48227539,
48228660,
48229581,
48231972,
48232074,
48232499,
48232516,
48233567,
48233568,
48234037,
48234849,
48234894,
48234936,
48235317,
48235352,
48235392,
48238294,
48241293,
48242257,
48242330,
48242343,
48243316,
48246932,
48248388,
48258308,
48258535,
66248559,
66257315,
66260453,
66261744,
66262721,
66264134,
66264321,
66264626,
66265535,
66266730,
66267413,
66269235,
66269962,
66273848,
66274222,
66274570,
66274770,
66275777,
66276422,
66278876,
66285012,
66287125,
66288388,
66288489,
66288969,
66292109,
66292131,
66292285,
66299393,
66300909,
66303883,
66304091,
66304641,
66308025,
66309086,
66311587,
66311670,
66312624,
66325596,
66328305,
66329292,
66333545,
66338687,
66342171,
66346875,
66360842,
66361139,
66365985,
66366348,
66371061,
66379871,
66382732,
66410068,
66415919,
66417048,
66417137,
66423306,
66424965,
66425887,
66426707,
66427956,
66428445,
66436093,
66447924,
66459130,
66459144,
66465055,
66466430,
66471405,
66474367,
66476863,
66480347,
66482179,
66483240,
66484526,
66488277,
66489046,
66490585,
66490705,
66492579,
66495507,
66506023,
66507349,
66508329,
66508471,
66509434,
66513843,
66522176,
66528642,
66533427,
66538187,
66542210,
66543004,
66547927,
66548241,
66552521,
66553042,
66553517,
66567041,
66569863,
66581377,
66590724,
66590892,
66599855,
66608826,
66611421,
66617406,
66617648,
66617671,
66617853,
66620396,
66621368,
66623501,
66625992,
66626024,
66626123,
66634140,
66639997,
66641258,
66651758,
66652931,
66657501,
66672023,
66673004,
66674145,
66685071,
66686928,
66687324,
66687542,
66687925,
66689199,
66689830,
66689887,
66690130,
66691788,
66693195,
66697355,
66697798,
66698170,
66699007,
66700515,
66701650,
66708577,
66713047,
66717591,
66717737,
66718580,
66720930,
66723543,
66727311,
66732651,
66733695,
66734961,
66737528,
66738174,
66742859,
66743185,
66752658,
66754990,
66756091,
66758500,
66761487,
66764906,
66766614,
66767836,
66768030,
66779903,
66780333,
66781639,
66787865,
66790884,
66791660,
66796331,
66800263,
66806467,
66810351,
66810469,
66810666,
66812681,
66813854,
66816315,
66817887,
66818065,
66818301,
66826508,
66829162,
66831021,
66832334,
66836378,
66836583,
66840221,
66842541,
66843118,
66847244,
66848243,
66849372,
66854250,
66858886,
66860247,
66861574,
66861785,
66865446,
66865455,
66867943,
66868018,
66870838,
66871312,
66871440,
66872758,
66875145,
66875750,
66876655,
66878022,
66879833,
66880982,
66884327,
66886396,
66886407,
66886720,
66887931,
66888648,
66897401,
66899749,
66900110,
66900434,
66903470,
66904095,
66904277,
66905871,
66910684,
66910973,
66913325,
66917770,
66925619,
66926654,
66931545,
66936456,
66937135,
66941001,
66941587,
66945659,
66948109,
66952035,
66956681,
66957547,
66957569,
66960147,
66961089,
66961487,
66965071,
66971090,
66971388,
66974190,
66976663,
66977181,
66977549,
66981567,
66982889,
66984758,
66985080,
66987461,
66988070,
66988231,
66989880,
66990787,
66999109,
67000053,
67001199,
67010224,
67011862,
67012567,
67022346,
67036047,
67037722,
67041643,
67057334,
67071374,
67073603,
67075153,
67076654,
67077159,
67080108,
67081559,
67086581,
67089248,
67090990,
67092193,
67095399,
67098034,
67100487,
67102231,
67102680,
67114710,
67115895,
67133019,
67138330,
67140896,
67153037,
67156878,
67158898,
67160379,
67161349,
67162821,
67163238,
67173060,
67173242,
67180890,
67184818,
67190119,
67191992,
67198243,
67209983,
67217489,
67221332,
67226638,
67233284,
67235612,
67237593,
67241074,
67241109,
67242889,
67247334,
67247357,
67250951,
67254021,
67254152,
67255740,
67265010,
67269507,
67269936,
67270230,
67270474,
67271209,
67272283,
67275849,
67285263,
67288616,
67289456,
67290365,
67295656,
67299578,
67301748,
67306106,
67316049,
67317178,
67324832,
67333593,
67336317,
67337832,
67343543,
67350638,
67351589,
67352040,
67352131,
67356416,
67357863,
67359657,
67361834,
67363914,
67374319,
67380064,
67385790,
67405325,
67418515,
67423355,
67429763,
67440332,
67445150,
67449304,
67449593,
67483837,
67505476);

BEGIN

	dbms_output.put_line('Inicio Datafix OSF-4760');
	
	FOR rcContratos IN cuContratos LOOP
		
		BEGIN
		
			nuQuotaBlockId  := NULL;
			nuQuotaBlockId	:= SEQ_LD_QUOTA_BLOCK.NEXTVAL;
				
			-- Llena el registro de los contratos
			rcContratosBloqueo.Quota_Block_Id 	:= nuQuotaBlockId;
			rcContratosBloqueo.Block 			:= 'Y';
			rcContratosBloqueo.Subscription_Id 	:= rcContratos.susccodi;
			rcContratosBloqueo.Causal_Id 		:= nuCausalId;
			rcContratosBloqueo.Register_Date 	:= dtRegisterDate;
			rcContratosBloqueo.Observation 		:= sbObservation;
			rcContratosBloqueo.Username			:= sbUserName;
			rcContratosBloqueo.Terminal			:= sbTerminal; 
			
			DALD_quota_block.insRecord(rcContratosBloqueo);
			
			COMMIT;	
			
			sblog := nuQuotaBlockId || '|Y|' || rcContratos.susccodi || '|' || nuCausalId || '|' || dtRegisterDate || '|' || sbObservation || '|' || sbUserName || '|' || sbTerminal || '|EXITO';
			
			dbms_output.put_line(sbencabezadoLog || CHR(10) || sblog);
		
		EXCEPTION
			WHEN OTHERS then
				sblog := nuQuotaBlockId || '|Y|' || rcContratos.susccodi || '|' || nuCausalId || '|' || dtRegisterDate || '|' || sbObservation || '|' || sbUserName || '|' || sbTerminal || '|FALLO';
				ROLLBACK;
		END;
		
	END LOOP;	
	
	dbms_output.put_line('FIN Datafix OSF-4760');
	
END;
/
select to_char(sysdate,'yyyy-mm-dd hh:mi:ss p.m.') fecha_fin from dual;
set serveroutput off
quit
/