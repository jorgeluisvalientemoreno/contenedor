declare
  nuError           number;
  sbError           varchar2(4000);
  
  cursor cuDatos is
   select p.subscription_id, p.product_id, pa.package_id, pa.request_date,pa.motive_status_id, m.category_id, m.subcategory_id
    from open.pr_product p
    inner join open.mo_motive m on m.product_id=p.product_id
    inner join open.mo_packages pa on pa.package_id = m.package_id and pa.package_type_id=100225 and pa.request_date>='21/01/2025' and m.subcategory_id=5 and m.category_id = 3
    where p.subscription_id in (17223044,17212164,17194004,18001410,17178836,17218162,17209301,48052668,17192337,17223466,17218839,17152601,6215324,4101237,17163139,48025551,
                                1999647,66277539,4168392,2171360,1999658,48002300,17104208,17132900,17129443,17117131,17115084,17123286,17129923,17191161,17191162,17192432,
                                48118571,48035282,48032685,48126466,48109706,2175344,2178220,199565,17135051,17192181,17174687,17154180,14223549,17223572,17127972,1999586,
                                48024890,2156730,6215909,1000905,48052666,48052662,2100062,6230001,48148557,199633,14226053,17125891,17127837,48223980,2100065,48201362,48080741,
                                48147811,6235351,48139431,17146982,48070353,17138741,17132159,17133298,17135842,16103265,17136005,17104374,17146806,17120380,2100063,17193665,17124793,
                                17118573,17169222,17107508,17112303,17118671,17118027,17124932,17118037,17154135,17145861,17154074,1999545,8090201,1182573,14054873,48053762,17160160,
                                17154581,17222594,48131355,17189730,48002152,48051478,48107256,48095515,48150763,48093278,48157489,48138992,48170363,1000984,48251575,48052665,48249028,
                                1116311,48052664,1014442,1185815,1041670,1001927,1129907,1036432,1082787,1999639,1999587,66413217,66413753,66496019,66522309,66511233,66531286,66689972,
                                66545295,66614652,66651546,66681232,66700721,66750017,66758403,66729310,66735638,66741698,66814728,66861735,66869507,66878609,67001626,67039454,67043036,
                                67095831,67075460,67077957,17222557,48361338,17222512,17179188,17181761,17223464,17224485,17216192,3143068,3161474,1999580,48211075,2187123,6236383,1999631,
                                48082057,67126789,67110046,67133269,67167795,67153673,67151687,67192008,67185261,67201460,67206498,67230227,67259965,67309293,67371932,67463397,67463396,67506846,
                                67517011,67525666,67569881,48052660,17116960,48070354,17152800,48002132,17118672,48179260,17118645,66268418,17104206,66254329,17125359,48038477,48029142,48136105,
                                48090916,17159637,48004401,1136965,5156362,48053657,17216193,5157264,1081994,5160682,14213181,17174487,1109235,17117436,1000867,48052658,4168183,2178738,1153977,
                                48049191,4167433,6139594,48201472,17139950,17116966,17108798,17131090,17123141,17119565,17117932,2100067,4168593,2100064,17120178,17122022,48239992,17120143,17104207,
                                17154136,17150640,17161045,17169430,17192132,17173496,17192203,48132030,48154659,48155280,48235183,48254538,48249027,1191328,1001361,1999557,9086941,1134535,1999682,
                                1003087,1999546,1999638,1176604,1999584,1999585,1185354,66354845,66354847,66346600,66346596,66383259,66400933,66414015,66459159,66490966,66553294,66580073,66579043,
                                66585367,66582846,66611667,66613393,66611658,66617750,66669003,66749623,66745312,66812121,66844634,66887246,66887878,66909142,67137592,67126790,67148763,67148761,
                                67165092,67172282,67192011,67230198,67233515,67240660,67258837,67273884,67330908,67371313,67406355,67412058,67436054,67525658,199634,17207774,66266975,66277281,
                                17222615,17217901,17210246,48052667,17218433,4168395,4167144,8162700,17160173,17156235,66242953,48070170,48170325,48109685,48002301,48002857,17181190,14207031,
                                48010071,17119138,17117936,17127527,17104205,48042846,48032686,1191221,14218159,17210126,17209785,17174486,17173251,7059208,1061739,48095014,14221225,48052661,
                                48052659,48052663,48199988,2100066,17119708,6231380,7059237,4169052,4168632,2100058,4168841,199569,48231293,48181379,48199517,48078644,17147469,17135852,17120179,
                                17132902,17139286,17146870,17121657,17118045,17107509,17120317,17120448,2100061,4167421,17133333,17139442,17122404,48109226,17150636,17107495,17108730,17117435,
                                17151020,48072833,48067569,1084126,6111623,1999605,1177780,1000999,17151018,17217895,17187557,48150809,48061223,48124367,48121721,48104723,48119215,48162499,48206766,
                                48178533,48159002,1099769,48204984,48224303,48198490,48211347,1999629,1191459,1505657,1999660,1999559,1000862,1137164,1085685,1999604,66299678,66340588,66428875,66436596,
                                66460858,66517241,66524072,66545360,66584614,66588829,66611664,66644038,66657178,66701816,66698969,66757048,66823704,66839958,66856880,66859356,66844681,66848471,66889509,
                                66996214,66968362,67037534,67017644,67021655,67099699,67134464,67112614,67114279,67148762,67175721,67176958,67172186,67182953,67193789,67224069,67224230,67330900,67344395,
                                67387974,67433840,67509794,67539438,67513955)
      and p.product_type_id=7014
    ;
begin
    --Script para corregir los datos de la solicitudes de los productos que se corrigieron ayer, se legalizaron con subcategoria 5 y tenia que ser 1.
    dbms_output.put_line('PRODUCTO|RESULTADO');
    for reg in cuDatos loop
      begin
        update mo_motive m set m.subcategory_id = 1 where m.package_id=reg.package_id and m.product_id = reg.product_id;
        update mo_bill_data_change bi set bi.old_subcategory_id = 5, bi.new_subcategory_id = 1  where package_id=reg.package_id;
        update or_order_activity  a set value1='Cod_Subcategoria>1>>>' where a.package_id=reg.package_id and a.product_id=reg.product_id and a.task_type_id=12622 and value1='Cod_Subcategoria>5>>>';
        commit;
        dbms_output.put_line(reg.product_id||'|OK');
      exception
        when others then
          rollback;
          pkg_error.setError;
          pkg_error.getError(nuError, sbError);
          dbms_output.put_line(reg.product_id||'|'||sbError);
      end;
    end loop;
end;
/    