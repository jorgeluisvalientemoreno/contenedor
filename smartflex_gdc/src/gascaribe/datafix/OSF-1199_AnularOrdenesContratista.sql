column dt new_value vdt
column db new_value vdb
select to_char(sysdate,'yyyymmdd_hh24miss') dt, sys_context('userenv','db_name') db from dual;
set serveroutput on size unlimited
execute dbms_application_info.set_action('APLICANDO DATAFIX');
select to_char(sysdate,'yyyy-mm-dd hh:mi:ss p.m.') fecha_inicio from dual;

DECLARE
  CURSOR cuDatos IS
    SELECT a.package_id,
           a.product_id,
           a.subscription_id,
           o.order_id,
           o.created_date,
           o.order_status_id,
           o.operating_unit_id
      FROM open.or_order_activity a, open.or_order o
     WHERE a.order_id IN (285687426,285553885,285761850,285762256,285761793,285761925,285762004,285761988,285762660,285761885,285762017,285764236,285761921,
						285762046,285762514,285762029,285762109,285762022,285762069,285761795,285761893,285762072,285761963,285761965,285762007,285762013,
						285762038,285762160,285761801,285762006,285762012,285762138,285762107,285762110,285761856,285761892,285761926,285761979,285762008,
						285762021,285762001,285762283,285763173,285762045,285762099,285762128,285762116,285761894,285762078,285762016,285761796,285762011,
						285762184,285761852,285761797,285761854,285762033,285761922,285762055,285762161,285762065,285762145,285762238,192198180,285762293,
						285761798,285761851,285761927,285761999,285762062,285762071,285762080,285762108,285761919,285761924,285761984,285762009,285763162,
						285762049,285762257,285761849,285762217,285762073,285761969,285762044,285761886,285761891,285762056,285761890,285761966,285761981,
						285761986,285762060,285762088,285761794,287191998,285761799,285761889,285761982,285761998,285762098,285761855,285761985,285762081,
						285761847,285762173,192198179,287193445,285761977,192198184,285762089,285553879,285553883,285762146,285762090,192198175,285761888,
						285765284,285762058,285762120,285762199,285761918,285762193,285762250,192198185,192198178,192198183,192198176,287191997,285762237,
						287192000,285761800,285762002,285762091,285761792,285761993,285762131,285762179,285762500,285765439,285762010,285762024,285762112,
						192198181,285762681,287193441,285761848,285761987,285762216,285762095,285761887,285761920,285762019,285762178,285762084,285762165,
						285761853,285761967,285762015,285761968,285762030,285761970,285762074,287192814,285761964,285761978,192198174,287194011,287192816,
						192198177,287192815,285553886,287194012,287193439,287192001,287191994,287193444,285553887,287191999,287192817,287192002,287191995,
						287193440,192198182)
       and a.order_id = o.order_id
     order by package_id;

  sbOrderCommen varchar2(4000) := 'Se cambia estado a anulado por caso OSF-1199';
  nuCommentType number := 1277;
  nuErrorCode   number;
  sbErrorMesse  varchar2(4000);
BEGIN

  FOR reg IN cudatos LOOP
    BEGIN
      dbms_output.put_line('Orden: ' || reg.order_id);
      
	  or_boanullorder.anullorderwithoutval(reg.order_id, SYSDATE);
    
      OS_ADDORDERCOMMENT(reg.order_id, nuCommentType, sbOrderCommen, nuErrorCode, sbErrorMesse);
	  
      IF (nuErrorCode = 0) THEN
        COMMIT;
        dbms_output.put_line('Se anulo OK orden: ' || reg.order_id);
      ELSE
        ROLLBACK;
        dbms_output.put_line('Error anulando orden: ' || reg.order_id || ' : ' || sbErrorMesse);
      END IF;
    
	EXCEPTION
      WHEN OTHERS THEN
        dbms_output.put_line('Error OTHERS anulando orden: ' || reg.order_id || ' : ' || sqlerrm);
        ROLLBACK;
    END;
  END LOOP;
END;
/

select to_char(sysdate,'yyyy-mm-dd hh:mi:ss p.m.') fecha_fin from dual;
set serveroutput off
quit
/