column dt new_value vdt
column db new_value vdb
select to_char(sysdate,'yyyymmdd_hh24miss') dt, sys_context('userenv','db_name') db from dual;
set serveroutput on size unlimited
execute dbms_application_info.set_action('APLICANDO DATAFIX');
select to_char(sysdate,'yyyy-mm-dd hh:mi:ss p.m.') fecha_inicio from dual;

declare
	cursor cuOrdenes is
	select a.order_id,
       a.register_date,
       a.comment_,
       o.order_Status_id,
       a.product_id,
       o.external_address_id,
       a.address_id,
       (select p.address_id from open.pr_product p where p.product_id=a.product_id) direccion
from open.or_order_activity a 
inner join open.or_order o on o.order_id=a.order_id
where a.activity_id in (4000031,100009283,100007376,4000079,4000980)
 and a.register_date>='01/02/2022'
 and a.address_id is null
 and a.order_id in (246399525,246605872,246837891,246843323,246849328,246849329,246862324,247112619,247112634,247112956,247114357,247119201,
 247353554,247353557,247353605,247355347,247356721,247358566,247358578,247365449,247365456,247365471,247365473,247365474,247365479,247365482,
 247495753,247643536,247644023,247644579,247783292,247790590,247790592,247790681,247793016,247793144,247927485,247983658,248008779,248229963,
 248229969,248229976,248352817,248408124,249249170,249398914,249550062,249550085,249835978,249844207,249998141,250412777,250540587,250789006,
 251425383,251494639,253184135,253184754,253303938,253309613,253467911,253551173,253872034,254404410,254404413,254404421,254404432,254404443,
 254404446,254404460,254404476,254404479,254404576,254404606,255860611,256250144,256250453,256251063,256259124,256264487,256269010,256280633,
 256292734,256297144,256320503,256333389,256333964,256334490,256335122,256336415,256379002,256379211,256379434,256400478,256400624,256400680,
 256401240,256401621,256401637,256401663,256401667,256401671,256401683,256401688,256401708,256401778,256402521,256402905,256402962,256407422,
 256407781,256413975,256414120,256414864,256417605,256418004,256418020,256418616,256418727,256427513,256427549,256431995,256432817,256504829,
 256533274,256533588,256533590,256533682,256539784,256539812,256540407,256540713,256572993,256575113,256575966,256576752,256581350,256603381,
 256604284,256607644,256608166,256608909,256609178,256609929,256611238,256611293,256612035,256613624,256613628,256613736,256613830,256613942,
 256614627,256614658,256614661,256615037,256615291,256615296,256615333,256615428,256615459,256617784,256681326,256688995,256689071,256689177,
 256689280,256689456,256690555,256690888,256694432,256694437,256694685,256694743,256697372,256697373,256697408,256698155,256698699,256699609,
 256699805,256701238,256701239,256702593,256702824,256703042,256703310,256703512,256703818,256704853,256769577,256771645,256771695,256772314,
 256773253,256843522,256843828,256844232,256972380,256973362,256973556,256973581,256977459,256977478,256977669,256979150,256979965,256981035,
 256981871,256981931,256982120,256983337,256983805,256999369,257002366,257004136,257004602,257005425,257006598,257006787,257021869,257049371,
 257055367,257066064,257090533,257090677,257091337,257091650,257103187,257125383,257126785,257127064,257127347,257127649,257127962,257128058,
 257128455,257130551,257182863,257183793,257184863,257185424,257185567,257185770,257191987,257192659,257193175,257193482,257195041,257195437,
 257195557,257195597,257195850,257197550,257199234,257199391,257201122,257201425,257201445,257201541,257202077,257202137,257202603,257316220,
 257316318,257316468,257316682,257316828,257317080,257317984,257318467,257318575,257319951,257321787,257324906,257350149,257351252,257351752,
 257518228,257522361,257536615,257550333,257553925,257571452,257607237,257622676,257640624,257696228,257696300,257696820,257697597,257700926,
 257702116,257704539,257706689,257708416,257711833,257712239,257714192,257720542,257725898,257727184,257739945,257740196,257742793,257743171,
 257746087,257746483,257746507,257761347,257804157,257813291,257815411,257815826,257816024,257816083,257816216,257817140,257817831,257898326,
 257898477,257900836,257902024,257902107,257902456,257902687,257941730,257970620,257972862,257984008,257984789,257984834,258013098,258017188,
 258024931,258024988,258025342,258036930,258037085,258037268,258116025,258116033,258117209,258117321,258156263,258156375,258157088,258163010,
 258167092,258170283,258171757,258258363,258280082,258312652,258333224,258333478,258333575,258414448,258473720,258481245,258511680,258512075,
 258512819,258515879,258516283,258516351,258518582,258518585,258518662,258564183,258624023,258671128,258676175,258685396,258685697,258692447,
 258692669,258700969,258701111,258705154,258705304,258705796,258706251,258733510,258738547,258738902,258738914,258739312,258743848,258745491,
 258921260,258944612,258948753,258966366,258966723,258969135,258969203,258969782,258970059,258970233,258970819,258971575,258971743,258971753,
 258971770,258971904,258971947,259041729,259046437,259046713,259049766,259050392,259051940,259052101,259052135,259052158,259052159,259052163,
 259052162,259052161,259052164,259052809,259054273,259054525,259054545,259054546,259054547,259054548,259054570,259054884,259055230,259055908,
 259055981,259071214,259083828,259083836,259083837,259083841,259083843,259083840,259084200,259084278,259084345,259084731,259084928,259085763,
 259086008,259086123,259108959,259108960,259113757,259116173,259118523,259118903,259120490,259120613,259122687,259125692,259126004,259128744,
 259146611,259146616,259147197,259147712,259147727,259147950,259148027,259148134,259148191,259148212,259148528,259148576,259148633,259173365,
 259174163,259178904,259182230,259186131,259216708,259216709,259220269,259221195,259221270,259221556,259223009,259224146,259249907,259250770,
 259268812,259274654,259278833,259278842,259278844,259281370,259287890,259290619,259296623,259304659,259305979,259325527,259397376,259404779,
 259405609,259406041,259406159,259406268,259409269,259410115,259410132,259564583,259573488,259577511,259591627,259591971,259598846,259621765,
 259621986,259622499,259747227,259747325,259749309,259751046,259751483,259892374,259901213,259908018,260029198,260040508,260079241,260079267,
 260167908,260177148,260182365,260194840,260196038,260207755,260211814,260212188,260212724,260275892,260284328,260286417,260332698,260332699,
 260332806,260334390,260339669,260350309,260384895,260384897,260448368,260448370,260449963,260450185,260471979,260510495,260515172,260515621,
 260583653,260650815,260651679,260653356,260654134,260796562,260803770,260807417,260808079,260875427,260895120,260937095,260967753,260992815,
 261020671,261058265,261126512,261126771,261183537,261195788,261208098,261208097,261208114,261208115,261208152,261208153,261208163,261208449,
 261209541,261209741,261209752,261209760,261209770,261209773,261209777,261209780,261209797,261209798,261209953,261209958,261209963,261209966,
 261209967,261209970,261209974,261209977,261209976,261209975,261209978,261209980,261209981,261209982,261209990,261209992,261209993,261209996,
 261210002,261210004,261210008,261210007,261210009,261210015,261210017,261210019,261210020,261210024,261210038,261210040,261210130,261210134,
 261210138,261210141,261210139,261210188,261210198,261210195,261210206,261210209,261210212,261210215,261210216,261210218,261210219,261210222,
 261210221,261210225,261210234,261210233,261210237,261210242,261210241,261210243,261210244,261210247,261210248,261432337,261706108,261708502,
 261744074,261761796,261762510,261922917,261947197,261948008,261948070,262002582,262004000,262038551,262075485,262200948,262211762,262243976,
 262247967,262344357,262347492,262348251)
 and a.product_id is not null
 and not exists(select null from open.ct_order_certifica c where c.order_id=o.order_id);
begin
	for reg in cuOrdenes loop
		begin
			update or_order ot set ot.external_address_id=reg.direccion where ot.order_id=reg.order_id and ot.external_Address_id is null;
			update or_order_activity ac set ac.address_id=reg.direccion where ac.order_id=reg.order_id and ac.address_id is null;
			update or_extern_systems_id ex set address_id=reg.direccion where ex.order_id=reg.order_id;
			commit;
		exception
			when others then
				rollback;
				dbms_output.put_line(reg.order_id||'|'||sqlerrm);
		end;
	end loop;
end;
/

select to_char(sysdate,'yyyy-mm-dd hh:mi:ss p.m.') fecha_fin from dual;
set serveroutput off
quit
/