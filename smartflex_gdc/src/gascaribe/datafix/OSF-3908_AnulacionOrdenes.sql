column dt new_value vdt
column db new_value vdb
select to_char(sysdate,'yyyymmdd_hh24miss') dt, sys_context('userenv','db_name') db from dual;
set serveroutput on size unlimited
execute dbms_application_info.set_action('APLICANDO DATAFIX');
select to_char(sysdate,'yyyy-mm-dd hh:mi:ss p.m.') fecha_inicio from dual;

DECLARE
  CURSOR cuDatos IS
    SELECT a.package_id,
           a.product_id,
           a.subscription_id,
           o.order_id,
           o.created_date,
           o.order_status_id,
           o.operating_unit_id
      FROM open.or_order_activity a, open.or_order o
     WHERE a.order_id IN (  351191589, 351191592, 351191596, 351191597, 351191624, 351194758, 351195527, 351194871, 351195118, 351194786,
                            351191625, 351191588, 351191593, 351191626, 351191630, 351195240, 351194884, 351195858, 351194902, 351195202,
                            351191672, 351191591, 351191587, 351191590, 351191717, 351195278, 351194942, 351194824, 351194856, 351195686,
                            351191663, 351191755, 351191662, 351191702, 351191666, 351194967, 351195236, 351195271, 351195898, 351195607,
                            351191655, 351191665, 351191703, 351191756, 351191743, 351195721, 351195972, 351195940, 351194920, 351195714,
                            351191804, 351191711, 351191820, 351191750, 351191772, 351195351, 351195346, 351196018, 351196012, 351195381,
                            351191817, 351191742, 351191795, 351191793, 351191782, 351195433, 351196127, 351195470, 351194957, 351195948,
                            351191701, 351191826, 351191868, 351191677, 351191906, 351194980, 351194989, 351195635, 351195979, 351196259,
                            351191951, 351191860, 351191723, 351191891, 351191733, 351195120, 351196330, 351195933, 351195165, 351195662,
                            351191933, 351191729, 351191819, 351191858, 351191810, 351195699, 351196027, 351195851, 351195200, 351196105,
                            351191973, 351191941, 351192033, 351191757, 351191814, 351195958, 351196281, 351196139, 351195270, 351195448,
                            351191987, 351192040, 351191869, 351191912, 351191953, 351196254, 351195384, 351196434, 351196285, 351196476,
                            351191913, 351192027, 351191803, 351191812, 351191840, 351195456, 351196469, 351195640, 351196643, 351195799,
                            351191889, 351191897, 351192074, 351191853, 351192117, 351196460, 351196812, 351196852, 351195659, 351195681,
                            351192149, 351191924, 351192183, 351191892, 351192073, 351196893, 351195738, 351196046, 351195743, 351196767,
                            351192077, 351191971, 351192165, 351192112, 351192024, 351196414, 351195801, 351196894, 351196944, 351195864,
                            351192059, 351192123, 351192220, 351191993, 351192069, 351195901, 351195956, 351197004, 351196258, 351196760,
                            351192036, 351192166, 351192161, 351192267, 351191980, 351196795, 351196377, 351196080, 351196570, 351196726,
                            351192098, 351192259, 351192140, 351192198, 351192304, 351196697, 351196730, 351196610, 351196162, 351196647,
                            351192190, 351192016, 351192061, 351192305, 351192342, 351195961, 351196315, 351196379, 351197185, 351196719,
                            351192152, 351192363, 351192403, 351192101, 351192243, 351196831, 351196757, 351197025, 351196823, 351197093,
                            351192389, 351191942, 351192194, 351192451, 351192236, 351197232, 351196959, 351197523, 351196937, 351196111,
                            351191979, 351192197, 351192247, 351192276, 351192495, 351197366, 351197101, 351197562, 351197140, 351197175,
                            351192322, 351192452, 351192146, 351192490, 351191989, 351197534, 351197192, 351197364, 351196694, 351196264,
                            351192203, 351192032, 351192037, 351192265, 351192316, 351197120, 351197491, 351196480, 351196826, 351197891,
                            351192359, 351192070, 351192234, 351192554, 351192408, 351197179, 351198041, 351198070, 351198135, 351197457,
                            351192446, 351192324, 351192562, 351192598, 351192268, 351197796, 351196803, 351197007, 351198319, 351198120,
                            351192645, 351192368, 351192614, 351192402, 351192308, 351198419, 351198550, 351197683, 351198245, 351198469,
                            351192347, 351192319, 351192435, 351192730, 351192367, 351198325, 351197036, 351198359, 351197749, 351198615,
                            351192664, 351192278, 351192431, 351192455, 351192496, 351197210, 351198401, 351198917, 351197239, 351198786,
                            351192539, 351192569, 351192411, 351192318, 351192361, 351197291, 351198818, 351198932, 351198489, 351198946,
                            351192428, 351192450, 351192434, 351192121, 351192163, 351198971, 351197897, 351199104, 351198584, 351199105,
                            351192506, 351192850, 351192889, 351192534, 351192201, 351197934, 351199174, 351198683, 351198686, 351199212,
                            351192929, 351192524, 351192576, 351192975, 351192238, 351199168, 351199235, 351198589, 351198622, 351198941,
                            351192755, 351192689, 351192787, 351192619, 351192661, 351199616, 351198952, 351198579, 351199138, 351197807,
                            351192725, 351192835, 351192765, 351192274, 351192701, 351197841, 351199056, 351199237, 351199803, 351199313,
                            351192704, 351192876, 351192302, 351192578, 351192739, 351199346, 351198082, 351199297, 351200035, 351199958,
                            351193057, 351193095, 351192742, 351192636, 351192355, 351199154, 351199534, 351199576, 351200508, 351199837,
                            351192284, 351192925, 351192690, 351192965, 351192726, 351199805, 351199972, 351199323, 351199353, 351200632,
                            351192820, 351193139, 351193019, 351192625, 351192792, 351200224, 351199857, 351200115, 351200982, 351201301,
                            351193061, 351193224, 351192354, 351192397, 351193275, 351198960, 351199059, 351200192, 351200641, 351201582,
                            351192707, 351193146, 351192851, 351192669, 351192843, 351200703, 351200944, 351201994, 351200836, 351201547,
                            351192859, 351192433, 351192886, 351192891, 351192736, 351201018, 351201323, 351201618, 351201845, 351202061,
                            351192932, 351192440, 351192772, 351193181, 351192817, 351201325, 351201499, 351201532, 351200100, 351202110,
                            351192931, 351193322, 351192966, 351192942, 351192777, 351203084, 351202206, 351202235, 351201792, 351201972,
                            351193364, 351193393, 351192511, 351193435, 351193006, 351201823, 351202020, 351202271, 351203569, 351203450,
                            351192715, 351192992, 351192501, 351192572, 351192986, 351203498, 351202901, 351203243, 351204154, 351204747,
                            351192543, 351193014, 351193085, 351193280, 351193320, 351204176, 351203331, 351203796, 351201504, 351204387,
                            351192667, 351192870, 351193122, 351192616, 351193388, 351203650, 351204138, 351204991, 351203877, 351204476,
                            351192767, 351193422, 351192831, 351192920, 351192796, 351205010, 351204161, 351204370, 351205030, 351204500,
                            351192662, 351193039, 351192956, 351192847, 351192706, 351204195, 351204346, 351204244, 351204049, 351204269,
                            351192993, 351193460, 351192700, 351192893, 351193206, 351204574, 351204599, 351191621, 351191712, 351191671,
                            351193531, 351193062, 351193081, 351192744, 351192905, 351191692, 351191777, 351191636, 351191848, 351191911,
                            351193106, 351192786, 351193250, 351192829, 351192857, 351191900, 351192071, 351191760, 351191977, 351191985,
                            351193524, 351192718, 351193123, 351193038, 351193143, 351192023, 351191938, 351191956, 351192107, 351192078,
                            351193569, 351192989, 351193195, 351193023, 351192780, 351192108, 351192277, 351192294, 351192488, 351192688,
                            351193052, 351192890, 351193070, 351193600, 351193111, 351192388, 351192761, 351192465, 351192535, 351192606,
                            351192840, 351192949, 351193079, 351192892, 351193565, 351192581, 351192647, 351192513, 351192618, 351192660,
                            351193321, 351192935, 351192980, 351193773, 351192940, 351192574, 351192591, 351192383, 351193186, 351193104,
                            351193145, 351192981, 351193803, 351192973, 351193348, 351192666, 351192894, 351193054, 351193162, 351193487,
                            351193163, 351193214, 351193363, 351193261, 351193399, 351193497, 351193293, 351193228, 351193651, 351193690,
                            351193153, 351193839, 351193207, 351193341, 351193255, 351193264, 351193306, 351193727, 351193309, 351193406,
                            351193394, 351193288, 351193191, 351193433, 351193440, 351193537, 351193301, 351194150, 351194187, 351193730,
                            351193328, 351193227, 351193387, 351193009, 351193370, 351193272, 351193182, 351193375, 351193418, 351193355,
                            351193011, 351193451, 351193010, 351193047, 351193915, 351193503, 351194478, 351193959, 351193993, 351193621,
                            351193603, 351193954, 351193991, 351193478, 351193648, 351193525, 351194627, 351193924, 351193704, 351193571,
                            351193266, 351193499, 351193045, 351193507, 351193472, 351193728, 351194013, 351194048, 351194119, 351194115,
                            351193679, 351193548, 351194067, 351193121, 351193588, 351193816, 351194393, 351194385, 351194515, 351194412,
                            351193716, 351193617, 351193448, 351193581, 351193156, 351194549, 351194021, 351193965, 351194489, 351194520,
                            351193485, 351193662, 351193196, 351194102, 351193102, 351194058, 351194661, 351194484, 351194636, 351194510,
                            351193078, 351193142, 351193508, 351193216, 351193609, 351194939, 351195333, 351194622, 351194948, 351194677,
                            351193248, 351193694, 351193234, 351193551, 351193533, 351195038, 351194282, 351194708, 351194748, 351194318,
                            351193116, 351193343, 351193566, 351193772, 351193584, 351194823, 351194490, 351194528, 351195023, 351194541,
                            351194262, 351194291, 351193601, 351193642, 351194332, 351195121, 351194747, 351194783, 351195531, 351195033,
                            351193804, 351193461, 351194367, 351193675, 351193236, 351195849, 351195566, 351195419, 351194614, 351195601,
                            351193655, 351193620, 351193540, 351193573, 351193832, 351195458, 351194981, 351194646, 351194671, 351195339,
                            351193271, 351193851, 351194405, 351193616, 351193432, 351194841, 351195617, 351195568, 351195679, 351195977,
                            351193469, 351193324, 351193757, 351193689, 351193796, 351195309, 351195754, 351195030, 351195067, 351196045,
                            351193367, 351193724, 351193658, 351193712, 351193920, 351195136, 351195830, 351195603, 351196025, 351195438,
                            351193764, 351193547, 351193835, 351193878, 351193916, 351196065, 351196204, 351196135, 351195208, 351195011,
                            351193955, 351194027, 351193802, 351194553, 351193706, 351195062, 351195280, 351195779, 351195765, 351196216,
                            351193751, 351193963, 351194000, 351193854, 351193453, 351196495, 351196448, 351196727, 351197660, 351197333,
                            351193860, 351193488, 351193895, 351193664, 351193809, 351197439, 351197742, 351197751, 351196717, 351197863,
                            351194016, 351193886, 351194727, 351194158, 351193859, 351197906, 351198324, 351198116, 351198486, 351198723,
                            351193962, 351193932, 351194094, 351194010, 351193897, 351198282, 351197867, 351198171, 351199186, 351199502,
                            351194085, 351193964, 351194788, 351194046, 351194004, 351199555, 351200447, 351199901, 351200145, 351200182,
                            351193608, 351193516, 351193649, 351194180, 351194084, 351199288, 351199736, 351198410, 351199851, 351199420,
                            351194073, 351194128, 351194194, 351194170, 351194230, 351200095, 351200793, 351200387, 351200715, 351201009,
                            351194211, 351194227, 351194250, 351194284, 351193768, 351202026, 351202714, 351203532, 351202593, 351203541,
                            351193806, 351194252, 351194245, 351194152, 351193783, 351204164, 351203192, 351203076, 351204082, 351201563,
                            351194324, 351193568, 351194182, 351194354, 351194433, 351203855, 351204456, 351203884, 351191658, 351191586,
                            351194220, 351193614, 351194280, 351194322, 351194361, 351191828, 351191863, 351191961, 351191988, 351191761,
                            351194397, 351193719, 351194482, 351193871, 351194852, 351191838, 351191854, 351192028, 351191865, 351191870,
                            351194518, 351193769, 351194167, 351194886, 351194928, 351191902, 351192228, 351192154, 351192379, 351192064,
                            351194288, 351194202, 351193885, 351194319, 351194438, 351192109, 351192271, 351192476, 351192705, 351192491,
                            351194312, 351194357, 351194382, 351194258, 351194277, 351192164, 351192393, 351192207, 351192733, 351192481,
                            351194471, 351194349, 351194315, 351194590, 351194517, 351192803, 351192531, 351193016, 351192789, 351193217,
                            351194961, 351194630, 351193826, 351194351, 351193899, 351192593, 351193359, 351193112, 351193184, 351193084)
     and a.order_id = o.order_id
     order by package_id;
     
CURSOR cuDatos1 IS
    SELECT a.package_id,
           a.product_id,
           a.subscription_id,
           o.order_id,
           o.created_date,
           o.order_status_id,
           o.operating_unit_id
      FROM open.or_order_activity a, open.or_order o
     WHERE a.order_id IN   (351193937, 351194548, 351193923, 351193889, 351194289, 351194024, 351193074, 351194222, 351193333, 351193151,
                            351194409, 351194320, 351194444, 351194355, 351194386, 351193779, 351193318, 351193883, 351193877, 351193715,
                            351194996, 351194441, 351195037, 351195071, 351195108, 351193389, 351193652, 351194440, 351193512, 351193756,
                            351193978, 351193928, 351195144, 351194452, 351195179, 351193409, 351193592, 351194589, 351194040, 351194077,
                            351194486, 351194594, 351194011, 351194633, 351194523, 351193427, 351194122, 351194765, 351194053, 351194142,
                            351193966, 351194596, 351194116, 351194628, 351194702, 351194193, 351193692, 351194154, 351194075, 351194229,
                            351194451, 351195219, 351194667, 351194162, 351194695, 351193747, 351194110, 351193663, 351194243, 351194275,
                            351194189, 351194214, 351194558, 351194560, 351194062, 351194408, 351194477, 351194387, 351194413, 351194668,
                            351195252, 351194249, 351194598, 351194739, 351194001, 351194705, 351194743, 351194785, 351194894, 351195599,
                            351194725, 351194781, 351194755, 351194082, 351194137, 351194919, 351195261, 351194652, 351195892, 351195931,
                            351194281, 351194795, 351194177, 351194216, 351194044, 351195156, 351195464, 351194797, 351195525, 351194790,
                            351194825, 351194593, 351194309, 351194253, 351194866, 351195197, 351194817, 351195756, 351195159, 351195442,
                            351194821, 351195288, 351194832, 351194333, 351194851, 351195310, 351195473, 351195871, 351196163, 351195859,
                            351194901, 351194083, 351194897, 351194546, 351194125, 351194959, 351195906, 351195896, 351195935, 351195533,
                            351194970, 351194372, 351194858, 351195004, 351194403, 351196103, 351195485, 351195032, 351195712, 351195755,
                            351194584, 351194168, 351194982, 351194463, 351194782, 351195320, 351195524, 351195970, 351195302, 351196066,
                            351194500, 351195193, 351194854, 351194358, 351194889, 351196175, 351196615, 351195775, 351196531, 351196560,
                            351195645, 351195233, 351195082, 351195682, 351194417, 351195824, 351196769, 351196921, 351197070, 351197053,
                            351195221, 351194577, 351194447, 351194955, 351195286, 351196391, 351196296, 351197176, 351197212, 351197163,
                            351195718, 351194988, 351194703, 351195773, 351195066, 351196758, 351197622, 351197482, 351196400, 351197697,
                            351194503, 351195192, 351195388, 351194673, 351194710, 351196649, 351197864, 351197172, 351198211, 351197713,
                            351195430, 351194962, 351195815, 351194588, 351195311, 351198739, 351200279, 351201628, 351200354, 351200543,
                            351195462, 351195497, 351195167, 351195010, 351195259, 351200769, 351202032, 351201775, 351202467, 351202358,
                            351194754, 351195295, 351195040, 351194685, 351195069, 351202387, 351204060, 351202684, 351203373, 351201359,
                            351195672, 351194699, 351194737, 351195110, 351195395, 351204704, 351203578, 351203528, 351201605, 351201696,
                            351194718, 351194776, 351195716, 351195562, 351195386, 351204549, 351203793)
       and a.order_id = o.order_id
     order by package_id;

  sbOrderCommen varchar2(4000) := 'Se cambia estado a anulado por caso OSF-3908';
  nuCommentType number := 1277;
  nuErrorCode   number;
  sbErrorMesse  varchar2(4000);
BEGIN

  FOR reg IN cudatos LOOP
    BEGIN
      dbms_output.put_line('Orden: ' || reg.order_id);
      
	  or_boanullorder.anullorderwithoutval(reg.order_id, SYSDATE);
    
      OS_ADDORDERCOMMENT(reg.order_id, nuCommentType, sbOrderCommen, nuErrorCode, sbErrorMesse);
	  
      IF (nuErrorCode = 0) THEN
        COMMIT;
        dbms_output.put_line('Se anulo OK orden: ' || reg.order_id);
      ELSE
        ROLLBACK;
        dbms_output.put_line('Error anulando orden: ' || reg.order_id || ' : ' || sbErrorMesse);
      END IF;
    
	EXCEPTION
      WHEN OTHERS THEN
        dbms_output.put_line('Error OTHERS anulando orden: ' || reg.order_id || ' : ' || sqlerrm);
        ROLLBACK;
    END;
  END LOOP;
  
  FOR reg IN cudatos1 LOOP
    BEGIN
      dbms_output.put_line('Orden: ' || reg.order_id);
      
	  or_boanullorder.anullorderwithoutval(reg.order_id, SYSDATE);
    
      OS_ADDORDERCOMMENT(reg.order_id, nuCommentType, sbOrderCommen, nuErrorCode, sbErrorMesse);
	  
      IF (nuErrorCode = 0) THEN
        COMMIT;
        dbms_output.put_line('Se anulo OK orden: ' || reg.order_id);
      ELSE
        ROLLBACK;
        dbms_output.put_line('Error anulando orden: ' || reg.order_id || ' : ' || sbErrorMesse);
      END IF;
    
	EXCEPTION
      WHEN OTHERS THEN
        dbms_output.put_line('Error OTHERS anulando orden: ' || reg.order_id || ' : ' || sqlerrm);
        ROLLBACK;
    END;
  END LOOP;
END;
/

select to_char(sysdate,'yyyy-mm-dd hh:mi:ss p.m.') fecha_fin from dual;
set serveroutput off
quit
/