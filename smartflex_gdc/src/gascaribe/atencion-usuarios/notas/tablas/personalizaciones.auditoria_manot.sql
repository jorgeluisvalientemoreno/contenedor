/*******************************************************************************
    Método:         personalizaciones.auditoria_manot.sql
    Descripción:    Creación de tabla AUDITORIA_MANOT
    Autor:          jcatuche
    Fecha:          29/11/2024

    Historia de Modificaciones
    ==========================
    FECHA           AUTOR               DESCRIPCION
    29/11/2024      jcatuche            OSF-3332: Creación
*******************************************************************************/
Declare 
    CURSOR cuTabla(sbTabla VARCHAR2) IS
    SELECT COUNT(1) FROM dba_tables WHERE upper(TABLE_NAME) = upper(sbTabla);

    nuExistsTabla NUMBER; 
BEGIN
    --Validacion de existencia de entidad
    OPEN cuTabla('AUDITORIA_MANOT');
    FETCH cuTabla INTO nuExistsTabla;
    close cuTabla;
  
    IF nuExistsTabla = 0 THEN  
        EXECUTE IMMEDIATE 'CREATE TABLE PERSONALIZACIONES.AUDITORIA_MANOT  
        (
            CODIGO            NUMBER(10),  
            NOVEDAD           VARCHAR2(4),
            USUARIO           VARCHAR2(40),
            FECHA             DATE,
            SOLICITUD         NUMBER(15),
            OBSERVACION       VARCHAR2(180),
            ERROR             VARCHAR2(4000),
            CONSTRAINT CK_AUDITORIA_MANOT_NOVEDAD CHECK (NOVEDAD IS NOT NULL)
        ) TABLESPACE TSD_DEFAULT';
														
        EXECUTE IMMEDIATE 'COMMENT ON COLUMN PERSONALIZACIONES.AUDITORIA_MANOT.CODIGO               IS ''IDENTIFICADOR DEL REGISTRO''';
        EXECUTE IMMEDIATE 'COMMENT ON COLUMN PERSONALIZACIONES.AUDITORIA_MANOT.NOVEDAD              IS ''NOVEDAD MANOT''';
        EXECUTE IMMEDIATE 'COMMENT ON COLUMN PERSONALIZACIONES.AUDITORIA_MANOT.USUARIO              IS ''USUARIO QUE REGISTRA LA NOTA''';
        EXECUTE IMMEDIATE 'COMMENT ON COLUMN PERSONALIZACIONES.AUDITORIA_MANOT.FECHA                IS ''FECHA DE REGISTRO DE LA NOTA''';
        EXECUTE IMMEDIATE 'COMMENT ON COLUMN PERSONALIZACIONES.AUDITORIA_MANOT.SOLICITUD            IS ''SOLICITUD REGSITADA''';
        EXECUTE IMMEDIATE 'COMMENT ON COLUMN PERSONALIZACIONES.AUDITORIA_MANOT.OBSERVACION          IS ''OBSERVACION PARA LA NOTA A REGSITRAR''';
        EXECUTE IMMEDIATE 'COMMENT ON COLUMN PERSONALIZACIONES.AUDITORIA_MANOT.ERROR                IS ''REGISTRADA O CON ERROR''';
        EXECUTE IMMEDIATE 'COMMENT ON TABLE PERSONALIZACIONES.AUDITORIA_MANOT IS ''AUDITORIA MANOT OSF-3332''';
        EXECUTE IMMEDIATE 'ALTER TABLE PERSONALIZACIONES.AUDITORIA_MANOT ADD CONSTRAINT PK_AUDITORIA_MANOT PRIMARY KEY (CODIGO) USING INDEX TABLESPACE TSI_DEFAULT';	
        EXECUTE IMMEDIATE 'CREATE INDEX PERSONALIZACIONES.IDX_AUDITORIA_MANOT_01 ON PERSONALIZACIONES.AUDITORIA_MANOT(NOVEDAD) TABLESPACE TSI_DEFAULT';
        EXECUTE IMMEDIATE 'CREATE INDEX PERSONALIZACIONES.IDX_AUDITORIA_MANOT_02 ON PERSONALIZACIONES.AUDITORIA_MANOT(SOLICITUD) TABLESPACE TSI_DEFAULT';
        EXECUTE IMMEDIATE 'CREATE INDEX PERSONALIZACIONES.IDX_AUDITORIA_MANOT_03 ON PERSONALIZACIONES.AUDITORIA_MANOT(FECHA) TABLESPACE TSI_DEFAULT';
        
        dbms_output.put_line('Tabla AUDITORIA_MANOT creada');
        
    ELSE
        dbms_output.put_line('Tabla AUDITORIA_MANOT ya existe');
    END IF;

END;
/
PROMPT Otorga Permisos a personalizaciones.AUDITORIA_MANOT
begin
    pkg_utilidades.prAplicarPermisos('AUDITORIA_MANOT','PERSONALIZACIONES');
end;
/

