CREATE OR REPLACE PROCEDURE FIX_BRILLAINACTIVOS IS
CURSOR UX IS SELECT SESUNUSE FROM SERVSUSC WHERE SESUSERV=7055;
nuLogError number;
CUENTAS NUMBER;
DIFES NUMBER;
begin
     PKLOG_MIGRACION.prInsLogMigra (2153,2153,1,'FIX_BRILLAINACTIVOS',0,0,'Inicia Proceso','INICIO',nuLogError);
     pkErrors.setapplication('MIGRA');
     FOR U IN UX LOOP
         SELECT COUNT(1) INTO CUENTAS FROM CUENCOBR WHERE CUCONUSE=U.SESUNUSE;
         SELECT  COUNT(1) INTO DIFES FROM DIFERIDO WHERE DIFENUSE=U.SESUNUSE;
         IF CUENTAS+DIFES=0 THEN
            UPDATE SERVSUSC SET SESUESCO=95 WHERE SESUNUSE=U.SESUNUSE;
            COMMIT;
         END IF;
     END LOOP;
     COMMIT;
     PKLOG_MIGRACION.prInsLogMigra (2153,2153,3,'FIX_BRILLAINACTIVOS',0,0,'Termina Proceso','FIN',nuLogError);
END;
/
