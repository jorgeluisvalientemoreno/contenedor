CREATE OR REPLACE TRIGGER ADM_PERSON.TRGAIUDLDCRANGOCOMISION
    AFTER INSERT OR UPDATE OR DELETE ON open.LDCRANGOCOMISION
    FOR EACH ROW

DECLARE

    sbterminal VARCHAR2(20);
    sbuser     VARCHAR2(20);
BEGIN

    SELECT SYS_CONTEXT('USERENV', 'TERMINAL') INTO sbTerminal FROM DUAL;
    SELECT USER INTO sbuser FROM DUAL;

    IF inserting THEN

        BEGIN
            INSERT INTO open.LDCRANGOCOMISIONLOG
                (ZONA, RANGO_INI, RANGO_FIN, VALOR_COMISION, VALOR_COMICUMP, OPERACION, USUARIO, TERMINAL, FECHA_REGISTRO,FLAGPOREFE)
            VALUES
                (:new.ZONA, :new.RANGO_INI, :new.RANGO_FIN, :new.VALOR_COMISION, :new.VALOR_COMICUMP, 'I', sbuser, sbTerminal, SYSDATE,:new.flagporefe);
        END;
    ELSIF updating THEN
        BEGIN
            INSERT INTO open.LDCRANGOCOMISIONLOG
                (ZONA, RANGO_INI, RANGO_FIN, VALOR_COMISION, VALOR_COMICUMP, OPERACION, USUARIO, TERMINAL, FECHA_REGISTRO,FLAGPOREFE)
            VALUES
                (:new.ZONA, :new.RANGO_INI, :new.RANGO_FIN, :new.VALOR_COMISION, :new.VALOR_COMICUMP, 'U', sbuser, sbTerminal, SYSDATE,:new.flagporefe);
        END;
    ELSE
        BEGIN
            INSERT INTO open.LDCRANGOCOMISIONLOG
                (ZONA, RANGO_INI, RANGO_FIN, VALOR_COMISION, VALOR_COMICUMP, OPERACION, USUARIO, TERMINAL, FECHA_REGISTRO,FLAGPOREFE)
            VALUES
                (:OLD.ZONA, :OLD.RANGO_INI, :OLD.RANGO_FIN, :OLD.VALOR_COMISION, :OLD.VALOR_COMICUMP, 'D', sbuser, sbTerminal, SYSDATE,:old.flagporefe);
        END;
    END IF;

EXCEPTION
    WHEN OTHERS THEN
        NULL;

END;
/
