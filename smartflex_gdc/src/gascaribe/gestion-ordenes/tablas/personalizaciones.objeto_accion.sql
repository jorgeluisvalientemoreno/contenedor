DECLARE
  nuconta number;
BEGIN
  SELECT COUNT(1) INTO nuconta
  FROM DBA_TABLES
  WHERE TABLE_NAME = 'OBJETOS_ACCION'
   AND OWNER = 'PERSONALIZACIONES';
  
  IF nuconta = 0 THEN  
    EXECUTE IMMEDIATE 'CREATE TABLE PERSONALIZACIONES.OBJETOS_ACCION   (	IDACCION NUMBER NOT NULL ENABLE, 
                      TIPOACCION VARCHAR2(6 BYTE) NOT NULL ENABLE, 
                      NOMBREOBJETO VARCHAR2(500 BYTE) NOT NULL ENABLE, 
                      TIPOTRABAJO NUMBER(6,0), 
                      IDACTIVIDAD NUMBER(15,0), 
                      IDCAUSAL NUMBER(6,0), 
                      UNIDADOPERATIVA NUMBER(6,0), 
                      DESCRIPCION VARCHAR2(2000 BYTE), 
                      PROCESONEGOCIO NUMBER(15,0), 
                      ORDENEJECUCION NUMBER(3,0) NOT NULL ENABLE, 
                      ACTIVO VARCHAR2(1 BYTE) DEFAULT ''S'' NOT NULL ENABLE, 
                      FECHACREACION DATE DEFAULT SYSDATE, 
                      CONSTRAINT TIPOACCION_CK CHECK (TIPOACCION IN (''PRE'',''POST'')) ENABLE, 
                      CONSTRAINT ACTIVO_CK CHECK (ACTIVO IN (''S'',''N'')) ENABLE, 
                      CONSTRAINT ACCION_FK FOREIGN KEY (IDACCION)
                        REFERENCES PERSONALIZACIONES.ACCIONES_GENERAL (IDACCION) ON DELETE CASCADE ENABLE)';
    EXECUTE IMMEDIATE  q'#COMMENT ON COLUMN PERSONALIZACIONES.OBJETOS_ACCION.IDACCION IS 'ID DE LA ACCION'#';
    EXECUTE IMMEDIATE  q'#COMMENT ON COLUMN PERSONALIZACIONES.OBJETOS_ACCION.TIPOACCION IS 'PRE / POST'#';
    EXECUTE IMMEDIATE  q'#COMMENT ON COLUMN PERSONALIZACIONES.OBJETOS_ACCION.NOMBREOBJETO IS 'NOMBRE DEL OBJETO DE BASE DE DATOS'#';
    EXECUTE IMMEDIATE  q'#COMMENT ON COLUMN PERSONALIZACIONES.OBJETOS_ACCION.TIPOTRABAJO IS 'TIPO DE TRABAJO'#';
    EXECUTE IMMEDIATE  q'#COMMENT ON COLUMN PERSONALIZACIONES.OBJETOS_ACCION.IDACTIVIDAD IS 'ACTIVIDAD'#';
    EXECUTE IMMEDIATE  q'#COMMENT ON COLUMN PERSONALIZACIONES.OBJETOS_ACCION.IDCAUSAL IS 'CAUSAL DE LEGALIZACION'#';
    EXECUTE IMMEDIATE  q'#COMMENT ON COLUMN PERSONALIZACIONES.OBJETOS_ACCION.UNIDADOPERATIVA IS 'UNIDAD OPETATIVA'#';
    EXECUTE IMMEDIATE  q'#COMMENT ON COLUMN PERSONALIZACIONES.OBJETOS_ACCION.DESCRIPCION IS 'OBSERVACION'#';
    EXECUTE IMMEDIATE  q'#COMMENT ON COLUMN PERSONALIZACIONES.OBJETOS_ACCION.PROCESONEGOCIO IS 'PROCESO DE NEGOCIO AL QUE APLICA'#';
    EXECUTE IMMEDIATE  q'#COMMENT ON COLUMN PERSONALIZACIONES.OBJETOS_ACCION.ORDENEJECUCION IS 'ORDEN DE EJECUCION DE PROCESOS'#';
    EXECUTE IMMEDIATE  q'#COMMENT ON COLUMN PERSONALIZACIONES.OBJETOS_ACCION.ACTIVO IS 'S / N'#';
    EXECUTE IMMEDIATE  q'#COMMENT ON COLUMN PERSONALIZACIONES.OBJETOS_ACCION.FECHACREACION IS 'FECHA DE CREACION'#';
    EXECUTE IMMEDIATE  q'#COMMENT ON TABLE PERSONALIZACIONES.OBJETOS_ACCION  IS 'CONFIGURACION DE OBJETOS PRE Y POST ACCIONES Y TRANSICIONES'#';

		EXECUTE IMMEDIATE 'CREATE INDEX PERSONALIZACIONES.IDX_CON01OBJETOS_ACCION ON PERSONALIZACIONES.OBJETOS_ACCION (TIPOTRABAJO, IDACTIVIDAD, IDCAUSAL, IDACCION, TIPOACCION,unidadoperativa, ACTIVO)';
    EXECUTE IMMEDIATE 'CREATE INDEX PERSONALIZACIONES.IDX_CON02OBJETOS_ACCION ON PERSONALIZACIONES.OBJETOS_ACCION (TIPOTRABAJO, IDACCION, TIPOACCION, unidadoperativa, ACTIVO)' ;

  END IF;

 
  SELECT COUNT(*) INTO nuConta
  FROM dba_constraints
  WHERE r_constraint_name LIKE '%PK_PROCESO_NEGOCIO%'
  AND R_OWNER = 'PERSONALIZACIONES'
  AND TABLE_NAME = 'OBJETOS_ACCION';

  IF nuConta > 0 then
    EXECUTE IMMEDIATE 'ALTER TABLE PERSONALIZACIONES.OBJETOS_ACCION DROP CONSTRAINT FK_ACCION_PROCESO';
  END IF;


  begin
  pkg_utilidades.prAplicarPermisos('OBJETOS_ACCION', 'PERSONALIZACIONES');
  end;


END;
/