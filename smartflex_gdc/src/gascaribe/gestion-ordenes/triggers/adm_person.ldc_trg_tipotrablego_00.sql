CREATE OR REPLACE TRIGGER ADM_PERSON.LDC_TRG_TIPOTRABLEGO_00
  BEFORE INSERT OR UPDATE ON LDC_TIPOTRABLEGO
  REFERENCING old AS old new AS new
  for each row
DECLARE

  cursor CUOR_TASK_TYPE_CAUSAL is
    SELECT COUNT(OR_TASK_TYPE_CAUSAL.CAUSAL_ID) CANTIDAD
      FROM OR_TASK_TYPE_CAUSAL
     WHERE OR_TASK_TYPE_CAUSAL.TASK_TYPE_ID = :NEW.TIPOTRABLEGO_ID
       AND OR_TASK_TYPE_CAUSAL.CAUSAL_ID = :NEW.CAUSALLEGO_ID;

  RFCUOR_TASK_TYPE_CAUSAL CUOR_TASK_TYPE_CAUSAL%rowtype;

BEGIN
  open CUOR_TASK_TYPE_CAUSAL;
  fetch CUOR_TASK_TYPE_CAUSAL
    into RFCUOR_TASK_TYPE_CAUSAL;
  close CUOR_TASK_TYPE_CAUSAL;

  if RFCUOR_TASK_TYPE_CAUSAL.CANTIDAD <= 0 then
    errors.seterror(2741,
                    'La causal [' || :NEW.CAUSALLEGO_ID ||
                    '] no se relaciona con el Tipo de Trabajo [' ||
                    :NEW.TIPOTRABLEGO_ID || '].');
    RAISE ex.controlled_error;
  end if;

EXCEPTION
  WHEN EX.CONTROLLED_ERROR THEN
    RAISE;
  WHEN others THEN
    RAISE;
END;
/
