CREATE OR REPLACE TRIGGER ADM_PERSON.TRG_BI_RANGLIQU
AFTER INSERT OR UPDATE OR DELETE ON RANGLIQU
REFERENCING OLD AS OLD NEW AS NEW
FOR EACH ROW
DECLARE

OPERATION VARCHAR(1) := NULL;
RALICODO NUMBER(10) := NULL;
RALISESU NUMBER(10) := NULL;
RALIPEFA NUMBER(6) := NULL;
RALIPECO NUMBER(15) := NULL;
RALITICO NUMBER(4) := NULL;
RALIIDRE NUMBER(15) := NULL;
RALICONC NUMBER(4) := NULL;
RALIFECR DATE := NULL;

RALICODO_OLD NUMBER(10) := NULL;
RALISESU_OLD NUMBER(10) := NULL;
RALIPEFA_OLD NUMBER(6) := NULL;
RALIPECO_OLD NUMBER(15) := NULL;
RALITICO_OLD NUMBER(4) := NULL;
RALIIDRE_OLD NUMBER(15) := NULL;
RALICONC_OLD NUMBER(4) := NULL;
RALIFECR_OLD DATE := NULL;

BEGIN

IF INSERTING THEN
  OPERATION := 'I';
  RALICODO := :new.RALICODO ;
  RALISESU := :new.RALISESU ;
  RALIPEFA := :new.RALIPEFA ;
  RALIPECO := :new.RALIPECO ;
  RALITICO := :new.RALITICO ;
  RALIIDRE := :new.RALIIDRE ;
  RALICONC := :new.RALICONC ;
  RALIFECR := :new.RALIFECR ;
ELSIF UPDATING THEN
  OPERATION := 'U';
  RALICODO := :new.RALICODO ;
  RALISESU := :new.RALISESU ;
  RALIPEFA := :new.RALIPEFA ;
  RALIPECO := :new.RALIPECO ;
  RALITICO := :new.RALITICO ;
  RALIIDRE := :new.RALIIDRE ;
  RALICONC := :new.RALICONC ;
  RALIFECR := :new.RALIFECR ;

  RALICODO_OLD := :old.RALICODO ;
  RALISESU_OLD := :old.RALISESU ;
  RALIPEFA_OLD := :old.RALIPEFA ;
  RALIPECO_OLD := :old.RALIPECO ;
  RALITICO_OLD := :old.RALITICO ;
  RALIIDRE_OLD := :old.RALIIDRE ;
  RALICONC_OLD := :old.RALICONC ;
  RALIFECR_OLD := :old.RALIFECR ;
ELSE
  OPERATION := 'D';
  RALICODO_OLD := :old.RALICODO ;
  RALISESU_OLD := :old.RALISESU ;
  RALIPEFA_OLD := :old.RALIPEFA ;
  RALIPECO_OLD := :old.RALIPECO ;
  RALITICO_OLD := :old.RALITICO ;
  RALIIDRE_OLD := :old.RALIIDRE ;
  RALICONC_OLD := :old.RALICONC ;
  RALIFECR_OLD := :old.RALIFECR ;
END IF;
INSERT INTO LDCBI_RANGLIQU (
  RALICODO,
  RALISESU,
  RALIPEFA,
  RALIPECO,
  RALITICO,
  RALIIDRE,
  RALICONC,
  RALIFECR,
  RALICODO_OLD,
  RALISESU_OLD,
  RALIPEFA_OLD,
  RALIPECO_OLD,
  RALITICO_OLD,
  RALIIDRE_OLD,
  RALICONC_OLD,
  RALIFECR_OLD,
  OPERATION
)
VALUES (
  RALICODO,
  RALISESU,
  RALIPEFA,
  RALIPECO,
  RALITICO,
  RALIIDRE,
  RALICONC,
  RALIFECR,
  RALICODO_OLD,
  RALISESU_OLD,
  RALIPEFA_OLD,
  RALIPECO_OLD,
  RALITICO_OLD,
  RALIIDRE_OLD,
  RALICONC_OLD,
  RALIFECR_OLD,
  OPERATION
);
EXCEPTION
    WHEN OTHERS THEN
        RAISE EX.CONTROLLED_ERROR;
END;
/
