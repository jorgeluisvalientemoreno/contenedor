/*******************************************************************************
    Método:         personalizaciones.reportes_tarifa_trans.sql
    Descripción:    Creación de tabla REPORTES_TARIFA_TRANS
    Autor:          jcatuche
    Fecha:          25/10/2024

    Historia de Modificaciones
    ==========================
    FECHA           AUTOR               DESCRIPCION
    25/10/2024      jcatuche            OSF-3387: Creación
*******************************************************************************/
Declare 
    CURSOR cuTabla(sbTabla VARCHAR2) IS
    SELECT COUNT(1) FROM dba_tables WHERE upper(TABLE_NAME) = upper(sbTabla);

    nuExistsTabla NUMBER; 
BEGIN
    --Validacion de existencia de entidad
    OPEN cuTabla('REPORTES_TARIFA_TRANS');
    FETCH cuTabla INTO nuExistsTabla;
    close cuTabla;
  
    IF nuExistsTabla = 0 THEN  
        EXECUTE IMMEDIATE 'CREATE TABLE PERSONALIZACIONES.REPORTES_TARIFA_TRANS  
        (
            REPORTE           VARCHAR2(5),
            CENTRO_BENEFICIO  VARCHAR2(10),
            LOCALIDAD         NUMBER(6), 
            LOCADESC          VARCHAR2(100),
            DEPADESC          VARCHAR2(100),
            CONTRATO          NUMBER(8),
            PRODUCTO          NUMBER(10),
            CATEGORIA         NUMBER(2),
            ESTRATO           NUMBER(2),
            ACTIVO            VARCHAR2(1),
            FECHA_ULTLIQ      DATE,
            FECHA_FINAL       DATE,
            FECHA_CAMBIO      DATE,
            FECHA_ANO         NUMBER(4),
            CUENTA            NUMBER(10),
            VALOR_NOTA        NUMBER(15),
            VALOR_CR          NUMBER(15),
            VALOR_DB          NUMBER(15),
            VALOR_L1TOTAL     NUMBER(15),
            VALOR_L1          NUMBER(15),
            VALOR_L1SA        NUMBER(15),
            VALOR_L1ANUL      NUMBER(15),
            VALOR_L1DESC      NUMBER(15),
            VALOR_L1ING       NUMBER(15),    
            VALOR_CARGOTOTAL  NUMBER(15),
            VALOR_CARGO       NUMBER(15),
            CLASIFICACION     VARCHAR2(200),
            OBSERVACION       VARCHAR2(200),
            ERROR             VARCHAR2(2000)
        ) TABLESPACE TSD_DEFAULT';
														
        EXECUTE IMMEDIATE 'COMMENT ON COLUMN PERSONALIZACIONES.REPORTES_TARIFA_TRANS.REPORTE             IS ''IDENTIFICADOR DEL REPORTE''';
        EXECUTE IMMEDIATE 'COMMENT ON COLUMN PERSONALIZACIONES.REPORTES_TARIFA_TRANS.CENTRO_BENEFICIO    IS ''IDENTIFICADOR DEL CENTRO DE BENEFICIO''';
        EXECUTE IMMEDIATE 'COMMENT ON COLUMN PERSONALIZACIONES.REPORTES_TARIFA_TRANS.LOCALIDAD           IS ''IDENTIFICADOR DE LA LOCALIDAD''';
        EXECUTE IMMEDIATE 'COMMENT ON COLUMN PERSONALIZACIONES.REPORTES_TARIFA_TRANS.LOCADESC            IS ''DESCRIPCIÓN DE LA LOCALIDAD''';
        EXECUTE IMMEDIATE 'COMMENT ON COLUMN PERSONALIZACIONES.REPORTES_TARIFA_TRANS.DEPADESC            IS ''DESCRIPCIÓN DEL DEPARTAMENTO''';
        EXECUTE IMMEDIATE 'COMMENT ON COLUMN PERSONALIZACIONES.REPORTES_TARIFA_TRANS.CONTRATO            IS ''IDENTIFICADOR DEL CONTRATO''';
        EXECUTE IMMEDIATE 'COMMENT ON COLUMN PERSONALIZACIONES.REPORTES_TARIFA_TRANS.PRODUCTO            IS ''IDENTIFICADOR DEL PRODUCTO''';
        EXECUTE IMMEDIATE 'COMMENT ON COLUMN PERSONALIZACIONES.REPORTES_TARIFA_TRANS.CATEGORIA           IS ''IDENTIFICADOR DE LA CATEGORIA''';
        EXECUTE IMMEDIATE 'COMMENT ON COLUMN PERSONALIZACIONES.REPORTES_TARIFA_TRANS.ESTRATO             IS ''IDENTIFICADOR DE LA SUBCATEGORIA''';
        EXECUTE IMMEDIATE 'COMMENT ON COLUMN PERSONALIZACIONES.REPORTES_TARIFA_TRANS.ACTIVO              IS ''FLAG TARIFA ACTIVA''';
        EXECUTE IMMEDIATE 'COMMENT ON COLUMN PERSONALIZACIONES.REPORTES_TARIFA_TRANS.FECHA_ULTLIQ        IS ''FECHA DE ÚLTIMA LIQUIDACIÓN TT''';
        EXECUTE IMMEDIATE 'COMMENT ON COLUMN PERSONALIZACIONES.REPORTES_TARIFA_TRANS.FECHA_FINAL         IS ''FECHA DE FINALIZACIÓN TT''';
        EXECUTE IMMEDIATE 'COMMENT ON COLUMN PERSONALIZACIONES.REPORTES_TARIFA_TRANS.FECHA_CAMBIO        IS ''FECHA DE CAMBIO COBRO DE MÁS''';
        EXECUTE IMMEDIATE 'COMMENT ON COLUMN PERSONALIZACIONES.REPORTES_TARIFA_TRANS.FECHA_ANO           IS ''AÑO DEL REPORTO PARA LIQUIDACIÓN TT''';
        EXECUTE IMMEDIATE 'COMMENT ON COLUMN PERSONALIZACIONES.REPORTES_TARIFA_TRANS.CUENTA              IS ''IDENTIFICADOR DE LA CUENTE DE COBRO''';
        EXECUTE IMMEDIATE 'COMMENT ON COLUMN PERSONALIZACIONES.REPORTES_TARIFA_TRANS.VALOR_NOTA          IS ''SALDO O VALOR LIQUIDADO TT''';
        EXECUTE IMMEDIATE 'COMMENT ON COLUMN PERSONALIZACIONES.REPORTES_TARIFA_TRANS.VALOR_CR            IS ''VALOR CRÉDITO''';
        EXECUTE IMMEDIATE 'COMMENT ON COLUMN PERSONALIZACIONES.REPORTES_TARIFA_TRANS.VALOR_DB            IS ''VALOR DÉBITO''';
        EXECUTE IMMEDIATE 'COMMENT ON COLUMN PERSONALIZACIONES.REPORTES_TARIFA_TRANS.VALOR_L1TOTAL       IS ''VALOR CARGOS L1 TOTAL''';
        EXECUTE IMMEDIATE 'COMMENT ON COLUMN PERSONALIZACIONES.REPORTES_TARIFA_TRANS.VALOR_L1            IS ''VALOR CARGOS L1''';
        EXECUTE IMMEDIATE 'COMMENT ON COLUMN PERSONALIZACIONES.REPORTES_TARIFA_TRANS.VALOR_L1SA          IS ''VALOR CARGOS L1 SALDO A FAVOR''';
        EXECUTE IMMEDIATE 'COMMENT ON COLUMN PERSONALIZACIONES.REPORTES_TARIFA_TRANS.VALOR_L1ANUL        IS ''VALOR CARGOS L1 ANULACIÓN''';
        EXECUTE IMMEDIATE 'COMMENT ON COLUMN PERSONALIZACIONES.REPORTES_TARIFA_TRANS.VALOR_L1DESC        IS ''VALOR CARGOS L1 DESCUENTO''';
        EXECUTE IMMEDIATE 'COMMENT ON COLUMN PERSONALIZACIONES.REPORTES_TARIFA_TRANS.VALOR_L1ING         IS ''VALOR CARGOS L1 INGRESO''';
        EXECUTE IMMEDIATE 'COMMENT ON COLUMN PERSONALIZACIONES.REPORTES_TARIFA_TRANS.VALOR_CARGOTOTAL    IS ''VALOR CARGOS TOTAL CUENTA''';
        EXECUTE IMMEDIATE 'COMMENT ON COLUMN PERSONALIZACIONES.REPORTES_TARIFA_TRANS.VALOR_CARGO         IS ''VALOR CARGO JOB TT''';
        EXECUTE IMMEDIATE 'COMMENT ON COLUMN PERSONALIZACIONES.REPORTES_TARIFA_TRANS.CLASIFICACION       IS ''CLASIFICACIÓN SALDOS NEGATIVO O POSITIVO''';
        EXECUTE IMMEDIATE 'COMMENT ON COLUMN PERSONALIZACIONES.REPORTES_TARIFA_TRANS.OBSERVACION         IS ''OBSERVACIÓN DE LA CALIFICACIÓN''';
        EXECUTE IMMEDIATE 'COMMENT ON COLUMN PERSONALIZACIONES.REPORTES_TARIFA_TRANS.ERROR               IS ''ERROR EN ANÁLISIS DE LIQUIDACIÓN TT''';
        EXECUTE IMMEDIATE 'COMMENT ON TABLE PERSONALIZACIONES.REPORTES_TARIFA_TRANS IS ''REPORTES TARIFA TRANSITORIA OSF-3387''';
        EXECUTE IMMEDIATE 'ALTER TABLE PERSONALIZACIONES.REPORTES_TARIFA_TRANS ADD CONSTRAINT PK_REPORTES_TARIFA_TRANS PRIMARY KEY (REPORTE, LOCALIDAD, PRODUCTO, CUENTA) USING INDEX TABLESPACE TSI_DEFAULT';	
        EXECUTE IMMEDIATE 'CREATE INDEX PERSONALIZACIONES.IDX_REPORTES_TARIFA_TRANS_01 ON PERSONALIZACIONES.REPORTES_TARIFA_TRANS(REPORTE,LOCALIDAD) TABLESPACE TSI_DEFAULT';
        EXECUTE IMMEDIATE 'CREATE INDEX PERSONALIZACIONES.IDX_REPORTES_TARIFA_TRANS_02 ON PERSONALIZACIONES.REPORTES_TARIFA_TRANS(REPORTE,PRODUCTO) TABLESPACE TSI_DEFAULT';
        
        dbms_output.put_line('Tabla REPORTES_TARIFA_TRANS creada');
        
    ELSE
        dbms_output.put_line('Tabla REPORTES_TARIFA_TRANS ya existe');
    END IF;

END;
/
PROMPT Otorga Permisos a personalizaciones.REPORTES_TARIFA_TRANS
begin
    pkg_utilidades.prAplicarPermisos('REPORTES_TARIFA_TRANS','PERSONALIZACIONES');
end;
/
