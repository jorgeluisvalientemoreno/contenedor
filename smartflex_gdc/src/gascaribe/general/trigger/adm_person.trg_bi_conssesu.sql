CREATE OR REPLACE TRIGGER ADM_PERSON.TRG_BI_CONSSESU 
AFTER INSERT OR UPDATE OR DELETE ON OPEN.CONSSESU
REFERENCING OLD AS OLD NEW AS NEW
FOR EACH ROW

DECLARE

OPERATION VARCHAR(1) := NULL;

BEGIN

IF INSERTING THEN
  OPERATION := 'I';
  INSERT INTO LDCBI_CONSSESU (
    COSSSESU,
    COSSPEFA,
    COSSCOCA,
    COSSMECC,
    COSSFERE,
    OPERATION
)
  VALUES (
    :new.COSSSESU,
    :new.COSSPEFA,
    :new.COSSCOCA,
    :new.COSSMECC,
    :new.COSSFERE,
    OPERATION
  );
ELSIF UPDATING THEN
  OPERATION := 'U';
  INSERT INTO LDCBI_CONSSESU (
    COSSSESU,
    COSSPEFA,
    COSSCOCA,
    COSSMECC,
    COSSFERE,
    COSSSESU_OLD,
    COSSPEFA_OLD,
    COSSCOCA_OLD,
    COSSMECC_OLD,
    COSSFERE_OLD,
    OPERATION
  )
  VALUES (
    :new.COSSSESU,
    :new.COSSPEFA,
    :new.COSSCOCA,
    :new.COSSMECC,
    :new.COSSFERE,
    :old.COSSSESU,
    :old.COSSPEFA,
    :old.COSSCOCA,
    :old.COSSMECC,
    :old.COSSFERE,
    OPERATION
  );
ELSIF DELETING THEN
  OPERATION := 'D';
  INSERT INTO LDCBI_CONSSESU (
    COSSSESU,
    COSSPEFA,
    COSSCOCA,
    COSSMECC,
    COSSFERE,
    OPERATION
  )
  VALUES (
    :old.COSSSESU,
    :old.COSSPEFA,
    :old.COSSCOCA,
    :old.COSSMECC,
    :old.COSSFERE,
    OPERATION
  );
ELSE
  OPERATION := 'O';
  INSERT INTO LDCBI_CONSSESU (
    COSSSESU,
    COSSPEFA,
    COSSCOCA,
    COSSMECC,
    COSSFERE,
    COSSSESU_OLD,
    COSSPEFA_OLD,
    COSSCOCA_OLD,
    COSSMECC_OLD,
    COSSFERE_OLD,
    OPERATION
  )
  VALUES (
    :new.COSSSESU,
    :new.COSSPEFA,
    :new.COSSCOCA,
    :new.COSSMECC,
    :new.COSSFERE,
    :old.COSSSESU,
    :old.COSSPEFA,
    :old.COSSCOCA,
    :old.COSSMECC,
    :old.COSSFERE,
    OPERATION
  );
END IF;

EXCEPTION
  WHEN OTHERS THEN
    RAISE EX.CONTROLLED_ERROR;
END;
/
