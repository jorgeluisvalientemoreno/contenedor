CREATE OR REPLACE TRIGGER ADM_PERSON.TRG_BI_LDC_OSF_LDCRBAI
AFTER INSERT OR UPDATE OR DELETE ON LDC_OSF_LDCRBAI
REFERENCING OLD AS OLD NEW AS NEW
FOR EACH ROW

DECLARE

FEC_CORTE DATE;
COD_UNID_OPER NUMBER(15);
COD_ITEM NUMBER(15);
OPERATION VARCHAR2(1);

BEGIN

IF INSERTING THEN
  FEC_CORTE := :new.FEC_CORTE;
  COD_UNID_OPER := :new.COD_UNID_OPER;
  COD_ITEM := :new.COD_ITEM;
  OPERATION := 'I';
ELSIF UPDATING THEN
  FEC_CORTE := :new.FEC_CORTE;
  COD_UNID_OPER := :new.COD_UNID_OPER;
  COD_ITEM := :new.COD_ITEM;
  OPERATION := 'U';
ELSE
  FEC_CORTE := :old.FEC_CORTE;
  COD_UNID_OPER := :old.COD_UNID_OPER;
  COD_ITEM := :old.COD_ITEM;
  OPERATION := 'D';
END IF;

INSERT INTO LDCBI_LDC_OSF_LDCRBAI (
  FEC_CORTE,
  COD_UNID_OPER,
  COD_ITEM,
  OPERATION
)
VALUES (
  FEC_CORTE,
  COD_UNID_OPER,
  COD_ITEM,
  OPERATION
);

EXCEPTION WHEN OTHERS THEN
    RAISE_APPLICATION_ERROR(
        -20000,
        'Error en TRG_BI_LDC_OSF_LDCRBAI por -->' || sqlcode || chr(13) || sqlerrm
    );
END;
/
