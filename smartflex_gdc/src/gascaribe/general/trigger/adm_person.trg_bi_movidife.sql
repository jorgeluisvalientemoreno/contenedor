CREATE OR REPLACE TRIGGER ADM_PERSON.TRG_BI_MOVIDIFE
AFTER INSERT OR UPDATE OR DELETE ON MOVIDIFE

REFERENCING OLD AS OLD NEW AS NEW
FOR EACH ROW

DECLARE

OPERATION VARCHAR(1) := NULL;
MODIDIFE NUMBER(15) := NULL;
MODISUSC NUMBER(8) := NULL;
MODISIGN VARCHAR2(2) := NULL;
MODIFECH DATE := NULL;
MODIFECA DATE := NULL;
MODICUAP NUMBER(4) := NULL;
MODIVACU NUMBER(13,2) := NULL;
MODIDOSO VARCHAR2(14) := NULL;
MODICACA NUMBER(2) := NULL;
MODIUSUA VARCHAR2(40) := NULL;
MODITERM VARCHAR2(60) := NULL;
MODIPROG VARCHAR2(10) := NULL;
MODINUSE NUMBER(10) := NULL;
MODIDIIN NUMBER(5) := NULL;
MODIPOIN NUMBER(11,8) := NULL;
MODIVAIN NUMBER(13,2) := NULL;
MODICODO NUMBER(15) := NULL;

BEGIN

IF INSERTING THEN
  OPERATION := 'I';
  MODIDIFE := :new.MODIDIFE ;
  MODISUSC := :new.MODISUSC ;
  MODISIGN := :new.MODISIGN ;
  MODIFECH := :new.MODIFECH ;
  MODIFECA := :new.MODIFECA ;
  MODICUAP := :new.MODICUAP ;
  MODIVACU := :new.MODIVACU ;
  MODIDOSO := :new.MODIDOSO ;
  MODICACA := :new.MODICACA ;
  MODIUSUA := :new.MODIUSUA ;
  MODITERM := :new.MODITERM ;
  MODIPROG := :new.MODIPROG ;
  MODINUSE := :new.MODINUSE ;
  MODIDIIN := :new.MODIDIIN ;
  MODIPOIN := :new.MODIPOIN ;
  MODIVAIN := :new.MODIVAIN ;
  MODICODO := :new.MODICODO ;
ELSIF UPDATING THEN
  -- esto no deberia pasar NUNCA
  OPERATION := 'U';
  MODIDIFE := :old.MODIDIFE ;
ELSIF DELETING THEN
  OPERATION := 'D';
  MODIDIFE := :old.MODIDIFE ;
  MODISUSC := :old.MODISUSC ;
  MODISIGN := :old.MODISIGN ;
  MODIFECH := :old.MODIFECH ;
  MODIFECA := :old.MODIFECA ;
  MODICUAP := :old.MODICUAP ;
  MODIVACU := :old.MODIVACU ;
  MODIDOSO := :old.MODIDOSO ;
  MODICACA := :old.MODICACA ;
  MODIUSUA := :old.MODIUSUA ;
  MODITERM := :old.MODITERM ;
  MODIPROG := :old.MODIPROG ;
  MODINUSE := :old.MODINUSE ;
  MODIDIIN := :old.MODIDIIN ;
  MODIPOIN := :old.MODIPOIN ;
  MODIVAIN := :old.MODIVAIN ;
  MODICODO := :old.MODICODO ;
ELSE
  -- esto no deberia pasar NUNCA
  OPERATION := 'O';
  MODIDIFE := :old.MODIDIFE;
END IF;

INSERT INTO LDCBI_MOVIDIFE (
  MODIDIFE,
  MODISUSC,
  MODISIGN,
  MODIFECH,
  MODIFECA,
  MODICUAP,
  MODIVACU,
  MODIDOSO,
  MODICACA,
  MODIUSUA,
  MODITERM,
  MODIPROG,
  MODINUSE,
  MODIDIIN,
  MODIPOIN,
  MODIVAIN,
  MODICODO,
  OPERATION
)
VALUES (
  MODIDIFE,
  MODISUSC,
  MODISIGN,
  MODIFECH,
  MODIFECA,
  MODICUAP,
  MODIVACU,
  MODIDOSO,
  MODICACA,
  MODIUSUA,
  MODITERM,
  MODIPROG,
  MODINUSE,
  MODIDIIN,
  MODIPOIN,
  MODIVAIN,
  MODICODO,
  OPERATION
);

EXCEPTION
    WHEN OTHERS THEN
        RAISE EX.CONTROLLED_ERROR;
END;
/
