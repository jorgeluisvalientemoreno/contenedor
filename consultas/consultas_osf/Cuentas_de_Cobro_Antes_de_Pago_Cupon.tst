PL/SQL Developer Test script 3.0
752
DECLARE
  -- Variable declarations
  l_INUPRODUCTID            NUMBER;
  l_IDTDATE                 DATE;
  l_ONUCURRENTACCOUNTTOTAL  NUMBER;
  l_ONUDEFERREDACCOUNTTOTAL NUMBER;
  l_ONUCREDITBALANCE        NUMBER;
  l_ONUCLAIMVALUE           NUMBER;
  l_ONUDEFCLAIMVALUE        NUMBER;
  l_OTBBALANCEACCOUNTS      FA_BOACCOUNTSTATUSTODATE.TYTBBALANCEACCOUNTS;
  l_OTBDEFERREDBALANCE      FA_BOACCOUNTSTATUSTODATE.TYTBDEFERREDBALANCE;

  sbIndexAcc varchar2(20);
  sbIndexDif varchar2(20);

  cursor cuservicios/*(inuContrato number)*/ is
    select a.* from open.servsusc a where a.sesususc in (159917,
                          221581,
                          194758,
                          208294,
                          243981,
                          877590,
                          292861,
                          318105,
                          1084886,
                          160640,
                          168464,
                          269224,
                          312264,
                          1450416,
                          123630,
                          131150,
                          137150,
                          173581,
                          188193,
                          191686,
                          266118,
                          268985,
                          325090,
                          675729,
                          882146,
                          1015769,
                          1037323,
                          1474939,
                          1405858,
                          1475646,
                          1571973,
                          1618486,
                          1642394,
                          1275488,
                          1277384,
                          1513400,
                          268113,
                          1491483,
                          336544,
                          1165906,
                          1172058,
                          132515,
                          170063,
                          196575,
                          206783,
                          209167,
                          325991,
                          882127,
                          278535,
                          862469,
                          1472262,
                          123208,
                          132056,
                          218512,
                          224152,
                          150481,
                          162917,
                          310398,
                          280913,
                          922542,
                          1095390,
                          1117153,
                          172972,
                          188748,
                          1590252,
                          179786,
                          184317,
                          192482,
                          248881,
                          267058,
                          296409,
                          700174,
                          701985,
                          882065,
                          910522,
                          932745,
                          1035465,
                          1047109,
                          1079737,
                          1364081,
                          1638502,
                          1233292,
                          281772,
                          781204,
                          909108,
                          925088,
                          123611,
                          133143,
                          165999,
                          219695,
                          269459,
                          314575,
                          323959,
                          324007,
                          683563,
                          950951,
                          159843,
                          168267,
                          206231,
                          1047991,
                          1061363,
                          1131603,
                          1316703,
                          950853,
                          1097765,
                          1348969,
                          1414002,
                          1495002,
                          1628498,
                          133160,
                          156936,
                          317764,
                          861053,
                          147397,
                          163873,
                          186961,
                          162746,
                          289418,
                          296930,
                          324741,
                          673997,
                          1041698,
                          1125875,
                          1133315,
                          173204,
                          204516,
                          850044,
                          946308,
                          1140924,
                          1268544,
                          1521524,
                          1524760,
                          123657,
                          128178,
                          128505,
                          242074,
                          251206,
                          265006,
                          657990,
                          698749,
                          882565,
                          883381,
                          962521,
                          1032575,
                          1429175,
                          1519427,
                          1607823,
                          1208465,
                          1364010,
                          1389058,
                          1356292,
                          1502068,
                          1021988,
                          1179954,
                          127247,
                          190499,
                          205631,
                          227515,
                          248847,
                          726107,
                          268827,
                          725695,
                          734179,
                          1047595,
                          1077949,
                          1095277,
                          1318733,
                          1623797,
                          1440866,
                          132400,
                          171432,
                          198436,
                          219028,
                          632813,
                          164193,
                          318750,
                          1105593,
                          228856,
                          186068,
                          224272,
                          669848,
                          886988,
                          1529924,
                          123805,
                          130954,
                          131298,
                          140413,
                          165718,
                          195237,
                          265993,
                          271937,
                          325209,
                          1091053,
                          1368311,
                          1441079,
                          1512659,
                          1233849,
                          1351089,
                          1238316,
                          134163,
                          729535,
                          196672,
                          172055,
                          257071,
                          720035,
                          958879,
                          1101021,
                          1626686,
                          123248,
                          132760,
                          133248,
                          147752,
                          171176,
                          210376,
                          324416,
                          162873,
                          144653,
                          193777,
                          159490,
                          243614,
                          264461,
                          920854,
                          1052526,
                          1134618,
                          1253430,
                          1138879,
                          200480,
                          203424,
                          217664,
                          278536,
                          807140,
                          1148280,
                          1431916,
                          196993,
                          198501,
                          238637,
                          295434,
                          304781,
                          669422,
                          923414,
                          1091022,
                          1216923,
                          1402859,
                          1592299,
                          1202562,
                          1343141,
                          1365817,
                          1368469,
                          1417741,
                          1507501,
                          1608143,
                          1037996,
                          1137608,
                          124811,
                          213903,
                          281695,
                          324079,
                          847279,
                          856971,
                          158723,
                          173651,
                          197971,
                          300715,
                          720513,
                          727605,
                          756909,
                          1005137,
                          1517761,
                          1432506,
                          271912,
                          324400,
                          174717,
                          174082,
                          208886,
                          244689,
                          246537,
                          303102,
                          1146829,
                          342560,
                          665220,
                          999128,
                          1235232,
                          1248844,
                          172481,
                          267610,
                          300829,
                          324253,
                          694609,
                          882165,
                          883261,
                          1612519,
                          1226214,
                          1351274,
                          1397798,
                          1495246,
                          1547498,
                          1561162,
                          1636877,
                          1366700,
                          305691,
                          1494059,
                          1128804,
                          1179966,
                          171111,
                          186391,
                          241587,
                          316415,
                          323803,
                          192603,
                          1255603,
                          827765,
                          1081909,
                          1455957,
                          1405986,
                          1450442,
                          1584698,
                          144752,
                          148161,
                          194265,
                          246401,
                          675742,
                          1092414,
                          1137214,
                          1145830,
                          1240726,
                          1113282,
                          1141226,
                          185272,
                          1136152,
                          1299612,
                          1335924,
                          129073,
                          129749,
                          190630,
                          211077,
                          243289,
                          285693,
                          325553,
                          330053,
                          860994,
                          951817,
                          1226335,
                          1229499,
                          1236719,
                          1453939,
                          1315006,
                          1361897,
                          1510404,
                          1616924,
                          1277547,
                          165223,
                          170079,
                          202195,
                          222427,
                          328035,
                          144381,
                          158515,
                          161855,
                          309031,
                          1174079,
                          1195805,
                          1338925,
                          1464845,
                          1341222,
                          1377110,
                          1474022,
                          1534830,
                          131132,
                          202168,
                          267064,
                          162617,
                          224921,
                          282406,
                          1130594,
                          1141238,
                          1536032,
                          131222,
                          131238,
                          131274,
                          168477,
                          210181,
                          266390,
                          325429,
                          331578,
                          337521,
                          680373,
                          932461,
                          944518,
                          982713,
                          1068094,
                          1069085,
                          1256670,
                          1601074,
                          1207856,
                          1457371,
                          1589523,
                          1608179,
                          342364,
                          697232,
                          970940,
                          1015232,
                          132283,
                          268615,
                          324263,
                          342831,
                          869843,
                          881979,
                          1219925,
                          1178479,
                          171527,
                          1322983,
                          1339219,
                          807197,
                          1126849,
                          1398809,
                          1466889,
                          1438470,
                          135496,
                          323092,
                          324916,
                          1113466,
                          118085,
                          624814,
                          659445,
                          952259,
                          1044889,
                          1053775,
                          1338135,
                          1290253,
                          1403857,
                          1335456,
                          103445,
                          11495,
                          25763,
                          527655,
                          45712,
                          82320,
                          90608,
                          1098173,
                          1498,
                          1502,
                          5630,
                          24878,
                          73725,
                          98210,
                          582641,
                          972853,
                          1194583,
                          1494547,
                          1450542,
                          1533017,
                          1543094,
                          749524,
                          749548,
                          1106956,
                          1158985,
                          41707,
                          77911,
                          88399,
                          98699,
                          722567,
                          1113901,
                          557,
                          922,
                          957,
                          4365,
                          10745,
                          11505,
                          42450,
                          64198,
                          67810,
                          82886,
                          91186,
                          98213,
                          118457,
                          537381,
                          584553,
                          658926,
                          698605,
                          703201,
                          735497,
                          847846,
                          1268839,
                          1202430,
                          1394721,
                          1309756,
                          616200,
                          1173134,
                          86927,
                          37804,
                          47368,
                          89888,
                          113592,
                          1113126,
                          1126535,
                          909,
                          1334,
                          96037,
                          549894,
                          604090,
                          694817,
                          705797,
                          1209347,
                          1217938,
                          1571808,
                          581616,
                          11571,
                          6352,
                          89696,
                          99320,
                          81200,
                          29177,
                          37846,
                          54622,
                          67674,
                          74205,
                          106205,
                          112485,
                          629173,
                          749529,
                          953189,
                          967759,
                          1054813,
                          1622683,
                          1306549,
                          1424589,
                          1517698,
                          1240836,
                          1446788,
                          554912,
                          569364,
                          757008,
                          42075,
                          46448,
                          56176,
                          85120,
                          639563,
                          11502,
                          36725,
                          92210,
                          545957,
                          709305,
                          813290,
                          906438,
                          1149131,
                          1345023,
                          1206706,
                          1410546,
                          1629649,
                          1443896,
                          1573352,
                          1647412,
                          538412,
                          55615,
                          44584,
                          49660,
                          68300,
                          93948,
                          75316,
                          69757,
                          591157,
                          1292847,
                          1344069,
                          1406586,
                          1477981,
                          558860,
                          1030564,
                          109131,
                          536,
                          76420,
                          85652,
                          1414,
                          2969,
                          5457,
                          12202,
                          36026,
                          37497,
                          90402,
                          583270,
                          601385,
                          1241559,
                          1315903,
                          1360731,
                          1369723,
                          1553382,
                          541268,
                          747516,
                          1036520,
                          1113192,
                          86243,
                          90071,
                          102691,
                          652603,
                          718195,
                          788131,
                          11504,
                          47820,
                          89960,
                          1204582,
                          475171,
                          544429);

  rfcuservicios cuservicios%rowtype;

  nuCuentaCobro            open.cuencobr.cucocodi%type;
  nuCuenCobrCantidadPreLEg number;
  nuCuenCobrCantidadPosLEg number;
  nuContrato               number;
  nuProducto               number := 0;

  CURSOR cuLoadAccWithBalByProd(inuSusc NUMBER, InuServicio Number) IS
  --Cursor para establecer las cuentas de cobro que maneja el producto 
  --a fecha actual del sistema
  --CURSOR cuCargaCCConValorProd(inuSusc NUMBER, InuServicio Number) IS
    SELECT COUNT(cuco.cucocodi) ACCBAL
      FROM SERVSUSC SER, CUENCOBR CUCO
     WHERE SER.SESUSUSC = inuSusc
       and ser.sesunuse = InuServicio
       AND CUCO.CUCONUSE = SER.SESUNUSE
       AND CUCO.CUCOFEVE < SYSDATE
       AND CUCO.CUCOSACU IS NOT NULL;

BEGIN

  /*ut_trace.Init;
  ut_trace.SetOutPut(ut_trace.cnuTRACE_DBMS_OUTPUT);
  ut_trace.SetLevel(99);*/

dbms_output.put_line('Contrato|Producto');

  
    --nuContrato := 269991;
    --l_IDTDATE := to_Date('27052023 000000','ddmmyyyy hh24miss');
    --dbms_output.put_line('Contrato: ' || RFcuCONTRATO.sesususc);
    --nuContrato := RFcuCONTRATO.sesususc;
  
    l_IDTDATE := to_date('03/07/2023', 'DD/MM/YYYY');
    for rfcuservicios in cuservicios/*(RFcuCONTRATO.sesususc)*/ loop
    
      -- Variable initializations
      l_INUPRODUCTID := rfcuservicios.sesunuse;
    
      -- Call
      --/*
      FA_BOACCOUNTSTATUSTODATE.PRODUCTBALANCEACCOUNTSTODATE(INUPRODUCTID            => l_INUPRODUCTID,
                                                            IDTDATE                 => l_IDTDATE,
                                                            ONUCURRENTACCOUNTTOTAL  => l_ONUCURRENTACCOUNTTOTAL,
                                                            ONUDEFERREDACCOUNTTOTAL => l_ONUDEFERREDACCOUNTTOTAL,
                                                            ONUCREDITBALANCE        => l_ONUCREDITBALANCE,
                                                            ONUCLAIMVALUE           => l_ONUCLAIMVALUE,
                                                            ONUDEFCLAIMVALUE        => l_ONUDEFCLAIMVALUE,
                                                            OTBBALANCEACCOUNTS      => l_OTBBALANCEACCOUNTS,
                                                            OTBDEFERREDBALANCE      => l_OTBDEFERREDBALANCE);
    
      --dbms_output.put_line('*****Cuentas de cobro: ' || l_OTBBALANCEACCOUNTS.count);
      sbIndexAcc               := l_OTBBALANCEACCOUNTS.first;
      nuCuentaCobro            := 0;
      nuCuenCobrCantidadPreLEg := 0;
    
      if sbIndexAcc is not null then
        --Identificar cuentas de cobro con saldo pendiente antes de la legalizacion
        --dbms_output.put_line('*****Recorrido de cuenta de cobro con saldo antes de la legalizacion');
        loop
          if nuCuentaCobro <> l_OTBBALANCEACCOUNTS(sbIndexAcc).cucocodi then
            --dbms_output.put_line('**********Recorrido: '||sbIndexAcc);
            --dbms_output.put_line('**********Cuenta: ' || l_OTBBALANCEACCOUNTS(sbIndexAcc).cucocodi);
            --dbms_output.put_line('**********Concepto: '||l_OTBBALANCEACCOUNTS(sbIndexAcc).conccodi);
            --dbms_output.put_line('**********Edad: '||l_OTBBALANCEACCOUNTS(sbIndexAcc).cucodive);
            --dbms_output.put_line('**********saldvalo: '||l_OTBBALANCEACCOUNTS(sbIndexAcc).saldvalo);
            --nuCuentaCobro := l_OTBBALANCEACCOUNTS(sbIndexAcc).cucocodi;
          
            if l_OTBBALANCEACCOUNTS(sbIndexAcc).saldvalo > 0 then
              dbms_output.put_line(rfcuservicios.sesususc||'|'||rfcuservicios.sesunuse);
            end if;
          end if;
        
       
          sbIndexAcc := l_OTBBALANCEACCOUNTS.next(sbIndexAcc);
          exit when sbIndexAcc is null;
        end loop;
      
        --else
        --dbms_output.put_line('Sin registros de cuentas');
      end if;
      ---*/
    
    /*if sbIndexAcc is not null then
                    --Identificar cuentas de cobro con saldo pendiente antes de la legalizacion
                    dbms_output.put_line('*****Recorrido de cuenta de cobro con saldo antes de la legalizacion');
                    loop            
                      if nuCuentaCobro <> l_OTBBALANCEACCOUNTS(sbIndexAcc).cucocodi then
                        --dbms_output.put_line('**********Recorrido: '||sbIndexAcc);
                        dbms_output.put_line('**********Cuenta: '||l_OTBBALANCEACCOUNTS(sbIndexAcc).cucocodi);
                        --dbms_output.put_line('**********Concepto: '||l_OTBBALANCEACCOUNTS(sbIndexAcc).conccodi);
                        --dbms_output.put_line('**********Edad: '||l_OTBBALANCEACCOUNTS(sbIndexAcc).cucodive);
                        --dbms_output.put_line('**********saldvalo: '||l_OTBBALANCEACCOUNTS(sbIndexAcc).saldvalo);
                        nuCuentaCobro := l_OTBBALANCEACCOUNTS(sbIndexAcc).cucocodi;
                        nuCuenCobrCantidadPreLEg := nuCuenCobrCantidadPreLEg + 1;
                      end if;
                        
                      sbIndexAcc := l_OTBBALANCEACCOUNTS.next(sbIndexAcc);
                      exit when sbIndexAcc is null;              
                    end loop;
                    dbms_output.put_line('***************Cuentas de cobros pedientes [' || nuCuenCobrCantidadPreLEg || ']');
                    
                    dbms_output.put_line('*****Recorrido de cuenta de cobro con saldo despues de la legalizacion');
                    open cuLoadAccWithBalByProd(nuContrato,rfcuservicios.sesunuse);
                    fetch cuLoadAccWithBalByProd into nuCuenCobrCantidadPosLEg;
                    close cuLoadAccWithBalByProd;
                    dbms_output.put_line('***************Cuentas de cobros pedientes poslegalizacion[' || nuCuenCobrCantidadPosLEg || ']');
                else
                    dbms_output.put_line('Sin registros de cuentas');
                end if;*/
    
    /*
                dbms_output.put_line('');
                dbms_output.put_line('');      
                sbIndexDif := l_OTBDEFERREDBALANCE.first;
                dbms_output.put_line('*****Recorrido de direfridos con saldo');      
                if sbIndexDif is not null then
                    loop
                        dbms_output.put_line('**********Recorrido: '||sbIndexDif);
                        dbms_output.put_line('**********Cuenta: '||l_OTBDEFERREDBALANCE(sbIndexDif).conccodi);
                        dbms_output.put_line('**********saldvalo: '||l_OTBDEFERREDBALANCE(sbIndexDif).saldvalo);
                        
                        sbIndexDif := l_OTBDEFERREDBALANCE.next(sbIndexDif);
                        exit when sbIndexDif is null;
                    end loop;
                else
                    dbms_output.put_line('Sin registros de Diferidos');
                end if;
                //*/
    
    end loop;
    --dbms_output.put_line('-------------------------------------------------------');
END;
0
0
