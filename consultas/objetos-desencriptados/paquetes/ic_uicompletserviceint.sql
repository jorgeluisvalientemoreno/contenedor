CREATE OR REPLACE PACKAGE BODY IC_UICOMPLETSERVICEINT IS
   CSBVERSION CONSTANT VARCHAR2( 250 ) := 'SAO185253';
   CNUNIVELTRAZA CONSTANT NUMBER := 2;
   FUNCTION FSBVERSION
    RETURN VARCHAR2
    IS
    BEGIN
      RETURN IC_UICOMPLETSERVICEINT.CSBVERSION;
    EXCEPTION
      WHEN EX.CONTROLLED_ERROR THEN
         RAISE;
      WHEN OTHERS THEN
         ERRORS.SETERROR;
         RAISE EX.CONTROLLED_ERROR;
   END FSBVERSION;
   PROCEDURE PROCESS
    IS
      SBOPERATIONMODE GE_BOINSTANCECONTROL.STYSBVALUE;
      NUOPERACION NUMBER;
      SBDOGEFEIN GE_BOINSTANCECONTROL.STYSBVALUE;
      DTFECHAINI DATE;
      SBDOGEFEFI GE_BOINSTANCECONTROL.STYSBVALUE;
      DTFECHAFIN DATE;
      SBDIAS GE_BOINSTANCECONTROL.STYSBVALUE;
      NUDIAS NUMBER;
      PROCEDURE GETINSTANCEINFO
       IS
       BEGIN
         UT_TRACE.TRACE( '[ IC_UICompletServiceInt.Process.GetInstanceInfo ] INICIO', IC_UICOMPLETSERVICEINT.CNUNIVELTRAZA );
         SBOPERATIONMODE := GE_BOINSTANCECONTROL.FSBGETFIELDVALUE( 'IN_OPERATION_MODE', 'OPERATION_MODE_ID' );
         SBDOGEFEIN := GE_BOINSTANCECONTROL.FSBGETFIELDVALUE( 'IC_DOCUGENE', 'DOGEFEMO' );
         SBDOGEFEFI := GE_BOINSTANCECONTROL.FSBGETFIELDVALUE( 'IC_DOCUGENE', 'DOGEFEGE' );
         SBDIAS := GE_BOINSTANCECONTROL.FSBGETFIELDVALUE( 'DAPRINST', 'DPINIDPA' );
         NUOPERACION := UT_CONVERT.FNUCHARTONUMBER( SBOPERATIONMODE );
         DTFECHAINI := TO_DATE( SBDOGEFEIN, UT_DATE.FSBDATE_FORMAT );
         DTFECHAFIN := TO_DATE( SBDOGEFEFI, UT_DATE.FSBDATE_FORMAT );
         NUDIAS := UT_CONVERT.FNUCHARTONUMBER( SBDIAS );
         UT_TRACE.TRACE( '[ IC_UICompletServiceInt.Process.GetInstanceInfo ] FIN', IC_UICOMPLETSERVICEINT.CNUNIVELTRAZA );
       EXCEPTION
         WHEN EX.CONTROLLED_ERROR THEN
            RAISE EX.CONTROLLED_ERROR;
         WHEN OTHERS THEN
            ERRORS.SETERROR;
            RAISE EX.CONTROLLED_ERROR;
      END GETINSTANCEINFO;
      PROCEDURE VALINPUTDATA
       IS
       BEGIN
         UT_TRACE.TRACE( '[ IC_UICompletServiceInt.Process.ValInputData ] INICIO', IC_UICOMPLETSERVICEINT.CNUNIVELTRAZA );
         IC_BOCOMPLETSERVICEINT.VALINPUTDATA( DTFECHAINI, DTFECHAFIN, NUOPERACION, NUDIAS );
         UT_TRACE.TRACE( '[ IC_UICompletServiceInt.Process.ValInputData ] INICIO', IC_UICOMPLETSERVICEINT.CNUNIVELTRAZA );
       EXCEPTION
         WHEN EX.CONTROLLED_ERROR THEN
            RAISE EX.CONTROLLED_ERROR;
         WHEN OTHERS THEN
            ERRORS.SETERROR;
            RAISE EX.CONTROLLED_ERROR;
      END VALINPUTDATA;
      PROCEDURE UPDSCHEDULE
       IS
         CSBSLASH CONSTANT VARCHAR2( 1 ) := '/';
         CSBAT CONSTANT VARCHAR2( 1 ) := '@';
         CSBTOKENCONEXION CONSTANT VARCHAR2( 6 ) := 'CONEX=';
         RCPROGRAMACION DAGE_PROCESS_SCHEDULE.STYGE_PROCESS_SCHEDULE;
         SBUSUARIO VARCHAR2( 100 );
         SBCONTRASENA VARCHAR2( 100 );
         SBINSTANCIA VARCHAR2( 100 );
         SBCONEXION VARCHAR2( 1000 );
         NUIDPROGRAMACION GE_PROCESS_SCHEDULE.PROCESS_SCHEDULE_ID%TYPE;
       BEGIN
         UT_TRACE.TRACE( '[ IC_UICompletServiceInt.Process.UpdSchedule ] INICIO', IC_UICOMPLETSERVICEINT.CNUNIVELTRAZA );
         NUIDPROGRAMACION := GE_BOSCHEDULE.FNUGETSCHEDULEINMEMORY;
         RCPROGRAMACION := DAGE_PROCESS_SCHEDULE.FRCGETRECORD( NUIDPROGRAMACION );
         GE_BODATABASECONNECTION.GETCONNECTIONSTRING( SBUSUARIO, SBCONTRASENA, SBINSTANCIA );
         SBCONEXION := SBUSUARIO || CSBSLASH || SBCONTRASENA || CSBAT || SBINSTANCIA;
         SBCONEXION := BI_BOSERVICIOSDOTNET.FSBCODIFICARCONTRASENA( SBCONEXION );
         RCPROGRAMACION.PARAMETERS_ := RCPROGRAMACION.PARAMETERS_ || CSBTOKENCONEXION || SBCONEXION || GE_BOSCHEDULE.CSBSEPARADOR_PARAMETROS;
         DAGE_PROCESS_SCHEDULE.UPDRECORD( RCPROGRAMACION );
         PKGENERALSERVICES.COMMITTRANSACTION;
         UT_TRACE.TRACE( '[ IC_UICompletServiceInt.Process.UpdSchedule ] FIN', IC_UICOMPLETSERVICEINT.CNUNIVELTRAZA );
       EXCEPTION
         WHEN EX.CONTROLLED_ERROR THEN
            RAISE;
         WHEN OTHERS THEN
            ERRORS.SETERROR;
            RAISE EX.CONTROLLED_ERROR;
      END UPDSCHEDULE;
    BEGIN
      UT_TRACE.TRACE( '[ IC_UICompletServiceInt.Process ] INICIO', IC_UICOMPLETSERVICEINT.CNUNIVELTRAZA );
      GETINSTANCEINFO;
      VALINPUTDATA;
      UPDSCHEDULE;
      UT_TRACE.TRACE( '[ IC_UICompletServiceInt.Process ] FIN', IC_UICOMPLETSERVICEINT.CNUNIVELTRAZA );
    EXCEPTION
      WHEN EX.CONTROLLED_ERROR THEN
         RAISE;
      WHEN OTHERS THEN
         ERRORS.SETERROR;
         RAISE EX.CONTROLLED_ERROR;
   END PROCESS;
END IC_UICOMPLETSERVICEINT;
/


