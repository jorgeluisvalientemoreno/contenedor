
CREATE OR REPLACE PACKAGE BODY CT_BOCERTIFICATECONTROL IS
   CSBVERSION CONSTANT VARCHAR2( 10 ) := 'SAO230779';
   CSBGE_CONTRATO CONSTANT GE_ENTITY.NAME_%TYPE := 'GE_CONTRATO';
   FUNCTION FSBVERSION
    RETURN VARCHAR2
    IS
    BEGIN
      RETURN CSBVERSION;
   END FSBVERSION;
   PROCEDURE ADDCERTIFICATEDETAIL( IRCCERTIFICATEDETAIL IN DAGE_DETALLE_ACTA.STYGE_DETALLE_ACTA )
    IS
      NUINDEX BINARY_INTEGER;
    BEGIN
      NUINDEX := TBGLOBALCERTIFDETAILS.LAST;
      IF ( NUINDEX IS NULL ) THEN
         NUINDEX := 0;
      END IF;
      NUINDEX := NUINDEX + 1;
      TBGLOBALCERTIFDETAILS( NUINDEX ) := IRCCERTIFICATEDETAIL;
    EXCEPTION
      WHEN EX.CONTROLLED_ERROR THEN
         RAISE EX.CONTROLLED_ERROR;
      WHEN OTHERS THEN
         ERRORS.SETERROR;
         RAISE EX.CONTROLLED_ERROR;
   END ADDCERTIFICATEDETAIL;
   PROCEDURE ADDORDERTOCERTIFICATE( IRCORDERCERTIFICATE IN DACT_ORDER_CERTIFICA.STYCT_ORDER_CERTIFICA )
    IS
      NUINDEX BINARY_INTEGER;
    BEGIN
      NUINDEX := TBGLOBALCERTIFICATEORDERS.LAST;
      IF ( NUINDEX IS NULL ) THEN
         NUINDEX := 0;
      END IF;
      NUINDEX := NUINDEX + 1;
      TBGLOBALCERTIFICATEORDERS( NUINDEX ) := IRCORDERCERTIFICATE;
    EXCEPTION
      WHEN EX.CONTROLLED_ERROR THEN
         RAISE EX.CONTROLLED_ERROR;
      WHEN OTHERS THEN
         ERRORS.SETERROR;
         RAISE EX.CONTROLLED_ERROR;
   END ADDORDERTOCERTIFICATE;
   PROCEDURE NODETAILINSERT
    IS
    BEGIN
      BLINSERTDETAILS := FALSE;
    EXCEPTION
      WHEN EX.CONTROLLED_ERROR THEN
         RAISE EX.CONTROLLED_ERROR;
      WHEN OTHERS THEN
         ERRORS.SETERROR;
         RAISE EX.CONTROLLED_ERROR;
   END NODETAILINSERT;
   PROCEDURE CLEARCERTIFICATEDETAILS
    IS
    BEGIN
      TBGLOBALCERTIFDETAILS.DELETE;
    EXCEPTION
      WHEN EX.CONTROLLED_ERROR THEN
         RAISE EX.CONTROLLED_ERROR;
      WHEN OTHERS THEN
         ERRORS.SETERROR;
         RAISE EX.CONTROLLED_ERROR;
   END CLEARCERTIFICATEDETAILS;
   PROCEDURE CLEARCERTIFICATEORDERS
    IS
      NUINDEXORDER PLS_INTEGER;
    BEGIN
      LOOP
         EXIT WHEN NUINDEXORDER IS NULL;
         DAOR_ORDER.UPDIS_PENDING_LIQ( TBGLOBALCERTIFICATEORDERS( NUINDEXORDER ).ORDER_ID, NULL );
         NUINDEXORDER := TBGLOBALCERTIFICATEORDERS.NEXT( NUINDEXORDER );
      END LOOP;
      TBGLOBALCERTIFICATEORDERS.DELETE;
    EXCEPTION
      WHEN EX.CONTROLLED_ERROR THEN
         RAISE EX.CONTROLLED_ERROR;
      WHEN OTHERS THEN
         ERRORS.SETERROR;
         RAISE EX.CONTROLLED_ERROR;
   END CLEARCERTIFICATEORDERS;
   FUNCTION FNUCALCULATECERTIFTOTALVALUE
    RETURN GE_ACTA.VALOR_TOTAL%TYPE
    IS
      SBID_ACTA GE_BOINSTANCECONTROL.STYSBVALUE;
    BEGIN
      GE_BOINSTANCECONTROL.GETATTRIBUTENEWVALUE( CT_BOCONSTANTS.FSBGETCONTRACTORINSTANCENAME, NULL, 'GE_ACTA', 'ID_ACTA', SBID_ACTA );
      RETURN CT_BCCERTIFICATE.FNUCALCULATECERTIFTOTALVALUE( TO_NUMBER( SBID_ACTA ) );
    EXCEPTION
      WHEN EX.CONTROLLED_ERROR THEN
         RAISE EX.CONTROLLED_ERROR;
      WHEN OTHERS THEN
         ERRORS.SETERROR;
         RAISE EX.CONTROLLED_ERROR;
   END FNUCALCULATECERTIFTOTALVALUE;
   FUNCTION FNUCERTIFTOTALVALUEBYITEM( INUITEMSID IN GE_ITEMS.ITEMS_ID%TYPE )
    RETURN GE_ACTA.VALOR_TOTAL%TYPE
    IS
      SBID_ACTA GE_BOINSTANCECONTROL.STYSBVALUE;
    BEGIN
      GE_BOINSTANCECONTROL.GETATTRIBUTENEWVALUE( CT_BOCONSTANTS.FSBGETCONTRACTORINSTANCENAME, NULL, 'GE_ACTA', 'ID_ACTA', SBID_ACTA );
      RETURN CT_BCCERTIFICATE.FNUCERTIFTOTALVALUEBYITEM( TO_NUMBER( SBID_ACTA ), INUITEMSID );
    EXCEPTION
      WHEN EX.CONTROLLED_ERROR THEN
         RAISE EX.CONTROLLED_ERROR;
      WHEN OTHERS THEN
         ERRORS.SETERROR;
         RAISE EX.CONTROLLED_ERROR;
   END FNUCERTIFTOTALVALUEBYITEM;
   FUNCTION FNUCERTIFTOTALAMOUNTBYITEM( INUITEMSID IN GE_ITEMS.ITEMS_ID%TYPE )
    RETURN NUMBER
    IS
      SBID_ACTA GE_BOINSTANCECONTROL.STYSBVALUE;
    BEGIN
      GE_BOINSTANCECONTROL.GETATTRIBUTENEWVALUE( CT_BOCONSTANTS.FSBGETCONTRACTORINSTANCENAME, NULL, 'GE_ACTA', 'ID_ACTA', SBID_ACTA );
      RETURN CT_BCCERTIFICATE.FNUCERTIFTOTALAMOUNTBYITEM( TO_NUMBER( SBID_ACTA ), INUITEMSID );
    EXCEPTION
      WHEN EX.CONTROLLED_ERROR THEN
         RAISE EX.CONTROLLED_ERROR;
      WHEN OTHERS THEN
         ERRORS.SETERROR;
         RAISE EX.CONTROLLED_ERROR;
   END FNUCERTIFTOTALAMOUNTBYITEM;
   FUNCTION FNUTOTALVALUEBYORDERBYCERTTYPE
    RETURN NUMBER
    IS
      SBCERTIFICATE_TYPE_ID GE_BOINSTANCECONTROL.STYSBVALUE;
      SBORDER_ID GE_BOINSTANCECONTROL.STYSBVALUE;
    BEGIN
      GE_BOINSTANCECONTROL.GETATTRIBUTENEWVALUE( CT_BOCONSTANTS.FSBGETCONTRACTORINSTANCENAME, NULL, 'CT_CONDITIONS', 'CERTIFICATE_TYPE_ID', SBCERTIFICATE_TYPE_ID );
      GE_BOINSTANCECONTROL.GETATTRIBUTENEWVALUE( CT_BOCONSTANTS.FSBGETCONTRACTORINSTANCENAME, NULL, 'OR_ORDER', 'ORDER_ID', SBORDER_ID );
      RETURN CT_BCCERTIFICATE.FNUTOTALVALUEBYORDERBYCERTTYPE( TO_NUMBER( SBCERTIFICATE_TYPE_ID ), TO_NUMBER( SBORDER_ID ) );
    EXCEPTION
      WHEN EX.CONTROLLED_ERROR THEN
         RAISE EX.CONTROLLED_ERROR;
      WHEN OTHERS THEN
         ERRORS.SETERROR;
         RAISE EX.CONTROLLED_ERROR;
   END FNUTOTALVALUEBYORDERBYCERTTYPE;
   PROCEDURE CREATEBASICCERTIFDETAIL( INUAMOUNT IN GE_DETALLE_ACTA.CANTIDAD%TYPE, INUUNITVALUE IN GE_DETALLE_ACTA.VALOR_UNITARIO%TYPE, INUTOTALVALUE IN GE_DETALLE_ACTA.VALOR_TOTAL%TYPE, IDTDATE IN OR_ORDER.LEGALIZATION_DATE%TYPE := NULL )
    IS
    BEGIN
      CT_BOCERTIFICATECONTROL.BASICCERTIFBYDETAIL( INUAMOUNT, INUUNITVALUE, INUTOTALVALUE, IDTDATE );
    EXCEPTION
      WHEN EX.CONTROLLED_ERROR THEN
         RAISE EX.CONTROLLED_ERROR;
      WHEN OTHERS THEN
         ERRORS.SETERROR;
         RAISE EX.CONTROLLED_ERROR;
   END CREATEBASICCERTIFDETAIL;
   FUNCTION FNUGETREADVALXORDER
    RETURN GE_DETALLE_ACTA.CANTIDAD%TYPE
    IS
      SBORDER_ID GE_BOINSTANCECONTROL.STYSBVALUE;
    BEGIN
      GE_BOINSTANCECONTROL.GETATTRIBUTENEWVALUE( CT_BOCONSTANTS.FSBGETCONTRACTORINSTANCENAME, NULL, 'OR_ORDER', 'ORDER_ID', SBORDER_ID );
      RETURN PKBCLECTELME.OBTLECTVALXORDEN( TO_NUMBER( SBORDER_ID ) );
    EXCEPTION
      WHEN EX.CONTROLLED_ERROR THEN
         RAISE EX.CONTROLLED_ERROR;
      WHEN OTHERS THEN
         ERRORS.SETERROR;
         RAISE EX.CONTROLLED_ERROR;
   END FNUGETREADVALXORDER;
   FUNCTION FNUCALCERTIFREALTOTALVALUE
    RETURN GE_ACTA.VALOR_TOTAL%TYPE
    IS
      SBID_ACTA GE_BOINSTANCECONTROL.STYSBVALUE;
    BEGIN
      GE_BOINSTANCECONTROL.GETATTRIBUTENEWVALUE( CT_BOCONSTANTS.FSBGETCONTRACTORINSTANCENAME, NULL, 'GE_ACTA', 'ID_ACTA', SBID_ACTA );
      RETURN CT_BCCERTIFICATE.FNUCALCERTIFREALTOTVALUE( TO_NUMBER( SBID_ACTA ) );
    EXCEPTION
      WHEN EX.CONTROLLED_ERROR THEN
         RAISE EX.CONTROLLED_ERROR;
      WHEN OTHERS THEN
         ERRORS.SETERROR;
         RAISE EX.CONTROLLED_ERROR;
   END FNUCALCERTIFREALTOTALVALUE;
   FUNCTION FNUDOWNPAYMENTREDEEMDISC
    RETURN NUMBER
    IS
      SBID_CONTRATO GE_BOINSTANCECONTROL.STYSBVALUE;
      SBVALOR_TOTAL_CONTRATO GE_BOINSTANCECONTROL.STYSBVALUE;
      SBVALOR_ANTICIPO GE_BOINSTANCECONTROL.STYSBVALUE;
      SBANTICIPO_AMORTIZADO GE_BOINSTANCECONTROL.STYSBVALUE;
      NUADVANCEDPAYMENT GE_CONTRATO.VALOR_ANTICIPO%TYPE;
      NUCERTIFTOTALVALUE NUMBER;
      NUAMORTIZEDPAYMENT GE_CONTRATO.ANTICIPO_AMORTIZADO%TYPE;
      NUCONTRACTVALUE GE_CONTRATO.VALOR_TOTAL_CONTRATO%TYPE;
      NUDOWNPAYMENTREDEEMDISC NUMBER;
      CNUERROR_NO_TOTAL_VAL CONSTANT GE_MESSAGE.MESSAGE_ID%TYPE := 3429;
      CNUERROR_NO_ADV_PAY CONSTANT GE_MESSAGE.MESSAGE_ID%TYPE := 3431;
    BEGIN
      GE_BOINSTANCECONTROL.GETATTRIBUTENEWVALUE( CT_BOCONSTANTS.FSBGETCONTRACTORINSTANCENAME, NULL, CSBGE_CONTRATO, 'ID_CONTRATO', SBID_CONTRATO );
      GE_BOINSTANCECONTROL.GETATTRIBUTENEWVALUE( CT_BOCONSTANTS.FSBGETCONTRACTORINSTANCENAME, NULL, CSBGE_CONTRATO, 'VALOR_TOTAL_CONTRATO', SBVALOR_TOTAL_CONTRATO );
      IF ( SBVALOR_TOTAL_CONTRATO IS NULL ) THEN
         ERRORS.SETERROR( CNUERROR_NO_TOTAL_VAL );
         RAISE EX.CONTROLLED_ERROR;
      END IF;
      GE_BOINSTANCECONTROL.GETATTRIBUTENEWVALUE( CT_BOCONSTANTS.FSBGETCONTRACTORINSTANCENAME, NULL, CSBGE_CONTRATO, 'VALOR_ANTICIPO', SBVALOR_ANTICIPO );
      IF ( SBVALOR_ANTICIPO IS NULL ) THEN
         ERRORS.SETERROR( CNUERROR_NO_ADV_PAY );
         RAISE EX.CONTROLLED_ERROR;
      END IF;
      GE_BOINSTANCECONTROL.GETATTRIBUTENEWVALUE( CT_BOCONSTANTS.FSBGETCONTRACTORINSTANCENAME, NULL, CSBGE_CONTRATO, 'ANTICIPO_AMORTIZADO', SBANTICIPO_AMORTIZADO );
      NUCONTRACTVALUE := TO_NUMBER( SBVALOR_TOTAL_CONTRATO );
      NUADVANCEDPAYMENT := TO_NUMBER( SBVALOR_ANTICIPO );
      NUAMORTIZEDPAYMENT := NVL( TO_NUMBER( SBANTICIPO_AMORTIZADO ), 0 );
      IF ( NUADVANCEDPAYMENT = NUAMORTIZEDPAYMENT ) THEN
         RETURN 0;
      END IF;
      NUCERTIFTOTALVALUE := CT_BOCERTIFICATECONTROL.FNUCALCERTIFREALTOTALVALUE;
      NUCERTIFTOTALVALUE := NVL( NUCERTIFTOTALVALUE, 0 );
      IF ( NUCERTIFTOTALVALUE <= 0 ) THEN
         RETURN 0;
      END IF;
      NUDOWNPAYMENTREDEEMDISC := ( NUCERTIFTOTALVALUE * NUADVANCEDPAYMENT ) / NUCONTRACTVALUE;
      RETURN NUDOWNPAYMENTREDEEMDISC;
    EXCEPTION
      WHEN EX.CONTROLLED_ERROR THEN
         RAISE EX.CONTROLLED_ERROR;
      WHEN OTHERS THEN
         ERRORS.SETERROR;
         RAISE EX.CONTROLLED_ERROR;
   END FNUDOWNPAYMENTREDEEMDISC;
   FUNCTION FNUWARRANTYFUNDDISC
    RETURN NUMBER
    IS
      SBID_CONTRATO GE_BOINSTANCECONTROL.STYSBVALUE;
      SBPORCEN_FONDO_GARANT GE_BOINSTANCECONTROL.STYSBVALUE;
      NUCERTIFTOTALVALUE NUMBER;
      NUWARRANTYFUNDDISC NUMBER;
      CNUERROR_NO_WARR_FUND CONSTANT GE_MESSAGE.MESSAGE_ID%TYPE := 3432;
    BEGIN
      GE_BOINSTANCECONTROL.GETATTRIBUTENEWVALUE( CT_BOCONSTANTS.FSBGETCONTRACTORINSTANCENAME, NULL, CSBGE_CONTRATO, 'ID_CONTRATO', SBID_CONTRATO );
      GE_BOINSTANCECONTROL.GETATTRIBUTENEWVALUE( CT_BOCONSTANTS.FSBGETCONTRACTORINSTANCENAME, NULL, CSBGE_CONTRATO, 'PORCEN_FONDO_GARANT', SBPORCEN_FONDO_GARANT );
      IF ( SBPORCEN_FONDO_GARANT IS NULL ) THEN
         ERRORS.SETERROR( CNUERROR_NO_WARR_FUND );
         RAISE EX.CONTROLLED_ERROR;
      END IF;
      NUCERTIFTOTALVALUE := CT_BOCERTIFICATECONTROL.FNUCALCERTIFREALTOTALVALUE;
      NUCERTIFTOTALVALUE := NVL( NUCERTIFTOTALVALUE, 0 );
      IF ( NUCERTIFTOTALVALUE <= 0 ) THEN
         RETURN 0;
      END IF;
      NUWARRANTYFUNDDISC := ( TO_NUMBER( SBPORCEN_FONDO_GARANT ) / 100 ) * NUCERTIFTOTALVALUE;
      RETURN NUWARRANTYFUNDDISC;
    EXCEPTION
      WHEN EX.CONTROLLED_ERROR THEN
         RAISE EX.CONTROLLED_ERROR;
      WHEN OTHERS THEN
         ERRORS.SETERROR;
         RAISE EX.CONTROLLED_ERROR;
   END FNUWARRANTYFUNDDISC;
   PROCEDURE CREATEACTDETAIL( INUAMOUNT IN GE_DETALLE_ACTA.CANTIDAD%TYPE, INUUNITVALUE IN GE_DETALLE_ACTA.VALOR_UNITARIO%TYPE, INUTOTALVALUE IN GE_DETALLE_ACTA.VALOR_TOTAL%TYPE, IDTDATE IN OR_ORDER.LEGALIZATION_DATE%TYPE := NULL, INUREFITEMID IN GE_DETALLE_ACTA.REFERENCE_ITEM_ID%TYPE := NULL )
    IS
    BEGIN
      CT_BOCERTIFICATECONTROL.BASICCERTIFBYDETAIL( INUAMOUNT, INUUNITVALUE, INUTOTALVALUE, IDTDATE, INUREFITEMID );
    EXCEPTION
      WHEN EX.CONTROLLED_ERROR THEN
         RAISE EX.CONTROLLED_ERROR;
      WHEN OTHERS THEN
         ERRORS.SETERROR;
         RAISE EX.CONTROLLED_ERROR;
   END CREATEACTDETAIL;
   PROCEDURE BASICCERTIFBYDETAIL( INUAMOUNT IN GE_DETALLE_ACTA.CANTIDAD%TYPE, INUUNITVALUE IN GE_DETALLE_ACTA.VALOR_UNITARIO%TYPE, INUTOTALVALUE IN GE_DETALLE_ACTA.VALOR_TOTAL%TYPE, IDTDATE IN OR_ORDER.LEGALIZATION_DATE%TYPE := NULL, INUREFITEMID IN GE_DETALLE_ACTA.REFERENCE_ITEM_ID%TYPE := NULL, INUPORCENTCUMP IN GE_DETALLE_ACTA.PORCEN_CUMPLIMIENTO%TYPE := NULL, INUPORCENTPOND IN GE_DETALLE_ACTA.PORCEN_PONDERADO%TYPE := NULL, INUBASEVALUE IN GE_DETALLE_ACTA.BASE_VALUE%TYPE := NULL )
    IS
      SBITEMS_ID GE_BOINSTANCECONTROL.STYSBVALUE;
      NUITEMSID GE_ITEMS.ITEMS_ID%TYPE;
      SBMEASURE_UNIT_ID GE_BOINSTANCECONTROL.STYSBVALUE;
      NUMEASUREUNITID GE_MEASURE_UNIT.MEASURE_UNIT_ID%TYPE;
      SBDESCRIPTION GE_BOINSTANCECONTROL.STYSBVALUE;
      SBORDER_ID GE_BOINSTANCECONTROL.STYSBVALUE;
      NUORDERID OR_ORDER.ORDER_ID%TYPE;
      SBCERTIFICATE_TYPE_ID GE_BOINSTANCECONTROL.STYSBVALUE;
      NUCERTIFICATETYPEID GE_ACTA.ID_TIPO_ACTA%TYPE;
      SBLEGAL_ITEM_AMOUNT GE_BOINSTANCECONTROL.STYSBVALUE;
      NUAMOUNT GE_DETALLE_ACTA.CANTIDAD%TYPE;
      NUUNITVALUE GE_DETALLE_ACTA.VALOR_UNITARIO%TYPE;
      NUTOTALVALUE GE_DETALLE_ACTA.VALOR_TOTAL%TYPE;
      NULISTUNITARYCOSTID GE_LIST_UNITARY_COST.LIST_UNITARY_COST_ID%TYPE;
      NUINDEX GE_BOINSTANCECONTROL.STYNUINDEX;
    BEGIN
      GE_BOINSTANCECONTROL.GETATTRIBUTENEWVALUE( CT_BOCONSTANTS.FSBGETCONTRACTORINSTANCENAME, NULL, 'GE_ITEMS', 'ITEMS_ID', SBITEMS_ID );
      NUITEMSID := TO_NUMBER( SBITEMS_ID );
      GE_BOINSTANCECONTROL.GETATTRIBUTENEWVALUE( CT_BOCONSTANTS.FSBGETCONTRACTORINSTANCENAME, NULL, 'GE_ITEMS', 'MEASURE_UNIT_ID', SBMEASURE_UNIT_ID );
      NUMEASUREUNITID := TO_NUMBER( SBMEASURE_UNIT_ID );
      GE_BOINSTANCECONTROL.GETATTRIBUTENEWVALUE( CT_BOCONSTANTS.FSBGETCONTRACTORINSTANCENAME, NULL, 'GE_ITEMS', 'DESCRIPTION', SBDESCRIPTION );
      IF ( GE_BOINSTANCECONTROL.FBLACCKEYATTRIBUTESTACK( CT_BOCONSTANTS.FSBGETCONTRACTORINSTANCENAME, NULL, 'OR_ORDER', 'ORDER_ID', NUINDEX ) ) THEN
         GE_BOINSTANCECONTROL.GETATTRIBUTENEWVALUE( CT_BOCONSTANTS.FSBGETCONTRACTORINSTANCENAME, NULL, 'OR_ORDER', 'ORDER_ID', SBORDER_ID );
         NUORDERID := TO_NUMBER( SBORDER_ID );
      END IF;
      GE_BOINSTANCECONTROL.SETATTRIBUTENEWVALUE( CT_BOCONSTANTS.FSBGETCONTRACTORINSTANCENAME, NULL, 'GE_DETALLE_ACTA', 'ID_ITEMS', SBITEMS_ID );
      GE_BOINSTANCECONTROL.SETATTRIBUTENEWVALUE( CT_BOCONSTANTS.FSBGETCONTRACTORINSTANCENAME, NULL, 'GE_DETALLE_ACTA', 'DESCRIPCION_ITEMS', SBITEMS_ID || ' - ' || SBDESCRIPTION );
      GE_BOINSTANCECONTROL.SETATTRIBUTENEWVALUE( CT_BOCONSTANTS.FSBGETCONTRACTORINSTANCENAME, NULL, 'GE_DETALLE_ACTA', 'ID_UNIDAD_MEDIDA', NUMEASUREUNITID );
      IF ( ( INUAMOUNT IS NULL ) AND ( INUUNITVALUE IS NULL ) AND ( INUTOTALVALUE IS NULL ) ) THEN
         IF ( GE_BOINSTANCECONTROL.FBLACCKEYATTRIBUTESTACK( CT_BOCONSTANTS.FSBGETCONTRACTORINSTANCENAME, NULL, 'OR_ORDER_ITEMS', 'ORDER_ITEMS_ID', NUINDEX ) ) THEN
            GE_BOINSTANCECONTROL.GETATTRIBUTENEWVALUE( CT_BOCONSTANTS.FSBGETCONTRACTORINSTANCENAME, NULL, 'OR_ORDER_ITEMS', 'LEGAL_ITEM_AMOUNT', SBLEGAL_ITEM_AMOUNT );
            NUAMOUNT := TO_NUMBER( SBLEGAL_ITEM_AMOUNT );
          ELSE
            NUAMOUNT := NULL;
         END IF;
       ELSE
         NUAMOUNT := INUAMOUNT;
      END IF;
      GE_BOINSTANCECONTROL.SETATTRIBUTENEWVALUE( CT_BOCONSTANTS.FSBGETCONTRACTORINSTANCENAME, NULL, 'GE_DETALLE_ACTA', 'CANTIDAD', TO_CHAR( NUAMOUNT ) );
      IF ( ( INUAMOUNT IS NULL ) AND ( INUUNITVALUE IS NULL ) AND ( INUTOTALVALUE IS NULL ) ) THEN
         IF ( SBORDER_ID IS NULL ) THEN
            NUUNITVALUE := NULL;
          ELSE
            GE_BOINSTANCECONTROL.GETATTRIBUTENEWVALUE( CT_BOCONSTANTS.FSBGETCONTRACTORINSTANCENAME, NULL, 'CT_CONDITIONS', 'CERTIFICATE_TYPE_ID', SBCERTIFICATE_TYPE_ID );
            NUCERTIFICATETYPEID := TO_NUMBER( SBCERTIFICATE_TYPE_ID );
            IF ( NUCERTIFICATETYPEID = CT_BOCONSTANTS.FNUGETLIQUIDATIONCERTITYPE ) THEN
               GE_BOCERTCONTRATISTA.OBTENERVALORITEMLISTA( NUORDERID, NUITEMSID, GE_BOCONSTANTS.FSBGETITEMPRICECOLNAME, NULISTUNITARYCOSTID, NUUNITVALUE, IDTDATE );
             ELSIF ( NUCERTIFICATETYPEID = CT_BOCONSTANTS.FNUGETBILLINGCERTITYPE ) THEN
               GE_BOCERTCONTRATISTA.OBTENERVALORITEMLISTA( NUORDERID, NUITEMSID, GE_BOCONSTANTS.FSBGETITEMSALESVALUECOLNAME, NULISTUNITARYCOSTID, NUUNITVALUE, IDTDATE );
            END IF;
         END IF;
       ELSE
         NUUNITVALUE := INUUNITVALUE;
      END IF;
      GE_BOINSTANCECONTROL.SETATTRIBUTENEWVALUE( CT_BOCONSTANTS.FSBGETCONTRACTORINSTANCENAME, NULL, 'GE_DETALLE_ACTA', 'VALOR_UNITARIO', TO_CHAR( NUUNITVALUE ) );
      IF ( ( INUAMOUNT IS NULL ) AND ( INUUNITVALUE IS NULL ) AND ( INUTOTALVALUE IS NULL ) ) THEN
         NUTOTALVALUE := NUAMOUNT * NUUNITVALUE;
       ELSE
         NUTOTALVALUE := INUTOTALVALUE;
      END IF;
      GE_BOINSTANCECONTROL.SETATTRIBUTENEWVALUE( CT_BOCONSTANTS.FSBGETCONTRACTORINSTANCENAME, NULL, 'GE_DETALLE_ACTA', 'VALOR_TOTAL', TO_CHAR( NUTOTALVALUE ) );
      GE_BOINSTANCECONTROL.SETATTRIBUTENEWVALUE( CT_BOCONSTANTS.FSBGETCONTRACTORINSTANCENAME, NULL, 'GE_DETALLE_ACTA', 'ID_LISTA_UNIT_COSTO', TO_CHAR( NULISTUNITARYCOSTID ) );
      GE_BOINSTANCECONTROL.SETATTRIBUTENEWVALUE( CT_BOCONSTANTS.FSBGETCONTRACTORINSTANCENAME, NULL, 'GE_DETALLE_ACTA', 'PORCEN_CUMPLIMIENTO', TO_CHAR( INUPORCENTCUMP ) );
      GE_BOINSTANCECONTROL.SETATTRIBUTENEWVALUE( CT_BOCONSTANTS.FSBGETCONTRACTORINSTANCENAME, NULL, 'GE_DETALLE_ACTA', 'PORCEN_PONDERADO', TO_CHAR( INUPORCENTPOND ) );
      GE_BOINSTANCECONTROL.SETATTRIBUTENEWVALUE( CT_BOCONSTANTS.FSBGETCONTRACTORINSTANCENAME, NULL, 'GE_DETALLE_ACTA', 'REFERENCE_ITEM_ID', TO_CHAR( INUREFITEMID ) );
      GE_BOINSTANCECONTROL.SETATTRIBUTENEWVALUE( CT_BOCONSTANTS.FSBGETCONTRACTORINSTANCENAME, NULL, 'GE_DETALLE_ACTA', 'BASE_VALUE', TO_CHAR( INUBASEVALUE ) );
    EXCEPTION
      WHEN EX.CONTROLLED_ERROR THEN
         RAISE EX.CONTROLLED_ERROR;
      WHEN OTHERS THEN
         ERRORS.SETERROR;
         RAISE EX.CONTROLLED_ERROR;
   END BASICCERTIFBYDETAIL;
END CT_BOCERTIFICATECONTROL;
/


