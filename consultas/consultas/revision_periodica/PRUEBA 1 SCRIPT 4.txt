DECLARE
   
   nuSolicitudRevision number;
	
  nucontaproductos NUMBER(10);

  nucontaproductos2 NUMBER(10):=0;

  dtplazominimo DATE;

  sw NUMBER(2) DEFAULT 0;
  sw2 NUMBER(2) DEFAULT 0;

  nuvamarca NUMBER(10);

  nuparano NUMBER;

  nuparmes NUMBER;

  nutsess NUMBER;

  sbparuser VARCHAR2(100);

  nucontausuarios NUMBER(8) DEFAULT 0;

  nuconta NUMBER(8) DEFAULT 0;
  nuMarca number;
  nuMarcaSusProc number;
  nuMarcaSuspAct number;
  nuCantSusp     number;
  nuMarcaRecoProc number;
  sbCondicion	varchar2(200);
  sbActuaRe     repoinco.reindes2%type;
  sbActuaSu     repoinco.reindes3%type;
  sbActuaPr     repoinco.reindes4%type;
  
      -- PARAMETROS DE ENTRADA
    sbSaocodi       reportes.repoapli%type := '100-54511';
    sbNombreArchivo reportes.repodesc%type := 'DatafixMarcas2';


    -- PARAMETROS REPORTE
    nuIdReporte         reportes.reponume%type;
    sbEncabezadoDatos   repoinco.REINDES2%type;
    sbValorDatos        repoinco.reinobse%type;
	

    -- manejo errores
    nuErrorCode NUMBER;
    sbErrorMessage VARCHAR2(4000);
  CURSOR cudatosuniverso IS
  
   SELECT p.product_id producto_rev
    FROM open.pr_product p
   WHERE p.product_type_id = 7014
     AND OPEN.ldc_getEdadRP(P.product_id)>=55
	 --And Product_id=6587283
     --AND PRODUCT_ID IN (2017794,15000971,1091353,2061178,6075601,6087898,50110102,1503120,6587283,2018297,1177152,1188096,1161527,50504471,1173378,50051528,50009275,1071458,50037868,50094120,1031159,1031162,2037501,6097190,50094911,50023843,1703906,1027930,50095919,1150679,50108323,50331703,50331706,1057441,1507691,1800160,50093812,1099629,1089650,50467670,1503561,1127963,1067165,1017542,1032883,1032939,1505993,50085389,50071801,50076493,50073607,50344404,50080758,1703819,1501779,50118513,50119332,1104541,1104642,50527871,50529760,1060784,1029170,1508654,1047804,50520653,1126148,50523811,1109733,1109904,50523183,50535427,50326907,1106452,6138812,1174108,6122085,50106203,1104125,1102979,6121648,6133491,6117293,1134915,6137030,6138958,1101337,50466842,50090327,1086513,1116540,1104946,50083671,50011969,6581240,4068956,1083734,1155848,1098934,1106858,50086664,1121523,50033648,1082389,50069041,1183226,1174155,1174304,1153409,1153643,50017710,1191726,1186327,50042057,50093460,50111798,1103999,50111012,50095413,50097857,1129155,17031923,50496158,50331671,1098458,1165912,50016503,50111669,17128973,17121759,1101672,50087655,1063058,1505479,50309060,1008389,50107392,50107501,50096363,1102873,1065348,1126993,1108685,50500479,1088645,50354481,50075378,1186757,1162423,1081748,1155703,1507390,50206402,1136404,1192000,1104590,1056956,1103745,1092412,1092455,1089981,1015887,1120177,1032479,50306661,50507762,50465486,50492331,50509116,1126182,1097343,50467380,50467381,50467382,50467384,1145915,1145957,1179439,1121884,50496656,50458853,50343875,1183552,1159213,1191004,1192630,1102930,1169188,1022894,6103523,1070103,8094872,1113644,2070540,38000044,1175210,14524510,1148630,1134314,1134674,1146600,1146613,1053404,1137326,50374147,2073902,3019769,50062333,1143784,1181263,50084379,1129184,1097125,50003602,1079379,1052264,50337554,1111105,1015581,1085909,1506238,1506279,50079144,50072005,50065972,1012177,50338846,1170005,1502813,1155711,50141974,1704853,1138640,1074351,50386481,50390845,1023376,1027660,1061086,50379697,50348510,50419256,1099770,1149116,1097321,1179362,1045741,1067423,1127801,1145518,1044259,1163560,1104290,1183883,1080285,1052982,1032329,1177910,50046521,17091271,4066298,4056126,50036506,50033294,50061409,17018353,1110025,1510824,50267086,50143763,50005801,50184567,1112086,50112063,1151845,50315682,1145321,1151745,1999587,4067938,5061537,1191127,50086941,17005018,17027175,17029546,1510042,50108841,4068438,1163411,1185354,50066563,50080808,50228392,50193651,50195262,1163479,6134586,4068549,4068589,1034467,2083978,4066979,4063375,4056000,1109480,2062820,1167106,1177386,1136805,1509608,1137037,1191903,1041844,1142128,1174107,1121619,14520877,6604181,6604183,50157693,50030753,17046641,50118057,1501114,1506997,14522004,14519144,50107783,17012698,1501298,1099807,1118991,2017794,1091353)
     --AND OPEN.ldc_getEdadRP(P.product_id)<=57
	 AND NOT EXISTS(SELECT NULL FROM OPEN.REPOINCO WHERE REINREPO= nuIdReporte  AND REINVAL1=PRODUCT_ID)
     AND NOT EXISTS( SELECT NULL
             FROM open.or_order_activity a,open.or_order ot
            WHERE a.product_id = p.product_id
              AND ot.order_status_id IN(0,5,7,11,20)
              AND ot.task_type_id IN(12161,10444,/*10834,*/10714,10715,10716,10717,10718,10719,10720,10721,10722,10723,10445,/*10835,*/12164,10795,10446,/*10836,10449,10450,12457,12460,*/ 12475, 10833)
              AND a.order_id = ot.order_id)
     and not exists(SELECT null FROM open.or_order_activity a,open.or_order ot,open.mo_packages m
                     WHERE a.product_id = p.product_id
                     AND ot.order_status_id IN(0,5,7,11,20)
                     AND ot.task_type_id IN(12135,12136,12138,12139,12140,12142,12143,12147,12148,12487)
                     AND m.package_type_id <> 100101
                     AND a.order_id = ot.order_id
                     AND a.package_id = m.package_id)
					;

  CURSOR cudatosprodf(nucuproductosy NUMBER) IS
  
    SELECT *
    
      FROM (
            
            /*SELECT nvl(ot.legalization_date,'01/01/2015') legalization_date,ot.task_type_id,
                    DECODE(ot.task_type_id,
                           12161,
                           101,
                           10444,
                           101,
                           10834,
                           101
                           
                          ,
                           10714,
                           102,
                           10715,
                           102,
                           10716,
                           102,
                           10717,
                           102,
                           10718,
                           102,
                           10719,
                           102,
                           10720,
                           102,
                           10721,
                           102,
                           10722,
                           102,
                           10723,
                           102,
                           10445,
                           102,
                           10835,
                           102
                           
                          ,
                           12164,
                           103,
                           10795,
                           103,
                           10446,
                           103,
                           10836,
                           103,
               10833,
               102,
               -1) marcaprod,
                    c.class_causal_id
            
              FROM open.or_order_activity a,
                    open.or_order          ot,
                    open.ge_causal         c
            
             WHERE a.product_id = nucuproductosy
               AND ot.order_status_id = 8
               AND c.class_causal_id = 2
               AND ot.causal_id <> -1
			   AND ot.task_type_id IN (12161,
                                       10444,
                                       --10834,
                                       10714,
                                       10715,
                                       10716,
                                       10717,
                                       10718,
                                       10719,
                                       10720,
                                       10721,
                                       10722,
                                       10723,
                                       10445,
                                       --10835,
                                       12164,
                                       10795,
                                       10446,
                                       --10836,
                                       10833
                                       )
                  
               AND a.order_id = ot.order_id
               AND ot.causal_id = c.causal_id
            UNION ALL
            SELECT nvl(ot.legalization_date,'01/01/2015') legalization_date,ot.task_type_id,
                   DECODE(ot.task_type_id,
                          12135,
                          102,
                          12136,
                          102,
                          12138,
                          102,
                          12139,
                          102,
                          12140,
                          102,
                          12142,
                          102,
                          12143,
                          102,
                          12147,
                          102,
                          12148,
                          102,
                          12487,
                          102,
              -1),
                   c.class_causal_id
              FROM open.or_order_activity a,
                   open.or_order          ot,
                   open.mo_packages       m,
                   open.ge_causal         c
             WHERE a.product_id = nucuproductosy
               AND ot.order_status_id = 8
               AND c.class_causal_id = 2
               AND ot.causal_id <> -1
               AND ot.task_type_id IN (12135,
                                       12136,
                                       12138,
                                       12139,
                                       12140,
                                       12142,
                                       12143,
                                       12147,
                                       12148,
                                       12487)
                  
               AND m.package_type_id <> 100101
               AND a.order_id = ot.order_id
               AND a.package_id = m.package_id
               AND ot.causal_id = c.causal_id
            UNION ALL*/
            SELECT nvl(ot.legalization_date,'01/01/2015') legalization_date,ot.task_type_id,
                   DECODE(ot.task_type_id,
                          12161,
                          DECODE(ot.causal_id,
                                 8967,
                                 102,
                                 3360,
                                 102,
                                 3299,
                                 102,
                                 3296,
                                 102,
								 3098,
								 102,
                                 -1),
                          10444,
                          DECODE(ot.causal_id, 3363, 102, 8903, 102, 3294, 101,9539, 102, 3547, 102, 9265, 102, 9417, 102, 3546,102, 3293, 101, 3298, 101, -1),
                          10834,
                          DECODE(ot.causal_id, 9537, 101, -1),
                          10714,
                          DECODE(ot.causal_id, 9074, 103, 9539, 103, 9874, 102, 3548, 103 , 9546, 103, -1),
                          10715,
                          DECODE(ot.causal_id, 9074, 103, 9539, 103, 9874, 102, 3548, 103 , 9546, 103, -1),
                          10716,
                          DECODE(ot.causal_id, 9074, 103, 9539, 103, 9874, 102, 3548, 103 , 9546, 103,  -1),
                          10717,
                          DECODE(ot.causal_id, 9074, 103, 9539, 103, 9874, 102, 3548, 103 , 9546, 103,  -1),
                          10718,
                          DECODE(ot.causal_id, 9074, 103, 9539, 103,9874, 102,  3548, 103 ,9546, 103,   -1),
                          10719,
                          DECODE(ot.causal_id, 9074, 103, 9539, 103, 9874, 102, 3548, 103 , 9546, 103,  -1),
                          10720,
                          DECODE(ot.causal_id, 9074, 103, 9539, 103, 9874, 102, 3548, 103 , 9546, 103,  -1),
                          10721,
                          DECODE(ot.causal_id, 9074, 103, 9539, 103, 9874, 102, 3548, 103 ,9546, 103,  -1),
                          10722,
                          DECODE(ot.causal_id, 9074, 103, 9539, 103,9874, 102,  3548, 103 ,9546, 103,   -1),
                          10723,
                          DECODE(ot.causal_id, 9074, 103, 9539, 103,9874, 102,  3548, 103 ,9546, 103, 9517, 103, 9518, 102,9947, 103, 1, 103,  -1),
                          10445,
                          DECODE(ot.causal_id, 3295, 103, -1),
                          10835,
                          DECODE(ot.causal_id, 9537, 102, -1),
                          12164,
                          DECODE(ot.causal_id, 9594, 102, 9472, 102, 9947, 103, 9417, 102, 9945, 103,-1),
                          10795,
                          DECODE(ot.causal_id, 3363, 102, 8903, 102, 3547, 102, 3546, 102, 9417, 102, 9947,103 , 1, 103,  -1),
                          10446,
                          DECODE(ot.causal_id,
                                 3297,
                                 103,
                                 9265,
                                 103,
                                 3298,
                                 103,
                                 9417,
                                 102,
                                 -1),
                          10836,
                          DECODE(ot.causal_id, 9537, 103, -1),
                          10833, DECODE(ot.causal_id, 9947, 103, 3360, 102, 3295, 103, -1),
              -1) marcaprod,
                   c.class_causal_id
              FROM open.or_order_activity a,
                   open.or_order          ot,
                   open.ge_causal         c
             WHERE a.product_id = nucuproductosy
               AND ot.order_status_id = 8
               AND c.class_causal_id = 1
               AND ot.causal_id <> -1
               AND ot.task_type_id IN (
                                       
                                       12161,
                                       10444,
                                       --10834,
                                       10714,
                                       10715,
                                       10716,
                                       10717,
                                       10718,
                                       10719,
                                       10720,
                                       10721,
                                       10722,
                                       10723,
                                       10445,
                                       --10835,
                                       12164,
                                       10795,
                                       10446,
                                       --10836,
                     10833
                                       )
                  
               AND a.order_id = ot.order_id
               AND ot.causal_id = c.causal_id
            UNION ALL
            SELECT nvl(ot.legalization_date,'01/01/2015') legalization_date,ot.task_type_id,
                   DECODE(ot.task_type_id,
                          12135,
                          DECODE(ot.causal_id, 9539, 103, 9546, 103, 9945,103,9944, 103,9514, 103, -1),
                          12136,
                          DECODE(ot.causal_id, 9539, 103, 9546, 103,8971,103, -1),
                          12138,
                          DECODE(ot.causal_id, 9539, 103, 9546, 103, 9526, 103, 9514, 103,9540, 103,-1),
                          12139,
                          DECODE(ot.causal_id, 9539, 103, 9546, 103, 9514, 103, 8971, 103, -1),
                          12140,
                          DECODE(ot.causal_id, 9539, 103, 9546, 103,9514, 103, 8971, 103,  -1),
                          12142,
                          DECODE(ot.causal_id, 9539, 103, 9546, 103, 9514, 103, -1),
                          12143,
                          DECODE(ot.causal_id, 9539, 103, 9546, 103, 8971, 103, 9540, 103, -1),
                          12147,
                          DECODE(ot.causal_id, 9539, 103, 9546, 103, 9944, 103, 9945, 103, 9514, 103, 8971, 103, -1),
                          12148,
                          DECODE(ot.causal_id, 9539, 103, 9546, 103, 8971, 103 -1),
                          12487,
                          DECODE(ot.causal_id, 9539, 103, 9546, 103, -1),
						  -1) marcaprod,
                   c.class_causal_id
              FROM open.or_order_activity a,
                   open.or_order          ot,
                   open.mo_packages       m,
                   open.ge_causal         c
             WHERE a.product_id = nucuproductosy
               AND ot.order_status_id = 8
               AND c.class_causal_id = 1
               AND ot.causal_id <> -1
               AND ot.task_type_id IN (12135,
                                       12136,
                                       12138,
                                       12139,
                                       12140,
                                       12142,
                                       12143,
                                       12147,
                                       12148,
                                       12487)
               AND m.package_type_id <> 100101
               AND a.order_id = ot.order_id   
               AND a.package_id = m.package_id 
               AND ot.causal_id = c.causal_id
             ORDER BY legalization_date DESC
            )
     WHERE ROWNUM = 1;
	 
 CURSOR cudatosprodf2(nucuproductosy NUMBER, nusolicitud number) IS
  
    SELECT *
    
      FROM (
            SELECT nvl(ot.legalization_date,'01/01/2015') legalization_date,ot.task_type_id,
                    DECODE(ot.task_type_id,
                           12161,
                           101,
                           10444,
                           101,
                           10834,
                           101,
                           10714,
                           102,
                           10715,
                           102,
                           10716,
                           102,
                           10717,
                           102,
                           10718,
                           102,
                           10719,
                           102,
                           10720,
                           102,
                           10721,
                           102,
                           10722,
                           102,
                           10723,
                           102,
                           10445,
                           102,
                           10835,
                           102,
                           12164,
                           103,
                           10795,
                           103,
                           10446,
                           103,
                           10836,
                           103,
               10833,
               102,
               -1) marcaprod,
                    c.class_causal_id
            
              FROM open.or_order_activity a,
                    open.or_order          ot,
                    open.ge_causal         c
            
             WHERE a.product_id = nucuproductosy
               AND ot.order_status_id = 8
               AND c.class_causal_id = 2
               AND ot.causal_id <> -1
			   and a.package_id=decode(nusolicitud, -1, a.package_id, nusolicitud)
               AND ot.task_type_id IN (12161,
                                       10444,
                                       --10834,
                                       10714,
                                       10715,
                                       10716,
                                       10717,
                                       10718,
                                       10719,
                                       10720,
                                       10721,
                                       10722,
                                       10723,
                                       10445,
                                       --10835,
                                       12164,
                                       10795,
                                       10446,
                                       --10836,
                                       10833
                                       )
                  
               AND a.order_id = ot.order_id
               AND ot.causal_id = c.causal_id
            UNION ALL
            SELECT nvl(ot.legalization_date,'01/01/2015') legalization_date,ot.task_type_id,
                   DECODE(ot.task_type_id,
                          12135,
                          102,
                          12136,
                          102,
                          12138,
                          102,
                          12139,
                          102,
                          12140,
                          102,
                          12142,
                          102,
                          12143,
                          102,
                          12147,
                          102,
                          12148,
                          102,
                          12487,
                          102,
              -1),
                   c.class_causal_id
              FROM open.or_order_activity a,
                   open.or_order          ot,
                   open.mo_packages       m,
                   open.ge_causal         c
             WHERE a.product_id = nucuproductosy
               AND ot.order_status_id = 8
               AND c.class_causal_id = 2
			   and a.package_id=decode(nusolicitud, -1, a.package_id, nusolicitud)
               AND ot.causal_id <> -1
               AND ot.task_type_id IN (12135,
                                       12136,
                                       12138,
                                       12139,
                                       12140,
                                       12142,
                                       12143,
                                       12147,
                                       12148,
                                       12487)
               AND m.package_type_id <> 100101
               AND a.order_id = ot.order_id
               AND a.package_id = m.package_id
               AND ot.causal_id = c.causal_id
            UNION ALL
            SELECT nvl(ot.legalization_date,'01/01/2015') legalization_date,ot.task_type_id,
                   DECODE(ot.task_type_id,
                          12161,
                          DECODE(ot.causal_id,
                                 8967,
                                 102,
                                 3360,
                                 102,
                                 3299,
                                 102,
                                 3296,
                                 102,
								 3098,
								 102,
                                 -1),
                          10444,
                          DECODE(ot.causal_id, 3363, 102, 8903, 102, 3294, 101,9539, 102, 3547, 102, 9265, 102, 9417, 102, 3546,102, 3293, 101, 3298, 101, -1),
                          10834,
                          DECODE(ot.causal_id, 9537, 101, -1),
                          10714,
                          DECODE(ot.causal_id, 9074, 103, 9539, 103, 9874, 102, 3548, 103 , 9546, 103, -1),
                          10715,
                          DECODE(ot.causal_id, 9074, 103, 9539, 103, 9874, 102, 3548, 103 , 9546, 103, -1),
                          10716,
                          DECODE(ot.causal_id, 9074, 103, 9539, 103, 9874, 102, 3548, 103 , 9546, 103,  -1),
                          10717,
                          DECODE(ot.causal_id, 9074, 103, 9539, 103, 9874, 102, 3548, 103 , 9546, 103,  -1),
                          10718,
                          DECODE(ot.causal_id, 9074, 103, 9539, 103,9874, 102,  3548, 103 ,9546, 103,   -1),
                          10719,
                          DECODE(ot.causal_id, 9074, 103, 9539, 103, 9874, 102, 3548, 103 , 9546, 103,  -1),
                          10720,
                          DECODE(ot.causal_id, 9074, 103, 9539, 103, 9874, 102, 3548, 103 , 9546, 103,  -1),
                          10721,
                          DECODE(ot.causal_id, 9074, 103, 9539, 103, 9874, 102, 3548, 103 ,9546, 103,  -1),
                          10722,
                          DECODE(ot.causal_id, 9074, 103, 9539, 103,9874, 102,  3548, 103 ,9546, 103,   -1),
                          10723,
                          DECODE(ot.causal_id, 9074, 103, 9539, 103,9874, 102,  3548, 103 ,9546, 103, 9517, 103, 9518, 102,9947, 103, 1, 103,  -1),
                          10445,
                          DECODE(ot.causal_id, 3295, 103, -1),
                          10835,
                          DECODE(ot.causal_id, 9537, 102, -1),
                          12164,
                          DECODE(ot.causal_id, 9594, 102, 9472, 102, 9947, 103, 9417, 102, 9945, 103,-1),
                          10795,
                          DECODE(ot.causal_id, 3363, 102, 8903, 102, 3547, 102, 3546, 102, 9417, 102, 9947,103 , 1, 103,  -1),
                          10446,
                          DECODE(ot.causal_id,
                                 3297,
                                 103,
                                 9265,
                                 103,
                                 3298,
                                 103,
                                 9417,
                                 102,
                                 -1),
                          10836,
                          DECODE(ot.causal_id, 9537, 103, -1),
                          10833, DECODE(ot.causal_id, 9947, 103, 3360, 102, 3295, 103, -1),
              -1),
                   c.class_causal_id
              FROM open.or_order_activity a,
                   open.or_order          ot,
                   open.ge_causal         c
             WHERE a.product_id = nucuproductosy
               AND ot.order_status_id = 8
               AND c.class_causal_id = 1
			   and a.package_id=decode(nusolicitud, -1, a.package_id, nusolicitud)
               AND ot.causal_id <> -1
               AND ot.task_type_id IN (
                                       
                                       12161,
                                       10444,
                                       --10834,
                                       10714,
                                       10715,
                                       10716,
                                       10717,
                                       10718,
                                       10719,
                                       10720,
                                       10721,
                                       10722,
                                       10723,
                                       10445,
                                       --10835,
                                       12164,
                                       10795,
                                       10446,
                                       --10836,
                     10833
                                       )
               AND a.order_id = ot.order_id
               AND ot.causal_id = c.causal_id
            UNION ALL
            SELECT nvl(ot.legalization_date,'01/01/2015') legalization_date,ot.task_type_id,
                   DECODE(ot.task_type_id,
                          12135,
                          DECODE(ot.causal_id, 9539, 103, 9546, 103, 9945,103,9944, 103,9514, 103, -1),
                          12136,
                          DECODE(ot.causal_id, 9539, 103, 9546, 103,8971,103, -1),
                          12138,
                          DECODE(ot.causal_id, 9539, 103, 9546, 103, 9526, 103, 9514, 103,9540, 103,-1),
                          12139,
                          DECODE(ot.causal_id, 9539, 103, 9546, 103, 9514, 103, 8971, 103, -1),
                          12140,
                          DECODE(ot.causal_id, 9539, 103, 9546, 103,9514, 103, 8971, 103,  -1),
                          12142,
                          DECODE(ot.causal_id, 9539, 103, 9546, 103, 9514, 103, -1),
                          12143,
                          DECODE(ot.causal_id, 9539, 103, 9546, 103, 8971, 103, 9540, 103, -1),
                          12147,
                          DECODE(ot.causal_id, 9539, 103, 9546, 103, 9944, 103, 9945, 103, 9514, 103, 8971, 103, -1),
                          12148,
                          DECODE(ot.causal_id, 9539, 103, 9546, 103, 8971, 103 -1),
                          12487,
                          DECODE(ot.causal_id, 9539, 103, 9546, 103, -1),
						  -1),
                   c.class_causal_id
              FROM open.or_order_activity a,
                   open.or_order          ot,
                   open.mo_packages       m,
                   open.ge_causal         c
             WHERE a.product_id = nucuproductosy
               AND ot.order_status_id = 8
               AND c.class_causal_id = 1
			   and a.package_id=decode(nusolicitud, -1, a.package_id, nusolicitud)
               AND ot.causal_id <> -1
               AND ot.task_type_id IN (12135,
                                       12136,
                                       12138,
                                       12139,
                                       12140,
                                       12142,
                                       12143,
                                       12147,
                                       12148,
                                       12487)
               AND m.package_type_id <> 100101
               AND a.order_id = ot.order_id
               AND a.package_id = m.package_id
               AND ot.causal_id = c.causal_id
             ORDER BY legalization_date DESC
            )
     WHERE ROWNUM = 1;
  
  CURSOR cudatosprodf3(nucuproductosy NUMBER) IS
  
    SELECT *
    
      FROM (
            
            SELECT nvl(ot.legalization_date,'01/01/2015') legalization_date,ot.task_type_id,
                    DECODE(ot.task_type_id,
                           12161,
                           101,
                           10444,
                           101,
                           10834,
                           101
                           
                          ,
                           10714,
                           102,
                           10715,
                           102,
                           10716,
                           102,
                           10717,
                           102,
                           10718,
                           102,
                           10719,
                           102,
                           10720,
                           102,
                           10721,
                           102,
                           10722,
                           102,
                           10723,
                           102,
                           10445,
                           102,
                           10835,
                           102
                           
                          ,
                           12164,
                           103,
                           10795,
                           103,
                           10446,
                           103,
                           10836,
                           103,
               10833,
               102,
               -1) marcaprod,
                    c.class_causal_id
            
              FROM open.or_order_activity a,
                    open.or_order          ot,
                    open.ge_causal         c,
					open.mo_packages       p
            
             WHERE a.product_id = nucuproductosy
               AND ot.order_status_id = 8
               AND c.class_causal_id = 2
               AND ot.causal_id <> -1
			   And p.package_id=a.package_id
			   And p.package_type_id not in (100237, 100293, 100294, 100295)
			   AND ot.task_type_id IN (12161,
                                       10444,
                                      -- 10834,
                                       10714,
                                       10715,
                                       10716,
                                       10717,
                                       10718,
                                       10719,
                                       10720,
                                       10721,
                                       10722,
                                       10723,
                                       10445,
                                       --10835,
                                       12164,
                                       10795,
                                       10446,
                                       --10836,
                                       10833
                                       )
                  
               AND a.order_id = ot.order_id
               AND ot.causal_id = c.causal_id
            UNION ALL
            SELECT nvl(ot.legalization_date,'01/01/2015') legalization_date,ot.task_type_id,
                   DECODE(ot.task_type_id,
                          12135,
                          102,
                          12136,
                          102,
                          12138,
                          102,
                          12139,
                          102,
                          12140,
                          102,
                          12142,
                          102,
                          12143,
                          102,
                          12147,
                          102,
                          12148,
                          102,
                          12487,
                          102,
              -1),
                   c.class_causal_id
              FROM open.or_order_activity a,
                   open.or_order          ot,
                   open.mo_packages       m,
                   open.ge_causal         c
             WHERE a.product_id = nucuproductosy
               AND ot.order_status_id = 8
               AND c.class_causal_id = 2
               AND ot.causal_id <> -1
               AND ot.task_type_id IN (12135,
                                       12136,
                                       12138,
                                       12139,
                                       12140,
                                       12142,
                                       12143,
                                       12147,
                                       12148,
                                       12487)
                  
               AND m.package_type_id not in (100101, 100237, 100293, 100294, 100295)
               AND a.order_id = ot.order_id
               AND a.package_id = m.package_id
               AND ot.causal_id = c.causal_id
            UNION ALL
            SELECT nvl(ot.legalization_date,'01/01/2015') legalization_date,ot.task_type_id,
                   DECODE(ot.task_type_id,
                          12161,
                          DECODE(ot.causal_id,
                                 8967,
                                 102,
                                 3360,
                                 102,
                                 3299,
                                 102,
                                 3296,
                                 102,
								 3098,
								 102,
                                 -1),
                          10444,
                          DECODE(ot.causal_id, 3363, 102, 8903, 102, 3294, 101,9539, 102, 3547, 102, 9265, 102, 9417, 102, 3546,102, 3293, 101, 3298, 101, -1),
                          10834,
                          DECODE(ot.causal_id, 9537, 101, -1),
                          10714,
                          DECODE(ot.causal_id, 9074, 103, 9539, 103, 9874, 102, 3548, 103 , 9546, 103, -1),
                          10715,
                          DECODE(ot.causal_id, 9074, 103, 9539, 103, 9874, 102, 3548, 103 , 9546, 103, -1),
                          10716,
                          DECODE(ot.causal_id, 9074, 103, 9539, 103, 9874, 102, 3548, 103 , 9546, 103,  -1),
                          10717,
                          DECODE(ot.causal_id, 9074, 103, 9539, 103, 9874, 102, 3548, 103 , 9546, 103,  -1),
                          10718,
                          DECODE(ot.causal_id, 9074, 103, 9539, 103,9874, 102,  3548, 103 ,9546, 103,   -1),
                          10719,
                          DECODE(ot.causal_id, 9074, 103, 9539, 103, 9874, 102, 3548, 103 , 9546, 103,  -1),
                          10720,
                          DECODE(ot.causal_id, 9074, 103, 9539, 103, 9874, 102, 3548, 103 , 9546, 103,  -1),
                          10721,
                          DECODE(ot.causal_id, 9074, 103, 9539, 103, 9874, 102, 3548, 103 ,9546, 103,  -1),
                          10722,
                          DECODE(ot.causal_id, 9074, 103, 9539, 103,9874, 102,  3548, 103 ,9546, 103,   -1),
                          10723,
                          DECODE(ot.causal_id, 9074, 103, 9539, 103,9874, 102,  3548, 103 ,9546, 103, 9517, 103, 9518, 102,9947, 103, 1, 103,  -1),
                          10445,
                          DECODE(ot.causal_id, 3295, 103, -1),
                          10835,
                          DECODE(ot.causal_id, 9537, 102, -1),
                          12164,
                          DECODE(ot.causal_id, 9594, 102, 9472, 102, 9947, 103, 9417, 102, 9945, 103,-1),
                          10795,
                          DECODE(ot.causal_id, 3363, 102, 8903, 102, 3547, 102, 3546, 102, 9417, 102, 9947,103 , 1, 103,  -1),
                          10446,
                          DECODE(ot.causal_id,
                                 3297,
                                 103,
                                 9265,
                                 103,
                                 3298,
                                 103,
                                 9417,
                                 102,
                                 -1),
                          10836,
                          DECODE(ot.causal_id, 9537, 103, -1),
                          10833, DECODE(ot.causal_id, 9947, 103, 3360, 102, 3295, 103, -1),
              -1),
                   c.class_causal_id
              FROM open.or_order_activity a,
                   open.or_order          ot,
                   open.ge_causal         c,
				   open.mo_packages       p
             WHERE a.product_id = nucuproductosy
               AND ot.order_status_id = 8
               AND c.class_causal_id = 1
			   And p.package_id=a.package_id
			   and p.package_type_id not in (100237, 100293, 100294, 100295)
               AND ot.causal_id <> -1
               AND ot.task_type_id IN (
                                       
                                       12161,
                                       10444,
                                       --10834,
                                       10714,
                                       10715,
                                       10716,
                                       10717,
                                       10718,
                                       10719,
                                       10720,
                                       10721,
                                       10722,
                                       10723,
                                       10445,
                                       --10835,
                                       12164,
                                       10795,
                                       10446,
                                       --10836,
                     10833
                                       )
                  
               AND a.order_id = ot.order_id
               AND ot.causal_id = c.causal_id
            UNION ALL
            SELECT nvl(ot.legalization_date,'01/01/2015') legalization_date,ot.task_type_id,
                   DECODE(ot.task_type_id,
                          12135,
                          DECODE(ot.causal_id, 9539, 103, 9546, 103, 9945,103,9944, 103,9514, 103, -1),
                          12136,
                          DECODE(ot.causal_id, 9539, 103, 9546, 103,8971,103, -1),
                          12138,
                          DECODE(ot.causal_id, 9539, 103, 9546, 103, 9526, 103, 9514, 103,9540, 103,-1),
                          12139,
                          DECODE(ot.causal_id, 9539, 103, 9546, 103, 9514, 103, 8971, 103, -1),
                          12140,
                          DECODE(ot.causal_id, 9539, 103, 9546, 103,9514, 103, 8971, 103,  -1),
                          12142,
                          DECODE(ot.causal_id, 9539, 103, 9546, 103, 9514, 103, -1),
                          12143,
                          DECODE(ot.causal_id, 9539, 103, 9546, 103, 8971, 103, 9540, 103, -1),
                          12147,
                          DECODE(ot.causal_id, 9539, 103, 9546, 103, 9944, 103, 9945, 103, 9514, 103, 8971, 103, -1),
                          12148,
                          DECODE(ot.causal_id, 9539, 103, 9546, 103, 8971, 103 -1),
                          12487,
                          DECODE(ot.causal_id, 9539, 103, 9546, 103, -1),
						  -1),
                   c.class_causal_id
              FROM open.or_order_activity a,
                   open.or_order          ot,
                   open.mo_packages       m,
                   open.ge_causal         c
             WHERE a.product_id = nucuproductosy
               AND ot.order_status_id = 8
               AND c.class_causal_id = 1
               AND ot.causal_id <> -1
               AND ot.task_type_id IN (12135,
                                       12136,
                                       12138,
                                       12139,
                                       12140,
                                       12142,
                                       12143,
                                       12147,
                                       12148,
                                       12487)
               AND m.package_type_id not in (100101,100237, 100293, 100294, 100295)
               AND a.order_id = ot.order_id   
               AND a.package_id = m.package_id 
               AND ot.causal_id = c.causal_id
             ORDER BY legalization_date DESC
            )
     WHERE ROWNUM = 1;
	
  cursor cuDatos10444(nuProducto number) is
  select p.package_id, package_Type_id, decode(p.package_type_id, 100295, 103, 102) marca, p.attention_date, null legalization_date,  p.request_date
  from open.mo_packages p, open.mo_motive m
  where p.package_id=m.package_id
    and m.product_id=nuProducto
	and p.motive_status_id=14
	and package_type_id in (100295, 100294, 100293)
	order by p.attention_date desc, legalization_date desc;
	
   rgDatos10444 cuDatos10444%rowtype;
    
	cursor cuDatosCerti(nuProducto number, fecha date) is
  select p.package_id, package_Type_id, decode(p.package_type_id, 100295, 103, 102) marca, p.attention_date
  from open.mo_packages p, open.mo_motive m
  where p.package_id=m.package_id
    and m.product_id=nuProducto
	and p.motive_status_id=14
	and package_type_id in (100294, 100293)
	and P.attention_date<=fecha
	order by p.attention_date desc;
	
	cursor cuRevisado(nuProducto Number) is
	select package_id
	from open.or_order_activity a, open.or_order o, open.ge_causal c
	where a.order_id=o.order_id
	  and o.task_type_id=10444
	  and o.causal_id=c.causal_id
	  and a.activity_id in (100003629,100003630,100003631)
	  and c.class_causal_id=1;
   
    rgDatosCerti cuDatosCerti%rowtype;

    -- crear cabecera deL reporte de seguimiento
    FUNCTION fnuCrReportHeader(isbArchivo reportes.repodesc%type, isbParameter reportes.repostej%type)
    return number
    IS
        rcRecord Reportes%rowtype;
    BEGIN
        rcRecord.REPOAPLI := sbSaocodi;
        rcRecord.REPOFECH := sysdate;
        rcRecord.REPOUSER := ut_session.getTerminal;
        rcRecord.REPODESC := isbArchivo ;
        rcRecord.REPOSTEJ := isbParameter;
        rcRecord.REPONUME :=  seq.getnext('SQ_REPORTES');
        pktblReportes.insRecord(rcRecord);
        return rcRecord.Reponume;
    END ;
	
    -- crear detalle de reporte de seguimiento
    PROCEDURE crReportDetail(
                            inuIdReporte        in  repoinco.reinrepo%type,
                            isbEntidad          in  repoinco.reindes1%type,
                            inuProduct			in  repoinco.REINVAL1%type,
                            inuMarcaAct		    in  repoinco.REINVAL2%type,
							inuMarcaSuspAct		in  repoinco.REINVAL3%type,
							inuMarcaSuspPro		in  repoinco.REINVAL4%type,
							inuMarcaRecoPro		in  repoinco.REINVAL5%type,
							inuNuevaMarca		in  repoinco.REINVAL6%type,
                            isbAccion           in  repoinco.reindes1%type,
							isbActuaRe           in  repoinco.reindes2%type,
							isbActuaSu           in  repoinco.reindes3%type,
							isbActuaPr           in  repoinco.reindes4%type
                            )
    IS
        rcRepoinco repoinco%rowtype;
    BEGIN
        rcRepoinco.Reinrepo := inuIdReporte;
        rcRepoinco.reindes1 := isbEntidad;
        rcRepoinco.REINVAL1 := inuProduct;
        rcRepoinco.REINVAL2 := inuMarcaAct;
		rcRepoinco.REINVAL3 := inuMarcaSuspAct;
		rcRepoinco.REINVAL4 := inuMarcaSuspPro;
		rcRepoinco.REINVAL5 := inuMarcaRecoPro;
		rcRepoinco.REINVAL6 := inuNuevaMarca;
        rcRepoinco.reindes2 := isbAccion;
		rcRepoinco.reindes3 := isbActuaRe;
		rcRepoinco.reindes4 := isbActuaSu;
		rcRepoinco.reindes5 := isbActuaPr;
		rcRepoinco.REINDAT1:=sysdate;
        
	
        rcRepoinco.reincodi :=  seq.getnext('SQ_REPOINCO_REINCODI');
        pktblRepoinco.insrecord(rcRepoinco);
    END ; 
BEGIN
  DBMS_OUTPUT.ENABLE(1000000);
  EXECUTE IMMEDIATE 'ALTER TRIGGER LDCTRG_INS_UPD_PR_PROD_SUSPENS DISABLE';
  nucontausuarios := 0;
  begin
	  SELECT REPONUME
	    into nuIdReporte
		FROM OPEN.REPORTES
		WHERE REPOAPLI=sbSaocodi
		  AND REPODESC=sbNombreArchivo;
  exception
    when others then 
		nuIdReporte:=-1;
  end;
  -- se crea el encabezado de reporte
  if nuIdReporte = -1 then 
	   nuIdReporte :=  fnuCrReportHeader(sbNombreArchivo , null);
  end if;
  commit;

  FOR i IN cudatosuniverso LOOP
    begin select nvl(suspension_type_id,1000) into nuMarca from open.ldc_marca_producto where id_producto=i.producto_rev; exception when others then nuMarca := -1; end;
    begin select nvl(suspension_type_id,1000) into nuMarcaSusProc from open.or_order_activity a, open.mo_motive m, open.mo_suspension ms where a.product_id=i.producto_rev and a.task_type_id in (10450, 12457) and a.status!='F' and a.package_id=m.package_id and m.motive_id=ms.motive_id; exception when others then nuMarcaSusProc:=-1; end;
	begin select nvl(suspension_type_id,1000) into nuMarcaRecoProc from open.or_order_activity a, open.mo_motive m, open.mo_suspension ms where a.product_id=i.producto_rev and a.task_type_id in (10834, 10835, 10836, 10260) and a.status!='F' and a.package_id=m.package_id and m.motive_id=ms.motive_id; exception when others then nuMarcaRecoProc:=-1; end;
    begin select nvl(suspension_type_id,1000) into nuMarcaSuspAct from open.pr_prod_suspension where product_id=i.producto_rev and suspension_type_id in (101,102,103,104) and active='Y' and rownum=1; exception when others then nuMarcaSuspAct := -1; end;
    --begin select count(1) into nuCantSusp from open.pr_prod_suspension where id_producto=i.producto_rev and suspension_type_id in (101,102,103,104) and active='Y'; exception when others then nuMarca := -1; end;
    
     
        sw := 0;
      
        FOR j IN cudatosprodf(i.producto_rev) LOOP
        
          nuvamarca := j.marcaprod;
        
          IF nuvamarca = -1 THEN
			--DBMS_OUTPUT.PUT_LINE(i.producto_rev||'|NO HACE NADA|ANTES|'||nuMarca||' SUSPENSEION|'||nuMarcaSus);
            sbCondicion:='NADA';
          ELSE
          
            --"OPEN".ldcprocinsactumarcaprodu(i.producto_rev,nuvamarca,NULL);   
            if j.task_type_id = 10444 and j.class_causal_id = 2 then
              open cuDatos10444(i.producto_rev);
              fetch cuDatos10444 into rgDatos10444;
              if cuDatos10444%found then 
                if rgDatos10444.marca = 103 then
                  open cuDatosCerti(i.producto_rev, rgDatos10444.request_date);
                  fetch cuDatosCerti into rgDatosCerti;
                  if cuDatosCerti%found then
                    
					for y in cudatosprodf2(i.producto_rev,rgDatos10444.package_id) loop
					sw2:=1;
					nuvamarca:=y.marcaprod;
                    --DBMS_OUTPUT.PUT_LINE(i.producto_rev || '|ACTUALIZA1|' || nuvamarca||'|ANTES|'||nuMarca||' SUSPENSEION|'||nuMarcaSus);
					sbCondicion:='ACTU1';
					end loop;
					if sw2 = 0 then
						nuvamarca:=rgDatos10444.marca;
						--DBMS_OUTPUT.PUT_LINE(i.producto_rev || '|ACTUALIZA2|' || nuvamarca||'|ANTES|'||nuMarca||' SUSPENSEION|'||nuMarcaSus);
						sbCondicion:='ACTU2';
					end if;
					sw2:=0;
                  else
                    --DBMS_OUTPUT.PUT_LINE(i.producto_rev || '|ACTUALIZA3|' || nuvamarca||'|ANTES|'||nuMarca||' SUSPENSEION|'||nuMarcaSus);
					for reg in cudatosprodf3(i.producto_rev) loop
						sw2:=1;
						if reg.marcaprod != -1 then
							nuvamarca:=reg.marcaprod;
							sbCondicion:='ACTU3';
						end if;
					end loop;
					if sw2 = 0 then
						sbCondicion:='ACTU4';
					end if;
					sw2:=0;
                  end if;
                  close cuDatosCerti;
                else
                
					for y in cudatosprodf2(i.producto_rev,rgDatos10444.package_id) loop
						sw2:=1;
						nuvamarca:=y.marcaprod;
						--DBMS_OUTPUT.PUT_LINE(i.producto_rev || '|ACTUALIZA4|' || nuvamarca||'|ANTES|'||nuMarca||' SUSPENSEION|'||nuMarcaSus);
						sbCondicion:='ACTU5';
						end loop;
						if sw2 = 0 then
							nuvamarca:=rgDatos10444.marca;
							--DBMS_OUTPUT.PUT_LINE(i.producto_rev || '|ACTUALIZA5|' || nuvamarca||'|ANTES|'||nuMarca||' SUSPENSEION|'||nuMarcaSus);
							sbCondicion:='ACTU6';
						end if;
						sw2:=0;
					end IF;
                  
              else
                --DBMS_OUTPUT.PUT_LINE(i.producto_rev || '|ACTUALIZA6|' || nuvamarca||'|ANTES|'||nuMarca||' SUSPENSEION|'||nuMarcaSus);
					for reg in cudatosprodf3(i.producto_rev) loop
						sw2:=1;
						if reg.marcaprod != -1 then
							nuvamarca:=reg.marcaprod;
							sbCondicion:='ACTU7';
						end if;
					end loop;
					if sw2 = 0 then
						sbCondicion:='ACTU8';
					end if;
					sw2:=0;
				     
              end if;
              close cuDatos10444;
            else          
              --DBMS_OUTPUT.PUT_LINE(i.producto_rev || '|ACTUALIZA6|' || nuvamarca||'|ANTES|'||nuMarca||' SUSPENSEION|'||nuMarcaSus);
			        sbCondicion:='ACTU8';
            end if;
          END IF;
        
          sw := 1;
        
        END LOOP;
      
        IF sw = 0 THEN
        
          DELETE open.ldc_marca_producto y WHERE y.id_producto = i.producto_rev; 
          --DBMS_OUTPUT.PUT_LINE(i.producto_rev||'|BORRAR MARCA PRODUCTO2|ANTES|'||nuMarca||' SUSPENSEION|'||nuMarcaSus );
		  sbCondicion:='BORRA';
		  begin select 'Y' into sbActuaSu from open.or_order_activity a, open.mo_motive m, open.mo_suspension ms where a.product_id=i.producto_rev and a.task_type_id in (10450, 12457) and a.status!='F' and a.package_id=m.package_id and m.motive_id=ms.motive_id and suspension_type_id!=101; exception when others then sbActuaSu:='N'; end;
		  begin select 'Y' into sbActuaRe from open.or_order_activity a, open.mo_motive m, open.mo_suspension ms where a.product_id=i.producto_rev and a.task_type_id in (10834, 10835, 10836, 10260) and a.status!='F' and a.package_id=m.package_id and m.motive_id=ms.motive_id and suspension_type_id!=101; exception when others then sbActuaRe:='N'; end;
		  begin select 'Y' into sbActuaPr from open.pr_prod_suspension where product_id=i.producto_rev and suspension_type_id in (101,102,103,104) and active='Y' and suspension_type_id!=101 and rownum=1; exception when others then sbActuaPr:='N'; end;
		  
		  -- UPDATE PR_PROD_SUSPENSION SET SUSPENSION_TYPE_ID=nuvamarca  WHERE PRODUCT_ID=i.producto_rev AND SUSPENSION_TYPE_ID IN (101,102,103,104) AND ACTIVE='Y';
		  -- UPDATE MO_SUSPENSION SET SUSPENSION_TYPE_ID=nuvamarca WHERE MOTIVE_ID IN (SELECT MOTIVE_ID FROM OPEN.MO_MOTIVE MO, OPEN.MO_PACKAGES P, OPEN.OR_ORDER_ACTIVITY A, OPEN.OR_ORDER O WHERE P.PACKAGE_ID=MO.PACKAGE_ID AND P.MOTIVE_STATUS_ID=13 AND P.PACKAGE_ID=A.PACKAGE_ID AND O.ORDER_ID=A.ORDER_ID AND O.TASK_TYPE_ID IN (10450,12457) AND ORDER_STATUS_ID NOT IN (8,12));
		  crReportDetail(nuIdReporte, 'LDC_MARCA_PRODUCTO',i.producto_rev,nuMarca, nuMarcaSuspAct,nuMarcaSusProc,nuMarcaRecoProc, null,sbCondicion, sbActuaSu, sbActuaRe, sbActuaPr);
		ELSIF nuvamarca != -1 THEN
			begin select 'Y' into sbActuaSu from open.or_order_activity a, open.mo_motive m, open.mo_suspension ms where a.product_id=i.producto_rev and a.task_type_id in (10450, 12457) and a.status!='F' and a.package_id=m.package_id and m.motive_id=ms.motive_id and suspension_type_id!=nuvamarca; exception when others then sbActuaSu:='N'; end;
			begin select 'Y' into sbActuaRe from open.or_order_activity a, open.mo_motive m, open.mo_suspension ms where a.product_id=i.producto_rev and a.task_type_id in (10834, 10835, 10836, 10260) and a.status!='F' and a.package_id=m.package_id and m.motive_id=ms.motive_id and suspension_type_id!=nuvamarca; exception when others then sbActuaRe:='N'; end;
			begin select 'Y' into sbActuaPr from open.pr_prod_suspension where product_id=i.producto_rev and suspension_type_id in (101,102,103,104) and active='Y' and suspension_type_id!=nuvamarca and rownum=1; exception when others then sbActuaPr:='N'; end;
			--"OPEN".ldcprocinsactumarcaprodu(i.producto_rev,nuvamarca,NULL);
			-- UPDATE PR_PROD_SUSPENSION SET SUSPENSION_TYPE_ID=nuvamarca  WHERE PRODUCT_ID=i.producto_rev AND SUSPENSION_TYPE_ID IN (101,102,103,104) AND ACTIVE='Y';
			-- UPDATE MO_SUSPENSION SET SUSPENSION_TYPE_ID=nuvamarca WHERE MOTIVE_ID IN (SELECT MOTIVE_ID FROM OPEN.MO_MOTIVE MO, OPEN.MO_PACKAGES P, OPEN.OR_ORDER_ACTIVITY A, OPEN.OR_ORDER O WHERE P.PACKAGE_ID=MO.PACKAGE_ID AND P.MOTIVE_STATUS_ID=13 AND P.PACKAGE_ID=A.PACKAGE_ID AND O.ORDER_ID=A.ORDER_ID AND O.TASK_TYPE_ID IN (10450,12457) AND ORDER_STATUS_ID NOT IN (8,12));
			crReportDetail(nuIdReporte, 'LDC_MARCA_PRODUCTO',i.producto_rev,nuMarca, nuMarcaSuspAct,nuMarcaSusProc ,nuMarcaRecoProc,nuvamarca,sbCondicion, sbActuaSu, sbActuaRe, sbActuaPr);
			--dbms_output.put_line(nuvamarca);
		ELSIF nuvamarca = -1 THEN
			begin select 'Y' into sbActuaSu from open.or_order_activity a, open.mo_motive m, open.mo_suspension ms where a.product_id=i.producto_rev and a.task_type_id in (10450, 12457) and a.status!='F' and a.package_id=m.package_id and m.motive_id=ms.motive_id; exception when others then sbActuaSu:='N'; end;
			begin select 'Y' into sbActuaRe from open.or_order_activity a, open.mo_motive m, open.mo_suspension ms where a.product_id=i.producto_rev and a.task_type_id in (10834, 10835, 10836, 10260) and a.status!='F' and a.package_id=m.package_id and m.motive_id=ms.motive_id; exception when others then sbActuaRe:='N'; end;
			begin select 'Y' into sbActuaPr from open.pr_prod_suspension where product_id=i.producto_rev and suspension_type_id in (101,102,103,104) and active='Y' and rownum=1; exception when others then sbActuaPr:='N'; end;
			
			-- UPDATE PR_PROD_SUSPENSION SET SUSPENSION_TYPE_ID=nuvamarca  WHERE PRODUCT_ID=i.producto_rev AND SUSPENSION_TYPE_ID IN (101,102,103,104) AND ACTIVE='Y';
			-- UPDATE MO_SUSPENSION SET SUSPENSION_TYPE_ID=nuvamarca WHERE MOTIVE_ID IN (SELECT MOTIVE_ID FROM OPEN.MO_MOTIVE MO, OPEN.MO_PACKAGES P, OPEN.OR_ORDER_ACTIVITY A, OPEN.OR_ORDER O WHERE P.PACKAGE_ID=MO.PACKAGE_ID AND P.MOTIVE_STATUS_ID=13 AND P.PACKAGE_ID=A.PACKAGE_ID AND O.ORDER_ID=A.ORDER_ID AND O.TASK_TYPE_ID IN (10450,12457) AND ORDER_STATUS_ID NOT IN (8,12));
			crReportDetail(nuIdReporte, 'LDC_MARCA_PRODUCTO',i.producto_rev,nuMarca, nuMarcaSuspAct,nuMarcaSusProc ,nuMarcaRecoProc,nuvamarca,'NADA', sbActuaSu, sbActuaRe, sbActuaPr);
        END IF;
		sw := 0;
		
		nucontausuarios:=nucontausuarios+1;
		IF MOD(nucontausuarios,2000) =0 THEN
			COMMIT;
			ldc_sendemail( 'dsaltarin@horbath.com','Cantidad de usuarios procesados test1',nucontausuarios);
		END IF;
  END LOOP;
  DBMS_OUTPUT.PUT_LINE(nucontausuarios);
  ldc_sendemail( 'dsaltarin@horbath.com','Termino test1',nucontausuarios);
  COMMIT;

EXCEPTION

  WHEN OTHERS THEN
  
    dbms_output.put_line('Error ' || sqlerrm);
  
END;

/
