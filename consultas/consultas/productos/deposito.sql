SELECT *
FROM OPEN.SUSCRIPC
WHERE SUSCCODI = 66690118;
--
SELECT *
FROM OPEN.SERVSUSC
WHERE SESUNUSE = 51546398;
--
SELECT *
FROM OPEN.SALDFAVO
WHERE SAFASESU = 51546398
;
--
SELECT *
FROM OPEN.MOVISAFA
WHERE MOSFSESU = 51546398
 
;
--
SELECT *
FROM OPEN.PAGOS
WHERE PAGOSUSC = 66690118;
--
SELECT *
FROM OPEN.CUPON
WHERE CUPONUME IN(108237859
);

select m.subscription_id, m.product_id,p.package_id, p.attention_date, 
p.package_type_id,(select description from open.ps_package_type t where t.package_type_id=p.package_type_id) desc_pack,
(SELECT  /*+ index(a IDX_MO_PACKAGE_PAYMENT) */
               B.ACCOUNT
        FROM    OPEN.MO_PACKAGE_PAYMENT A, open.MO_MOTIVE_PAYMENT b
                /*+ MO_BOPackagePayment.GetIDPackPayment */
        WHERE   A.PACKAGE_ID = P.PACKAGE_ID
        AND     A.ACTIVE||'' = 'Y' 
        AND A.PACKAGE_PAYMENT_ID=B.PACKAGE_PAYMENT_ID) FACTURA,
        SUSCSAFA
from open.mo_packages p, open.mo_motive m, open.suscripc
where p.package_id=m.package_id
 and m.subscription_id in (66427259,66545582,66642300,66642295,66478355,66443053,66656198,66341311,66579478,66630710,66579250,66579434,66579298,66630849,66579400,66577621,66630846,66579380,66579501,66579246,66577841,66577669,66630650,66579268,66577849,66579496,66577929,66579131,66579100,66630843,66577928,66579530,66579459,66579045,66577913,66579413,66577917,66579228,66579147,66579447,66577581,66577840,66630668,66577953,66579122,66577847,66577837,66577952,66579259,66579487,66579137,66630758,66577768,66579393,66579171,66577898,66630659,66579332,66630761,66579117,66630695,66579394,66630617,66577798,66630840,66579427,66579173,66579505,66579339,66630665,66577899,66579038,66630807,66577861,66630713,66577642,66579512,66577628,66630837,66577916,66579316,66630764,66577850,66577886,66579467,66630611,66577938,66577645,66579051,66579433,66630798,66579425,66630662,66577715,66577834,66630816,66577895,66579243,66577566,66577827,66579402,66630716,66579378,66579374,66579470,66579016,66579490,66579033,66579220,66579282,66579439,66577868,66630698,66579130,66577912,66577887,66579524,66630704,66579209,66579023,66577857,66577724,66577848,66579183,66579366,66577880,66577856,66579474,66630801,66577820,66577842,66579362,66630810,66579164,66579075,66579272,66577896,66630749,66577860,66579408,66579481,66630813,66630653,66579387,66630647,66630701,66577975,66579460,66630804,66630752,66630620,66579432,66579105,66577872,66577817,66579454,66579159,66577569,66630656,66579445,66630707,66577907,66579363,66577804,66577811,66577575,66577765,66579055,66579373,66577921,66630755,66579179,66577866,66577972,66579493,66630795,66579392,66579349,66579233,66577893,66577935,66630522,66630537,66630516,66630603,66630549,66630513,66630594,66630561,66630525,66630540,66630543,66630546,66630519,66630528,66630534,66630552,66630597,66630555,66630606,66630600,66630531,66658456,66658172,66658588,66657955,66658661,66658247,66658353,66658178,66657918,66658371,66658534,66658649,66658058,66657964,66658310,66658130,66641961,66442989,66558641,66294230,66622311,66342756,66543779,66460767,66656577,66558608,66567218,66326983,66503363,66539197,66558631,66649036,66461252,66436252,66283894,66298863,66570526,66575866,66486271,66300476)
 and package_type_id in (271, 100229)
 and p.motive_status_id =14
 and m.subscription_id=SUSCCODI
 and suscsafa>0
-- and p.package_id=15041513


select *
from (select p.package_id, p.motive_status_id, p.package_type_id, m.subscription_id , m.producT_id, open.RC_BCPositiveBalance.fnuGetDepPosBalBySusc(m.subscription_id) deposito
      /*  factcodi factura,
        f.factfege,
       (select cucocodi from open.cuencobr where cucofact=factcodi) cuenta_cobri*/
from open.mo_packages p, open.mo_motive m--, open.factura f
where m.package_id=p.package_id
  --and m.subscription_id in (66427259,66545582,66478355,66656198,66341311,66641961,66442989,66558641,66294230,66342756,66543779,66460767,66558608,66567218,66326983,66503363,66539197,66558631,66461252,66283894,66298863,66570526,66575866,66486271,66300476, 66657431,66286554,66623876,66598178,66597242,66490260,66474301,66287664,66367316,66556254,66364754,66551897,66460408,66342880,66343129,66595465,66575961,66321679,66530547,66427259,66545582,66642300,66642295,66478355,66443053,66656198,66341311,66579478,66630710,66579250,66579434,66579298,66630849,66579400,66577621,66630846,66579380,66579501,66579246,66577841,66577669,66630650,66579268,66577849,66579496,66577929,66579131,66579100,66630843,66577928,66579530,66579459,66579045,66577913,66579413,66577917,66579228,66579147,66579447,66577581,66577840,66630668,66577953,66579122,66577847,66577837,66577952,66579259,66579487,66579137,66630758,66577768,66579393,66579171,66577898,66630659,66579332,66630761,66579117,66630695,66579394,66630617,66577798,66630840,66579427,66579173,66579505,66579339,66630665,66577899,66579038,66630807,66577861,66630713,66577642,66579512,66577628,66630837,66577916,66579316,66630764,66577850,66577886,66579467,66630611,66577938,66577645,66579051,66579433,66630798,66579425,66630662,66577715,66577834,66630816,66577895,66579243,66577566,66577827,66579402,66630716,66579378,66579374,66579470,66579016,66579490,66579033,66579220,66579282,66579439,66577868,66630698,66579130,66577912,66577887,66579524,66630704,66579209,66579023,66577857,66577724,66577848,66579183,66579366,66577880,66577856,66579474,66630801,66577820,66577842,66579362,66630810,66579164,66579075,66579272,66577896,66630749,66577860,66579408,66579481,66630813,66630653,66579387,66630647,66630701,66577975,66579460,66630804,66630752,66630620,66579432,66579105,66577872,66577817,66579454,66579159,66577569,66630656,66579445,66630707,66577907,66579363,66577804,66577811,66577575,66577765,66579055,66579373,66577921,66630755,66579179,66577866,66577972,66579493,66630795,66579392,66579349,66579233,66577893,66577935,66630522,66630537,66630516,66630603,66630549,66630513,66630594,66630561,66630525,66630540,66630543,66630546,66630519,66630528,66630534,66630552,66630597,66630555,66630606,66630600,66630531,66658456,66658172,66658588,66657955,66658661,66658247,66658353,66658178,66657918,66658371,66658534,66658649,66658058,66657964,66658310,66658130,66641961,66442989,66558641,66294230,66622311,66342756,66543779,66460767,66656577,66558608,66567218,66326983,66503363,66539197,66558631,66649036,66461252,66436252,66283894,66298863,66570526,66575866,66486271,66300476)
  --and subscription_id in (66657431,66286554,66623876,66598178,66597242,66490260,66474301,66287664,66367316,66556254,66364754,66551897,66460408,66342880,66343129,66595465,66575961,66321679,66530547)
  and subscription_id in (66427259,66545582,66642300,66642295,66478355,66443053,66656198,66341311,66579478,66630710,66579250,66579434,66579298,66630849,66579400,66577621,66630846,66579380,66579501,66579246,66577841,66577669,66630650,66579268,66577849,66579496,66577929,66579131,66579100,66630843,66577928,66579530,66579459,66579045,66577913,66579413,66577917,66579228,66579147,66579447,66577581,66577840,66630668,66577953,66579122,66577847,66577837,66577952,66579259,66579487,66579137,66630758,66577768,66579393,66579171,66577898,66630659,66579332,66630761,66579117,66630695,66579394,66630617,66577798,66630840,66579427,66579173,66579505,66579339,66630665,66577899,66579038,66630807,66577861,66630713,66577642,66579512,66577628,66630837,66577916,66579316,66630764,66577850,66577886,66579467,66630611,66577938,66577645,66579051,66579433,66630798,66579425,66630662,66577715,66577834,66630816,66577895,66579243,66577566,66577827,66579402,66630716,66579378,66579374,66579470,66579016,66579490,66579033,66579220,66579282,66579439,66577868,66630698,66579130,66577912,66577887,66579524,66630704,66579209,66579023,66577857,66577724,66577848,66579183,66579366,66577880,66577856,66579474,66630801,66577820,66577842,66579362,66630810,66579164,66579075,66579272,66577896,66630749,66577860,66579408,66579481,66630813,66630653,66579387,66630647,66630701,66577975,66579460,66630804,66630752,66630620,66579432,66579105,66577872,66577817,66579454,66579159,66577569,66630656,66579445,66630707,66577907,66579363,66577804,66577811,66577575,66577765,66579055,66579373,66577921,66630755,66579179,66577866,66577972,66579493,66630795,66579392,66579349,66579233,66577893,66577935,66630522,66630537,66630516,66630603,66630549,66630513,66630594,66630561,66630525,66630540,66630543,66630546,66630519,66630528,66630534,66630552,66630597,66630555,66630606,66630600,66630531,66658456,66658172,66658588,66657955,66658661,66658247,66658353,66658178,66657918,66658371,66658534,66658649,66658058,66657964,66658310,66658130,66641961,66442989,66558641,66294230,66622311,66342756,66543779,66460767,66656577,66558608,66567218,66326983,66503363,66539197,66558631,66649036,66461252,66436252,66283894,66298863,66570526,66575866,66486271,66300476)
  and p.package_type_id in (271, 100229)
  and p.motive_status_id=14
  --and f.factcodi=open.MO_BOPackagePayment.fnuGetAccountByPackage(p.package_id)
  ) datos
  where datos.deposito>0
  /* and product_id not in (50911640,50922989, 51004938, 50893402 ) --usuarios pendientse por validar
   and product_id not in (50920525, 51186563, 51184993, 51368609) --usuario pago 2 veces
   and product_id not in (51482051, 51002429, 51505161, 51211837) --cotizada
;*/


select p.package_id, p.attention_date, m.product_id, open.RC_BCPositiveBalance.fnuGetDepPosBalBySusc(m.subscription_id)
from open.mo_packages p, open.mo_motive m
where p.package_id=m.package_id
  and package_type_id=271
  and p.motive_status_id=14
  and p.attention_date>='01/04/2018'
  and p.attention_date<'01/05/2018'
  --and open.RC_BCPositiveBalance.fnuGetDepPosBalBySusc(m.subscription_id)>0

