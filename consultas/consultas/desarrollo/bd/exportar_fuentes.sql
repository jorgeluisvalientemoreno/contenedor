declare
    cursor cuDatos is
    select lower(OBJECT_NAME)||'.sql' nombre,OBJECT_TYPE, dbms_metadata.get_ddl(OBJECT_TYPE,OBJECT_NAME)  FUENTE
    from dba_objects d
    where object_name in ('GE_EXEACTION_CT1E121008922','FABSCT93E121177867','FABSCT93E121006470','GE_EXEACTION_CT1E121036956','FABSCT93E121006476','FABSCT93E121146928','FABSCT93E121006475','GE_EXEACTION_CT1E121008830','FABSCT93E121177872','GEGE_EXERULVAL_CT69E121036955','FABSCT93E121177870','FABSCT93E121006462','FABSCT93E121006466','FABSCT93E121177868','FABSCT93E121146936','FABSCT93E121006472','FABSCT93E121285637','FABSCT93E121152948','GE_EXEACTION_CT1E121008829','FABSCT93E121006474','FABSCT93E121171952','GE_EXEACTION_CT1E121008858','FABSCT93E121146932','FABSCT93E121006471','GE_EXEACTION_CT1E121007987','FABSCT93E121269558','FABSCT93E121006473','FABSCT93E121177873','FABSCT93E121177871','FABSCT93E121006469','GE_EXEACTION_CT1E121036959','GEGE_EXERULVAL_CT69E121036953','GE_EXEACTION_CT1E121036958','FABSCT93E121006467','GE_EXEACTION_CT1E121036957','GE_EXEACTION_CT1E121008857','FABSCT93E121067081','FABSCT93E121006465','FABSCT93E121171953','FABSCT93E121006468','GEGE_EXERULVAL_CT69E121036951','FABSCT93E121398626','IMIM_CT101E121023985','FABSCT93E121310738','FABSCT93E121038651','FABSCT93E121175202','FABSCT93E121207021','GE_EXEACTION_CT1E121008888','LDC_PKGOSFFACTURE2','FCFLDC_DETALLEFACT_GASCARIBE2','GC_CONTRACTORSCT321E121008841','MO_INITATRIB_CT23E121296509','MO_VALIDATTR_CT26E121079824','GEGE_EXERULVAL_CT69E121008769','MO_INITATRIB_CT23E121388977','MO_INITATRIB_CT23E121296514','GC_CONTRACTORSCT321E121008789','GC_CONTRACTORSCT321E121008865','GC_CONTRACTORSCT321E121008802','MO_INITATRIB_CT23E121296499','GC_CONTRACTORSCT321E121008791','MO_INITATRIB_CT23E121079823','FWFW_PROCESS_CT54E121208349','MO_INITATRIB_CT23E121040036','FWFW_PROCESS_CT54E121000675','MO_INITATRIB_CT23E121296504','GC_CONTRACTORSCT321E121008794','MO_INITATRIB_CT23E121296501','FWFW_PROCESS_CT54E121000676','MO_INITATRIB_CT23E121007429','FABRCT56E121174575','GEGE_EXERULVAL_CT69E121008764','GC_CONTRACTORSCT321E121008806','OR_SEL_TASTYP_CT404E121379978','MO_VALIDATTR_CT26E121296510','MO_INITATRIB_CT23E121388985','GEGE_EXERULVAL_CT69E121008771','FWFW_PROCESS_CT54E121047679','GC_CONTRACTORSCT321E121061724','MO_INITATRIB_CT23E121296515','MO_INITATRIB_CT23E121296506','FWFW_PROCESS_CT54E121176923','OR_SEL_TASTYP_CT404E121042185','GC_CONTRACTORSCT321E121008862','MO_INITATRIB_CT23E121388987','MO_INITATRIB_CT23E121029467','GEGE_EXERULVAL_CT69E121008828','FWFW_PROCESS_CT54E121176922','FWFW_PROCESS_CT54E121007046','GEGE_EXERULVAL_CT69E121008873','GC_CONTRACTORSCT321E121008805','MO_INITATRIB_CT23E121040037','GE_EXEACTION_CT1E153000786','FABRCT56E121140862','GE_EXEACTION_CT1E121008821','FWFW_PROCESS_CT54E121000677','MO_INITATRIB_CT23E121039518','GC_CONTRACTORSCT321E121008814','MO_INITATRIB_CT23E121029469','GEGE_EXERULVAL_CT69E121008765','FWFW_PROCESS_CT54E121208348','FABRCT56E121351826','MO_VALIDATTR_CT26E121388982','MO_VALIDATTR_CT26E121388979','GC_CONTRACTORSCT321E121006664','GC_CONTRACTORSCT321E121006759','MO_INITATRIB_CT23E121296512','MO_INITATRIB_CT23E121388988','GC_CONTRACTORSCT321E121008818','CC_POL_BRILLA_CT585E121007390','GC_CONTRACTORSCT321E121008820','MO_INITATRIB_CT23E121296511','GEGE_EXERULVAL_CT69E121388989','FWFW_PROCESS_CT54E121176913','FWFW_PROCESS_CT54E121208347','FABRCT56E121140861','GC_CONTRACTORSCT321E121008813','GC_CONTRACTORSCT321E121008800','GEGE_EXERULVAL_CT69E121036952','GC_CONTRACTORSCT321E121008801','GEGE_EXERULVAL_CT69E121008760','GC_CONTRACTORSCT321E121008866','MO_INITATRIB_CT23E121039517','GEGE_EXERULVAL_CT69E121262400','FWFW_PROCESS_CT54E121000904','GC_CONTRACTORSCT321E121008817','GEGE_EXERULVAL_CT69E121036954','MO_INITATRIB_CT23E121296498','FWFW_PROCESS_CT54E21384','GEGE_EXERULVAL_CT69E121008772','MO_INITATRIB_CT23E121388983','GEGE_EXERULVAL_CT69E121008757','MO_INITATRIB_CT23E121296508','GC_CONTRACTORSCT321E121008826','GEGE_EXERULVAL_CT69E121008761','OR_SEL_TASTYP_CT404E121042186','GEGE_EXERULVAL_CT69E121008759','GEGE_EXERULVAL_CT69E121008766','GEGE_EXERULVAL_CT69E121008767','MO_INITATRIB_CT23E121296500','GEGE_EXERULVAL_CT69E121008770','GEGE_EXERULVAL_CT69E121008867','OR_SEL_TASTYP_CT404E121042183','MO_INITATRIB_CT23E121388980','GEGE_EXERULVAL_CT69E121008768','GC_CONTRACTORSCT321E121008861','GEGE_EXERULVAL_CT69E121008758','GC_CONTRACTORSCT321E121008827','GEGE_EXERULVAL_CT69E121008756','GC_CONTRACTORSCT321E121008837','GC_CONTRACTORSCT321E121008838','MO_VALIDATTR_CT26E121296505','GC_CONTRACTORSCT321E121006757','GC_CONTRACTORSCT321E121008863','FWFW_PROCESS_CT54E121176912','GEGE_EXERULVAL_CT69E121008845','GC_CONTRACTORSCT321E121008804','MO_INITATRIB_CT23E121040038','MO_INITATRIB_CT23E121296513','GEGE_EXERULVAL_CT69E121122437','FWFW_PROCESS_CT54E121176914','GC_CONTRACTORSCT321E121006758','FWFW_PROCESS_CT54E121176920','GEGE_EXERULVAL_CT69E121008763','GC_CONTRACTORSCT321E121008815','GC_CONTRACTORSCT321E121008793','MO_INITATRIB_CT23E121039519','GC_CONTRACTORSCT321E121008842','FWFW_PROCESS_CT54E121000903','CC_POL_BRILLA_CT585E121062877','MO_INITATRIB_CT23E121029468','FWFW_PROCESS_CT54E121007043','GEGE_EXERULVAL_CT69E121008780','MO_VALIDATTR_CT26E121296507','MO_INITATRIB_CT23E121388984','MO_INITATRIB_CT23E121296502','OR_SEL_TASTYP_CT404E121042184','GC_CONTRACTORSCT321E121008792','GC_CONTRACTORSCT321E121008790','GC_CONTRACTORSCT321E121008819','MO_INITATRIB_CT23E121007431','GC_CONTRACTORSCT321E121061643','MO_VALIDATTR_CT26E121388978','MO_INITATRIB_CT23E121296503','GC_CONTRACTORSCT321E121008824','GC_CONTRACTORSCT321E121008788','MO_EVE_COMP_CT65E121040041','FWFW_PROCESS_CT54E121000896','MO_INITATRIB_CT23E121388981','GC_CONTRACTORSCT321E121008803','MO_EVE_COMP_CT65E121296516','GC_CONTRACTORSCT321E121008839','MO_INITATRIB_CT23E121007430','CC_POL_BRILLA_CT585E121007389','MO_VALIDATTR_CT26E121388986')
    and not exists(select null from open.gr_config_expression c where c.object_name=d.OBJECT_NAME)
    --and object_name in ('LDC_PKGOSFFACTURE2')
    and object_type='PROCEDURE'
    --and rownum=1
    ;
    SBRUTA       VARCHAR2(4000) := '/smartfiles/Construcciones/';
    SBLINEA      VARCHAR2(4000) := NULL;
    SBNEWLINEA   VARCHAR2(4000) := NULL;
    SBARCHI      VARCHAR2(4000) := NULL;
    SBMESSAGE    VARCHAR2(32000);
    ARCH         UTL_FILE.FILE_TYPE;
    ASBA         UTL_FILE.FILE_TYPE;
    INCO         UTL_FILE.FILE_TYPE;
begin
    
    for reg in cuDatos loop
        begin
             SBARCHI :=reg.nombre;
             SBMESSAGE := REG.FUENTE;
             SBMESSAGE := SBMESSAGE||'/';
             INCO := UTL_FILE.FOPEN(SBRUTA, SBARCHI, 'W');
             UTL_FILE.PUT_LINE(INCO, SBMESSAGE);
             UTL_FILE.FCLOSE(INCO);
        exception
            when others then
                dbms_output.put_line(SBARCHI||' '||sqlerrm);
        end;
    end loop;
end;
/




declare
    cursor cuDatos is
    select lower(OBJECT_NAME)||'.sql' nombre,OBJECT_TYPE, dbms_metadata.get_ddl(OBJECT_TYPE,OBJECT_NAME)  FUENTE
    from dba_objects d
    where object_name in ('FRCGETUNIDOPERTECCERT','FSBESTADOFINANCIERO','FSBEXISTSINSTANSUBSC','FSBGETCALIFICACION','FSBGETDEUDORBRILLA','FSBGETESTSOLVENTA','FSBGETOBSCONSECNOLECT','FSBGETOBSNOLECT','FSBGETSALEBYORDERVSI','FSBGETTIPOCONS','FSBOBSERVACIONOTPADRE','FSBSECTOROPERATIVO','LDCBI_ASSIGN_IOT_METER_READING','LDCFNCRETORNAFLAGDOCCOMPL','LDCFNCRETORNAMESLIQ','LDCFNU_GETMEREBYLOCA','LDCFNU_VENANOACTUAL','LDCFNU_VENANODIREC','LDC_ALLOW_GET_INFO_FNB','LDC_CARTASNOTIFICACION','LDC_CARTERACORRIENTE','LDC_CARTERADIFERIDA','LDC_CAULEG','LDC_CONSULTAVALDESMONTE','LDC_CRM_FECHAANO','LDC_CRM_FECHADIA','LDC_DATO_ADIC_NOTI_VENTAS','LDC_FNAPLICAENTREGAXCASO','LDC_FNCONSULTAORANPU','LDC_FNCONSULTAORDENES','LDC_FNCONSULTAOTESDOC','LDC_FNCRECUFACTCICLO','LDC_FNCRECUPAGOCICLO','LDC_FNCRETORNAPRODMOTIVE','LDC_FNCVALCUMPLDIFSEGMCOM','LDC_FNC_GETCUADREPFAC','LDC_FNC_GETSEGMENTSUSC','LDC_FNPRODDISPOSUSPEDFNC','LDC_FNUCENTRMEDCOTI','LDC_FNUCOMODATO','LDC_FNUCONTROLVISUALANULSOLI','LDC_FNUGETEDADCC','LDC_FNUGETLASTSUSPTYPEBYPROD','LDC_FNUGETNEWIDENTLODPD','LDC_FNUGETNUMBEREXPACCOUNTS','LDC_FNUGETPEFABYPECO','LDC_FNUGETTASKTYPEBYSUBS','LDC_FNUGETVASUPTITR','LDC_FNUGETZEROCONSPER2','LDC_FNURETACTAORDEN','LDC_FNURETDEPALOCACLIENTE','LDC_FNURETINFODATOADICORD','LDC_FNURETINFOORDENRUTERO','LDC_FNUULTESTACORT','LDC_FNUVALIDACASOSINSTALA','LDC_FNUVALIDACASOSREPARA','LDC_FNUVALIPROCESPPAGO','LDC_FNUVALQUOINIART','LDC_FNUVALVENTCOMI','LDC_FNUVALVENTTYPACK','LDC_FNU_APLICAENTREGA','LDC_FNVNOMBRECONTRA','LDC_FRFLISTCONTRACTOR','LDC_FRFLISTOPERATINGUNITY','LDC_FSBASIGNAUTOMATICAREVPER','LDC_FSBCOMMENORDER','LDC_FSBESTRATOVALIDO','LDC_FSBEXCLUIROT','LDC_FSBGETINFOBYCRIT','LDC_FSBGETNEWNAMELODPD','LDC_FSBNUMFORMULARIO','LDC_FSBOBTORDHIJA','LDC_FSBTTPROCESOCORREO','LDC_FSBVALIDAEXPRESION_IC','LDC_FVARETCONSUMOS','LDC_FVATELSUBSCRIBER','LDC_GETFINANVALSBYPKGTYPE','LDC_IMPORTEENLETRAS','LDC_PLAN_PRIO_FINAN','LDC_PROCCONSULTAACTASABIERTAS','LDC_PROCCONSULTAPRODOTSPNO','LDC_PRODSUSPEND','LDC_PRO_CANTI_REFINANCIADO','LDC_PRSUSPRVSEG','LDC_PRUOCERTIFICACION','LDC_PRVALIDAUOCERT','LDC_RETORACOBRORECONEX','LDC_RETORACTASSALDOSUSP','LDC_RETORADEDUAAFECHA','LDC_RETORADEUDAPRESENMES','LDC_RETORAFECHMORFECHA','LDC_RETORNAAUI_NIVEL','LDC_RETORNACONCIDECAJE','LDC_RETORNACUPONCONCIDECAJE','LDC_RETORNADIFEROSINIESTRO','LDC_RETORNAFLAGASOUNIDPER','LDC_RETORNAINTMOFI','LDC_RETORNAMEEDADMORA','LDC_RETORNAPROMED','LDC_SBRETORNACODDANE','LDC_SHOW_PAYMENT_ORDERS','LDC_TECNICOS_CERTIFICADO','LDC_TELE_PREFIJO','LDC_TIPO_DE_TELEF','LDC_VALIDAORDENINSTANCE','LDC_VISUALCONDTER','LD_FA_FNU_AREA_TYPE','NUTRAEUTLLECTFACT','OBTENERSALDORED','SBDATEMAXUNO','USU_NORMALIZADO_VIGENTE')
    and not exists(select null from open.gr_config_expression c where c.object_name=d.OBJECT_NAME)
    and object_type='FUNCTION'
    and rownum=1
    ;
    SBRUTA       VARCHAR2(4000) := '/smartfiles/Construcciones/';
    SBLINEA      VARCHAR2(4000) := NULL;
    SBNEWLINEA   VARCHAR2(4000) := NULL;
    SBARCHI      VARCHAR2(4000) := NULL;
    SBMESSAGE    VARCHAR2(32000);
    ARCH         UTL_FILE.FILE_TYPE;
    ASBA         UTL_FILE.FILE_TYPE;
    INCO         UTL_FILE.FILE_TYPE;
begin
    for reg in cuDatos loop
        begin
             SBARCHI :=reg.nombre;
             SBMESSAGE := replace(REG.FUENTE, chr(10), chr(13) || chr(10));
             --SBMESSAGE := SBMESSAGE||chr(13) || chr(10)||'/'||chr(13) || chr(10);
             INCO := UTL_FILE.FOPEN(SBRUTA, SBARCHI, 'W');
             
              UTL_FILE.PUT_LINE(INCO, SBMESSAGE);
             --UTL_FILE.put(INCO, utl_i18n.raw_to_char(utl_raw.cast_to_raw(SBMESSAGE), 'utf8'));
             UTL_FILE.FCLOSE(INCO);
        exception
            when others then
                dbms_output.put_line(SBARCHI||' '||sqlerrm);
        end;
    end loop;
end;
/

declare
    cursor cuDatos is
    select lower(OBJECT_NAME)||'.sql' nombre,OBJECT_TYPE, dbms_metadata.get_ddl(OBJECT_TYPE,OBJECT_NAME)  FUENTE
    from dba_objects d
    where object_name in ('FRCGETUNIDOPERTECCERT','FSBESTADOFINANCIERO','FSBEXISTSINSTANSUBSC','FSBGETCALIFICACION','FSBGETDEUDORBRILLA','FSBGETESTSOLVENTA','FSBGETOBSCONSECNOLECT','FSBGETOBSNOLECT','FSBGETSALEBYORDERVSI','FSBGETTIPOCONS','FSBOBSERVACIONOTPADRE','FSBSECTOROPERATIVO','LDCBI_ASSIGN_IOT_METER_READING','LDCFNCRETORNAFLAGDOCCOMPL','LDCFNCRETORNAMESLIQ','LDCFNU_GETMEREBYLOCA','LDCFNU_VENANOACTUAL','LDCFNU_VENANODIREC','LDC_ALLOW_GET_INFO_FNB','LDC_CARTASNOTIFICACION','LDC_CARTERACORRIENTE','LDC_CARTERADIFERIDA','LDC_CAULEG','LDC_CONSULTAVALDESMONTE','LDC_CRM_FECHAANO','LDC_CRM_FECHADIA','LDC_DATO_ADIC_NOTI_VENTAS','LDC_FNAPLICAENTREGAXCASO','LDC_FNCONSULTAORANPU','LDC_FNCONSULTAORDENES','LDC_FNCONSULTAOTESDOC','LDC_FNCRECUFACTCICLO','LDC_FNCRECUPAGOCICLO','LDC_FNCRETORNAPRODMOTIVE','LDC_FNCVALCUMPLDIFSEGMCOM','LDC_FNC_GETCUADREPFAC','LDC_FNC_GETSEGMENTSUSC','LDC_FNPRODDISPOSUSPEDFNC','LDC_FNUCENTRMEDCOTI','LDC_FNUCOMODATO','LDC_FNUCONTROLVISUALANULSOLI','LDC_FNUGETEDADCC','LDC_FNUGETLASTSUSPTYPEBYPROD','LDC_FNUGETNEWIDENTLODPD','LDC_FNUGETNUMBEREXPACCOUNTS','LDC_FNUGETPEFABYPECO','LDC_FNUGETTASKTYPEBYSUBS','LDC_FNUGETVASUPTITR','LDC_FNUGETZEROCONSPER2','LDC_FNURETACTAORDEN','LDC_FNURETDEPALOCACLIENTE','LDC_FNURETINFODATOADICORD','LDC_FNURETINFOORDENRUTERO','LDC_FNUULTESTACORT','LDC_FNUVALIDACASOSINSTALA','LDC_FNUVALIDACASOSREPARA','LDC_FNUVALIPROCESPPAGO','LDC_FNUVALQUOINIART','LDC_FNUVALVENTCOMI','LDC_FNUVALVENTTYPACK','LDC_FNU_APLICAENTREGA','LDC_FNVNOMBRECONTRA','LDC_FRFLISTCONTRACTOR','LDC_FRFLISTOPERATINGUNITY','LDC_FSBASIGNAUTOMATICAREVPER','LDC_FSBCOMMENORDER','LDC_FSBESTRATOVALIDO','LDC_FSBEXCLUIROT','LDC_FSBGETINFOBYCRIT','LDC_FSBGETNEWNAMELODPD','LDC_FSBNUMFORMULARIO','LDC_FSBOBTORDHIJA','LDC_FSBTTPROCESOCORREO','LDC_FSBVALIDAEXPRESION_IC','LDC_FVARETCONSUMOS','LDC_FVATELSUBSCRIBER','LDC_GETFINANVALSBYPKGTYPE','LDC_IMPORTEENLETRAS','LDC_PLAN_PRIO_FINAN','LDC_PROCCONSULTAACTASABIERTAS','LDC_PROCCONSULTAPRODOTSPNO','LDC_PRODSUSPEND','LDC_PRO_CANTI_REFINANCIADO','LDC_PRSUSPRVSEG','LDC_PRUOCERTIFICACION','LDC_PRVALIDAUOCERT','LDC_RETORACOBRORECONEX','LDC_RETORACTASSALDOSUSP','LDC_RETORADEDUAAFECHA','LDC_RETORADEUDAPRESENMES','LDC_RETORAFECHMORFECHA','LDC_RETORNAAUI_NIVEL','LDC_RETORNACONCIDECAJE','LDC_RETORNACUPONCONCIDECAJE','LDC_RETORNADIFEROSINIESTRO','LDC_RETORNAFLAGASOUNIDPER','LDC_RETORNAINTMOFI','LDC_RETORNAMEEDADMORA','LDC_RETORNAPROMED','LDC_SBRETORNACODDANE','LDC_SHOW_PAYMENT_ORDERS','LDC_TECNICOS_CERTIFICADO','LDC_TELE_PREFIJO','LDC_TIPO_DE_TELEF','LDC_VALIDAORDENINSTANCE','LDC_VISUALCONDTER','LD_FA_FNU_AREA_TYPE','NUTRAEUTLLECTFACT','OBTENERSALDORED','SBDATEMAXUNO','USU_NORMALIZADO_VIGENTE')
    and not exists(select null from open.gr_config_expression c where c.object_name=d.OBJECT_NAME)
    and object_type='FUNCTION'
    and rownum=1
    ;
    SBRUTA       VARCHAR2(4000) := '/smartfiles/Construcciones/';
    SBLINEA      VARCHAR2(4000) := NULL;
    SBNEWLINEA   VARCHAR2(4000) := NULL;
    SBARCHI      VARCHAR2(4000) := NULL;
    SBMESSAGE    VARCHAR2(32000);
    ARCH         UTL_FILE.FILE_TYPE;
    ASBA         UTL_FILE.FILE_TYPE;
    INCO         UTL_FILE.FILE_TYPE;
    v_Targetcharset VARCHAR2 (40 BYTE);
    v_Dbcharset     VARCHAR2 (40 BYTE);
    v_Raw1          RAW (20000);
begin
    for reg in cuDatos loop
        begin 
            -- define target CHARACTERSET
            v_Targetcharset := 'WE8ISO8859P1';
            -- define current NLS_CHARACTERSET
            v_Dbcharset := 'AL16UTF16';
            
            
            -- using RAW to avoid the problem documented in
            -- Note:257707.1 Last character truncated when using the CONVERT function
            -- due to bug 1840038 UTL_RAW.CONVERT DOES NOT RECOGNIZE CHARACTER SET NAME IN ITS PARAMETERS
            -- UTL_RAW.CONVERT needs a "NLS_LANG style" syntax and not like the docset say a characterset
            -- the best workaround is to prefix the characterset with AMERICAN_AMERICA.
            --
            v_Dbcharset := 'AMERICAN_AMERICA.' || v_Dbcharset;
            v_Targetcharset := 'AMERICAN_AMERICA.' || v_Targetcharset;
            
            -- convert the data first to RAW
            v_Raw1 := UTL_RAW.CAST_TO_RAW (REG.FUENTE);
            
            
             SBARCHI :=reg.nombre;
             --SBMESSAGE := replace(REG.FUENTE, chr(10), chr(13) || chr(10));
             --SBMESSAGE := SBMESSAGE||chr(13) || chr(10)||'/'||chr(13) || chr(10);
             --INCO := UTL_FILE.FOPEN(SBRUTA, SBARCHI, 'W');
             -- now write it out "as is"
            -- use the "byte mode" open_mode when wring out raw
            INCO := UTL_FILE.FOPEN (SBRUTA, SBARCHI, 'AB');
            UTL_FILE.PUT_LINE(INCO, CHR(239) || CHR(187) || CHR(191));
            UTL_FILE.PUT_RAW (INCO, v_Raw1, TRUE);
            -- convert that RAW to Targetcharset
            -- syntax: result := UTL_RAW.CONVERT(input, new_charset, old_charset);
            v_Raw1 := UTL_RAW.CONVERT (v_Raw1, v_Targetcharset, v_Dbcharset);
            
            UTL_FILE.PUT_RAW (INCO, v_Raw1);
             
             --UTL_FILE.PUT_LINE(INCO, SBMESSAGE);
             --UTL_FILE.put(INCO, utl_i18n.raw_to_char(utl_raw.cast_to_raw(SBMESSAGE), 'ISO'));
             --utl_file.put_line(INCO, convert(SBMESSAGE, 'WE8MSWIN1252', 'AL16UTF16'));
             UTL_FILE.FCLOSE(INCO);

        exception
            when others then
                dbms_output.put_line(SBARCHI||' '||sqlerrm);
        end;
    end loop;
end;
/




set serveroutput on;
declare
    cursor cuDatos is
        select lower(OBJECT_NAME)||'.sql' nombre,OBJECT_TYPE, dbms_metadata.get_ddl(OBJECT_TYPE,OBJECT_NAME)  FUENTE
    from dba_objects d
    where object_name in ('FRCGETUNIDOPERTECCERT','FSBESTADOFINANCIERO','FSBEXISTSINSTANSUBSC','FSBGETCALIFICACION','FSBGETDEUDORBRILLA','FSBGETESTSOLVENTA','FSBGETOBSCONSECNOLECT','FSBGETOBSNOLECT','FSBGETSALEBYORDERVSI','FSBGETTIPOCONS','FSBOBSERVACIONOTPADRE','FSBSECTOROPERATIVO','LDCBI_ASSIGN_IOT_METER_READING','LDCFNCRETORNAFLAGDOCCOMPL','LDCFNCRETORNAMESLIQ','LDCFNU_GETMEREBYLOCA','LDCFNU_VENANOACTUAL','LDCFNU_VENANODIREC','LDC_ALLOW_GET_INFO_FNB','LDC_CARTASNOTIFICACION','LDC_CARTERACORRIENTE','LDC_CARTERADIFERIDA','LDC_CAULEG','LDC_CONSULTAVALDESMONTE','LDC_CRM_FECHAANO','LDC_CRM_FECHADIA','LDC_DATO_ADIC_NOTI_VENTAS','LDC_FNAPLICAENTREGAXCASO','LDC_FNCONSULTAORANPU','LDC_FNCONSULTAORDENES','LDC_FNCONSULTAOTESDOC','LDC_FNCRECUFACTCICLO','LDC_FNCRECUPAGOCICLO','LDC_FNCRETORNAPRODMOTIVE','LDC_FNCVALCUMPLDIFSEGMCOM','LDC_FNC_GETCUADREPFAC','LDC_FNC_GETSEGMENTSUSC','LDC_FNPRODDISPOSUSPEDFNC','LDC_FNUCENTRMEDCOTI','LDC_FNUCOMODATO','LDC_FNUCONTROLVISUALANULSOLI','LDC_FNUGETEDADCC','LDC_FNUGETLASTSUSPTYPEBYPROD','LDC_FNUGETNEWIDENTLODPD','LDC_FNUGETNUMBEREXPACCOUNTS','LDC_FNUGETPEFABYPECO','LDC_FNUGETTASKTYPEBYSUBS','LDC_FNUGETVASUPTITR','LDC_FNUGETZEROCONSPER2','LDC_FNURETACTAORDEN','LDC_FNURETDEPALOCACLIENTE','LDC_FNURETINFODATOADICORD','LDC_FNURETINFOORDENRUTERO','LDC_FNUULTESTACORT','LDC_FNUVALIDACASOSINSTALA','LDC_FNUVALIDACASOSREPARA','LDC_FNUVALIPROCESPPAGO','LDC_FNUVALQUOINIART','LDC_FNUVALVENTCOMI','LDC_FNUVALVENTTYPACK','LDC_FNU_APLICAENTREGA','LDC_FNVNOMBRECONTRA','LDC_FRFLISTCONTRACTOR','LDC_FRFLISTOPERATINGUNITY','LDC_FSBASIGNAUTOMATICAREVPER','LDC_FSBCOMMENORDER','LDC_FSBESTRATOVALIDO','LDC_FSBEXCLUIROT','LDC_FSBGETINFOBYCRIT','LDC_FSBGETNEWNAMELODPD','LDC_FSBNUMFORMULARIO','LDC_FSBOBTORDHIJA','LDC_FSBTTPROCESOCORREO','LDC_FSBVALIDAEXPRESION_IC','LDC_FVARETCONSUMOS','LDC_FVATELSUBSCRIBER','LDC_GETFINANVALSBYPKGTYPE','LDC_IMPORTEENLETRAS','LDC_PLAN_PRIO_FINAN','LDC_PROCCONSULTAACTASABIERTAS','LDC_PROCCONSULTAPRODOTSPNO','LDC_PRODSUSPEND','LDC_PRO_CANTI_REFINANCIADO','LDC_PRSUSPRVSEG','LDC_PRUOCERTIFICACION','LDC_PRVALIDAUOCERT','LDC_RETORACOBRORECONEX','LDC_RETORACTASSALDOSUSP','LDC_RETORADEDUAAFECHA','LDC_RETORADEUDAPRESENMES','LDC_RETORAFECHMORFECHA','LDC_RETORNAAUI_NIVEL','LDC_RETORNACONCIDECAJE','LDC_RETORNACUPONCONCIDECAJE','LDC_RETORNADIFEROSINIESTRO','LDC_RETORNAFLAGASOUNIDPER','LDC_RETORNAINTMOFI','LDC_RETORNAMEEDADMORA','LDC_RETORNAPROMED','LDC_SBRETORNACODDANE','LDC_SHOW_PAYMENT_ORDERS','LDC_TECNICOS_CERTIFICADO','LDC_TELE_PREFIJO','LDC_TIPO_DE_TELEF','LDC_VALIDAORDENINSTANCE','LDC_VISUALCONDTER','LD_FA_FNU_AREA_TYPE','NUTRAEUTLLECTFACT','OBTENERSALDORED','SBDATEMAXUNO','USU_NORMALIZADO_VIGENTE')
    and not exists(select null from open.gr_config_expression c where c.object_name=d.OBJECT_NAME)
    and object_type='FUNCTION'
    --and rownum=1

    ;
    SBRUTA       VARCHAR2(4000) := '/smartfiles/Construcciones/';
    SBARCHI      VARCHAR2(4000) := NULL;
    SBMESSAGE    VARCHAR2(32000);
    INCO         UTL_FILE.FILE_TYPE;
    
    TYPE rcCaracEspe IS RECORD(
    CODIGO_ASCI VARCHAR2(50),
    CODIGO_UTF8 VARCHAR2(50),
    CODIGO_CHAR NUMBER);

    TYPE tbCaracEspe IS TABLE OF rcCaracEspe INDEX BY binary_integer;
    tcCaraEspe tbCaracEspe;
    
    i number:=0;
    j number:=11;
begin
    tcCaraEspe(0).CODIGO_ASCI := 'Á';
    tcCaraEspe(0).CODIGO_UTF8 := 'Ã';
    tcCaraEspe(0).CODIGO_CHAR :=193;
    
    tcCaraEspe(1).CODIGO_ASCI := 'á';
    tcCaraEspe(1).CODIGO_UTF8 := 'Ã¡';
    tcCaraEspe(1).CODIGO_CHAR :=225;
    
    tcCaraEspe(2).CODIGO_ASCI := 'É';
    tcCaraEspe(2).CODIGO_UTF8 := 'Ã‰¡';
    tcCaraEspe(2).CODIGO_CHAR :=201;
    
 	tcCaraEspe(3).CODIGO_ASCI := 'é';
    tcCaraEspe(3).CODIGO_UTF8 := 'Ã©';
    tcCaraEspe(3).CODIGO_CHAR :=233;
    
    tcCaraEspe(4).CODIGO_ASCI := 'Í';
    tcCaraEspe(4).CODIGO_UTF8 := 'Ã';
    tcCaraEspe(4).CODIGO_CHAR :=205;

    tcCaraEspe(5).CODIGO_ASCI := 'í';
    tcCaraEspe(5).CODIGO_UTF8 := 'Ã­';
    tcCaraEspe(5).CODIGO_CHAR :=237;
    
    tcCaraEspe(6).CODIGO_ASCI := 'Ó';
    tcCaraEspe(6).CODIGO_UTF8 := 'Ã“';
    tcCaraEspe(6).CODIGO_CHAR :=211;
    
    tcCaraEspe(7).CODIGO_ASCI := 'ó';
    tcCaraEspe(7).CODIGO_UTF8 := 'Ã³';
    tcCaraEspe(7).CODIGO_CHAR :=243;
    
    tcCaraEspe(8).CODIGO_ASCI := 'Ú';
    tcCaraEspe(8).CODIGO_UTF8 := 'Ãš';
    tcCaraEspe(8).CODIGO_CHAR :=218;
    
    tcCaraEspe(9).CODIGO_ASCI := 'ú';
    tcCaraEspe(9).CODIGO_UTF8 := 'Ãº';
    tcCaraEspe(9).CODIGO_CHAR :=250;
    
    tcCaraEspe(10).CODIGO_ASCI := 'Ñ';
    tcCaraEspe(10).CODIGO_UTF8 := 'Ã‘';
    tcCaraEspe(10).CODIGO_CHAR :=209;
    
    tcCaraEspe(11).CODIGO_ASCI := 'ñ';
    tcCaraEspe(11).CODIGO_UTF8 := 'Ã±';
    tcCaraEspe(11).CODIGO_CHAR :=241;
    /*
    tcCaraEspe(12).CODIGO_ASCI := '¿';
    tcCaraEspe(12).CODIGO_UTF8 := 'Â¿';
    tcCaraEspe(12).CODIGO_CHAR :=191;*/
 	
    
    for reg in cuDatos loop
        begin
             SBARCHI :=reg.nombre;
             SBMESSAGE := REG.FUENTE;
             

            begin
              i := 0;
              while i<=j loop
                SBMESSAGE := replace(SBMESSAGE,tcCaraEspe(i).CODIGO_ASCI,tcCaraEspe(i).CODIGO_UTF8);
                i:=i+1;
              end loop;
            end;
             INCO := UTL_FILE.FOPEN(SBRUTA, SBARCHI, 'W');
              UTL_FILE.PUT_LINE(INCO, SBMESSAGE);
              --UTL_FILE.PUT_LINE(INCO,SBMESSAGE,FALSE);
              UTL_FILE.PUT_LINE(INCO, CHR(10)||'/', FALSE);
              UTL_FILE.FCLOSE(INCO);
             --dbms_output.put_line(REG.FUENTE);
        exception
            when others then
                dbms_output.put_line(SBARCHI||' '||sqlerrm);
        end;
    end loop;
end;

/


  

  declare
    cursor cuDatos is
    select lower(OBJECT_NAME)||'.sql' nombre,OBJECT_TYPE, dbms_metadata.get_ddl(OBJECT_TYPE,OBJECT_NAME)  FUENTE
    from dba_objects d, OPEN.master_personalizaciones p
    where object_name =p.nombre
    and not exists(select null from open.gr_config_expression c where c.object_name=d.OBJECT_NAME)
    and object_type='PROCEDURE'
    and tipo_objeto = 'PROCEDURE'
    and comentario is null
    and (select count(1) from dba_dependencies where nombre = referenced_name) =0
    and not exists(select null from open.sa_executable e where e.name=d.object_name)
    and d.object_name not in ('BLOQUEO_CUPOS_ROLLOUT','BORRA_ESPACIOS_DIR','BORRA_LECYCONS_LECTOMNULO','CANCELPOLICYBYAGE','CARGOSMIGR','CLIENTES_INACTIVOS','CMELMEPOSI','CREA_DIRECCIONES_DE_COBRO','CREA_INDEX','CREA_NUEVA_RUTA_INDUSTRIAL','CREAPAGOSSA','CREA_RUTA_INDUSTRIAL','CREASA','CREATE_GRACE_PERIOD','CUENCOBRMIGR')

    ;
    sbRuta       VARCHAR2(4000) := '/smartfiles/Construcciones/';
    sbArchi      VARCHAR2(4000) := NULL;
    sbMessage    VARCHAR2(32767);
    INCO         UTL_FILE.FILE_TYPE;
    nuTamano     NUMBER;
	clFuente	 CLOB;

    TYPE rcCaracEspe IS RECORD(
								CODIGO_ASCI VARCHAR2(50),
								CODIGO_UTF8 VARCHAR2(50),
								CODIGO_CHAR NUMBER
							   );


    TYPE tbCaracEspe IS TABLE OF rcCaracEspe INDEX BY binary_integer;
    tcCaraEspe tbCaracEspe;

    i number:=0;
    j number:=11;

    procedure prCrearArchivo is
    begin
      INCO := UTL_FILE.FOPEN(sbRuta, sbArchi, 'W');
    end;
    procedure prCerrarArchivo is
    begin
      UTL_FILE.PUT_LINE(INCO, CHR(10)||'/', FALSE);
      UTL_FILE.FCLOSE(INCO);
    end;

	procedure prReemplazaCara is
	begin
	  i := 0;
	  while i<=j loop
		clFuente := replace(clFuente,tcCaraEspe(i).CODIGO_ASCI,tcCaraEspe(i).CODIGO_UTF8);
		i:=i+1;
	  end loop;
	end;

begin
    tcCaraEspe(0).CODIGO_ASCI := 'Á';
    tcCaraEspe(0).CODIGO_UTF8 := 'Ã';
    tcCaraEspe(0).CODIGO_CHAR :=193;

    tcCaraEspe(1).CODIGO_ASCI := 'á';
    tcCaraEspe(1).CODIGO_UTF8 := 'Ã¡';
    tcCaraEspe(1).CODIGO_CHAR :=225;

    tcCaraEspe(2).CODIGO_ASCI := 'É';
    tcCaraEspe(2).CODIGO_UTF8 := 'Ã‰¡';
    tcCaraEspe(2).CODIGO_CHAR :=201;

   tcCaraEspe(3).CODIGO_ASCI := 'é';
    tcCaraEspe(3).CODIGO_UTF8 := 'Ã©';
    tcCaraEspe(3).CODIGO_CHAR :=233;

    tcCaraEspe(4).CODIGO_ASCI := 'Í';
    tcCaraEspe(4).CODIGO_UTF8 := 'Ã';
    tcCaraEspe(4).CODIGO_CHAR :=205;

    tcCaraEspe(5).CODIGO_ASCI := 'í';
    tcCaraEspe(5).CODIGO_UTF8 := 'Ã­';
    tcCaraEspe(5).CODIGO_CHAR :=237;

    tcCaraEspe(6).CODIGO_ASCI := 'Ó';
    tcCaraEspe(6).CODIGO_UTF8 := 'Ã“';
    tcCaraEspe(6).CODIGO_CHAR :=211;

    tcCaraEspe(7).CODIGO_ASCI := 'ó';
    tcCaraEspe(7).CODIGO_UTF8 := 'Ã³';
    tcCaraEspe(7).CODIGO_CHAR :=243;

    tcCaraEspe(8).CODIGO_ASCI := 'Ú';
    tcCaraEspe(8).CODIGO_UTF8 := 'Ãš';
    tcCaraEspe(8).CODIGO_CHAR :=218;

    tcCaraEspe(9).CODIGO_ASCI := 'ú';
    tcCaraEspe(9).CODIGO_UTF8 := 'Ãº';
    tcCaraEspe(9).CODIGO_CHAR :=250;

    tcCaraEspe(10).CODIGO_ASCI := 'Ñ';
    tcCaraEspe(10).CODIGO_UTF8 := 'Ã‘';
    tcCaraEspe(10).CODIGO_CHAR :=209;

    tcCaraEspe(11).CODIGO_ASCI := 'ñ';
    tcCaraEspe(11).CODIGO_UTF8 := 'Ã±';
    tcCaraEspe(11).CODIGO_CHAR :=241;
    /*
    tcCaraEspe(12).CODIGO_ASCI := '¿';
    tcCaraEspe(12).CODIGO_UTF8 := 'Â¿';
    tcCaraEspe(12).CODIGO_CHAR :=191;*/


    for reg in cuDatos loop
        begin
             sbArchi :=reg.nombre;
			 clFuente := reg.fuente;
             nuTamano := DBMS_LOB.getlength(clFuente);
             prReemplazaCara();
			 prCrearArchivo;
             while nuTamano > 0 loop
             --if nuTamano <= 4000 then

                 sbMessage := substr(clFuente,1,4000);
                 UTL_FILE.PUT(INCO, sbMessage);
                 clFuente := replace(clFuente,sbMessage,'');
                 nuTamano := DBMS_LOB.getlength(clFuente);
             end loop; 
             prCerrarArchivo;
        exception
            when others then
                dbms_output.put_line(sbArchi||' '||sqlerrm);
        end;
    end loop;
end;



declare
    cursor cuDatos is
    select lower(OBJECT_NAME)||'.sql' nombre,OBJECT_TYPE, dbms_metadata.get_ddl(OBJECT_TYPE,OBJECT_NAME)  FUENTE
    from dba_objects d, OPEN.master_personalizaciones p
    where object_name =p.nombre
    and not exists(select null from open.gr_config_expression c where c.object_name=d.OBJECT_NAME)
    and object_type='PROCEDURE'
    and tipo_objeto = 'PROCEDURE'
    and comentario is null
    and (select count(1) from dba_dependencies where nombre = referenced_name) =0
    and not exists(select null from open.sa_executable e where e.name=d.object_name)
    and d.object_name in ('BLOQUEO_CUPOS_ROLLOUT','BORRA_ESPACIOS_DIR','BORRA_LECYCONS_LECTOMNULO','CANCELPOLICYBYAGE','CARGOSMIGR','CLIENTES_INACTIVOS','CMELMEPOSI','CREA_DIRECCIONES_DE_COBRO','CREA_INDEX','CREA_NUEVA_RUTA_INDUSTRIAL','CREAPAGOSSA','CREA_RUTA_INDUSTRIAL','CREASA','CREATE_GRACE_PERIOD','CUENCOBRMIGR')

    ;
    sbRuta       VARCHAR2(4000) := '/smartfiles/Construcciones/';
    sbArchi      VARCHAR2(4000) := NULL;
    sbMessage    VARCHAR2(32767);
    INCO         UTL_FILE.FILE_TYPE;
    nuTamano     NUMBER;
	clFuente	 CLOB;

    TYPE rcCaracEspe IS RECORD(
								CODIGO_ASCI VARCHAR2(50),
								CODIGO_UTF8 VARCHAR2(50),
								CODIGO_CHAR NUMBER
							   );


    TYPE tbCaracEspe IS TABLE OF rcCaracEspe INDEX BY binary_integer;
    tcCaraEspe tbCaracEspe;

    i number:=0;
    j number:=11;

    procedure prCrearArchivo is
    begin
      INCO := UTL_FILE.FOPEN(sbRuta, sbArchi, 'W');
    end;
    procedure prCerrarArchivo is
    begin
      UTL_FILE.PUT_LINE(INCO, CHR(10)||'/', FALSE);
      UTL_FILE.FCLOSE(INCO);
    end;

	procedure prReemplazaCara is
	begin
	  i := 0;
	  while i<=j loop
		clFuente := replace(clFuente,tcCaraEspe(i).CODIGO_ASCI,tcCaraEspe(i).CODIGO_UTF8);
		i:=i+1;
	  end loop;
	end;

begin
    tcCaraEspe(0).CODIGO_ASCI := 'Á';
    tcCaraEspe(0).CODIGO_UTF8 := 'Ã';
    tcCaraEspe(0).CODIGO_CHAR :=193;

    tcCaraEspe(1).CODIGO_ASCI := 'á';
    tcCaraEspe(1).CODIGO_UTF8 := 'Ã¡';
    tcCaraEspe(1).CODIGO_CHAR :=225;

    tcCaraEspe(2).CODIGO_ASCI := 'É';
    tcCaraEspe(2).CODIGO_UTF8 := 'Ã‰¡';
    tcCaraEspe(2).CODIGO_CHAR :=201;

   tcCaraEspe(3).CODIGO_ASCI := 'é';
    tcCaraEspe(3).CODIGO_UTF8 := 'Ã©';
    tcCaraEspe(3).CODIGO_CHAR :=233;

    tcCaraEspe(4).CODIGO_ASCI := 'Í';
    tcCaraEspe(4).CODIGO_UTF8 := 'Ã';
    tcCaraEspe(4).CODIGO_CHAR :=205;

    tcCaraEspe(5).CODIGO_ASCI := 'í';
    tcCaraEspe(5).CODIGO_UTF8 := 'Ã­';
    tcCaraEspe(5).CODIGO_CHAR :=237;

    tcCaraEspe(6).CODIGO_ASCI := 'Ó';
    tcCaraEspe(6).CODIGO_UTF8 := 'Ã“';
    tcCaraEspe(6).CODIGO_CHAR :=211;

    tcCaraEspe(7).CODIGO_ASCI := 'ó';
    tcCaraEspe(7).CODIGO_UTF8 := 'Ã³';
    tcCaraEspe(7).CODIGO_CHAR :=243;

    tcCaraEspe(8).CODIGO_ASCI := 'Ú';
    tcCaraEspe(8).CODIGO_UTF8 := 'Ãš';
    tcCaraEspe(8).CODIGO_CHAR :=218;

    tcCaraEspe(9).CODIGO_ASCI := 'ú';
    tcCaraEspe(9).CODIGO_UTF8 := 'Ãº';
    tcCaraEspe(9).CODIGO_CHAR :=250;

    tcCaraEspe(10).CODIGO_ASCI := 'Ñ';
    tcCaraEspe(10).CODIGO_UTF8 := 'Ã‘';
    tcCaraEspe(10).CODIGO_CHAR :=209;

    tcCaraEspe(11).CODIGO_ASCI := 'ñ';
    tcCaraEspe(11).CODIGO_UTF8 := 'Ã±';
    tcCaraEspe(11).CODIGO_CHAR :=241;
    /*
    tcCaraEspe(12).CODIGO_ASCI := '¿';
    tcCaraEspe(12).CODIGO_UTF8 := 'Â¿';
    tcCaraEspe(12).CODIGO_CHAR :=191;*/


    for reg in cuDatos loop
        begin
             sbArchi :=reg.nombre;
			 clFuente := reg.fuente;
             nuTamano := DBMS_LOB.getlength(clFuente);
             prReemplazaCara();
			 prCrearArchivo;
             while nuTamano > 0 loop
             --if nuTamano <= 4000 then

                 sbMessage := substr(clFuente,1,4000);
                 UTL_FILE.PUT(INCO, sbMessage);
                 clFuente := replace(clFuente,sbMessage,'');
                 nuTamano := DBMS_LOB.getlength(clFuente);
             end loop; 
             prCerrarArchivo;
        exception
            when others then
                dbms_output.put_line(sbArchi||' '||sqlerrm);
        end;
    end loop;
end;



declare
    cursor cuDatos is
    select lower(OBJECT_NAME)||'.sql' nombre,OBJECT_TYPE , object_name
    from dba_objects d
    where object_name = 'LDC_BOLDSEMAIL'
      and object_type='PACKAGE';
      
    cursor cuFuente(sbNombre varchar2) is
    select d.type,line, text, rownum
    from dba_source d
    where owner='OPEN'
     and name=upper(sbNombre)
     order by d.type,line;
    
    sbRuta       VARCHAR2(4000) := '/smartfiles/Construcciones/';
    sbArchi      VARCHAR2(4000) := NULL;
    sbMessage    VARCHAR2(32767);
    INCO         UTL_FILE.FILE_TYPE;
    nuContador   NUMBER;
    

    TYPE rcCaracEspe IS RECORD(
                CODIGO_ASCI VARCHAR2(50),
                CODIGO_UTF8 VARCHAR2(50),
                CODIGO_CHAR NUMBER
                 );


    TYPE tbCaracEspe IS TABLE OF rcCaracEspe INDEX BY binary_integer;
    tcCaraEspe tbCaracEspe;

    i number:=0;
    j number:=11;

    procedure prCrearArchivo is
    begin
      INCO := UTL_FILE.FOPEN(sbRuta, sbArchi, 'W', 32767);
    end;
    procedure prCerrarArchivo is
    begin
      UTL_FILE.PUT_LINE(INCO, '/', FALSE);
      UTL_FILE.FCLOSE(INCO);
    end;

  procedure prReemplazaCara(sbCadena in out varchar2) is
  begin
    i := 0;
    while i<=j loop
      sbCadena := replace(sbCadena,tcCaraEspe(i).CODIGO_ASCI,tcCaraEspe(i).CODIGO_UTF8);
      i:=i+1;
    end loop;
  end;

begin
    tcCaraEspe(0).CODIGO_ASCI := 'Á';
    tcCaraEspe(0).CODIGO_UTF8 := 'Ã';
    tcCaraEspe(0).CODIGO_CHAR :=193;

    tcCaraEspe(1).CODIGO_ASCI := 'á';
    tcCaraEspe(1).CODIGO_UTF8 := 'Ã¡';
    tcCaraEspe(1).CODIGO_CHAR :=225;

    tcCaraEspe(2).CODIGO_ASCI := 'É';
    tcCaraEspe(2).CODIGO_UTF8 := 'Ã‰¡';
    tcCaraEspe(2).CODIGO_CHAR :=201;

   tcCaraEspe(3).CODIGO_ASCI := 'é';
    tcCaraEspe(3).CODIGO_UTF8 := 'Ã©';
    tcCaraEspe(3).CODIGO_CHAR :=233;

    tcCaraEspe(4).CODIGO_ASCI := 'Í';
    tcCaraEspe(4).CODIGO_UTF8 := 'Ã';
    tcCaraEspe(4).CODIGO_CHAR :=205;

    tcCaraEspe(5).CODIGO_ASCI := 'í';
    tcCaraEspe(5).CODIGO_UTF8 := 'Ã­';
    tcCaraEspe(5).CODIGO_CHAR :=237;

    tcCaraEspe(6).CODIGO_ASCI := 'Ó';
    tcCaraEspe(6).CODIGO_UTF8 := 'Ã“';
    tcCaraEspe(6).CODIGO_CHAR :=211;

    tcCaraEspe(7).CODIGO_ASCI := 'ó';
    tcCaraEspe(7).CODIGO_UTF8 := 'Ã³';
    tcCaraEspe(7).CODIGO_CHAR :=243;

    tcCaraEspe(8).CODIGO_ASCI := 'Ú';
    tcCaraEspe(8).CODIGO_UTF8 := 'Ãš';
    tcCaraEspe(8).CODIGO_CHAR :=218;

    tcCaraEspe(9).CODIGO_ASCI := 'ú';
    tcCaraEspe(9).CODIGO_UTF8 := 'Ãº';
    tcCaraEspe(9).CODIGO_CHAR :=250;

    tcCaraEspe(10).CODIGO_ASCI := 'Ñ';
    tcCaraEspe(10).CODIGO_UTF8 := 'Ã‘';
    tcCaraEspe(10).CODIGO_CHAR :=209;

    tcCaraEspe(11).CODIGO_ASCI := 'ñ';
    tcCaraEspe(11).CODIGO_UTF8 := 'Ã±';
    tcCaraEspe(11).CODIGO_CHAR :=241;
    /*
    tcCaraEspe(12).CODIGO_ASCI := '¿';
    tcCaraEspe(12).CODIGO_UTF8 := 'Â¿';
    tcCaraEspe(12).CODIGO_CHAR :=191;*/


    for reg in cuDatos loop
        begin
             sbArchi :=reg.nombre;
             prCrearArchivo;
             nuContador := 0;
             for reg2 in cuFuente(reg.object_name) loop
               if reg2.line = 1 and reg2.rownum!=1 then
                 UTL_FILE.PUT_LINE(INCO, '/', FALSE);
               end if;
               if reg2.line = 1 then
                  sbMessage := 'CREATE OR REPLACE '||reg2.text;
               else
                  sbMessage := reg2.text;
               end if;
               
               prReemplazaCara(sbMessage);
               UTL_FILE.PUT_LINE(INCO, replace(sbMessage,CHR(10),''));
               --nuContador:=nuContador+1;
               --dbms_output.put_line(nuContador);
             end loop; 
             prCerrarArchivo;
        exception
            when others then
                dbms_output.put_line(sbArchi||' '||sqlerrm);
        end;
    end loop;
end;



select d.type,line, text, rownum, length(text) tamano,  ASCII( 'B' ) Caracter,
         ASCII( 'Blog de Miguel Troyano' ) Cadena, ascii(text),
         CHR(66),
         UTL_RAW.CAST_TO_RAW (text),
         UTL_RAW.CONVERT (UTL_RAW.CAST_TO_RAW (text), 'AMERICAN_AMERICA.WE8ISO8859P1', 'AMERICAN_AMERICA.AL16UTF16'),
         CONVERT(TEXT, 'US7ASCII','UTF8'),
         CONVERT(TEXT, 'UTF8', 'US7ASCII'),
         CONVERT(TEXT, 'AL32UTF8', 'US7ASCII'),
         CONVERT(TEXT, 'US7ASCII', 'AL32UTF8'),
         CONVERT(TEXT, 'WE8ISO8859P1', 'AL32UTF8'),
         CONVERT(TEXT, 'AL32UTF8', 'WE8ISO8859P1')
    from dba_source d
    where owner='OPEN'
     and type='PACKAGE BODY'
     and text like '%'||chr(191)||'%'
     order by d.type,line;




declare
    cursor cuDatos is
    select lower(OBJECT_NAME)||'.sql' nombre,OBJECT_TYPE , object_name
    from dba_objects d
    where OBJECT_NAME in ('FIX_BORRA_TELEFONOS','FIX_BRILLAINACTIVOS','FIX_CARG_2850','FIX_CARG_POLIZS','FIX_CARGCODO_SEQUENCE','FIX_CARGDOSO','FIX_CARGDOSO_2','FIX_CICLOS_INDUSTRIAS','FIX_CLIESUSC','FIX_CUCOFEPA','FIX_CUCOFEPA1','FIX_ELEMMEDI_ELMETOPE','FIX_ELMESESUFECH','FIX_EMSSFEIN','FIX_ESPACIOS','FIX_FECHA_INSTALACION','FIX_FEULLICO','FIX_MONICA','FIX_PROCEJEC','FIX_PRODUCTSUSC','FIX_SEQUENCES','FIX_SESUMECV','FIX_TIPO_MEDIDOR','FIX_TIPOCLIE','FIXCARGUNID','FIXCLIENTES','PR_AB_ADDRESS','PR_AB_ADDRESS_N','PR_AB_ADDRESS_T','PR_AB_BLOCK','PR_AB_PREMISE','PR_AB_SEGMENTS','PR_AB_WAY_BY_LOCATION','PR_ACT_ESTACORT_ROLLOUT','PR_ACT_SESUFECO','PR_ACT_SUSP_PRP_ROLLOUT','PR_ACT_TIPOMED_ROLLOUT','PR_ACT_TIPOSUSP_ROLLOUT','PR_ACTCONSU','PR_ACTFECHACALENT_ROLLOUT','PR_ACTFECHPAGOS','PR_ACTGE_ITEMS_ROLLOUT','PR_ACTPRPRODUCT_ROLLOUT','PR_ACTPRPRODUCT_ROLLOUT1','PR_ACTUALIZA_GIS','PR_ACTUALIZA_PUNTOSCONEXMA','PR_ACTUALIZA_SUPENSIONES','PR_AGRUPA_DIFECOFI','PR_BORRA_PERIODOS','PR_CALENTADORES_ROLLOUT','PR_CERTIFICACION_ROLLOUT','PR_CERTITERCE_ROLLOUT','PR_CODEUDOR_ROLLOUT','PR_CONSSESU','PR_CONT_REINT_ROLLOUT','PR_COPRSUCA','PR_CREA_AJUSTE_CUENTA_POST','PR_CREA_CONCILIA','PR_CREA_IMPUESTOMGR','PR_CREA_INDICES_CONSSESU','PR_CREA_INDICES_LECTELME','PR_DEFINE_ESFI','PR_DIRECCIONES_N','PR_ELMESESU','PR_FM_POSSIBLE_ROLLOUT','PR_GARANTIAS_ROLLOUT','PR_HICOPRPM','PR_HOMOLOGACIONES','PR_LD_POLICY_ROLLOUT','PR_LD_POLICY_ROLLOUT1','PR_LDC_MIG_DIRECCION','PR_LDC_OSF_SESUCIER','PR_LECTELME','PR_LECTELME1','PR_MARCA_CONSUMOS','PR_MEDIVIEJOS','PR_MIG_FM_POSSIBLE_NTL','PR_MIGRA_GE_ITEMS_ROLLOUT','PR_MIGRA_MATERIALES_ROLLOUT','PR_MIGRA_SELLOS_ROLLOUT','PR_OR_ORDER_LECTELME','PR_OR_ROUTE','PR_OR_ROUTE_PREMISE','PR_ORDENES_ROLLOUT','PR_OTS_SUSP_PRP_ROLLOUT','PR_POLICY_EXEQ_ROLLOUT','PR_PRODATOSSUSCRIPC_ROLLOUT','PR_RECONEXION_ROLLOUT','PR_SUSPASOCIADOS_ROLLOUT','PR_SUSPCONE_ROLLOUT','PR_TASA_DIFERIDOS','PR_TELEMEDIDO','PR_UPDATE_GE_GEOGRA','PR_VAVAFACO','PRACTMATERIALES','PRARMAENTREGAREGLAS','PRCOMPONENTMIGR','PREELEMMEDI','PREMEDIVIEJOS','BLOQUEO_CUPOS_ROLLOUT','BORRA_ESPACIOS_DIR','BORRA_LECYCONS_LECTOMNULO','CARGOSMIGR','CLIENTES_INACTIVOS','CMELMEPOSI','CREA_DIRECCIONES_DE_COBRO','CREA_NUEVA_RUTA_INDUSTRIAL','CREAPAGOSSA','CREA_RUTA_INDUSTRIAL','CREASA','CREATE_GRACE_PERIOD','CUENCOBRMIGR','CUPONMIGR','DEL_CUENTA_SINCARGOS','DELETESUSCRIPC','DIFERIDOFINANCING','DIFERIDOMIGR','ELEMMEDIMIGR','ELEMMEDIMIGROTROSESTAMEDI','FACTURAMIGR','GESUBSCRIBER','MATERIALES_ACTIVOS_ROLLOUT','MATERIALES_INVENTARIO_ROLLOUT','MODIFYCARGDOSO','MODIFYCARGDOSOINT','MOSUSPENSION_ROLLOUT','MOVIDIFEMIGR','NOTASCASTMIGR','NOTASMIGR','PAGOSMIGR','PERIFACTMIGR','PERSONASMIGR','PRFACTURASFALTANTEMIGR','PROCEJECMIGR','PROGARANTIASSERVICIO7014','PRPRODSUSPENSIONMIGR','PRPRODUCTMGR','STATELEMMEDIMIGR','SUSCRIPCMIGR','BLOQUEO_CUPOS_ROLLOUT','MATERIALES_ACTIVOS_ROLLOUT','MATERIALES_INVENTARIO_ROLLOUT','MOSUSPENSION_ROLLOUT','PR_ACT_ESTACORT_ROLLOUT','PR_ACTFECHACALENT_ROLLOUT','PR_ACTGE_ITEMS_ROLLOUT','PR_ACTPRPRODUCT_ROLLOUT','PR_ACTPRPRODUCT_ROLLOUT1','PR_ACT_SUSP_PRP_ROLLOUT','PR_ACT_TIPOMED_ROLLOUT','PR_ACT_TIPOSUSP_ROLLOUT','PR_CALENTADORES_ROLLOUT','PR_CERTIFICACION_ROLLOUT','PR_CERTITERCE_ROLLOUT','PR_CODEUDOR_ROLLOUT','PR_CONT_REINT_ROLLOUT','PR_FM_POSSIBLE_ROLLOUT','PR_GARANTIAS_ROLLOUT','PR_LD_POLICY_ROLLOUT','PR_LD_POLICY_ROLLOUT1','PR_MIGRA_GE_ITEMS_ROLLOUT','PR_MIGRA_MATERIALES_ROLLOUT','PR_MIGRA_SELLOS_ROLLOUT','PR_ORDENES_ROLLOUT','PR_OTS_SUSP_PRP_ROLLOUT','PR_POLICY_EXEQ_ROLLOUT','PR_PRODATOSSUSCRIPC_ROLLOUT','PR_RECONEXION_ROLLOUT','PR_SUSPASOCIADOS_ROLLOUT','PR_SUSPCONE_ROLLOUT','PRPRODSUSPENSIONMIGR','CUT_DATA_MIGRANET_JOB','CUT_DATA_MIGRANET_PRODUCT','LOG_MIGRAS','MIGRACARGOS','MIGRACARGOS2','MIGRACARGOS3','PKLOG_MIGRACION','PK_MIGRACION_GARANTIAS','PK_MIGRACION_GASPLUS_BLOQUE1','PK_MIGRACION_GASPLUS_BLOQUE4','PK_MIGRACION_GASPLUS_ESPECIAL','PK_MIGRACION_PERSONA','PK_MIGRA_ORDERGASP_1','PRAJUSTEPAGOSNOMIGRADOS','PR_MIGRA_GE_ITEMS_ROLLOUT','PR_MIGRA_MATERIALES_ROLLOUT','PR_MIGRA_SELLOS_ROLLOUT')
     and object_type in ('PACKAGE BODY','PROCEDURE','FUNCTION');

    cursor cuFuente(sbNombre varchar2) is
    select d.type,line, text, rownum
    from dba_source d
    where owner='OPEN'
     and name=upper(sbNombre)
     order by d.type,line;

    sbRuta       VARCHAR2(4000) := '/smartfiles/Construcciones/';
    sbArchi      VARCHAR2(4000) := NULL;
    sbMessage    VARCHAR2(32767);
    INCO         UTL_FILE.FILE_TYPE;
    nuContador   NUMBER;


    TYPE rcCaracEspe IS RECORD(
                CODIGO_ASCI VARCHAR2(50),
                CODIGO_UTF8 VARCHAR2(50),
                CODIGO_CHAR NUMBER
                 );


    TYPE tbCaracEspe IS TABLE OF rcCaracEspe INDEX BY binary_integer;
    tcCaraEspe tbCaracEspe;

    i number:=0;
    j number:=11;

    procedure prCrearArchivo is
    begin
      INCO := UTL_FILE.FOPEN(sbRuta, sbArchi, 'W', 32767);
    end;
    procedure prCerrarArchivo is
    begin
      UTL_FILE.PUT_LINE(INCO, '/', FALSE);
      UTL_FILE.FCLOSE(INCO);
    end;

  procedure prReemplazaCara(sbCadena in out varchar2) is
  begin
    i := 0;
    while i<=j loop
      sbCadena := replace(sbCadena,tcCaraEspe(i).CODIGO_ASCI,tcCaraEspe(i).CODIGO_UTF8);
      i:=i+1;
    end loop;
  end;

begin
    tcCaraEspe(0).CODIGO_ASCI := 'Á';
    tcCaraEspe(0).CODIGO_UTF8 := 'Ã';
    tcCaraEspe(0).CODIGO_CHAR :=193;

    tcCaraEspe(1).CODIGO_ASCI := 'á';
    tcCaraEspe(1).CODIGO_UTF8 := 'Ã¡';
    tcCaraEspe(1).CODIGO_CHAR :=225;

    tcCaraEspe(2).CODIGO_ASCI := 'É';
    tcCaraEspe(2).CODIGO_UTF8 := 'Ã‰¡';
    tcCaraEspe(2).CODIGO_CHAR :=201;

   tcCaraEspe(3).CODIGO_ASCI := 'é';
    tcCaraEspe(3).CODIGO_UTF8 := 'Ã©';
    tcCaraEspe(3).CODIGO_CHAR :=233;

    tcCaraEspe(4).CODIGO_ASCI := 'Í';
    tcCaraEspe(4).CODIGO_UTF8 := 'Ã';
    tcCaraEspe(4).CODIGO_CHAR :=205;

    tcCaraEspe(5).CODIGO_ASCI := 'í';
    tcCaraEspe(5).CODIGO_UTF8 := 'Ã­';
    tcCaraEspe(5).CODIGO_CHAR :=237;

    tcCaraEspe(6).CODIGO_ASCI := 'Ó';
    tcCaraEspe(6).CODIGO_UTF8 := 'Ã“';
    tcCaraEspe(6).CODIGO_CHAR :=211;

    tcCaraEspe(7).CODIGO_ASCI := 'ó';
    tcCaraEspe(7).CODIGO_UTF8 := 'Ã³';
    tcCaraEspe(7).CODIGO_CHAR :=243;

    tcCaraEspe(8).CODIGO_ASCI := 'Ú';
    tcCaraEspe(8).CODIGO_UTF8 := 'Ãš';
    tcCaraEspe(8).CODIGO_CHAR :=218;

    tcCaraEspe(9).CODIGO_ASCI := 'ú';
    tcCaraEspe(9).CODIGO_UTF8 := 'Ãº';
    tcCaraEspe(9).CODIGO_CHAR :=250;

    tcCaraEspe(10).CODIGO_ASCI := 'Ñ';
    tcCaraEspe(10).CODIGO_UTF8 := 'Ã‘';
    tcCaraEspe(10).CODIGO_CHAR :=209;

    tcCaraEspe(11).CODIGO_ASCI := 'ñ';
    tcCaraEspe(11).CODIGO_UTF8 := 'Ã±';
    tcCaraEspe(11).CODIGO_CHAR :=241;
    /*
    tcCaraEspe(12).CODIGO_ASCI := '¿';
    tcCaraEspe(12).CODIGO_UTF8 := 'Â¿';
    tcCaraEspe(12).CODIGO_CHAR :=191;*/


    for reg in cuDatos loop
        begin
             sbArchi :=reg.nombre;
             prCrearArchivo;
             nuContador := 0;
             for reg2 in cuFuente(reg.object_name) loop
               if reg2.line = 1 and reg2.rownum!=1 then
                 UTL_FILE.PUT_LINE(INCO, '/', FALSE);
               end if;
               if reg2.line = 1 then
                  sbMessage := 'CREATE OR REPLACE '||reg2.text;
               else
                  sbMessage := reg2.text;
               end if;

               prReemplazaCara(sbMessage);
               UTL_FILE.PUT_LINE(INCO, replace(sbMessage,CHR(10),''));
               --nuContador:=nuContador+1;
               --dbms_output.put_line(nuContador);
             end loop; 
             prCerrarArchivo;
        exception
            when others then
                dbms_output.put_line(sbArchi||' '||sqlerrm);
        end;
    end loop;
end;
