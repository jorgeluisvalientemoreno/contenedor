WITH BASE AS(
SELECT DISTINCT /*+ INDEX(O IDX_OR_ORDER_012)*/ O.ORDER_ID,
       O.TASK_TYPE_ID,
       (SELECT OPEN.DAOR_TASK_TYPE.FSBGETDESCRIPTION(O.TASK_TYPE_ID,NULL) FROM DUAL) DESC_TITR,
       DECODE(O.CHARGE_STATUS,3,O.ORDER_VALUE,0) INGRESO,
       A.PACKAGE_ID,
       O.OPERATING_UNIT_ID
FROM OPEN.OR_ORDER O
INNER JOIN OPEN.OR_ORDER_ACTIVITY A ON A.ORDER_ID=O.ORDER_ID
WHERE O.TASK_tYPE_ID IN (10074,10075,10077,10088,10093,10094,10714,10716,10720,10721,10722,10723,10764,10833,10916,10923,10924,10925,10926,10933,10951,10952,10953,10954,10955,12135,12137,12138,12143,12147,12148,12155,12187,12188,12189,12190,12487, 12705, 12292, 12333, 12194, 12182)
  AND O.ORDER_STATUS_ID=8
  AND TRUNC(O.LEGALIZATION_dATE)>='01/01/2019'
  AND TRUNC(O.LEGALIZATION_DATE)<'01/02/2019'
UNION ALL
SELECT DISTINCT /*+ INDEX(O IDX_OR_ORDER_012)*/ O.ORDER_ID,
       O.TASK_TYPE_ID,
       (SELECT OPEN.DAOR_TASK_TYPE.FSBGETDESCRIPTION(O.TASK_TYPE_ID,NULL) FROM DUAL) DESC_TITR,
       DECODE(O.CHARGE_STATUS,3,O.ORDER_VALUE,0) INGRESO,
       A.PACKAGE_ID,
       O.OPERATING_UNIT_ID
FROM OPEN.OR_ORDER O
INNER JOIN OPEN.OR_ORDER_ACTIVITY A ON A.ORDER_ID=O.ORDER_ID
WHERE O.TASK_tYPE_ID IN (10074,10075,10077,10088,10093,10094,10714,10716,10720,10721,10722,10723,10764,10833,10916,10923,10924,10925,10926,10933,10951,10952,10953,10954,10955,12135,12137,12138,12143,12147,12148,12155,12187,12188,12189,12190,12487, 12705, 12292, 12333, 12194, 12182)
  AND O.ORDER_STATUS_ID=8
  AND  trunc(o.created_Date) >= '01/08/2019'
  and trunc(o.created_Date) < '01/09/2019'
  and trunc(o.legalization_date)< '01/08/2019'
  ),
PROCESO AS(
 select 10074 titr, 'MTTO' PROCESO FROM DUAL union all
 select 10075 titr, 'MTTO' PROCESO FROM DUAL union all
 select 10077 titr, 'MTTO' PROCESO FROM DUAL union all
 select 10088 titr, 'MTTO' PROCESO FROM DUAL union all
 select 10093 titr, 'MTTO' PROCESO FROM DUAL union all
 select 10094 titr, 'MTTO' PROCESO FROM DUAL union all
 select 10722 titr, 'RP' PROCESO FROM DUAL union all
 select 10723 titr, 'RP' PROCESO FROM DUAL union all
 select 10951 titr, 'SV' PROCESO FROM DUAL union all
 select 10952 titr, 'SV' PROCESO FROM DUAL union all
 select 10953 titr, 'SV' PROCESO FROM DUAL union all
 select 10716 titr, 'RP' PROCESO FROM DUAL union all
 select 10720 titr, 'RP' PROCESO FROM DUAL union all
 select 10721 titr, 'RP' PROCESO FROM DUAL union all
 select 10933 titr, 'RP' PROCESO FROM DUAL union all
 select 10764 titr, 'MTTO' PROCESO FROM DUAL union all
 select 10833 titr, 'RP' PROCESO FROM DUAL union all
 select 10923 titr, 'SV' PROCESO FROM DUAL union all
 select 10954 titr, 'SV' PROCESO FROM DUAL union all
 select 10955 titr, 'SV' PROCESO FROM DUAL union all
 select 10925 titr, 'RP' PROCESO FROM DUAL union all
 select 10926 titr, 'RP' PROCESO FROM DUAL union all
 select 10916 titr, 'RP' PROCESO FROM DUAL union all
 select 10714 titr, 'RP' PROCESO FROM DUAL union all
 select 10924 titr, 'RP' PROCESO FROM DUAL)  
SELECT BASE.*,
       (SELECT SUM(OI.VALUE) FROM OPEN.OR_ORDER_ITEMS OI WHERE OI.ORDER_ID=BASE.ORDER_ID) VALOR_OT,
       (SELECT SUM(A.VALUE_REFERENCE*N.LIQUIDATION_SIGN*NVL((SELECT -1 FROM OPEN.OR_RELATED_ORDER R WHERE R.RELATED_ORDER_ID=BASE.ORDER_ID),1)) FROM OPEN.OR_ORDER_ACTIVITY A, OPEN.CT_ITEM_NOVELTY N WHERE N.ITEMS_ID=a.ACTIVITY_ID AND A.ORDER_ID=BASE.ORDER_ID) VALOR_NOVEDAD,
       PROCESO
FROM BASE  
LEFT JOIN PROCESO ON BASE.TASK_TYPE_ID=PROCESO.TITR
  
