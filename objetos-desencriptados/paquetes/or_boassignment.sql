PACKAGE BODY Or_BOAssignment AS
    
    
    

    
    
    
    CNUNOEXISREGIST   CONSTANT NUMBER := 2055; 

    
    
    CSBVERSION          CONSTANT VARCHAR2(250) := 'SAO198736';

    
    
    

    FUNCTION FSBVERSION  RETURN VARCHAR2 IS
    BEGIN
    
        RETURN CSBVERSION;
    
    END;

    
    
    
    

















    PROCEDURE ASSIGNORDERPROCESS
    (
        INUORDERID      IN  OR_ORDER.ORDER_ID%TYPE,
        INUOPERUNITID   IN  OR_OPERATING_UNIT.OPERATING_UNIT_ID%TYPE,
        IDTARRANGEDHOUR IN  OR_ORDER.ARRANGED_HOUR%TYPE,
        IDTCHANGEDATE   IN OR_ORDER_STAT_CHANGE.STAT_CHG_DATE%TYPE DEFAULT NULL
    )
    IS
        RCORDER         DAOR_ORDER.STYOR_ORDER;
        RCORDERACTIVITY DAOR_ORDER_ACTIVITY.STYOR_ORDER_ACTIVITY;
        DTARRANGEDHOUR  OR_ORDER.ARRANGED_HOUR%TYPE;
    BEGIN
        UT_TRACE.TRACE('INICIA Or_BOAssignment.assignOrderProcess', 25);

        DTARRANGEDHOUR  :=  IDTARRANGEDHOUR;

        
        DAOR_ORDER.ACCKEY(INUORDERID);
        
        DAOR_OPERATING_UNIT.ACCKEY(INUOPERUNITID);

        IF(DTARRANGEDHOUR IS NULL) THEN
            DTARRANGEDHOUR := SYSDATE;
            
        ELSIF ( DTARRANGEDHOUR < TRUNC(SYSDATE, 'MI')) THEN
            
            GE_BOERRORS.SETERRORCODE(7152); 
        END IF;
    
        RCORDER := DAOR_ORDER.FRCGETRECORD(INUORDERID);
        
        
        IF RCORDER.ORDER_STATUS_ID <> OR_BOCONSTANTS.CNUORDER_STAT_REGISTERED THEN
            GE_BOERRORS.SETERRORCODE(OR_BOCONSTANTS.CNUERR_122462);
        END IF;

        
        IF ( DAOR_OPERATING_UNIT.FSBGETASSIGN_TYPE(INUOPERUNITID) = OR_BCORDEROPERATINGUNIT.CSBASSIGN_SCHED ) THEN

            
            
            IF( OR_BCOPERUNIT_ADMIN.FSBVALIDOPEUNISCHEDASSIGN(RCORDER, INUOPERUNITID) = OR_BOCONSTANTS.CSBNO ) THEN
                
                GE_BOERRORS.SETERRORCODEARGUMENT(6986,' '||RCORDER.ORDER_ID||'|'||INUOPERUNITID||' ');
            END IF;

            RCORDER.ORDER_STATUS_ID    := OR_BOCONSTANTS.CNUORDER_STAT_ASSIGNED;
            RCORDER.OPERATING_UNIT_ID  := INUOPERUNITID;
            RCORDER.ARRANGED_HOUR      := DTARRANGEDHOUR;
            DAOR_ORDER.UPDRECORD(RCORDER);

        ELSE

            
            
            IF( OR_BCOPERUNIT_ADMIN.FSBVALIDOPERUNITASSIGN(RCORDER, INUOPERUNITID) = OR_BOCONSTANTS.CSBNO ) THEN
                
                GE_BOERRORS.SETERRORCODEARGUMENT(6986,' '||RCORDER.ORDER_ID||'|'||INUOPERUNITID||' ');
            END IF;
            
            OR_BOPROCESSORDER.UPDBASICDATA(RCORDER, RCORDER.OPERATING_SECTOR_ID, NULL);

            
            OR_BOPROCESSORDER.ASSIGN(RCORDER,
                                     INUOPERUNITID,
                                     DTARRANGEDHOUR,
                                     FALSE,
                                     TRUE,
                                     NULL,
                                     NULL,
                                     NULL,
                                     NULL,
                                     NULL,
                                     IDTCHANGEDATE);
        END IF;

        UT_TRACE.TRACE('FIN Or_BOAssignment.assignOrderProcess', 25);
    EXCEPTION
        WHEN EX.CONTROLLED_ERROR THEN
            RAISE EX.CONTROLLED_ERROR;
        WHEN OTHERS THEN
            ERRORS.SETERROR;
            RAISE EX.CONTROLLED_ERROR;
    END ASSIGNORDERPROCESS;

END OR_BOASSIGNMENT;