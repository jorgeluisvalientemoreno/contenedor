
CREATE OR REPLACE PROCEDURE CMGAL( INUSCHEDULE IN NUMBER )
 IS
   RCPROGRAMACION DAGE_PROCESS_SCHEDULE.STYGE_PROCESS_SCHEDULE;
   SBPARAMETROS GE_PROCESS_SCHEDULE.PARAMETERS_%TYPE;
   NUPERICOSE PERICOSE.PECSCONS%TYPE;
   SBCONNSTRING VARCHAR2( 500 ) := NULL;
   PROCEDURE OBTIENEPARAMETROS( ISBPARAMETROS IN VARCHAR2, OSBCONEXION OUT VARCHAR2, ONUPERIODO OUT PERICOSE.PECSCONS%TYPE )
    IS
      NUPOSPARAM NUMBER;
      TBSTR UT_STRING.TYTB_STRING;
    BEGIN
      TBSTR.DELETE;
      UT_STRING.EXTSTRING( ISBPARAMETROS, '|', TBSTR );
      FOR I IN 1..TBSTR.COUNT
       LOOP
         NUPOSPARAM := INSTR( TBSTR( I ), 'PECSCONS=' );
         IF NUPOSPARAM != 0 THEN
            ONUPERIODO := SUBSTR( TBSTR( I ), NUPOSPARAM + 9, LENGTH( TBSTR( I ) ) );
         END IF;
      END LOOP;
      NUPOSPARAM := INSTR( ISBPARAMETROS, 'CON=' );
      IF NUPOSPARAM != 0 THEN
         OSBCONEXION := SUBSTR( ISBPARAMETROS, NUPOSPARAM + 4, LENGTH( ISBPARAMETROS ) - ( NUPOSPARAM + 4 ) );
      END IF;
   END;
 BEGIN
   RCPROGRAMACION := DAGE_PROCESS_SCHEDULE.FRCGETRECORD( INUSCHEDULE );
   SBPARAMETROS := RCPROGRAMACION.PARAMETERS_;
   OBTIENEPARAMETROS( SBPARAMETROS, SBCONNSTRING, NUPERICOSE );
   CM_BOREGLECT.EXECUTEREADINGACTBYPERIOD( NUPERICOSE, SBCONNSTRING, RCPROGRAMACION.PROCESS_SCHEDULE_ID );
END;
/


