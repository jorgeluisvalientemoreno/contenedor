CREATE OR REPLACE PACKAGE BODY PKMEASUREMENTELEMENMGR IS
   RCELEMMEDI CUELEMMEDI%ROWTYPE;
   RCRECORDNULL ELEMMEDI%ROWTYPE;
   GPARDEMANDA PARAMETR.PAMECHAR%TYPE;
   TBGPARDEMANDA UT_STRING.TYTB_STRING;
   GNUENERGIA PARAMETR.PAMENUME%TYPE;
   GNUACUEDUCTO PARAMETR.PAMENUME%TYPE;
   BLISLOADED BOOLEAN;
   GBOISLOADEDDEMANDA BOOLEAN := FALSE;
   CSBVERSION CONSTANT VARCHAR2( 250 ) := 'SAO189803';
   CACHE CONSTANT NUMBER := 1;
   CNUCODIINVA CONSTANT NUMBER := 10002;
   CNUIDELEMNULL CONSTANT NUMBER := 10032;
   CNUCODEELEMNULL CONSTANT NUMBER := 10033;
   CNURECORD_NO_EXISTE CONSTANT NUMBER := 10020;
   CNURECORD_YA_EXISTE CONSTANT NUMBER := 10021;
   CNUNOEXISTE_ELMESESU CONSTANT NUMBER := 10026;
   CSBDIVISION CONSTANT VARCHAR2( 20 ) := PKCONSTANTE.CSBDIVISION;
   CSBMODULE CONSTANT VARCHAR2( 20 ) := PKCONSTANTE.CSBMOD_EME;
   PROCEDURE LOAD( ISBELMECODI IN ELEMMEDI.ELMECODI%TYPE );
   PROCEDURE LOADRECORD( ISBELMECODI IN ELEMMEDI.ELMECODI%TYPE );
   PROCEDURE GETPRODUCTS( ITBPRODUCTS IN PKTBLSERVSUSC.TYSESUNUSE, ONUPRODENER OUT SERVSUSC.SESUNUSE%TYPE, ONUPRODACUE OUT SERVSUSC.SESUNUSE%TYPE );
   FUNCTION FBLINMEMORY( ISBELMECODI IN ELEMMEDI.ELMECODI%TYPE )
    RETURN BOOLEAN;
   FUNCTION FSBGETELEMENTYPEDESC( INUPRODENER IN SERVSUSC.SESUNUSE%TYPE, INUPRODACUE IN SERVSUSC.SESUNUSE%TYPE )
    RETURN VARCHAR2;
   PROCEDURE GETPARAMETERS
    IS
    BEGIN
      PKERRORS.PUSH( 'pkMeasurementElemenMgr.GetParameters' );
      IF ( BLISLOADED ) THEN
         PKERRORS.POP;
         RETURN;
      END IF;
      GPARDEMANDA := PKGENERALPARAMETERSMGR.FSBGETSTRINGPARAMETER( 'TIPO_CONS_ELEM_DEMANDA' );
      BLISLOADED := TRUE;
      GNUENERGIA := PKGENERALPARAMETERSMGR.FNUGETNUMBERVALUE( 'SERVICIO_ENERGIA' );
      GNUACUEDUCTO := PKGENERALPARAMETERSMGR.FNUGETNUMBERVALUE( 'TMP_SRV_ACUEDUCTO' );
      PKERRORS.POP;
    EXCEPTION
      WHEN LOGIN_DENIED THEN
         BLISLOADED := FALSE;
         PKERRORS.POP;
         RAISE LOGIN_DENIED;
      WHEN PKCONSTANTE.EXERROR_LEVEL2 THEN
         BLISLOADED := FALSE;
         PKERRORS.POP;
         RAISE PKCONSTANTE.EXERROR_LEVEL2;
      WHEN OTHERS THEN
         BLISLOADED := FALSE;
         PKERRORS.NOTIFYERROR( PKERRORS.FSBLASTOBJECT, SQLERRM, SBERRMSG );
         PKERRORS.POP;
         RAISE_APPLICATION_ERROR( PKCONSTANTE.NUERROR_LEVEL2, SBERRMSG );
   END GETPARAMETERS;
   PROCEDURE GETPARAMETERSDEMANDA
    IS
    BEGIN
      PKERRORS.PUSH( 'pkMeasurementElemenMgr.GetParametersDemanda' );
      IF ( GBOISLOADEDDEMANDA ) THEN
         PKERRORS.POP;
         RETURN;
      END IF;
      GPARDEMANDA := PKGENERALPARAMETERSMGR.FSBGETSTRINGPARAMETER( 'TIPO_CONS_ELEM_DEMANDA' );
      UT_STRING.EXTSTRING( GPARDEMANDA, '|', TBGPARDEMANDA );
      GBOISLOADEDDEMANDA := TRUE;
      PKERRORS.POP;
    EXCEPTION
      WHEN LOGIN_DENIED THEN
         BLISLOADED := FALSE;
         PKERRORS.POP;
         RAISE LOGIN_DENIED;
      WHEN PKCONSTANTE.EXERROR_LEVEL2 THEN
         BLISLOADED := FALSE;
         PKERRORS.POP;
         RAISE PKCONSTANTE.EXERROR_LEVEL2;
      WHEN OTHERS THEN
         BLISLOADED := FALSE;
         PKERRORS.NOTIFYERROR( PKERRORS.FSBLASTOBJECT, SQLERRM, SBERRMSG );
         PKERRORS.POP;
         RAISE_APPLICATION_ERROR( PKCONSTANTE.NUERROR_LEVEL2, SBERRMSG );
   END GETPARAMETERSDEMANDA;
   PROCEDURE LOAD( ISBELMECODI IN ELEMMEDI.ELMECODI%TYPE )
    IS
    BEGIN
      PKERRORS.PUSH( 'pkMeasurementElemenMgr.Load' );
      LOADRECORD( ISBELMECODI );
      IF ( RCELEMMEDI.ELMECODI IS NULL ) THEN
         PKERRORS.POP;
         RAISE NO_DATA_FOUND;
      END IF;
      PKERRORS.POP;
    EXCEPTION
      WHEN NO_DATA_FOUND THEN
         PKERRORS.SETERRORCODE( CSBDIVISION, CSBMODULE, CNURECORD_NO_EXISTE );
         RAISE LOGIN_DENIED;
   END LOAD;
   PROCEDURE LOADRECORD( ISBELMECODI IN ELEMMEDI.ELMECODI%TYPE )
    IS
    BEGIN
      PKERRORS.PUSH( 'pkMeasurementElemenMgr.LoadRecord' );
      IF ( CUELEMMEDI%ISOPEN ) THEN
         CLOSE CUELEMMEDI;
      END IF;
      OPEN CUELEMMEDI( ISBELMECODI );
      FETCH CUELEMMEDI
         INTO RCELEMMEDI;
      IF ( CUELEMMEDI%NOTFOUND ) THEN
         CLOSE CUELEMMEDI;
         PKERRORS.POP;
         RCELEMMEDI := RCRECORDNULL;
         RETURN;
      END IF;
      CLOSE CUELEMMEDI;
      PKERRORS.POP;
   END LOADRECORD;
   FUNCTION FBLINMEMORY( ISBELMECODI IN ELEMMEDI.ELMECODI%TYPE )
    RETURN BOOLEAN
    IS
    BEGIN
      PKERRORS.PUSH( 'pkMeasurementElemenMgr.fblInMemory' );
      IF ( RCELEMMEDI.ELMECODI = ISBELMECODI ) THEN
         PKERRORS.POP;
         RETURN ( TRUE );
      END IF;
      PKERRORS.POP;
      RETURN ( FALSE );
   END FBLINMEMORY;
   PROCEDURE FILLDATAMEASUREELEMENT( NUELEMMEDI IN ELEMMEDI.ELMEIDEM%TYPE, SBCODIELEM IN ELEMMEDI.ELMECODI%TYPE, INUCLASELEM IN ELEMMEDI.ELMECLEM%TYPE, INUNUMEDIGI IN ELEMMEDI.ELMENUDC%TYPE, INULUGAINST IN ELEMMEDI.ELMEUIEM%TYPE, RCELEMMEDI OUT ELEMMEDI%ROWTYPE )
    IS
    BEGIN
      PKERRORS.PUSH( 'pkMeasurementElemenMgr.FillDataMeasureElement' );
      RCELEMMEDI.ELMEIDEM := NUELEMMEDI;
      RCELEMMEDI.ELMECODI := SBCODIELEM;
      RCELEMMEDI.ELMECLEM := INUCLASELEM;
      RCELEMMEDI.ELMENUDC := NVL( INUNUMEDIGI, 0 );
      RCELEMMEDI.ELMEUIEM := INULUGAINST;
      PKERRORS.POP;
    EXCEPTION
      WHEN LOGIN_DENIED THEN
         PKERRORS.POP;
         RAISE LOGIN_DENIED;
      WHEN PKCONSTANTE.EXERROR_LEVEL2 THEN
         PKERRORS.POP;
         RAISE PKCONSTANTE.EXERROR_LEVEL2;
      WHEN OTHERS THEN
         PKERRORS.NOTIFYERROR( PKERRORS.FSBLASTOBJECT, SQLERRM, SBERRMSG );
         PKERRORS.POP;
         RAISE_APPLICATION_ERROR( PKCONSTANTE.NUERROR_LEVEL2, SBERRMSG );
   END FILLDATAMEASUREELEMENT;
   PROCEDURE FILLDATAMEASUREELEMENT( INUIDELEM IN ELEMMEDI.ELMEIDEM%TYPE, ISBCODIELEM IN ELEMMEDI.ELMECODI%TYPE, INUCLASELEM IN ELEMMEDI.ELMECLEM%TYPE, INUNUMEDIGI IN ELEMMEDI.ELMENUDC%TYPE, INUUBICINST IN ELEMMEDI.ELMEUIEM%TYPE, INUPOSICION IN ELEMMEDI.ELMEPOSI%TYPE, INUFACTCONV IN ELEMMEDI.ELMEFACM%TYPE, INUFACTDEMA IN ELEMMEDI.ELMEFACD%TYPE, INUTOPE IN ELEMMEDI.ELMETOPE%TYPE, ORCELEMMEDI OUT ELEMMEDI%ROWTYPE )
    IS
    BEGIN
      PKERRORS.PUSH( 'pkMeasurementElemenMgr.FillDataMeasureElement' );
      ORCELEMMEDI.ELMEIDEM := INUIDELEM;
      ORCELEMMEDI.ELMECODI := ISBCODIELEM;
      ORCELEMMEDI.ELMECLEM := INUCLASELEM;
      ORCELEMMEDI.ELMENUDC := INUNUMEDIGI;
      ORCELEMMEDI.ELMEUIEM := INUUBICINST;
      ORCELEMMEDI.ELMEPOSI := INUPOSICION;
      ORCELEMMEDI.ELMEFACM := INUFACTCONV;
      ORCELEMMEDI.ELMEFACD := INUFACTDEMA;
      ORCELEMMEDI.ELMETOPE := INUTOPE;
      PKERRORS.POP;
    EXCEPTION
      WHEN LOGIN_DENIED THEN
         PKERRORS.POP;
         RAISE LOGIN_DENIED;
      WHEN PKCONSTANTE.EXERROR_LEVEL2 THEN
         PKERRORS.POP;
         RAISE PKCONSTANTE.EXERROR_LEVEL2;
      WHEN OTHERS THEN
         PKERRORS.NOTIFYERROR( PKERRORS.FSBLASTOBJECT, SQLERRM, SBERRMSG );
         PKERRORS.POP;
         RAISE_APPLICATION_ERROR( PKCONSTANTE.NUERROR_LEVEL2, SBERRMSG );
   END FILLDATAMEASUREELEMENT;
   PROCEDURE FINDMEASUREELEMENT( ISBELMECODI IN ELEMMEDI.ELMECODI%TYPE, INUCACHE IN NUMBER := 1 )
    IS
    BEGIN
      PKERRORS.PUSH( 'pkMeasurementElemenMgr.FindMeasureElement' );
      IF ( INUCACHE = CACHE ) THEN
         IF ( FBLINMEMORY( ISBELMECODI ) ) THEN
            PKERRORS.POP;
            RETURN;
         END IF;
      END IF;
      LOAD( ISBELMECODI );
      PKERRORS.POP;
    EXCEPTION
      WHEN LOGIN_DENIED THEN
         PKERRORS.POP;
         RAISE LOGIN_DENIED;
   END FINDMEASUREELEMENT;
   PROCEDURE GENMEASUREMENTELEMEN( NUELEMMEDI IN ELEMMEDI.ELMEIDEM%TYPE, SBCODIELEM IN ELEMMEDI.ELMECODI%TYPE, INUCLASELEM IN ELEMMEDI.ELMECLEM%TYPE, INUNUMEDIGI IN ELEMMEDI.ELMENUDC%TYPE, INULUGAINST IN ELEMMEDI.ELMEUIEM%TYPE )
    IS
      RCELEMMEDI ELEMMEDI%ROWTYPE;
      PROCEDURE INITIALIZE
       IS
       BEGIN
         PKERRORS.PUSH( 'pkMeasurementElemenMgr.Initialize' );
         PKERRORS.INITIALIZE;
         PKERRORS.POP;
      END INITIALIZE;
    BEGIN
      PKERRORS.PUSH( 'pkMeasurementElemenMgr.GenMeasurementElemen' );
      INITIALIZE;
      FILLDATAMEASUREELEMENT( NUELEMMEDI, SBCODIELEM, INUCLASELEM, INUNUMEDIGI, INULUGAINST, RCELEMMEDI );
      PKTBLELEMMEDI.INSRECORD( RCELEMMEDI );
      PKERRORS.POP;
    EXCEPTION
      WHEN LOGIN_DENIED THEN
         PKERRORS.POP;
         RAISE LOGIN_DENIED;
      WHEN PKCONSTANTE.EXERROR_LEVEL2 THEN
         PKERRORS.POP;
         RAISE PKCONSTANTE.EXERROR_LEVEL2;
      WHEN OTHERS THEN
         PKERRORS.NOTIFYERROR( PKERRORS.FSBLASTOBJECT, SQLERRM, SBERRMSG );
         PKERRORS.POP;
         RAISE_APPLICATION_ERROR( PKCONSTANTE.NUERROR_LEVEL2, SBERRMSG );
   END GENMEASUREMENTELEMEN;
   PROCEDURE GENMEASUREMENTELEMEN( INUIDELEM IN ELEMMEDI.ELMEIDEM%TYPE, ISBCODIELEM IN ELEMMEDI.ELMECODI%TYPE, INUCLASELEM IN ELEMMEDI.ELMECLEM%TYPE, INUNUMEDIGI IN ELEMMEDI.ELMENUDC%TYPE, INUUBICINST IN ELEMMEDI.ELMEUIEM%TYPE, INUPOSICION IN ELEMMEDI.ELMEPOSI%TYPE, INUFACTCONV IN ELEMMEDI.ELMEFACM%TYPE, INUFACTDEMA IN ELEMMEDI.ELMEFACD%TYPE, INUTOPE IN ELEMMEDI.ELMETOPE%TYPE )
    IS
      RCELEMMEDI ELEMMEDI%ROWTYPE;
    BEGIN
      PKERRORS.PUSH( 'pkMeasurementElemenMgr.GenMeasurementElemen' );
      FILLDATAMEASUREELEMENT( INUIDELEM, ISBCODIELEM, INUCLASELEM, INUNUMEDIGI, INUUBICINST, INUPOSICION, INUFACTCONV, INUFACTDEMA, INUTOPE, RCELEMMEDI );
      PKTBLELEMMEDI.INSRECORD( RCELEMMEDI );
      PKERRORS.POP;
    EXCEPTION
      WHEN LOGIN_DENIED THEN
         PKERRORS.POP;
         RAISE LOGIN_DENIED;
      WHEN PKCONSTANTE.EXERROR_LEVEL2 THEN
         PKERRORS.POP;
         RAISE PKCONSTANTE.EXERROR_LEVEL2;
      WHEN OTHERS THEN
         PKERRORS.NOTIFYERROR( PKERRORS.FSBLASTOBJECT, SQLERRM, SBERRMSG );
         PKERRORS.POP;
         RAISE_APPLICATION_ERROR( PKCONSTANTE.NUERROR_LEVEL2, SBERRMSG );
   END GENMEASUREMENTELEMEN;
   PROCEDURE GETNEWMEASUREELEMENTID( ONUELMEIDEM OUT ELEMMEDI.ELMEIDEM%TYPE )
    IS
      CURSOR CUSEQUENCE IS
SELECT SqElemmedi.NEXTVAL codigo
	FROM   dual;
      CNUSEQUENCE_ERROR CONSTANT NUMBER := 10000;
      CNUSEQUENCE_INVALIDA CONSTANT NUMBER := 10284;
      CSBTOKEN CONSTANT VARCHAR2( 2 ) := '%';
      CSBCOMPLEMENTO_ERROR CONSTANT VARCHAR2( 40 ) := 'SQELEMMEDI';
    BEGIN
      PKERRORS.PUSH( 'pkMeasurementElemenMgr.GetNewMeasureElementId' );
      OPEN CUSEQUENCE;
      FETCH CUSEQUENCE
         INTO ONUELMEIDEM;
      IF ( CUSEQUENCE%NOTFOUND ) THEN
         CLOSE CUSEQUENCE;
         PKERRORS.SETERRORCODE( PKCONSTANTE.CSBDIVISION, PKCONSTANTE.CSBMOD_EME, CNUSEQUENCE_ERROR );
         RAISE LOGIN_DENIED;
      END IF;
      CLOSE CUSEQUENCE;
      IF ( PKTBLELEMMEDI.FBLEXIST( ONUELMEIDEM ) ) THEN
         PKERRORS.SETERRORCODE( PKCONSTANTE.CSBDIVISION, PKCONSTANTE.CSBMOD_CUS, CNUSEQUENCE_INVALIDA );
         PKERRORS.CHANGEMESSAGE( CSBTOKEN, CSBCOMPLEMENTO_ERROR );
         RAISE LOGIN_DENIED;
      END IF;
      PKERRORS.POP;
    EXCEPTION
      WHEN LOGIN_DENIED THEN
         PKERRORS.POP;
         RAISE LOGIN_DENIED;
      WHEN PKCONSTANTE.EXERROR_LEVEL2 THEN
         PKERRORS.POP;
         RAISE PKCONSTANTE.EXERROR_LEVEL2;
      WHEN OTHERS THEN
         PKERRORS.NOTIFYERROR( PKERRORS.FSBLASTOBJECT, SQLERRM, SBERRMSG );
         PKERRORS.POP;
         RAISE_APPLICATION_ERROR( PKCONSTANTE.NUERROR_LEVEL2, SBERRMSG );
         RAISE;
   END GETNEWMEASUREELEMENTID;
   PROCEDURE VALBASICDATA( ISBELMECODI IN ELEMMEDI.ELMECODI%TYPE )
    IS
      NUELEMIDEM ELEMMEDI.ELMEIDEM%TYPE;
    BEGIN
      PKERRORS.PUSH( 'pkMeasurementElemenMgr.ValBasicData' );
      VALIDATENULL( ISBELMECODI );
      NUELEMIDEM := FNUGETMEASUREELEMENTID( ISBELMECODI );
      PKTBLELEMMEDI.ACCKEY( NUELEMIDEM );
      PKERRORS.POP;
    EXCEPTION
      WHEN LOGIN_DENIED OR PKCONSTANTE.EXERROR_LEVEL2 THEN
         PKERRORS.POP;
         RAISE;
      WHEN OTHERS THEN
         PKERRORS.NOTIFYERROR( PKERRORS.FSBLASTOBJECT, SQLERRM, SBERRMSG );
         PKERRORS.POP;
         RAISE_APPLICATION_ERROR( PKCONSTANTE.NUERROR_LEVEL2, SBERRMSG );
   END VALBASICDATA;
   PROCEDURE VALBASICDATA( INUELMEIDEM IN ELEMMEDI.ELMEIDEM%TYPE )
    IS
    BEGIN
      PKERRORS.PUSH( 'pkMeasurementElemenMgr.ValBasicData' );
      VALIDATENULL( INUELMEIDEM );
      PKTBLELEMMEDI.ACCKEY( INUELMEIDEM );
      PKERRORS.POP;
    EXCEPTION
      WHEN LOGIN_DENIED OR PKCONSTANTE.EXERROR_LEVEL2 THEN
         PKERRORS.POP;
         RAISE;
      WHEN OTHERS THEN
         PKERRORS.NOTIFYERROR( PKERRORS.FSBLASTOBJECT, SQLERRM, SBERRMSG );
         PKERRORS.POP;
         RAISE_APPLICATION_ERROR( PKCONSTANTE.NUERROR_LEVEL2, SBERRMSG );
   END VALBASICDATA;
   PROCEDURE VALDUPMEASUREELEMENT( ISBELMECODI IN ELEMMEDI.ELMECODI%TYPE, INUCACHE IN NUMBER := 1 )
    IS
    BEGIN
      PKERRORS.PUSH( 'pkMeasurementElemenMgr.ValDupMeasureElement' );
      IF ( FBLEXISTMEASUREELEMENT( ISBELMECODI, INUCACHE ) ) THEN
         PKERRORS.SETERRORCODE( CSBDIVISION, CSBMODULE, CNURECORD_YA_EXISTE );
         RAISE LOGIN_DENIED;
      END IF;
      PKERRORS.POP;
    EXCEPTION
      WHEN LOGIN_DENIED THEN
         PKERRORS.POP;
         RAISE LOGIN_DENIED;
   END VALDUPMEASUREELEMENT;
   PROCEDURE VALIDATENULL( ISBELMECODI IN ELEMMEDI.ELMECODI%TYPE )
    IS
    BEGIN
      PKERRORS.PUSH( 'pkMeasurementElemenMgr.ValidateNull' );
      IF ( ISBELMECODI IS NULL ) THEN
         RAISE LOGIN_DENIED;
      END IF;
      PKERRORS.POP;
    EXCEPTION
      WHEN LOGIN_DENIED THEN
         PKERRORS.SETERRORCODE( PKCONSTANTE.CSBDIVISION, CSBMODULE, CNUCODEELEMNULL );
         PKERRORS.POP;
         RAISE;
      WHEN PKCONSTANTE.EXERROR_LEVEL2 THEN
         PKERRORS.POP;
         RAISE;
      WHEN OTHERS THEN
         PKERRORS.NOTIFYERROR( PKERRORS.FSBLASTOBJECT, SQLERRM, SBERRMSG );
         PKERRORS.POP;
         RAISE_APPLICATION_ERROR( PKCONSTANTE.NUERROR_LEVEL2, SBERRMSG );
   END VALIDATENULL;
   PROCEDURE VALIDATENULL( INUELMEIDEM IN ELEMMEDI.ELMEIDEM%TYPE )
    IS
    BEGIN
      PKERRORS.PUSH( 'pkMeasurementElemenMgr.ValidateNull' );
      IF ( INUELMEIDEM IS NULL ) THEN
         PKERRORS.SETERRORCODE( PKCONSTANTE.CSBDIVISION, CSBMODULE, CNUIDELEMNULL );
         RAISE LOGIN_DENIED;
      END IF;
      PKERRORS.POP;
    EXCEPTION
      WHEN LOGIN_DENIED THEN
         PKERRORS.POP;
         RAISE;
      WHEN PKCONSTANTE.EXERROR_LEVEL2 THEN
         PKERRORS.POP;
         RAISE;
      WHEN OTHERS THEN
         PKERRORS.NOTIFYERROR( PKERRORS.FSBLASTOBJECT, SQLERRM, SBERRMSG );
         PKERRORS.POP;
         RAISE_APPLICATION_ERROR( PKCONSTANTE.NUERROR_LEVEL2, SBERRMSG );
   END VALIDATENULL;
   FUNCTION FBLEXISTMEASUREELEMENT( ISBELMECODI IN ELEMMEDI.ELMECODI%TYPE, INUCACHE IN NUMBER := 1 )
    RETURN BOOLEAN
    IS
    BEGIN
      PKERRORS.PUSH( 'pkMeasurementElemenMgr.fblExistMeasureElement' );
      IF ( INUCACHE = CACHE ) THEN
         IF ( FBLINMEMORY( ISBELMECODI ) ) THEN
            PKERRORS.POP;
            RETURN ( TRUE );
         END IF;
      END IF;
      LOADRECORD( ISBELMECODI );
      IF ( RCELEMMEDI.ELMECODI IS NULL ) THEN
         PKERRORS.POP;
         RETURN ( FALSE );
      END IF;
      PKERRORS.POP;
      RETURN ( TRUE );
   END FBLEXISTMEASUREELEMENT;
   FUNCTION FNUGETMEASUREELEMENTID( ISBELMECODI IN ELEMMEDI.ELMECODI%TYPE, INUCACHE IN NUMBER := 1 )
    RETURN ELEMMEDI.ELMEIDEM%TYPE
    IS
    BEGIN
      PKERRORS.PUSH( 'pkMeasurementElemenMgr.fnuGetMeasureElementId' );
      FINDMEASUREELEMENT( ISBELMECODI, INUCACHE );
      PKERRORS.POP;
      RETURN ( RCELEMMEDI.ELMEIDEM );
    EXCEPTION
      WHEN LOGIN_DENIED THEN
         PKERRORS.POP;
         RAISE LOGIN_DENIED;
   END FNUGETMEASUREELEMENTID;
   FUNCTION FNUGETMEASUREFACTOR( INUELMEIDME IN ELEMMEDI.ELMEIDEM%TYPE, INUTCONCODI IN TIPOCONS.TCONCODI%TYPE )
    RETURN NUMBER
    IS
      TBAUX UT_STRING.TYTB_STRING;
      NURETORNO NUMBER;
      NUCONT NUMBER;
    BEGIN
      PKERRORS.PUSH( 'pkMeasurementElemenMgr.fnuGetMeasureFactor' );
      GETPARAMETERSDEMANDA;
      UT_STRING.EXTSTRING( GPARDEMANDA, '|', TBAUX );
      RCELEMMEDI := PKTBLELEMMEDI.FRCGETRECORD( INUELMEIDME );
      NURETORNO := RCELEMMEDI.ELMEFACM;
      NUCONT := TBAUX.FIRST;
      WHILE ( NUCONT IS NOT NULL )
       LOOP
         IF ( TO_NUMBER( TBAUX( NUCONT ) ) = INUTCONCODI ) THEN
            NURETORNO := RCELEMMEDI.ELMEFACD;
         END IF;
         NUCONT := TBAUX.NEXT( NUCONT );
      END LOOP;
      PKERRORS.POP;
      RETURN ( NURETORNO );
    EXCEPTION
      WHEN LOGIN_DENIED THEN
         PKERRORS.POP;
         RAISE LOGIN_DENIED;
   END FNUGETMEASUREFACTOR;
   FUNCTION FRCGETRECORDELMESESUACTIV( INUSERVSUSC IN ELMESESU.EMSSSESU%TYPE, INUIDELEMMEDI IN ELEMMEDI.ELMEIDEM%TYPE )
    RETURN ELMESESU%ROWTYPE
    IS
      RGELMESESU ELMESESU%ROWTYPE;
      CURSOR CUELMESESUACTIVO IS
SELECT 	elmesesu.*
    	FROM 	compsesu, elmesesu, servsusc
    	WHERE	emsselme = inuIDElemmedi
    	AND     emssfein <= sysdate     -- Asociacion activa
    	AND     emssfere > sysdate
    	AND	    emsscmss = cmssidco	    -- Join con Componente Servicio Susct.
    	AND     EMSSSESU = inuServsusc
    	AND	    sesunuse = cmsssesu
    	AND     sesunuse = EMSSSESU
    	AND	rownum	= 1;
    BEGIN
      PKERRORS.PUSH( 'pkMeasurementElemenMgr.frcGetRecordElmesesuActiv' );
      RGELMESESU.EMSSELME := NULL;
      IF ( CUELMESESUACTIVO%ISOPEN ) THEN
         CLOSE CUELMESESUACTIVO;
      END IF;
      OPEN CUELMESESUACTIVO;
      FETCH CUELMESESUACTIVO
         INTO RGELMESESU;
      CLOSE CUELMESESUACTIVO;
      IF ( RGELMESESU.EMSSELME IS NULL ) THEN
         PKERRORS.SETERRORCODE( PKCONSTANTE.CSBDIVISION, PKCONSTANTE.CSBMOD_EME, CNUNOEXISTE_ELMESESU );
         RAISE LOGIN_DENIED;
      END IF;
      PKERRORS.POP;
      RETURN RGELMESESU;
    EXCEPTION
      WHEN LOGIN_DENIED OR PKCONSTANTE.EXERROR_LEVEL2 THEN
         PKERRORS.POP;
         RAISE LOGIN_DENIED;
      WHEN OTHERS THEN
         PKERRORS.NOTIFYERROR( PKERRORS.FSBLASTOBJECT, SQLERRM, SBERRMSG );
         PKERRORS.POP;
         RAISE_APPLICATION_ERROR( PKCONSTANTE.NUERROR_LEVEL2, SBERRMSG );
   END FRCGETRECORDELMESESUACTIV;
   FUNCTION FNUGETTYPEOFCONSOFMEASELEM( INUELMEIDEM IN ELEMMEDI.ELMEIDEM%TYPE )
    RETURN TICOCLSE.TCCLTCON%TYPE
    IS
      NUTETCTCON TICOCLSE.TCCLTCON%TYPE;
      CURSOR CUTYPECONS IS
SELECT TCCLTCON
         FROM elmesesu, pr_component, ticoclse
        WHERE EMSSELME = inuelmeidem
          AND EMSSCMSS = component_id
          AND class_service_id = TCCLCLSE;
    BEGIN
      PKERRORS.PUSH( 'pkMeasurementElemenMgr.fnuGetTypeOfConsOfMeasElem' );
      IF ( CUTYPECONS%ISOPEN ) THEN
         CLOSE CUTYPECONS;
      END IF;
      OPEN CUTYPECONS;
      FETCH CUTYPECONS
         INTO NUTETCTCON;
      CLOSE CUTYPECONS;
      IF ( NUTETCTCON IS NULL ) THEN
         PKERRORS.SETERRORCODE( PKCONSTANTE.CSBDIVISION, PKCONSTANTE.CSBMOD_EME, CNUNOEXISTE_ELMESESU );
         RAISE LOGIN_DENIED;
      END IF;
      PKERRORS.POP;
      RETURN NUTETCTCON;
    EXCEPTION
      WHEN LOGIN_DENIED OR PKCONSTANTE.EXERROR_LEVEL2 THEN
         PKERRORS.POP;
         RAISE LOGIN_DENIED;
      WHEN OTHERS THEN
         PKERRORS.NOTIFYERROR( PKERRORS.FSBLASTOBJECT, SQLERRM, SBERRMSG );
         PKERRORS.POP;
         RAISE_APPLICATION_ERROR( PKCONSTANTE.NUERROR_LEVEL2, SBERRMSG );
   END FNUGETTYPEOFCONSOFMEASELEM;
   PROCEDURE GETPRODUCTS( ITBPRODUCTS IN PKTBLSERVSUSC.TYSESUNUSE, ONUPRODENER OUT SERVSUSC.SESUNUSE%TYPE, ONUPRODACUE OUT SERVSUSC.SESUNUSE%TYPE )
    IS
      NUPRODUCT SERVSUSC.SESUNUSE%TYPE;
      NUTIPOPROD SERVSUSC.SESUSERV%TYPE;
      NUIDX NUMBER;
    BEGIN
      PKERRORS.PUSH( 'pkMeasurementElemenMgr.GetProducts' );
      NUIDX := ITBPRODUCTS.FIRST;
      LOOP
         EXIT WHEN NUIDX IS NULL;
         NUPRODUCT := ITBPRODUCTS( NUIDX );
         IF ( NOT PKSERVNUMBERMGR.FBLISWITHDRAWAL( NUPRODUCT ) ) THEN
            NUTIPOPROD := PKTBLSERVSUSC.FNUGETSERVICE( NUPRODUCT );
            IF ( ONUPRODENER IS NULL ) AND ( NUTIPOPROD = GNUENERGIA ) THEN
               ONUPRODENER := NUPRODUCT;
            END IF;
            IF ( ONUPRODACUE IS NULL ) AND ( NUTIPOPROD = GNUACUEDUCTO ) THEN
               ONUPRODACUE := NUPRODUCT;
            END IF;
            IF ( ONUPRODACUE IS NOT NULL ) AND ( ONUPRODENER IS NOT NULL ) THEN
               RETURN;
            END IF;
         END IF;
         NUIDX := ITBPRODUCTS.NEXT( NUIDX );
      END LOOP;
      PKERRORS.POP;
    EXCEPTION
      WHEN LOGIN_DENIED THEN
         PKERRORS.POP;
         RAISE LOGIN_DENIED;
      WHEN PKCONSTANTE.EXERROR_LEVEL2 THEN
         PKERRORS.POP;
         RAISE PKCONSTANTE.EXERROR_LEVEL2;
      WHEN OTHERS THEN
         PKERRORS.NOTIFYERROR( PKERRORS.FSBLASTOBJECT, SQLERRM, SBERRMSG );
         PKERRORS.POP;
         RAISE_APPLICATION_ERROR( PKCONSTANTE.NUERROR_LEVEL2, SBERRMSG );
   END GETPRODUCTS;
   FUNCTION FSBGETELEMENTYPEDESC( INUPRODENER IN SERVSUSC.SESUNUSE%TYPE, INUPRODACUE IN SERVSUSC.SESUNUSE%TYPE )
    RETURN VARCHAR2
    IS
      CSBMEDIDOR CONSTANT VARCHAR2( 10 ) := 'MEDIDOR';
      CSBGENERAL CONSTANT VARCHAR2( 10 ) := ' GENERAL';
      CSBPARCIAL CONSTANT VARCHAR2( 10 ) := ' PARCIAL';
      CSBENERGIA CONSTANT VARCHAR2( 10 ) := ' ENERGIA';
      CSBACUEDUCTO CONSTANT VARCHAR2( 10 ) := ' ACUEDUCTO';
      NUELEMMEDI ELEMMEDI.ELMEIDEM%TYPE;
      NUELMECLEM ELEMMEDI.ELMECLEM%TYPE;
      NUELMEEMAC ELEMMEDI.ELMEEMAC%TYPE;
      BLGENERAL BOOLEAN := FALSE;
      BLPARCIAL BOOLEAN := FALSE;
      SBDESTIPOELEM VARCHAR2( 200 ) := NULL;
      TBELEMBYPROD PKMEASELEMSUBSSERVMGR.TYTBELEMMEDIBYSUBSSERV;
      NUIDX NUMBER;
    BEGIN
      PKERRORS.PUSH( 'pkMeasurementElemenMgr.fsbGetElemenTypeDesc' );
      IF ( INUPRODENER IS NOT NULL ) THEN
         TBELEMBYPROD := PKMEASELEMSUBSSERVMGR.FTBELEMMEDIBYSUBSSERV( INUPRODENER );
         NUIDX := TBELEMBYPROD.FIRST;
         IF ( NUIDX IS NOT NULL ) THEN
            NUELEMMEDI := TBELEMBYPROD( NUIDX ).EMSSELME;
            NUELMECLEM := PKTBLELEMMEDI.FNUGETMEASCLASS( NUELEMMEDI );
            NUELMEEMAC := PKTBLELEMMEDI.FNUGETMEASGENERAL( NUELEMMEDI );
            IF ( PKTBLCLASELME.FBLISGENERAL( NUELMECLEM ) ) THEN
               SBDESTIPOELEM := CSBMEDIDOR || CSBGENERAL || CSBENERGIA;
               BLGENERAL := TRUE;
             ELSIF ( NUELMEEMAC IS NOT NULL ) THEN
               SBDESTIPOELEM := CSBMEDIDOR || CSBPARCIAL || CSBENERGIA;
               BLPARCIAL := TRUE;
            END IF;
            NUELEMMEDI := NULL;
            NUELMECLEM := NULL;
            NUELMEEMAC := NULL;
         END IF;
         NUIDX := NULL;
         TBELEMBYPROD.DELETE;
      END IF;
      IF ( INUPRODACUE IS NOT NULL ) THEN
         TBELEMBYPROD := PKMEASELEMSUBSSERVMGR.FTBELEMMEDIBYSUBSSERV( INUPRODACUE );
         NUIDX := TBELEMBYPROD.FIRST;
         IF ( NUIDX IS NOT NULL ) THEN
            NUELEMMEDI := TBELEMBYPROD( NUIDX ).EMSSELME;
            NUELMECLEM := PKTBLELEMMEDI.FNUGETMEASCLASS( NUELEMMEDI );
            NUELMEEMAC := PKTBLELEMMEDI.FNUGETMEASGENERAL( NUELEMMEDI );
            IF ( PKTBLCLASELME.FBLISGENERAL( NUELMECLEM ) ) THEN
               IF BLGENERAL THEN
                  SBDESTIPOELEM := SBDESTIPOELEM || ' Y' || CSBACUEDUCTO;
                ELSIF BLPARCIAL THEN
                  SBDESTIPOELEM := SBDESTIPOELEM || ' Y' || CSBGENERAL || CSBACUEDUCTO;
                ELSE
                  SBDESTIPOELEM := CSBMEDIDOR || CSBGENERAL || CSBACUEDUCTO;
               END IF;
             ELSIF ( NUELMEEMAC IS NOT NULL ) THEN
               IF BLGENERAL THEN
                  SBDESTIPOELEM := SBDESTIPOELEM || ' Y' || CSBPARCIAL || CSBACUEDUCTO;
                ELSIF BLPARCIAL THEN
                  SBDESTIPOELEM := SBDESTIPOELEM || ' Y' || CSBACUEDUCTO;
                ELSE
                  SBDESTIPOELEM := CSBMEDIDOR || CSBPARCIAL || CSBACUEDUCTO;
               END IF;
            END IF;
         END IF;
         TBELEMBYPROD.DELETE;
      END IF;
      PKERRORS.POP;
      RETURN ( SBDESTIPOELEM );
    EXCEPTION
      WHEN LOGIN_DENIED THEN
         PKERRORS.POP;
         RAISE LOGIN_DENIED;
      WHEN PKCONSTANTE.EXERROR_LEVEL2 THEN
         PKERRORS.POP;
         RAISE PKCONSTANTE.EXERROR_LEVEL2;
      WHEN OTHERS THEN
         PKERRORS.NOTIFYERROR( PKERRORS.FSBLASTOBJECT, SQLERRM, SBERRMSG );
         PKERRORS.POP;
         RAISE_APPLICATION_ERROR( PKCONSTANTE.NUERROR_LEVEL2, SBERRMSG );
   END FSBGETELEMENTYPEDESC;
   FUNCTION FSBGETTYPEMEASELEMBYCON( INUCONTRATO IN SUSCRIPC.SUSCCODI%TYPE )
    RETURN VARCHAR2
    IS
      SBDESCTIPOELME VARCHAR2( 200 );
      TNUPRODUCTOS PKTBLSERVSUSC.TYSESUNUSE;
      NUPRODENER SERVSUSC.SESUNUSE%TYPE := NULL;
      NUPRODACUE SERVSUSC.SESUNUSE%TYPE := NULL;
    BEGIN
      PKERRORS.PUSH( 'pkMeasurementElemenMgr.fsbGetTypeMeasElemByCon' );
      GETPARAMETERS;
      PKSERVNUMBERMGR.GETSUBSSERVICES( INUCONTRATO, TNUPRODUCTOS );
      GETPRODUCTS( TNUPRODUCTOS, NUPRODENER, NUPRODACUE );
      SBDESCTIPOELME := FSBGETELEMENTYPEDESC( NUPRODENER, NUPRODACUE );
      PKERRORS.POP;
      RETURN ( SBDESCTIPOELME );
    EXCEPTION
      WHEN LOGIN_DENIED THEN
         PKERRORS.POP;
         RAISE LOGIN_DENIED;
      WHEN PKCONSTANTE.EXERROR_LEVEL2 THEN
         PKERRORS.POP;
         RAISE PKCONSTANTE.EXERROR_LEVEL2;
      WHEN OTHERS THEN
         PKERRORS.NOTIFYERROR( PKERRORS.FSBLASTOBJECT, SQLERRM, SBERRMSG );
         PKERRORS.POP;
         RAISE_APPLICATION_ERROR( PKCONSTANTE.NUERROR_LEVEL2, SBERRMSG );
   END FSBGETTYPEMEASELEMBYCON;
   FUNCTION FSBGETTYPEMEASELEMBYPROD( INUPRODUCTO IN SERVSUSC.SESUNUSE%TYPE )
    RETURN VARCHAR2
    IS
      SBDESCTIPOELME VARCHAR2( 200 );
      NUTIPOPROD SERVSUSC.SESUNUSE%TYPE;
    BEGIN
      PKERRORS.PUSH( 'pkMeasurementElemenMgr.fsbGetTypeMeasElemByProd' );
      GETPARAMETERS;
      NUTIPOPROD := PKTBLSERVSUSC.FNUGETSERVICE( INUPRODUCTO );
      IF ( NUTIPOPROD = GNUENERGIA ) THEN
         SBDESCTIPOELME := FSBGETELEMENTYPEDESC( INUPRODUCTO, NULL );
       ELSIF ( NUTIPOPROD = GNUACUEDUCTO ) THEN
         SBDESCTIPOELME := FSBGETELEMENTYPEDESC( NULL, INUPRODUCTO );
      END IF;
      PKERRORS.POP;
      RETURN ( SBDESCTIPOELME );
    EXCEPTION
      WHEN LOGIN_DENIED THEN
         PKERRORS.POP;
         RAISE LOGIN_DENIED;
      WHEN PKCONSTANTE.EXERROR_LEVEL2 THEN
         PKERRORS.POP;
         RAISE PKCONSTANTE.EXERROR_LEVEL2;
      WHEN OTHERS THEN
         PKERRORS.NOTIFYERROR( PKERRORS.FSBLASTOBJECT, SQLERRM, SBERRMSG );
         PKERRORS.POP;
         RAISE_APPLICATION_ERROR( PKCONSTANTE.NUERROR_LEVEL2, SBERRMSG );
   END FSBGETTYPEMEASELEMBYPROD;
   FUNCTION FSBVERSION
    RETURN VARCHAR2
    IS
    BEGIN
      PKERRORS.PUSH( 'pkMeasurementElemenMgr.fsbVersion' );
      PKERRORS.POP;
      RETURN ( CSBVERSION );
    EXCEPTION
      WHEN LOGIN_DENIED THEN
         PKERRORS.POP;
         RAISE LOGIN_DENIED;
      WHEN PKCONSTANTE.EXERROR_LEVEL2 THEN
         PKERRORS.POP;
         RAISE PKCONSTANTE.EXERROR_LEVEL2;
      WHEN OTHERS THEN
         PKERRORS.NOTIFYERROR( PKERRORS.FSBLASTOBJECT, SQLERRM, SBERRMSG );
         PKERRORS.POP;
         RAISE_APPLICATION_ERROR( PKCONSTANTE.NUERROR_LEVEL2, SBERRMSG );
   END FSBVERSION;
   PROCEDURE UPDATEMEASUREMENTFACTOR( INUELMEIDEM IN ELEMMEDI.ELMEIDEM%TYPE, INUELMEFACM IN ELEMMEDI.ELMEFACM%TYPE )
    IS
    BEGIN
      PKERRORS.PUSH( 'pkMeasurementElemenMgr.UpdateMeasurementFactor' );
      PKTBLELEMMEDI.UPDATEMEASUREFACTOR( INUELMEIDEM, INUELMEFACM );
      PKERRORS.POP;
    EXCEPTION
      WHEN LOGIN_DENIED OR PKCONSTANTE.EXERROR_LEVEL2 THEN
         PKERRORS.POP;
         RAISE;
      WHEN OTHERS THEN
         PKERRORS.NOTIFYERROR( PKERRORS.FSBLASTOBJECT, SQLERRM, SBERRMSG );
         PKERRORS.POP;
         RAISE_APPLICATION_ERROR( PKCONSTANTE.NUERROR_LEVEL2, SBERRMSG );
   END UPDATEMEASUREMENTFACTOR;
   PROCEDURE UPDATEELEMENTSITUATION( INUELMEIDEM IN ELEMMEDI.ELMEIDEM%TYPE, INUELMEUIEM IN ELEMMEDI.ELMEUIEM%TYPE )
    IS
    BEGIN
      PKERRORS.PUSH( 'pkMeasurementElemenMgr.UpdateElementSituation' );
      PKTBLELEMMEDI.UPDATEELEMENTSITUATE( INUELMEIDEM, INUELMEUIEM );
      PKERRORS.POP;
    EXCEPTION
      WHEN LOGIN_DENIED OR PKCONSTANTE.EXERROR_LEVEL2 THEN
         PKERRORS.POP;
         RAISE;
      WHEN OTHERS THEN
         PKERRORS.NOTIFYERROR( PKERRORS.FSBLASTOBJECT, SQLERRM, SBERRMSG );
         PKERRORS.POP;
         RAISE_APPLICATION_ERROR( PKCONSTANTE.NUERROR_LEVEL2, SBERRMSG );
   END UPDATEELEMENTSITUATION;
   PROCEDURE UPDATEDEPENDENTCOMMONAREA( INUELMEIDEM IN ELEMMEDI.ELMEIDEM%TYPE, INUELMEEMAC IN ELEMMEDI.ELMEEMAC%TYPE )
    IS
    BEGIN
      PKERRORS.PUSH( 'pkMeasurementElemenMgr.UpdateDependentCommonArea' );
      PKTBLELEMMEDI.UPDATEDEPENDENTCOMMONAREA( INUELMEIDEM, INUELMEEMAC );
      PKERRORS.POP;
    EXCEPTION
      WHEN LOGIN_DENIED OR PKCONSTANTE.EXERROR_LEVEL2 THEN
         PKERRORS.POP;
         RAISE;
      WHEN OTHERS THEN
         PKERRORS.NOTIFYERROR( PKERRORS.FSBLASTOBJECT, SQLERRM, SBERRMSG );
         PKERRORS.POP;
         RAISE_APPLICATION_ERROR( PKCONSTANTE.NUERROR_LEVEL2, SBERRMSG );
   END UPDATEDEPENDENTCOMMONAREA;
   FUNCTION FBLMEASELEMISTELEMEDIDO( INUELMEIDEM IN ELEMMEDI.ELMEIDEM%TYPE )
    RETURN BOOLEAN
    IS
      NUELMECLEM ELEMMEDI.ELMECLEM%TYPE;
    BEGIN
      PKERRORS.PUSH( 'pkMeasurementElemenMgr.fblMeasElemIsTelemedido' );
      GETPARAMETERS;
      IF ( PKBCELEMMEDI.FBLISTELEMETERED( INUELMEIDEM ) ) THEN
         PKERRORS.POP;
         PKGENERALSERVICES.TRACEDATA( 'Elemento Medición ' || INUELMEIDEM || ' TELEMEDIDO' );
         RETURN ( TRUE );
      END IF;
      PKGENERALSERVICES.TRACEDATA( 'Elemento Medición ' || INUELMEIDEM || ' NO TELEMEDIDO' );
      PKERRORS.POP;
      RETURN ( FALSE );
    EXCEPTION
      WHEN LOGIN_DENIED THEN
         PKERRORS.POP;
         RAISE LOGIN_DENIED;
      WHEN PKCONSTANTE.EXERROR_LEVEL2 THEN
         PKERRORS.POP;
         RAISE PKCONSTANTE.EXERROR_LEVEL2;
      WHEN OTHERS THEN
         PKERRORS.NOTIFYERROR( PKERRORS.FSBLASTOBJECT, SQLERRM, SBERRMSG );
         PKERRORS.POP;
         RAISE_APPLICATION_ERROR( PKCONSTANTE.NUERROR_LEVEL2, SBERRMSG );
   END FBLMEASELEMISTELEMEDIDO;
   PROCEDURE ACTMEDIDORAREACOMUN( INUELMEIDEMR IN ELEMMEDI.ELMEIDEM%TYPE, INUELMEIDEMI IN ELEMMEDI.ELMEIDEM%TYPE, INUELMEEMAC IN ELEMMEDI.ELMEEMAC%TYPE )
    IS
      RCELEMMEDI ELEMMEDI%ROWTYPE;
    BEGIN
      PKERRORS.PUSH( 'pkMeasurementElementRequest.ActMedidorAreaComun' );
      PKTBLELEMMEDI.UPDATEDEPENDENTCOMMONAREA( INUELMEIDEMR, NULL );
      PKTBLELEMMEDI.UPDATEDEPENDENTCOMMONAREA( INUELMEIDEMI, INUELMEEMAC );
      PKBCELEMMEDI.UPCOMMONAREAMEASELEM( INUELMEIDEMR, INUELMEIDEMI );
      PKERRORS.POP;
    EXCEPTION
      WHEN LOGIN_DENIED OR PKCONSTANTE.EXERROR_LEVEL2 THEN
         PKERRORS.POP;
         RAISE LOGIN_DENIED;
      WHEN OTHERS THEN
         PKERRORS.NOTIFYERROR( PKERRORS.FSBLASTOBJECT, SQLERRM, SBERRMSG );
         PKERRORS.POP;
         RAISE_APPLICATION_ERROR( PKCONSTANTE.NUERROR_LEVEL2, SBERRMSG );
   END ACTMEDIDORAREACOMUN;
   FUNCTION FBLHASDEMANDMEASUREFACTOR( INUELMEIDME IN ELEMMEDI.ELMEIDEM%TYPE, INUTCONCODI IN TIPOCONS.TCONCODI%TYPE )
    RETURN BOOLEAN
    IS
      NURETORNO BOOLEAN;
      NUCONT NUMBER;
    BEGIN
      PKERRORS.PUSH( 'pkMeasurementElemenMgr.fnuGetMeasureFactor' );
      GETPARAMETERSDEMANDA;
      NURETORNO := FALSE;
      NUCONT := TBGPARDEMANDA.FIRST;
      WHILE ( NUCONT IS NOT NULL )
       LOOP
         IF ( TO_NUMBER( TBGPARDEMANDA( NUCONT ) ) = INUTCONCODI ) THEN
            NURETORNO := TRUE;
            PKERRORS.POP;
            RETURN ( NURETORNO );
         END IF;
         NUCONT := TBGPARDEMANDA.NEXT( NUCONT );
      END LOOP;
      PKERRORS.POP;
      RETURN ( NURETORNO );
    EXCEPTION
      WHEN LOGIN_DENIED THEN
         PKERRORS.POP;
         RAISE LOGIN_DENIED;
   END FBLHASDEMANDMEASUREFACTOR;
END PKMEASUREMENTELEMENMGR;
/


