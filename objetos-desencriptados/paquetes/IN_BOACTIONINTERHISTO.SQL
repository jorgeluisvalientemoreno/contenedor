
CREATE OR REPLACE PACKAGE BODY IN_BOACTIONINTERHISTO IS
   CNUERROR_OPERA_MODE_QUEUE CONSTANT NUMBER := 5212;
   CNUERROR_EXECUTE_EXPRESION CONSTANT NUMBER := 5251;
   CNUNOT_NEXT_STATUS CONSTANT NUMBER := 4530;
   PROCEDURE INITIALIZEERRORMESSAGE( ONUERRORCODE OUT NUMBER, OSBERRORMESSAGE OUT VARCHAR2 )
    IS
    BEGIN
      ONUERRORCODE := CONSTANTS.CNUSUCCESS;
      OSBERRORMESSAGE := NULL;
   END;
   PROCEDURE EXECUTEEXPRESSION( INUCONFIGEXPRES IN IN_STATUS_TRANSITION.PRE_CONFIG_EXPRES_ID%TYPE, ONUERRORCODE OUT NUMBER, OSBERRORMESSAGE OUT VARCHAR2 )
    IS
    BEGIN
      UT_TRACE.TRACE( 'IN_BOActionInterHisto.ExecuteExpression Inicio Expresion:' || INUCONFIGEXPRES, 3 );
      INITIALIZEERRORMESSAGE( ONUERRORCODE, OSBERRORMESSAGE );
      IF ( INUCONFIGEXPRES IS NOT NULL ) THEN
         GR_BOCONFIG_EXPRESSION.EXECUTE( INUCONFIGEXPRES, ONUERRORCODE, OSBERRORMESSAGE );
      END IF;
      UT_TRACE.TRACE( 'IN_BOActionInterHisto.ExecuteExpression Retorna :' || 'Codigo :' || ONUERRORCODE || ' Descripcion :' || OSBERRORMESSAGE, 3 );
    EXCEPTION
      WHEN EX.CONTROLLED_ERROR THEN
         RAISE;
      WHEN OTHERS THEN
         ERRORS.SETERROR;
         RAISE EX.CONTROLLED_ERROR;
   END;
   PROCEDURE STATUSCONTROLERREGISTER( ITBTRANSITIONSTATUS IN IN_BOSTATUS_TRANSITION.TYTBTRANSITIONSTATUS, IRCINTERFACEMESSAGE IN STYIN_INTERFACE_MESSAGE, INUERRORCODETRANS IN NUMBER, ISBERRORMESSAGETRANS IN VARCHAR2, ITYOBMESSAGESTRUCT IN OUT IN_TYOBMESSAGESTRUCT, IONUINTERHISTOID IN OUT IN_INTERFACE_HISTORY.INTERFACE_HISTORY_ID%TYPE, ONUCURRENTSTATUS OUT IN_STATUS.STATUS_ID%TYPE )
    IS
      NUERRORCODE NUMBER;
      SBERRORMESSAGE VARCHAR2( 2000 );
      ININDEX INTEGER;
      BLEXECUTEEXPRESSION BOOLEAN;
      NUACTION IN_STATUS_TRANSITION.ACTION_ID%TYPE;
    BEGIN
      UT_TRACE.TRACE( 'IN_BOActionInterHisto.StatusControlerRegister Inicio :', 1 );
      BLEXECUTEEXPRESSION := FALSE;
      IN_BOINSTANCEGENERAL.GETACTION( NUACTION );
      ININDEX := ITBTRANSITIONSTATUS.FIRST;
      WHILE ININDEX <= ITBTRANSITIONSTATUS.LAST
       LOOP
         INITIALIZEERRORMESSAGE( NUERRORCODE, SBERRORMESSAGE );
         UT_TRACE.TRACE( 'IN_BOActionInterHisto.StatusControlerRegister 2.0 : expresion PRE:' || ITBTRANSITIONSTATUS( ININDEX ).NUPRECONFIGEXPRES, 3 );
         EXECUTEEXPRESSION( ITBTRANSITIONSTATUS( ININDEX ).NUPRECONFIGEXPRES, NUERRORCODE, SBERRORMESSAGE );
         UT_TRACE.TRACE( 'IN_BOActionInterHisto.StatusControlerRegister 2.0 retorno:' || NUERRORCODE || ' ' || SBERRORMESSAGE, 3 );
         IF ( NUERRORCODE = CONSTANTS.CNUSUCCESS ) THEN
            UT_TRACE.TRACE( 'IN_BOActionInterHisto.StatusControlerRegister 2.1 inserta el registro en la tabla historico:', 3 );
            IN_BOINTERFACE_HISTORY.INSMESSAGE( IONUINTERHISTOID, ITYOBMESSAGESTRUCT, IRCINTERFACEMESSAGE, ITBTRANSITIONSTATUS( ININDEX ).NUNEXTSTATUS, NUACTION, INUERRORCODETRANS, ISBERRORMESSAGETRANS );
            UT_TRACE.TRACE( 'IN_BOActionInterHisto.StatusControlerRegister 2.2 registro insertado:' || IONUINTERHISTOID, 3 );
            UT_TRACE.TRACE( 'IN_BOActionInterHisto.StatusControlerRegister 2.3 expresion PRE', 3 );
            EXECUTEEXPRESSION( ITBTRANSITIONSTATUS( ININDEX ).NUPOSCONFIGEXPRES, NUERRORCODE, SBERRORMESSAGE );
            IF ( NUERRORCODE = CONSTANTS.CNUSUCCESS ) THEN
               UT_TRACE.TRACE( 'IN_BOActionInterHisto.StatusControlerRegister 2.4 :' );
               ONUCURRENTSTATUS := ITBTRANSITIONSTATUS( ININDEX ).NUNEXTSTATUS;
               BLEXECUTEEXPRESSION := TRUE;
               UT_TRACE.TRACE( 'IN_BOActionInterHisto.StatusControlerRegister 2.4 retorna estado final:' || ONUCURRENTSTATUS, 3 );
               EXIT;
             ELSIF ( NUERRORCODE != CNUNOT_NEXT_STATUS ) THEN
               UT_TRACE.TRACE( 'IN_BOActionInterHisto.StatusControlerRegister 2.5 retorna error si diferente de proximo estado:' || NUERRORCODE || ' ' || SBERRORMESSAGE, 3 );
               ERRORS.SETERROR( NUERRORCODE );
               ERRORS.SETMESSAGE( SBERRORMESSAGE );
               RAISE EX.CONTROLLED_ERROR;
            END IF;
          ELSIF ( NUERRORCODE != CNUNOT_NEXT_STATUS ) THEN
            UT_TRACE.TRACE( 'IN_BOActionInterHisto.StatusControlerRegister 2.6 error si diferente de proximo estado:' || NUERRORCODE || ' ' || CNUNOT_NEXT_STATUS, 3 );
            ERRORS.SETERROR( NUERRORCODE );
            ERRORS.SETMESSAGE( SBERRORMESSAGE );
            RAISE EX.CONTROLLED_ERROR;
         END IF;
         UT_TRACE.TRACE( 'IN_BOActionInterHisto.StatusControlerRegister 2.7: ', 3 );
         ININDEX := ITBTRANSITIONSTATUS.NEXT( ININDEX );
      END LOOP;
      UT_TRACE.TRACE( 'IN_BOActionInterHisto.StatusControlerRegister 3: ', 2 );
      IF ( BLEXECUTEEXPRESSION = FALSE ) THEN
         UT_TRACE.TRACE( 'IN_BOActionInterHisto.StatusControlerRegister error no se ejecuto una epresion 4:', 2 );
         ERRORS.SETERROR( CNUERROR_EXECUTE_EXPRESION );
         RAISE EX.CONTROLLED_ERROR;
      END IF;
      UT_TRACE.TRACE( 'IN_BOActionInterHisto.StatusControlerRegister FIN 5 :', 2 );
    EXCEPTION
      WHEN EX.CONTROLLED_ERROR THEN
         RAISE;
      WHEN OTHERS THEN
         ERRORS.SETERROR;
         RAISE EX.CONTROLLED_ERROR;
   END;
   PROCEDURE STATUSCONTROLERPROCESS( ITBTRANSITIONSTATUS IN IN_BOSTATUS_TRANSITION.TYTBTRANSITIONSTATUS, INUERRORCODEPROCESS IN NUMBER, ISBERRORMESSAGEPROCESS IN VARCHAR2, INUINTERHISTOID IN IN_INTERFACE_HISTORY.INTERFACE_HISTORY_ID%TYPE, IRWMEESSAGEHANDLE IN IN_INTERFACE_HISTORY.QUEUE_ID%TYPE := NULL, INUASSOCINTERHISTORYID IN IN_INTERFACE_HISTORY.ASSOC_INTER_HISTO_ID%TYPE := NULL, ONUCURRENTSTATUS OUT IN_STATUS.STATUS_ID%TYPE )
    IS
      NUERRORCODE NUMBER;
      SBERRORMESSAGE VARCHAR2( 2000 );
      ININDEX INTEGER;
      BLEXECUTEEXPRESSION BOOLEAN;
      NUACTION IN_STATUS_TRANSITION.ACTION_ID%TYPE;
    BEGIN
      UT_TRACE.TRACE( 'IN_BOActionInterHisto.StatusControlerProcess 1 :', 2 );
      ININDEX := ITBTRANSITIONSTATUS.FIRST;
      IN_BOINSTANCEGENERAL.GETACTION( NUACTION );
      WHILE ININDEX <= ITBTRANSITIONSTATUS.LAST
       LOOP
         UT_TRACE.TRACE( 'IN_BOActionInterHisto.StatusControlerProcess 2.0 ejecuta expresion PRE:', 3 );
         INITIALIZEERRORMESSAGE( NUERRORCODE, SBERRORMESSAGE );
         EXECUTEEXPRESSION( ITBTRANSITIONSTATUS( ININDEX ).NUPRECONFIGEXPRES, NUERRORCODE, SBERRORMESSAGE );
         UT_TRACE.TRACE( 'IN_BOActionInterHisto.StatusControlerProcess 2.1 :', 3 );
         IF ( NUERRORCODE = CONSTANTS.CNUSUCCESS ) THEN
            UT_TRACE.TRACE( 'IN_BOActionInterHisto.StatusControlerProcess 2.2 actualiza el historico :' || INUINTERHISTOID, 3 );
            IN_BOINTERFACE_HISTORY.UPDMESSAGESTATUS( INUINTERHISTOID, ITBTRANSITIONSTATUS( ININDEX ).NUNEXTSTATUS, NUACTION, INUERRORCODEPROCESS, ISBERRORMESSAGEPROCESS, NULL, INUASSOCINTERHISTORYID );
            UT_TRACE.TRACE( 'IN_BOActionInterHisto.StatusControlerProcess 2.3 Ejecuta expresion POS:', 3 );
            EXECUTEEXPRESSION( ITBTRANSITIONSTATUS( ININDEX ).NUPOSCONFIGEXPRES, NUERRORCODE, SBERRORMESSAGE );
            UT_TRACE.TRACE( 'IN_BOActionInterHisto.StatusControlerProcess 2.4 :' || NUERRORCODE || ' ' || SBERRORMESSAGE, 3 );
            IF ( NUERRORCODE = CONSTANTS.CNUSUCCESS ) THEN
               ONUCURRENTSTATUS := ITBTRANSITIONSTATUS( ININDEX ).NUNEXTSTATUS;
               BLEXECUTEEXPRESSION := TRUE;
               UT_TRACE.TRACE( 'IN_BOActionInterHisto.StatusControlerProcess 2.5 retorna estado final:' || ONUCURRENTSTATUS, 3 );
               EXIT;
             ELSIF ( NUERRORCODE != CNUNOT_NEXT_STATUS ) THEN
               ERRORS.SETERROR( NUERRORCODE );
               ERRORS.SETMESSAGE( SBERRORMESSAGE );
               UT_TRACE.TRACE( 'IN_BOActionInterHisto.StatusControlerProcess 2.6 Error :' || NUERRORCODE || ' ' || SBERRORMESSAGE, 3 );
               RAISE EX.CONTROLLED_ERROR;
            END IF;
          ELSIF ( NUERRORCODE != CNUNOT_NEXT_STATUS ) THEN
            UT_TRACE.TRACE( 'IN_BOActionInterHisto.StatusControlerProcess 2.7 Error :' || NUERRORCODE || ' ' || SBERRORMESSAGE, 3 );
            ERRORS.SETERROR( NUERRORCODE );
            ERRORS.SETMESSAGE( SBERRORMESSAGE );
            RAISE EX.CONTROLLED_ERROR;
         END IF;
         ININDEX := ITBTRANSITIONSTATUS.NEXT( ININDEX );
         UT_TRACE.TRACE( 'IN_BOActionInterHisto.StatusControlerProcess 2.8 :', 3 );
      END LOOP;
      IF ( BLEXECUTEEXPRESSION = FALSE ) THEN
         UT_TRACE.TRACE( 'IN_BOActionInterHisto.StatusControlerProcess 3 Error no se ejecuto una expresion:', 2 );
         ERRORS.SETERROR( CNUERROR_EXECUTE_EXPRESION );
         RAISE EX.CONTROLLED_ERROR;
      END IF;
      UT_TRACE.TRACE( 'IN_BOActionInterHisto.StatusControlerProcess 4 FIN :', 2 );
    EXCEPTION
      WHEN EX.CONTROLLED_ERROR THEN
         RAISE;
      WHEN OTHERS THEN
         ERRORS.SETERROR;
         RAISE EX.CONTROLLED_ERROR;
   END;
   PROCEDURE STATUSCONTROLERREPROCESS( ITBTRANSITIONSTATUS IN IN_BOSTATUS_TRANSITION.TYTBTRANSITIONSTATUS, INUINTERHISTOID IN IN_INTERFACE_HISTORY.INTERFACE_HISTORY_ID%TYPE, ITYOBMESSAGESTRUCT IN OUT IN_TYOBMESSAGESTRUCT, IRCINTERFACEMESSAGE IN STYIN_INTERFACE_MESSAGE, INUERRORCODEPROCESS IN NUMBER, ISBERRORMESSAGEPROCESS IN VARCHAR2, ONUCURRENTSTATUS OUT IN_STATUS.STATUS_ID%TYPE )
    IS
      NUERRORCODE NUMBER;
      SBERRORMESSAGE VARCHAR2( 2000 );
      ININDEX INTEGER;
      BLEXECUTEEXPRESSION BOOLEAN;
      NUACTION IN_STATUS_TRANSITION.ACTION_ID%TYPE;
    BEGIN
      UT_TRACE.TRACE( 'IN_BOActionInterHisto.StatusControlerReProcess 1 :', 2 );
      ININDEX := ITBTRANSITIONSTATUS.FIRST;
      IN_BOINSTANCEGENERAL.GETACTION( NUACTION );
      WHILE ININDEX <= ITBTRANSITIONSTATUS.LAST
       LOOP
         UT_TRACE.TRACE( 'IN_BOActionInterHisto.StatusControlerReProcess 2.0 :', 3 );
         INITIALIZEERRORMESSAGE( NUERRORCODE, SBERRORMESSAGE );
         EXECUTEEXPRESSION( ITBTRANSITIONSTATUS( ININDEX ).NUPRECONFIGEXPRES, NUERRORCODE, SBERRORMESSAGE );
         UT_TRACE.TRACE( 'IN_BOActionInterHisto.StatusControlerReProcess 2.1 :', 3 );
         IF ( NUERRORCODE = CONSTANTS.CNUSUCCESS ) THEN
            UT_TRACE.TRACE( 'IN_BOActionInterHisto.StatusControlerReProcess 2.2 :', 3 );
            IN_BOINTERFACE_HISTORY.UPDMESSAGEREPROCESS( INUINTERHISTOID, ITYOBMESSAGESTRUCT, IRCINTERFACEMESSAGE, ITBTRANSITIONSTATUS( ININDEX ).NUNEXTSTATUS, NUACTION, INUERRORCODEPROCESS, ISBERRORMESSAGEPROCESS );
            UT_TRACE.TRACE( 'IN_BOActionInterHisto.StatusControlerReProcess 2.3 :', 3 );
            EXECUTEEXPRESSION( ITBTRANSITIONSTATUS( ININDEX ).NUPOSCONFIGEXPRES, NUERRORCODE, SBERRORMESSAGE );
            UT_TRACE.TRACE( 'IN_BOActionInterHisto.StatusControlerReProcess 2.4 :' || NUERRORCODE || ' ' || SBERRORMESSAGE, 3 );
            IF ( NUERRORCODE = CONSTANTS.CNUSUCCESS ) THEN
               UT_TRACE.TRACE( 'IN_BOActionInterHisto.StatusControlerReProcess 2.5 :', 3 );
               ONUCURRENTSTATUS := ITBTRANSITIONSTATUS( ININDEX ).NUNEXTSTATUS;
               BLEXECUTEEXPRESSION := TRUE;
               EXIT;
             ELSIF ( NUERRORCODE != CNUNOT_NEXT_STATUS ) THEN
               UT_TRACE.TRACE( 'IN_BOActionInterHisto.StatusControlerReProcess 2.6 :', 3 );
               ERRORS.SETERROR( NUERRORCODE );
               ERRORS.SETMESSAGE( SBERRORMESSAGE );
               RAISE EX.CONTROLLED_ERROR;
            END IF;
          ELSIF ( NUERRORCODE != CNUNOT_NEXT_STATUS ) THEN
            UT_TRACE.TRACE( 'IN_BOActionInterHisto.StatusControlerReProcess 2.7 :', 3 );
            ERRORS.SETERROR( NUERRORCODE );
            ERRORS.SETMESSAGE( SBERRORMESSAGE );
            RAISE EX.CONTROLLED_ERROR;
         END IF;
         ININDEX := ITBTRANSITIONSTATUS.NEXT( ININDEX );
         UT_TRACE.TRACE( 'IN_BOActionInterHisto.StatusControlerReProcess 2.8 :', 3 );
      END LOOP;
      IF ( BLEXECUTEEXPRESSION = FALSE ) THEN
         UT_TRACE.TRACE( 'IN_BOActionInterHisto.StatusControlerReProcess 3 :', 3 );
         ERRORS.SETERROR( CNUERROR_EXECUTE_EXPRESION );
         RAISE EX.CONTROLLED_ERROR;
      END IF;
      UT_TRACE.TRACE( 'IN_BOActionInterHisto.StatusControlerReProcess 4 :', 3 );
    EXCEPTION
      WHEN EX.CONTROLLED_ERROR THEN
         RAISE;
      WHEN OTHERS THEN
         ERRORS.SETERROR;
         RAISE EX.CONTROLLED_ERROR;
   END;
   PROCEDURE VALIDATEINTERFACETYPE( INUINTERFACEMESSAGEID IN IN_INTERFACE_MESSAGE.INTERFACE_MESSAGE_ID%TYPE, IORCINTERFACEMESSAGE IN OUT STYIN_INTERFACE_MESSAGE, ONUERRORCODE OUT NUMBER, OSBERRORMESSAGE OUT VARCHAR2 )
    IS
      NUCURREOPERAMODE IN_INTERFACE_TYPE.CURRE_OPERAT_MODE_ID%TYPE;
      SBINTERFACESTATUS IN_INTERFACE_TYPE.INTERFACE_STATUS%TYPE;
      NUOPERAMODEPROCESS IN_OPERATION_MODE.OPERATION_MODE_ID%TYPE;
    BEGIN
      UT_TRACE.TRACE( 'IN_BOActionInterHisto.ValidateInterfacetype INICIO 1 :', 2 );
      INITIALIZEERRORMESSAGE( ONUERRORCODE, OSBERRORMESSAGE );
      IN_BOINTERFACE_MESSAGE.GETINTERFACEMESSAGE( INUINTERFACEMESSAGEID, IORCINTERFACEMESSAGE );
      UT_TRACE.TRACE( 'IN_BOActionInterHisto.ValidateInterfacetype 2 :', 3 );
      NUCURREOPERAMODE := DAIN_INTERFACE_TYPE.FNUGETCURRE_OPERAT_MODE_ID( IORCINTERFACEMESSAGE.INTERFACE_TYPE_ID );
      IN_BOINSTANCEGENERAL.GETOPERAMODEPROCESS( NUOPERAMODEPROCESS );
      UT_TRACE.TRACE( 'IN_BOActionInterHisto.ValidateInterfacetype 3 :', 3 );
      IN_BOINTERFACE_TYPE.VALIDATEINTERFACE( IORCINTERFACEMESSAGE.INTERFACE_TYPE_ID, NUOPERAMODEPROCESS );
      UT_TRACE.TRACE( 'IN_BOActionInterHisto.ValidateInterfacetype 4 :', 3 );
      IN_BOINTERFACE_HISTORY.SETREGISINTERHISTO( IORCINTERFACEMESSAGE.REGIST_INTER_HISTORY, NUCURREOPERAMODE );
      UT_TRACE.TRACE( 'IN_BOActionInterHisto.ValidateInterfacetype FIN 5 :', 2 );
    EXCEPTION
      WHEN EX.CONTROLLED_ERROR THEN
         ERRORS.GETERROR( ONUERRORCODE, OSBERRORMESSAGE );
         UT_TRACE.TRACE( 'IN_BOActionInterHisto.ValidateInterfacetype 6 :', 2 );
      WHEN OTHERS THEN
         ERRORS.SETERROR;
         ERRORS.GETERROR( ONUERRORCODE, OSBERRORMESSAGE );
         UT_TRACE.TRACE( 'IN_BOActionInterHisto.ValidateInterfacetype 7 :', 2 );
   END;
   PROCEDURE REGISTER( ITYOBMESSAGESTRUCT IN OUT IN_TYOBMESSAGESTRUCT, IONUINTERHISTOID IN OUT IN_INTERFACE_HISTORY.INTERFACE_HISTORY_ID%TYPE, ONUCURRENTSTATUS OUT IN_STATUS.STATUS_ID%TYPE )
    IS
      NUACTION IN_STATUS_TRANSITION.ACTION_ID%TYPE;
      NUINITIALSTATUS IN_INITI_STATU_ACTIO.INITIAL_STATUS_ID%TYPE;
      NUERRORCODE NUMBER;
      SBERRORMESSAGE VARCHAR2( 2000 );
      NUERRORCODEPROCESS NUMBER;
      SBERRORMESSAGEPROCESS VARCHAR2( 2000 );
      TBTRANSITIONSTATUS IN_BOSTATUS_TRANSITION.TYTBTRANSITIONSTATUS;
      BLEXECUTEEXPRESSION BOOLEAN := FALSE;
      ININDEX INTEGER;
      RCINTERFACEMESSAGE STYIN_INTERFACE_MESSAGE;
    BEGIN
      UT_TRACE.TRACE( 'IN_BOActionInterHisto.Register 1 :', 1 );
      INITIALIZEERRORMESSAGE( NUERRORCODEPROCESS, SBERRORMESSAGEPROCESS );
      ONUCURRENTSTATUS := NULL;
      NUACTION := IN_BOPARAMETER.FNUGETINT_QUE_HIS_REGISTER;
      NUINITIALSTATUS := IN_BOPARAMETER.FNUGETINITIAL_STATUS_REGIS;
      IN_BOINSTANCEGENERAL.SETTRANSITION( NUACTION, NUINITIALSTATUS );
      UT_TRACE.TRACE( 'IN_BOActionInterHisto.Register 2 :', 2 );
      IN_BOINITI_STATU_ACTIO.EXIST( NUACTION, NUINITIALSTATUS );
      UT_TRACE.TRACE( 'IN_BOActionInterHisto.Register 3 :', 2 );
      VALIDATEINTERFACETYPE( ITYOBMESSAGESTRUCT.INTERFACE_MESSAGE_ID, RCINTERFACEMESSAGE, NUERRORCODEPROCESS, SBERRORMESSAGEPROCESS );
      UT_TRACE.TRACE( 'IN_BOActionInterHisto.Register 4 :' || NUACTION || ' ' || NUINITIALSTATUS || ' ' || NUERRORCODEPROCESS || ' ' || SBERRORMESSAGEPROCESS, 2 );
      IN_BOINSTANCEGENERAL.SETERRORMESSAGE( NUERRORCODEPROCESS, SBERRORMESSAGEPROCESS );
      IN_BOINSTANCEGENERAL.SETRECORDINTERFACEMESSAGE( RCINTERFACEMESSAGE );
      UT_TRACE.TRACE( 'IN_BOActionInterHisto.Register 5 :', 2 );
      IN_BOSTATUS_TRANSITION.GETNEXTSTATUS( RCINTERFACEMESSAGE.INTERFACE_TYPE_ID, NUACTION, NUINITIALSTATUS, TBTRANSITIONSTATUS );
      UT_TRACE.TRACE( 'IN_BOActionInterHisto.Register 6 :', 2 );
      STATUSCONTROLERREGISTER( TBTRANSITIONSTATUS, RCINTERFACEMESSAGE, NUERRORCODEPROCESS, SBERRORMESSAGEPROCESS, ITYOBMESSAGESTRUCT, IONUINTERHISTOID, ONUCURRENTSTATUS );
      UT_TRACE.TRACE( 'IN_BOActionInterHisto.Register 7 ejecuto controlador de estados:', 2 );
      IF NUERRORCODEPROCESS != IN_BOCONSTANT.CNUSUCCESS THEN
         UT_TRACE.TRACE( 'IN_BOActionInterHisto.Register valida error en la ejecucion de la accion 8:' || NUERRORCODEPROCESS || ' ' || SBERRORMESSAGEPROCESS, 2 );
         ERRORS.SETERROR( NUERRORCODEPROCESS );
         ERRORS.SETMESSAGE( SBERRORMESSAGEPROCESS );
         RAISE EX.CONTROLLED_ERROR;
      END IF;
      UT_TRACE.TRACE( 'IN_BOActionInterHisto.Register FIN 9', 1 );
    EXCEPTION
      WHEN EX.CONTROLLED_ERROR THEN
         RAISE;
      WHEN OTHERS THEN
         ERRORS.SETERROR;
         RAISE EX.CONTROLLED_ERROR;
   END;
   PROCEDURE BATCHREGISTER( ITYOBMESSAGESTRUCT IN OUT IN_TYOBMESSAGESTRUCT, IONUINTERHISTOID IN OUT IN_INTERFACE_HISTORY.INTERFACE_HISTORY_ID%TYPE, ONUCURRENTSTATUS OUT IN_STATUS.STATUS_ID%TYPE )
    IS
      NUACTION IN_STATUS_TRANSITION.ACTION_ID%TYPE;
      NUINITIALSTATUS IN_INITI_STATU_ACTIO.INITIAL_STATUS_ID%TYPE;
      NUERRORCODE NUMBER;
      SBERRORMESSAGE VARCHAR2( 2000 );
      NUERRORCODEPROCESS NUMBER;
      SBERRORMESSAGEPROCESS VARCHAR2( 2000 );
      TBTRANSITIONSTATUS IN_BOSTATUS_TRANSITION.TYTBTRANSITIONSTATUS;
      BLEXECUTEEXPRESSION BOOLEAN := FALSE;
      ININDEX INTEGER;
      RCINTERFACEMESSAGE STYIN_INTERFACE_MESSAGE;
    BEGIN
      UT_TRACE.TRACE( 'IN_BOActionInterHisto.Register 1 :', 1 );
      INITIALIZEERRORMESSAGE( NUERRORCODEPROCESS, SBERRORMESSAGEPROCESS );
      ONUCURRENTSTATUS := NULL;
      NUACTION := IN_BOPARAMETER.FNUGETINT_QUE_HIS_BAT_REGI;
      NUINITIALSTATUS := IN_BOPARAMETER.FNUGETINITIAL_STATUS_REGIS;
      IN_BOINSTANCEGENERAL.SETTRANSITION( NUACTION, NUINITIALSTATUS );
      UT_TRACE.TRACE( 'IN_BOActionInterHisto.Register 2 :', 2 );
      IN_BOINITI_STATU_ACTIO.EXIST( NUACTION, NUINITIALSTATUS );
      UT_TRACE.TRACE( 'IN_BOActionInterHisto.Register 3 :', 2 );
      VALIDATEINTERFACETYPE( ITYOBMESSAGESTRUCT.INTERFACE_MESSAGE_ID, RCINTERFACEMESSAGE, NUERRORCODEPROCESS, SBERRORMESSAGEPROCESS );
      UT_TRACE.TRACE( 'IN_BOActionInterHisto.Register 4 :' || NUACTION || ' ' || NUINITIALSTATUS || ' ' || NUERRORCODEPROCESS || ' ' || SBERRORMESSAGEPROCESS, 2 );
      IN_BOINSTANCEGENERAL.SETERRORMESSAGE( NUERRORCODEPROCESS, SBERRORMESSAGEPROCESS );
      IN_BOINSTANCEGENERAL.SETRECORDINTERFACEMESSAGE( RCINTERFACEMESSAGE );
      UT_TRACE.TRACE( 'IN_BOActionInterHisto.Register 5 :', 2 );
      IN_BOSTATUS_TRANSITION.GETNEXTSTATUS( RCINTERFACEMESSAGE.INTERFACE_TYPE_ID, NUACTION, NUINITIALSTATUS, TBTRANSITIONSTATUS );
      UT_TRACE.TRACE( 'IN_BOActionInterHisto.Register 6 :', 2 );
      STATUSCONTROLERREGISTER( TBTRANSITIONSTATUS, RCINTERFACEMESSAGE, NUERRORCODEPROCESS, SBERRORMESSAGEPROCESS, ITYOBMESSAGESTRUCT, IONUINTERHISTOID, ONUCURRENTSTATUS );
      UT_TRACE.TRACE( 'IN_BOActionInterHisto.Register 7 :', 2 );
      IF NUERRORCODEPROCESS != IN_BOCONSTANT.CNUSUCCESS THEN
         UT_TRACE.TRACE( 'IN_BOActionInterHisto.Register 8 valida ejecucion del proceso:' || NUERRORCODEPROCESS || ' ' || SBERRORMESSAGEPROCESS, 2 );
         ERRORS.SETERROR( NUERRORCODEPROCESS );
         ERRORS.SETMESSAGE( SBERRORMESSAGEPROCESS );
         RAISE EX.CONTROLLED_ERROR;
      END IF;
      UT_TRACE.TRACE( 'IN_BOActionInterHisto.Register 7 :', 1 );
    EXCEPTION
      WHEN EX.CONTROLLED_ERROR THEN
         RAISE;
      WHEN OTHERS THEN
         ERRORS.SETERROR;
         RAISE EX.CONTROLLED_ERROR;
   END;
   PROCEDURE PROCESS( INUINTERHISTOID IN IN_INTERFACE_HISTORY.INTERFACE_HISTORY_ID%TYPE, ITYOBMESSAGESTRUCT IN OUT IN_TYOBMESSAGESTRUCT, IRCINTERFACEMESSAGE IN STYIN_INTERFACE_MESSAGE, IONUCURRENTSTATUS IN OUT IN_STATUS.STATUS_ID%TYPE, OBLRESPONSEERROR OUT BOOLEAN, ONUERRORCODEPROCESS OUT NUMBER, OSBERRORMESSAGEPROCESS OUT VARCHAR2, ONUERRORCODE OUT NUMBER, OSBERRORMESSAGE OUT VARCHAR2 )
    IS
      NUACTION IN_STATUS_TRANSITION.ACTION_ID%TYPE;
      NUERRORCODE NUMBER;
      SBERRORMESSAGE VARCHAR2( 2000 );
      TBTRANSITIONSTATUS IN_BOSTATUS_TRANSITION.TYTBTRANSITIONSTATUS;
      BLEXECUTEEXPRESSION BOOLEAN := FALSE;
      ININDEX INTEGER;
    BEGIN
      UT_TRACE.TRACE( 'IN_BOActionInterHisto.Process 1 :', 1 );
      INITIALIZEERRORMESSAGE( ONUERRORCODEPROCESS, OSBERRORMESSAGEPROCESS );
      INITIALIZEERRORMESSAGE( ONUERRORCODE, OSBERRORMESSAGE );
      UT_TRACE.TRACE( 'IN_BOActionInterHisto.Process 2 :', 2 );
      NUACTION := IN_BOPARAMETER.FNUGETINT_QUE_HIS_PROCESS;
      IN_BOINSTANCEGENERAL.SETTRANSITION( NUACTION, IONUCURRENTSTATUS );
      IN_BOINITI_STATU_ACTIO.EXIST( NUACTION, IONUCURRENTSTATUS );
      UT_TRACE.TRACE( 'IN_BOActionInterHisto.Process 5 :', 2 );
      IN_BOSTATUS_TRANSITION.GETNEXTSTATUS( IRCINTERFACEMESSAGE.INTERFACE_TYPE_ID, NUACTION, IONUCURRENTSTATUS, TBTRANSITIONSTATUS );
      UT_TRACE.TRACE( 'IN_BOActionInterHisto.Process 3 :', 2 );
      IN_BOMESSAGEDATAPROCESS.MESSAGEDATAPROCESS( ITYOBMESSAGESTRUCT, IRCINTERFACEMESSAGE, ONUERRORCODEPROCESS, OSBERRORMESSAGEPROCESS );
      UT_TRACE.TRACE( 'IN_BOActionInterHisto.Process 4 :', 2 );
      IN_BOINSTANCEGENERAL.SETERRORMESSAGE( ONUERRORCODEPROCESS, OSBERRORMESSAGEPROCESS );
      UT_TRACE.TRACE( 'IN_BOActionInterHisto.Process 6 :', 2 );
      STATUSCONTROLERPROCESS( TBTRANSITIONSTATUS, ONUERRORCODEPROCESS, OSBERRORMESSAGEPROCESS, INUINTERHISTOID, NULL, NULL, IONUCURRENTSTATUS );
      UT_TRACE.TRACE( 'IN_BOActionInterHisto.Process 7 :', 2 );
      IN_BOINSTANCEGENERAL.GETGLOBALRESPONSEERROR( OBLRESPONSEERROR );
      UT_TRACE.TRACE( 'IN_BOActionInterHisto.Process FIN 8 :', 1 );
    EXCEPTION
      WHEN EX.CONTROLLED_ERROR THEN
         ERRORS.GETERROR( ONUERRORCODE, OSBERRORMESSAGE );
         UT_TRACE.TRACE( 'IN_BOActionInterHisto.Process 9 :' || ONUERRORCODE || ' ' || OSBERRORMESSAGE, 1 );
      WHEN OTHERS THEN
         ERRORS.SETERROR;
         ERRORS.GETERROR( ONUERRORCODE, OSBERRORMESSAGE );
         UT_TRACE.TRACE( 'IN_BOActionInterHisto.Process 10 :' || ONUERRORCODE || ' ' || OSBERRORMESSAGE, 1 );
   END;
   PROCEDURE REPROCESS( INUINTERHISTOID IN IN_INTERFACE_HISTORY.INTERFACE_HISTORY_ID%TYPE, ITYOBMESSAGESTRUCT IN OUT IN_TYOBMESSAGESTRUCT, IRCINTERFACEMESSAGE IN STYIN_INTERFACE_MESSAGE, IONUCURRENTSTATUS IN OUT IN_STATUS.STATUS_ID%TYPE, OBLRESPONSEERROR OUT BOOLEAN, ONUERRORCODEPROCESS OUT NUMBER, OSBERRORMESSAGEPROCESS OUT VARCHAR2, ONUERRORCODE OUT NUMBER, OSBERRORMESSAGE OUT VARCHAR2 )
    IS
      NUACTION IN_STATUS_TRANSITION.ACTION_ID%TYPE;
      NUERRORCODE NUMBER;
      SBERRORMESSAGE VARCHAR2( 2000 );
      TBTRANSITIONSTATUS IN_BOSTATUS_TRANSITION.TYTBTRANSITIONSTATUS;
      BLEXECUTEEXPRESSION BOOLEAN := FALSE;
      ININDEX INTEGER;
    BEGIN
      UT_TRACE.TRACE( 'IN_BOActionInterHisto.ReProcess 1 :', 1 );
      INITIALIZEERRORMESSAGE( ONUERRORCODEPROCESS, OSBERRORMESSAGEPROCESS );
      INITIALIZEERRORMESSAGE( ONUERRORCODE, OSBERRORMESSAGE );
      UT_TRACE.TRACE( 'IN_BOActionInterHisto.ReProcess 2 :', 2 );
      NUACTION := IN_BOPARAMETER.FNUGETINT_QUE_HIS_REPROCES;
      IN_BOINSTANCEGENERAL.SETTRANSITION( NUACTION, IONUCURRENTSTATUS );
      IN_BOINITI_STATU_ACTIO.EXIST( NUACTION, IONUCURRENTSTATUS );
      UT_TRACE.TRACE( 'IN_BOActionInterHisto.ReProcess 5 :', 2 );
      IN_BOSTATUS_TRANSITION.GETNEXTSTATUS( IRCINTERFACEMESSAGE.INTERFACE_TYPE_ID, NUACTION, IONUCURRENTSTATUS, TBTRANSITIONSTATUS );
      UT_TRACE.TRACE( 'IN_BOActionInterHisto.ReProcess 3 :', 2 );
      IN_BOMESSAGEDATAPROCESS.MESSAGEDATAPROCESS( ITYOBMESSAGESTRUCT, IRCINTERFACEMESSAGE, ONUERRORCODEPROCESS, OSBERRORMESSAGEPROCESS );
      UT_TRACE.TRACE( 'IN_BOActionInterHisto.ReProcess 4 :', 2 );
      IN_BOINSTANCEGENERAL.SETERRORMESSAGE( ONUERRORCODEPROCESS, OSBERRORMESSAGEPROCESS );
      UT_TRACE.TRACE( 'IN_BOActionInterHisto.ReProcess 6 :', 2 );
      STATUSCONTROLERREPROCESS( TBTRANSITIONSTATUS, INUINTERHISTOID, ITYOBMESSAGESTRUCT, IRCINTERFACEMESSAGE, ONUERRORCODEPROCESS, OSBERRORMESSAGEPROCESS, IONUCURRENTSTATUS );
      UT_TRACE.TRACE( 'IN_BOActionInterHisto.Process 7 :', 2 );
      IN_BOINSTANCEGENERAL.GETGLOBALRESPONSEERROR( OBLRESPONSEERROR );
      UT_TRACE.TRACE( 'IN_BOActionInterHisto.ReProcess FIN 8 :', 1 );
    EXCEPTION
      WHEN EX.CONTROLLED_ERROR THEN
         ERRORS.GETERROR( ONUERRORCODE, OSBERRORMESSAGE );
         UT_TRACE.TRACE( 'IN_BOActionInterHisto.ReProcess 9 :' || ONUERRORCODE || ' ' || OSBERRORMESSAGE, 1 );
      WHEN OTHERS THEN
         ERRORS.SETERROR;
         ERRORS.GETERROR( ONUERRORCODE, OSBERRORMESSAGE );
         UT_TRACE.TRACE( 'IN_BOActionInterHisto.ReProcess 10 :' || ONUERRORCODE || ' ' || OSBERRORMESSAGE, 1 );
   END;
   PROCEDURE PROCESSBYRESPONSE( INUINTERHISTOID IN IN_INTERFACE_HISTORY.INTERFACE_HISTORY_ID%TYPE, ITYOBMESSAGESTRUCT IN OUT IN_TYOBMESSAGESTRUCT, IRCINTERFACEMESSAGE IN STYIN_INTERFACE_MESSAGE, IONUCURRENTSTATUS IN OUT IN_STATUS.STATUS_ID%TYPE, ONUERRORCODEPROCESS OUT NUMBER, OSBERRORMESSAGEPROCESS OUT VARCHAR2, ONUERRORCODETRANS OUT NUMBER, OSBERRORMESSAGETRANS OUT VARCHAR2 )
    IS
      NUACTION IN_STATUS_TRANSITION.ACTION_ID%TYPE;
      NUERRORCODE NUMBER;
      SBERRORMESSAGE VARCHAR2( 2000 );
      TBTRANSITIONSTATUS IN_BOSTATUS_TRANSITION.TYTBTRANSITIONSTATUS;
      BLEXECUTEEXPRESSION BOOLEAN := FALSE;
      ININDEX INTEGER;
    BEGIN
      UT_TRACE.TRACE( 'IN_BOActionInterHisto.ProcessByResponse 1 :', 1 );
      INITIALIZEERRORMESSAGE( ONUERRORCODEPROCESS, OSBERRORMESSAGEPROCESS );
      INITIALIZEERRORMESSAGE( ONUERRORCODETRANS, OSBERRORMESSAGETRANS );
      UT_TRACE.TRACE( 'IN_BOActionInterHisto.ProcessByResponse 2 :', 2 );
      NUACTION := IN_BOPARAMETER.FNUGETINT_QUE_HIS_SE_PR_RE;
      IN_BOINSTANCEGENERAL.SETTRANSITION( NUACTION, IONUCURRENTSTATUS );
      IN_BOINITI_STATU_ACTIO.EXIST( NUACTION, IONUCURRENTSTATUS );
      UT_TRACE.TRACE( 'IN_BOActionInterHisto.ProcessByResponse 5 :', 2 );
      IN_BOSTATUS_TRANSITION.GETNEXTSTATUS( IRCINTERFACEMESSAGE.INTERFACE_TYPE_ID, NUACTION, IONUCURRENTSTATUS, TBTRANSITIONSTATUS );
      UT_TRACE.TRACE( 'IN_BOActionInterHisto.ProcessByResponse 3 Accion :' || NUACTION, 2 );
      IN_BOMESSAGEDATAPROCESS.MESSAGEDATAPROCESSRESPONSE( ITYOBMESSAGESTRUCT, IRCINTERFACEMESSAGE, ONUERRORCODEPROCESS, OSBERRORMESSAGEPROCESS );
      UT_TRACE.TRACE( 'IN_BOActionInterHisto.ProcessByResponse 4 :' || ONUERRORCODEPROCESS || ' ' || OSBERRORMESSAGEPROCESS, 2 );
      IN_BOINSTANCEGENERAL.SETERRORMESSAGE( ONUERRORCODEPROCESS, OSBERRORMESSAGEPROCESS );
      UT_TRACE.TRACE( 'IN_BOActionInterHisto.ProcessByResponse 6 :', 2 );
      STATUSCONTROLERPROCESS( TBTRANSITIONSTATUS, ONUERRORCODEPROCESS, OSBERRORMESSAGEPROCESS, INUINTERHISTOID, NULL, NULL, IONUCURRENTSTATUS );
      UT_TRACE.TRACE( 'IN_BOActionInterHisto.ProcessByResponse FIN 7 :', 1 );
    EXCEPTION
      WHEN EX.CONTROLLED_ERROR THEN
         ERRORS.GETERROR( ONUERRORCODETRANS, OSBERRORMESSAGETRANS );
         UT_TRACE.TRACE( 'IN_BOActionInterHisto.ProcessByResponse 8 :' || ONUERRORCODETRANS || ' ' || OSBERRORMESSAGETRANS, 2 );
      WHEN OTHERS THEN
         ERRORS.SETERROR;
         ERRORS.GETERROR( ONUERRORCODETRANS, OSBERRORMESSAGETRANS );
         UT_TRACE.TRACE( 'IN_BOActionInterHisto.ProcessByResponse 9 :' || ONUERRORCODETRANS || ' ' || OSBERRORMESSAGETRANS, 2 );
   END;
   PROCEDURE RESPONSEMESSAGEBYSEND( INUINTERFACEMESSAGEID IN IN_INTERFACE_MESSAGE.INTERFACE_MESSAGE_ID%TYPE, INUINTERFACETYPE IN IN_INTERFACE_TYPE.INTERFACE_TYPE_ID%TYPE, ITYOBMESSAGESTRUCT IN OUT IN_TYOBMESSAGESTRUCT, IONUCURRENTSTATUS IN OUT IN_STATUS.STATUS_ID%TYPE, INUINTERHISTOID IN IN_INTERFACE_HISTORY.INTERFACE_HISTORY_ID%TYPE, INUERRORCODEORIGIN IN NUMBER, ISBERRORMESSAGEORIGIN IN VARCHAR2, ONUERRORCODE OUT NUMBER, OSBERRORMESSAGE OUT VARCHAR2 )
    IS
      NUASSOCINTERHISTORYID IN_INTERFACE_HISTORY.ASSOC_INTER_HISTO_ID%TYPE;
      NUACTION IN_STATUS_TRANSITION.ACTION_ID%TYPE;
      TBTRANSITIONSTATUS IN_BOSTATUS_TRANSITION.TYTBTRANSITIONSTATUS;
      BLEXECUTEEXPRESSION BOOLEAN := FALSE;
      ININDEX INTEGER;
      NUERRORCODEPROCESS NUMBER;
      SBERRORMESSAGEPROCESS VARCHAR2( 2000 );
    BEGIN
      UT_TRACE.TRACE( 'IN_BOActionInterHisto.ResponseMessageBySend 1 :', 1 );
      INITIALIZEERRORMESSAGE( NUERRORCODEPROCESS, SBERRORMESSAGEPROCESS );
      INITIALIZEERRORMESSAGE( ONUERRORCODE, OSBERRORMESSAGE );
      NUACTION := IN_BOPARAMETER.FNUGETINT_QUE_HIS_RESPONSE;
      UT_TRACE.TRACE( 'IN_BOActionInterHisto.ResponseMessageBySend 2 Tipo interfa:' || INUINTERFACETYPE || ' Accion:' || NUACTION || ' Estado current:' || IONUCURRENTSTATUS, 2 );
      IN_BOINSTANCEGENERAL.SETTRANSITION( NUACTION, IONUCURRENTSTATUS );
      IN_BOINITI_STATU_ACTIO.EXIST( NUACTION, IONUCURRENTSTATUS );
      UT_TRACE.TRACE( 'IN_BOActionInterHisto.ResponseMessageBySend 3 :', 2 );
      IN_BOSTATUS_TRANSITION.GETNEXTSTATUS( INUINTERFACETYPE, NUACTION, IONUCURRENTSTATUS, TBTRANSITIONSTATUS );
      UT_TRACE.TRACE( 'IN_BOActionInterHisto.ResponseMessageBySend 4 Envia el mensaje de respuesta:' || INUINTERFACEMESSAGEID, 2 );
      IN_BOMESSAGECOMPOSERESPONSE.RESPONSEMESSAGESEND( INUINTERFACEMESSAGEID, ITYOBMESSAGESTRUCT, NUASSOCINTERHISTORYID, INUERRORCODEORIGIN, ISBERRORMESSAGEORIGIN, NUERRORCODEPROCESS, SBERRORMESSAGEPROCESS );
      UT_TRACE.TRACE( 'IN_BOActionInterHisto.ResponseMessageBySend 5 Retorno del envio de mensaje de respuesta:' || NUERRORCODEPROCESS || ' ' || SBERRORMESSAGEPROCESS, 2 );
      IN_BOINSTANCEGENERAL.SETERRORMESSAGE( NUERRORCODEPROCESS, SBERRORMESSAGEPROCESS );
      UT_TRACE.TRACE( 'IN_BOActionInterHisto.ResponseMessageBySend 6 :', 2 );
      STATUSCONTROLERPROCESS( TBTRANSITIONSTATUS, NULL, NULL, INUINTERHISTOID, NULL, NUASSOCINTERHISTORYID, IONUCURRENTSTATUS );
      UT_TRACE.TRACE( 'IN_BOActionInterHisto.ResponseMessageBySend FIN 7 :', 1 );
    EXCEPTION
      WHEN EX.CONTROLLED_ERROR THEN
         ERRORS.GETERROR( ONUERRORCODE, OSBERRORMESSAGE );
         UT_TRACE.TRACE( 'IN_BOActionInterHisto.ResponseMessageBySend CONTROLLED_ERROR 8 :' || ONUERRORCODE || ' ' || OSBERRORMESSAGE, 1 );
      WHEN OTHERS THEN
         ERRORS.SETERROR;
         ERRORS.GETERROR( ONUERRORCODE, OSBERRORMESSAGE );
         UT_TRACE.TRACE( 'IN_BOActionInterHisto.ResponseMessageBySend OTHERS 9 :' || ONUERRORCODE || ' ' || OSBERRORMESSAGE, 1 );
   END;
   PROCEDURE RESPONSEMESSAGEBYSENDBATCH( INUINTERFACEMESSAGEID IN IN_INTERFACE_MESSAGE.INTERFACE_MESSAGE_ID%TYPE, INUINTERFACETYPE IN IN_INTERFACE_TYPE.INTERFACE_TYPE_ID%TYPE, ITYOBMESSAGESTRUCT IN OUT IN_TYOBMESSAGESTRUCT, IONUCURRENTSTATUS IN OUT IN_STATUS.STATUS_ID%TYPE, INUINTERHISTOID IN IN_INTERFACE_HISTORY.INTERFACE_HISTORY_ID%TYPE, INUERRORCODEORIGIN IN NUMBER, ISBERRORMESSAGEORIGIN IN VARCHAR2, ONUERRORCODE OUT NUMBER, OSBERRORMESSAGE OUT VARCHAR2 )
    IS
      NUASSOCINTERHISTORYID IN_INTERFACE_HISTORY.ASSOC_INTER_HISTO_ID%TYPE;
      NUACTION IN_STATUS_TRANSITION.ACTION_ID%TYPE;
      TBTRANSITIONSTATUS IN_BOSTATUS_TRANSITION.TYTBTRANSITIONSTATUS;
      BLEXECUTEEXPRESSION BOOLEAN := FALSE;
      ININDEX INTEGER;
      NUERRORCODEPROCESS NUMBER;
      SBERRORMESSAGEPROCESS VARCHAR2( 2000 );
    BEGIN
      UT_TRACE.TRACE( 'IN_BOActionInterHisto.ResponseMessageBySendBatch 1 :', 1 );
      INITIALIZEERRORMESSAGE( NUERRORCODEPROCESS, SBERRORMESSAGEPROCESS );
      INITIALIZEERRORMESSAGE( ONUERRORCODE, OSBERRORMESSAGE );
      NUACTION := IN_BOPARAMETER.FNUGETINT_QUE_HIS_RESPONSE;
      UT_TRACE.TRACE( 'IN_BOActionInterHisto.ResponseMessageBySendBatch 2 Tipo interfaz:' || INUINTERFACETYPE || ' Accion:' || NUACTION || ' Estado Current:' || IONUCURRENTSTATUS, 2 );
      IN_BOINSTANCEGENERAL.SETTRANSITION( NUACTION, IONUCURRENTSTATUS );
      IN_BOINITI_STATU_ACTIO.EXIST( NUACTION, IONUCURRENTSTATUS );
      UT_TRACE.TRACE( 'IN_BOActionInterHisto.ResponseMessageBySendBatch 3 :' || INUINTERFACEMESSAGEID, 2 );
      IN_BOSTATUS_TRANSITION.GETNEXTSTATUS( INUINTERFACETYPE, NUACTION, IONUCURRENTSTATUS, TBTRANSITIONSTATUS );
      UT_TRACE.TRACE( 'IN_BOActionInterHisto.ResponseMessageBySendBatch 4 Respuesta en batch:' || INUINTERFACEMESSAGEID, 2 );
      IN_BOMESSAGECOMPOSERESPONSE.RESPONSEMESSAGESENDBATCH( INUINTERFACEMESSAGEID, ITYOBMESSAGESTRUCT, NUASSOCINTERHISTORYID, INUERRORCODEORIGIN, ISBERRORMESSAGEORIGIN, NUERRORCODEPROCESS, SBERRORMESSAGEPROCESS );
      UT_TRACE.TRACE( 'IN_BOActionInterHisto.ResponseMessageBySendBatch 5 Retorno de respuesta en batch:' || NUERRORCODEPROCESS || ' ' || SBERRORMESSAGEPROCESS, 2 );
      IN_BOINSTANCEGENERAL.SETERRORMESSAGE( NUERRORCODEPROCESS, SBERRORMESSAGEPROCESS );
      UT_TRACE.TRACE( 'IN_BOActionInterHisto.ResponseMessageBySendBatch 6 :', 2 );
      STATUSCONTROLERPROCESS( TBTRANSITIONSTATUS, NULL, NULL, INUINTERHISTOID, NULL, NUASSOCINTERHISTORYID, IONUCURRENTSTATUS );
      UT_TRACE.TRACE( 'IN_BOActionInterHisto.ResponseMessageBySendBatch 7 :', 1 );
    EXCEPTION
      WHEN EX.CONTROLLED_ERROR THEN
         ERRORS.GETERROR( ONUERRORCODE, OSBERRORMESSAGE );
         UT_TRACE.TRACE( 'IN_BOActionInterHisto.ResponseMessageBySendBatch CONTROLLED_ERROR 8 :' || ONUERRORCODE || ' ' || OSBERRORMESSAGE, 1 );
      WHEN OTHERS THEN
         ERRORS.SETERROR;
         ERRORS.GETERROR( ONUERRORCODE, OSBERRORMESSAGE );
         UT_TRACE.TRACE( 'IN_BOActionInterHisto.ResponseMessageBySendBatch OTHERS 9 :' || ONUERRORCODE || ' ' || OSBERRORMESSAGE, 1 );
   END;
   PROCEDURE RESPONSEMESSAGEBYCANCEL( INUINTERFACEMESSAGEID IN IN_INTERFACE_MESSAGE.INTERFACE_MESSAGE_ID%TYPE, INUINTERFACETYPE IN IN_INTERFACE_TYPE.INTERFACE_TYPE_ID%TYPE, ITYOBMESSAGESTRUCT IN OUT IN_TYOBMESSAGESTRUCT, IONUCURRENTSTATUS IN OUT IN_STATUS.STATUS_ID%TYPE, INUINTERHISTOID IN IN_INTERFACE_HISTORY.INTERFACE_HISTORY_ID%TYPE, INUERRORCODEORIGIN IN NUMBER, ISBERRORMESSAGEORIGIN IN VARCHAR2, ONUERRORCODE OUT NUMBER, OSBERRORMESSAGE OUT VARCHAR2 )
    IS
      NUASSOCINTERHISTORYID IN_INTERFACE_HISTORY.ASSOC_INTER_HISTO_ID%TYPE;
      NUACTION IN_STATUS_TRANSITION.ACTION_ID%TYPE;
      TBTRANSITIONSTATUS IN_BOSTATUS_TRANSITION.TYTBTRANSITIONSTATUS;
      BLEXECUTEEXPRESSION BOOLEAN := FALSE;
      ININDEX INTEGER;
      NUERRORCODEPROCESS NUMBER;
      SBERRORMESSAGEPROCESS VARCHAR2( 2000 );
    BEGIN
      UT_TRACE.TRACE( 'IN_BOActionInterHisto.ResponseMessageByCancel 1 :', 1 );
      INITIALIZEERRORMESSAGE( NUERRORCODEPROCESS, SBERRORMESSAGEPROCESS );
      INITIALIZEERRORMESSAGE( ONUERRORCODE, OSBERRORMESSAGE );
      NUACTION := IN_BOPARAMETER.FNUGETINT_QUE_HIS_CANCEL;
      IN_BOINSTANCEGENERAL.SETTRANSITION( NUACTION, IONUCURRENTSTATUS );
      UT_TRACE.TRACE( 'IN_BOActionInterHisto.ResponseMessageByCancel 2 Tipo Interfaz:' || INUINTERFACETYPE || ' Accion:' || NUACTION || ' Estado Current:' || IONUCURRENTSTATUS );
      IN_BOINITI_STATU_ACTIO.EXIST( NUACTION, IONUCURRENTSTATUS );
      UT_TRACE.TRACE( 'IN_BOActionInterHisto.ResponseMessageByCancel 3 :', 2 );
      IN_BOSTATUS_TRANSITION.GETNEXTSTATUS( INUINTERFACETYPE, NUACTION, IONUCURRENTSTATUS, TBTRANSITIONSTATUS );
      UT_TRACE.TRACE( 'IN_BOActionInterHisto.ResponseMessageByCancel 4 Genera el mensaje de respuesta:' || INUINTERFACEMESSAGEID, 2 );
      IN_BOMESSAGECOMPOSERESPONSE.RESPONSEMESSAGESEND( INUINTERFACEMESSAGEID, ITYOBMESSAGESTRUCT, NUASSOCINTERHISTORYID, INUERRORCODEORIGIN, ISBERRORMESSAGEORIGIN, NUERRORCODEPROCESS, SBERRORMESSAGEPROCESS );
      UT_TRACE.TRACE( 'IN_BOActionInterHisto.ResponseMessageByCancel 4 Retorno mensaje de respuesta:' || NUERRORCODEPROCESS || ' ' || SBERRORMESSAGEPROCESS, 2 );
      IN_BOINSTANCEGENERAL.SETERRORMESSAGE( NUERRORCODEPROCESS, SBERRORMESSAGEPROCESS );
      UT_TRACE.TRACE( 'IN_BOActionInterHisto.ResponseMessageByCancel 6 :', 2 );
      STATUSCONTROLERPROCESS( TBTRANSITIONSTATUS, NUERRORCODEPROCESS, SBERRORMESSAGEPROCESS, INUINTERHISTOID, NULL, NUASSOCINTERHISTORYID, IONUCURRENTSTATUS );
      UT_TRACE.TRACE( 'IN_BOActionInterHisto.ResponseMessageByCancel FIN 7 :', 1 );
    EXCEPTION
      WHEN EX.CONTROLLED_ERROR THEN
         ERRORS.GETERROR( ONUERRORCODE, OSBERRORMESSAGE );
         UT_TRACE.TRACE( 'IN_BOActionInterHisto.ResponseMessageByCancel CONTROLLED_ERRORS 8 :' || ONUERRORCODE || ' ' || OSBERRORMESSAGE, 1 );
      WHEN OTHERS THEN
         ERRORS.SETERROR;
         ERRORS.GETERROR( ONUERRORCODE, OSBERRORMESSAGE );
         UT_TRACE.TRACE( 'IN_BOActionInterHisto.ResponseMessageByCancel 9 OTHERS :' || ONUERRORCODE || ' ' || OSBERRORMESSAGE, 1 );
   END;
   PROCEDURE REPROCESSRESPONSE( INUINTERFACEMESSAGEID IN IN_INTERFACE_MESSAGE.INTERFACE_MESSAGE_ID%TYPE, INUINTERFACETYPE IN IN_INTERFACE_TYPE.INTERFACE_TYPE_ID%TYPE, ITYOBMESSAGESTRUCT IN OUT IN_TYOBMESSAGESTRUCT, IONUCURRENTSTATUS IN OUT IN_STATUS.STATUS_ID%TYPE, INUINTERHISTOID IN IN_INTERFACE_HISTORY.INTERFACE_HISTORY_ID%TYPE, INUERRORCODEORIGIN IN NUMBER, ISBERRORMESSAGEORIGIN IN VARCHAR2, ONUERRORCODE OUT NUMBER, OSBERRORMESSAGE OUT VARCHAR2 )
    IS
      NUASSOCINTERHISTORYID IN_INTERFACE_HISTORY.ASSOC_INTER_HISTO_ID%TYPE;
      NUACTION IN_STATUS_TRANSITION.ACTION_ID%TYPE;
      TBTRANSITIONSTATUS IN_BOSTATUS_TRANSITION.TYTBTRANSITIONSTATUS;
      BLEXECUTEEXPRESSION BOOLEAN := FALSE;
      ININDEX INTEGER;
      NUERRORCODEPROCESS NUMBER;
      SBERRORMESSAGEPROCESS VARCHAR2( 2000 );
    BEGIN
      UT_TRACE.TRACE( 'IN_BOActionInterHisto.ReProcessResponse 1 :', 1 );
      INITIALIZEERRORMESSAGE( NUERRORCODEPROCESS, SBERRORMESSAGEPROCESS );
      INITIALIZEERRORMESSAGE( ONUERRORCODE, OSBERRORMESSAGE );
      NUACTION := IN_BOPARAMETER.FNUGETINT_QUE_HIS_REP_RESP;
      IN_BOINSTANCEGENERAL.SETTRANSITION( NUACTION, IONUCURRENTSTATUS );
      UT_TRACE.TRACE( 'IN_BOActionInterHisto.ReProcessResponse 2 Tipo interfaz:' || INUINTERFACETYPE || ' Accion:' || NUACTION || ' EstadoCurrent:' || IONUCURRENTSTATUS, 2 );
      IN_BOINITI_STATU_ACTIO.EXIST( NUACTION, IONUCURRENTSTATUS );
      UT_TRACE.TRACE( 'IN_BOActionInterHisto.ReProcessResponse 3 :' || INUINTERFACEMESSAGEID, 2 );
      IN_BOSTATUS_TRANSITION.GETNEXTSTATUS( INUINTERFACETYPE, NUACTION, IONUCURRENTSTATUS, TBTRANSITIONSTATUS );
      UT_TRACE.TRACE( 'IN_BOActionInterHisto.ReProcessResponse 4 Envia mensaje de respuesta:', 2 );
      IN_BOMESSAGECOMPOSERESPONSE.RESPONSEMESSAGESEND( INUINTERFACEMESSAGEID, ITYOBMESSAGESTRUCT, NUASSOCINTERHISTORYID, INUERRORCODEORIGIN, ISBERRORMESSAGEORIGIN, NUERRORCODEPROCESS, SBERRORMESSAGEPROCESS );
      UT_TRACE.TRACE( 'IN_BOActionInterHisto.ReProcessResponse 6 retorno mensaje de respuesta :' || NUERRORCODEPROCESS || ' ' || SBERRORMESSAGEPROCESS, 2 );
      IN_BOINSTANCEGENERAL.SETERRORMESSAGE( NUERRORCODEPROCESS, SBERRORMESSAGEPROCESS );
      STATUSCONTROLERPROCESS( TBTRANSITIONSTATUS, NULL, NULL, INUINTERHISTOID, NULL, NUASSOCINTERHISTORYID, IONUCURRENTSTATUS );
      UT_TRACE.TRACE( 'IN_BOActionInterHisto.ReProcessResponse FIN 7 :', 1 );
    EXCEPTION
      WHEN EX.CONTROLLED_ERROR THEN
         ERRORS.GETERROR( ONUERRORCODE, OSBERRORMESSAGE );
         UT_TRACE.TRACE( 'IN_BOActionInterHisto.ReProcessResponse CONTROLLED_ERROR 8 :' || ONUERRORCODE || ' ' || OSBERRORMESSAGE, 1 );
      WHEN OTHERS THEN
         ERRORS.SETERROR;
         ERRORS.GETERROR( ONUERRORCODE, OSBERRORMESSAGE );
         UT_TRACE.TRACE( 'IN_BOActionInterHisto.ReProcessResponse OTHERS 9 :' || ONUERRORCODE || ' ' || OSBERRORMESSAGE, 1 );
   END;
END IN_BOACTIONINTERHISTO;
/


