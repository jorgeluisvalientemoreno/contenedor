PACKAGE PR_BCCertificate IS

















	

	

    















    CURSOR CULASTCERTIFREGISTER
    (
        INUPRODUCTID    IN  PR_CERTIFICATE.PRODUCT_ID%TYPE
    )
    IS
    SELECT  *
    FROM    (   SELECT  /*+ index(PR_CERTIFICATE IDX_PR_CERTIFICATE01 ) */
                        PR_CERTIFICATE.*, ROWID
                FROM    PR_CERTIFICATE
                WHERE   PR_CERTIFICATE.PRODUCT_ID = INUPRODUCTID
                ORDER BY PR_CERTIFICATE.REGISTER_DATE DESC ) CERTIF
    WHERE   ROWNUM = 1;

    
















    CURSOR CUGETLASTCERTIFICATE
    (
        INUPRODUCTID    IN  PR_CERTIFICATE.PRODUCT_ID%TYPE
    )
    IS
    SELECT  *
    FROM
        (SELECT  /*+ index(PR_CERTIFICATE, IDX_PR_CERTIFICATE01) */
                PR_CERTIFICATE.*, ROWID
        FROM    PR_CERTIFICATE
        WHERE   PR_CERTIFICATE.END_DATE IS NOT NULL
        AND     PR_CERTIFICATE.PRODUCT_ID = INUPRODUCTID
        ORDER BY PR_CERTIFICATE.END_DATE DESC ) CERTIFICATES
    WHERE   ROWNUM = 1;

    


















    CURSOR CUGETPRODUCTCERTIFICATE
    (
        INUPRODUCTID    IN  PR_CERTIFICATE.PRODUCT_ID%TYPE,
        IDTDATE         IN  PR_CERTIFICATE.END_DATE%TYPE
    )
    IS
    SELECT  /*+ index(PR_CERTIFICATE, IDX_PR_CERTIFICATE01) */
            PR_CERTIFICATE.*, ROWID
    FROM    PR_CERTIFICATE
    WHERE   PR_CERTIFICATE.ESTIMATED_END_DATE >= NVL(IDTDATE, SYSDATE)
    AND     PR_CERTIFICATE.END_DATE IS NULL
    AND     PR_CERTIFICATE.PRODUCT_ID = INUPRODUCTID;
    
    

















    CURSOR CUGETCERTIFEXPIRENEXT
    (
        INUSUBSCRIBERID IN  GE_SUBSCRIBER.SUBSCRIBER_ID%TYPE,
        INUADVANCEVALUE IN  NUMBER
    )
    IS
    SELECT  /*+ ordered
                index(SUSCRIPC IX_SUSCRIPC017)
                index(PR_PRODUCT IDX_PR_PRODUCT_010)
                index(PR_CERTIFICATE IDX_PR_CERTIFICATE01)
            */
            PR_CERTIFICATE.*
    FROM    SUSCRIPC,
            PR_PRODUCT,
            PR_CERTIFICATE

    WHERE   PR_CERTIFICATE.ESTIMATED_END_DATE BETWEEN SYSDATE AND (SYSDATE + 30*INUADVANCEVALUE)
    AND     PR_CERTIFICATE.END_DATE IS NULL
    AND     PR_CERTIFICATE.PRODUCT_ID = PR_PRODUCT.PRODUCT_ID
    AND     PR_PRODUCT.SUBSCRIPTION_ID = SUSCRIPC.SUSCCODI
    AND     SUSCRIPC.SUSCCLIE = INUSUBSCRIBERID;

    

















    CURSOR CUGETWITHOUTVALIDCERTIF
    (
        INUSUBSCRIBERID     IN  GE_SUBSCRIBER.SUBSCRIBER_ID%TYPE,
        INUPRODUCTTYPEID    IN  PR_PRODUCT.PRODUCT_TYPE_ID%TYPE
    )
    IS
    SELECT  /*+ ordered
                index(SUSCRIPC IX_SUSCRIPC017)
                index(PR_PRODUCT IDX_PR_PRODUCT_010)
                index(PS_PRODUCT_STATUS PK_PS_PRODUCT_STATUS)
                use_nl(PR_PRODUCT PS_PRODUCT_STATUS)
            */
            PR_PRODUCT.*
    FROM    SUSCRIPC,
            PR_PRODUCT,
            PS_PRODUCT_STATUS
    WHERE   PS_PRODUCT_STATUS.IS_ACTIVE_PRODUCT = GE_BOCONSTANTS.CSBYES
    AND     PS_PRODUCT_STATUS.PRODUCT_STATUS_ID = PR_PRODUCT.PRODUCT_STATUS_ID
    AND     PR_PRODUCT.PRODUCT_STATUS_ID <>  PR_BOCONSTANTS.CNUPRODUCT_INSTALL_PENDING
    AND     PR_PRODUCT.PRODUCT_TYPE_ID = INUPRODUCTTYPEID
    AND     PR_PRODUCT.SUBSCRIPTION_ID = SUSCRIPC.SUSCCODI
    AND     SUSCRIPC.SUSCCLIE = INUSUBSCRIBERID
    MINUS
    SELECT  /*+ ordered
                index(SUSCRIPC IX_SUSCRIPC017)
                index(PR_PRODUCT IDX_PR_PRODUCT_010)
                index(PS_PRODUCT_STATUS PK_PS_PRODUCT_STATUS)
                index(PR_CERTIFICATE IDX_PR_CERTIFICATE01)
                use_nl(PR_PRODUCT PS_PRODUCT_STATUS)
            */
            PR_PRODUCT.*
    FROM    SUSCRIPC,
            PR_PRODUCT,
            PS_PRODUCT_STATUS,
            PR_CERTIFICATE
    WHERE   PR_CERTIFICATE.END_DATE IS NULL
    AND     PR_CERTIFICATE.ESTIMATED_END_DATE > SYSDATE
    AND     PR_CERTIFICATE.PRODUCT_ID = PR_PRODUCT.PRODUCT_ID
    AND     PS_PRODUCT_STATUS.IS_ACTIVE_PRODUCT = GE_BOCONSTANTS.CSBYES
    AND     PS_PRODUCT_STATUS.PRODUCT_STATUS_ID = PR_PRODUCT.PRODUCT_STATUS_ID
    AND     PR_PRODUCT.PRODUCT_STATUS_ID <>  PR_BOCONSTANTS.CNUPRODUCT_INSTALL_PENDING
    AND     PR_PRODUCT.PRODUCT_TYPE_ID = INUPRODUCTTYPEID
    AND     PR_PRODUCT.SUBSCRIPTION_ID = SUSCRIPC.SUSCCODI
    AND     SUSCRIPC.SUSCCLIE = INUSUBSCRIBERID;

	

    
    FUNCTION FSBVERSION  RETURN VARCHAR2;
    
    



    FUNCTION FBLISCERTIFIEDPRODUCT(INUPRODUCTID    IN  PR_PRODUCT.PRODUCT_ID%TYPE)
    RETURN BOOLEAN;

END PR_BCCERTIFICATE;