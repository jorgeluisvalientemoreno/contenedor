
CREATE OR REPLACE PACKAGE CM_UIACTMETODOANALISIS IS
   FUNCTION FSBVERSION
    RETURN VARCHAR2;
   PROCEDURE ACTMETODOANALISIS;
END CM_UIACTMETODOANALISIS;
/


CREATE OR REPLACE PACKAGE BODY CM_UIACTMETODOANALISIS IS
   CSBVERSION CONSTANT VARCHAR2( 250 ) := 'SAO91016';
   GCNUATRIBUTONULO CONSTANT GE_MESSAGE.MESSAGE_ID%TYPE := 2126;
   GCNUNIVELTRAZA CONSTANT NUMBER := 1;
   SBMENSAJEERROR GE_ERROR_LOG.DESCRIPTION%TYPE;
   FUNCTION FSBVERSION
    RETURN VARCHAR2
    IS
    BEGIN
      PKERRORS.PUSH( 'CM_UIActMetodoAnalisis.fsbVersion' );
      PKERRORS.POP;
      RETURN CSBVERSION;
    EXCEPTION
      WHEN LOGIN_DENIED THEN
         PKERRORS.POP;
         RAISE LOGIN_DENIED;
      WHEN PKCONSTANTE.EXERROR_LEVEL2 THEN
         PKERRORS.POP;
         RAISE PKCONSTANTE.EXERROR_LEVEL2;
      WHEN OTHERS THEN
         PKERRORS.NOTIFYERROR( PKERRORS.FSBLASTOBJECT, SQLERRM, SBMENSAJEERROR );
         PKERRORS.POP;
         RAISE_APPLICATION_ERROR( PKCONSTANTE.NUERROR_LEVEL2, SBMENSAJEERROR );
   END FSBVERSION;
   PROCEDURE ACTMETODOANALISIS
    IS
      SBENTIDAD GE_ENTITY.NAME_%TYPE;
      SBSESUNUSE GE_BOINSTANCECONTROL.STYSBVALUE;
      SBSESUSUSC GE_BOINSTANCECONTROL.STYSBVALUE;
      SBSESUSERV GE_BOINSTANCECONTROL.STYSBVALUE;
      SBSESUMECV GE_BOINSTANCECONTROL.STYSBVALUE;
      SBMAVCCODI GE_BOINSTANCECONTROL.STYSBVALUE;
      RCREGISTRO SERVSUSC%ROWTYPE;
      PROCEDURE INICIALIZAR
       IS
       BEGIN
         UT_TRACE.TRACE( '[CM_UIActMetodoAnalisis.ActMetodoAnalisis.Inicializar] INICIO', GCNUNIVELTRAZA );
         SBENTIDAD := 'SERVSUSC';
         SBSESUNUSE := GE_BOINSTANCECONTROL.FSBGETFIELDVALUE( SBENTIDAD, 'SESUNUSE' );
         SBSESUSUSC := GE_BOINSTANCECONTROL.FSBGETFIELDVALUE( SBENTIDAD, 'SESUSUSC' );
         SBSESUSERV := GE_BOINSTANCECONTROL.FSBGETFIELDVALUE( SBENTIDAD, 'SESUSERV' );
         SBSESUMECV := GE_BOINSTANCECONTROL.FSBGETFIELDVALUE( SBENTIDAD, 'SESUMECV' );
         SBMAVCCODI := GE_BOINSTANCECONTROL.FSBGETFIELDVALUE( 'MEANVACO', 'MAVCCODI' );
         UT_TRACE.TRACE( '[sbSESUNUSE: ' || SBSESUNUSE || ' ]', GCNUNIVELTRAZA );
         UT_TRACE.TRACE( '[sbSESUSUSC: ' || SBSESUSUSC || ' ]', GCNUNIVELTRAZA );
         UT_TRACE.TRACE( '[sbSESUSERV: ' || SBSESUSERV || ' ]', GCNUNIVELTRAZA );
         UT_TRACE.TRACE( '[sbSESUMECV: ' || SBSESUMECV || ' ]', GCNUNIVELTRAZA );
         UT_TRACE.TRACE( '[sbMAVCCODI: ' || SBMAVCCODI || ' ]', GCNUNIVELTRAZA );
         UT_TRACE.TRACE( '[CM_UIActMetodoAnalisis.ActMetodoAnalisis.Inicializar] FIN', GCNUNIVELTRAZA );
       EXCEPTION
         WHEN EX.CONTROLLED_ERROR THEN
            RAISE;
         WHEN OTHERS THEN
            ERRORS.SETERROR;
            RAISE EX.CONTROLLED_ERROR;
      END INICIALIZAR;
      PROCEDURE VALIDARDATOS
       IS
       BEGIN
         UT_TRACE.TRACE( '[CM_UIActMetodoAnalisis.ActMetodoAnalisis.ValidarDatos] INICIO', GCNUNIVELTRAZA );
         IF ( SBSESUNUSE IS NULL ) THEN
            ERRORS.SETERROR( GCNUATRIBUTONULO, 'Numero de Producto' );
            RAISE EX.CONTROLLED_ERROR;
         END IF;
         UT_TRACE.TRACE( '[CM_UIActMetodoAnalisis.ActMetodoAnalisis.ValidarDatos] FIN', GCNUNIVELTRAZA );
       EXCEPTION
         WHEN EX.CONTROLLED_ERROR THEN
            RAISE;
         WHEN OTHERS THEN
            ERRORS.SETERROR;
            RAISE EX.CONTROLLED_ERROR;
      END VALIDARDATOS;
    BEGIN
      UT_TRACE.TRACE( '[CM_UIActMetodoAnalisis.ActMetodoAnalisis] INICIO', GCNUNIVELTRAZA );
      INICIALIZAR;
      VALIDARDATOS;
      RCREGISTRO := PKTBLSERVSUSC.FRCGETRECORD( TO_NUMBER( SBSESUNUSE ) );
      RCREGISTRO.SESUMECV := TO_NUMBER( SBMAVCCODI );
      PKTBLSERVSUSC.UPRECORD( RCREGISTRO );
      COMMIT;
      UT_TRACE.TRACE( '[CM_UIActMetodoAnalisis.ActMetodoAnalisis] FIN', GCNUNIVELTRAZA );
    EXCEPTION
      WHEN EX.CONTROLLED_ERROR THEN
         RAISE;
      WHEN OTHERS THEN
         ERRORS.SETERROR;
         RAISE EX.CONTROLLED_ERROR;
   END ACTMETODOANALISIS;
END CM_UIACTMETODOANALISIS;
/


